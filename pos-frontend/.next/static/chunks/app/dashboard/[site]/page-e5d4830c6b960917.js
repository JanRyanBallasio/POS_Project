(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[759],{44720:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>tH});var r=a(95155),l=a(12115),n=a(36764),s=a(47943);let i=(0,l.createContext)(void 0),o=(e,t)=>(null==e?void 0:e.id)&&(null==t?void 0:t.id)?e.id===t.id:!!((null==e?void 0:e.barcode)&&(null==t?void 0:t.barcode)&&e.barcode===t.barcode),c=e=>{let{children:t}=e,[a,c]=(0,l.useState)([]),[d,u]=(0,l.useState)(null),[m,x]=(0,l.useState)(!1),[h,p]=(0,l.useState)(null),[f,g]=(0,l.useState)(null),[v,j]=(0,l.useState)(new Set),b=(0,l.useRef)(new Map),{setBarcode:y,openModal:w,setOpen:N}=(0,s.c)(),C=(0,l.useCallback)(()=>{c([]),p(null),b.current=new Map},[]),S=(0,l.useCallback)(e=>{g(e)},[]),k=(0,l.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if(!(null==f?void 0:f.current))return;let s=document.activeElement;if(!e&&s){var t,a,r,l,n;let e=s.tagName,i="INPUT"===e||"TEXTAREA"===e||!0===s.isContentEditable,o=(null==(t=s.getAttribute)?void 0:t.call(s,"data-product-search"))==="true"||String(s.placeholder||"").toLowerCase().includes("search by product"),c=(null==(a=s.getAttribute)?void 0:a.call(s,"data-customer-search"))==="true"||String(s.placeholder||"").toLowerCase().includes("search name"),d=!!(null==(r=s.getAttribute)?void 0:r.call(s,"data-cart-price-input")),u=!!(null==(l=s.getAttribute)?void 0:l.call(s,"data-cart-qty-input")),m=(null==(n=s.getAttribute)?void 0:n.call(s,"data-pos-cash-input"))==="true"||s.getAttribute&&"0.00"===s.getAttribute("placeholder");if(i&&(o||c||d||u||m))return}requestAnimationFrame(()=>{try{var e,t,a;null==f||null==(e=f.current)||e.focus(),null==f||null==(a=f.current)||null==(t=a.select)||t.call(a)}catch(e){}})}catch(e){}},[f]),E=(0,l.useCallback)(e=>{let t=null;if(a&&a.length>0){let n=a.findIndex(t=>t.id===e);if(a.length>1)if(n>0)t=a[n-1].id;else{var r,l;t=null!=(l=null==(r=a[1])?void 0:r.id)?l:null}else t=null}c(t=>t.filter(t=>t.id!==e)),p(t=>t===e?null:t);try{window.dispatchEvent(new CustomEvent("cart:item-deleted",{detail:{deletedId:e,nextSelectedId:t}}))}catch(e){}k(!0)},[a,k]),A=(0,l.useCallback)((e,t)=>{c(a=>a.map(a=>a.id===e?{...a,quantity:Math.max(1,Number(t)||1)}:a))},[]),L=(0,l.useCallback)((e,t)=>{c(a=>a.map(a=>a.id===e?{...a,product:{...a.product,price:Number(isFinite(Number(t))?t:0)}}:a))},[]),P=(0,l.useCallback)(e=>{var t;let a=Date.now(),r=e.barcode||(null==(t=e.id)?void 0:t.toString())||e.name,l=b.current.get(r);l&&a-l<1e3||(b.current.set(r,a),c(t=>{let a=t.find(t=>o(t.product,e));if(a)return p(a.id),t.map(t=>o(t.product,e)?{...t,quantity:t.quantity+1}:t);let r={product:e,quantity:1,id:"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():Date.now().toString()};return p(r.id),[r,...t]}))},[]),_=(0,l.useCallback)(e=>{P(e)},[P]),D=(0,l.useCallback)(async(e,t)=>{if(!e)return;let a=String(e).replace(/[\u0000-\u001F\u007F-\u009F]/g,"").trim();if(!a)return void u("Invalid barcode");if(!v.has(a))try{x(!0),u(null),j(e=>new Set([...e,a]));let e=null;if(t)e=t;else try{e=await n.G.getByBarcode(a)}catch(t){e=null}if(e)P(e),u(null);else{P({id:"pending-".concat(a),name:"Loading product...",barcode:a,price:0,quantity:0,category_id:0,__placeholder:!0});try{"function"==typeof y&&y(a),"function"==typeof w?w("addProduct"):"function"==typeof N&&N(!0)}catch(e){}u("Product not found: ".concat(a))}}catch(e){u(e instanceof Error?e.message:"Error scanning barcode"),console.warn("[scanAndAddToCart] Error:",e)}finally{j(e=>{let t=new Set(e);return t.delete(a),t}),x(!1),requestAnimationFrame(()=>k(!0))}},[v,w,N,y,k,P]);(0,l.useEffect)(()=>{let e=e=>{let t=null==e?void 0:e.detail;if(!t)return;let a=t.product,r=t.barcode;a?P(a):r&&(async()=>{try{let e=await n.G.getByBarcode(r);e&&P(e)}catch(e){}})();try{let e=null==f?void 0:f.current;if(e){try{e.value=""}catch(e){}e.dispatchEvent(new Event("input",{bubbles:!0}));try{e.focus()}catch(e){}}}catch(e){}};return window.addEventListener("product:added",e),()=>window.removeEventListener("product:added",e)},[f,P]);let z=(0,l.useMemo)(()=>a.reduce((e,t)=>e+Number(t.product.price||0)*t.quantity,0),[a]),F=(0,l.useMemo)(()=>({cart:a,cartTotal:z,scanError:d,isScanning:m,lastAddedItemId:h,scanAndAddToCart:D,addProductToCart:_,refocusScanner:k,setScannerRef:S,updateCartItemQuantity:A,updateCartItemPrice:L,deleteCartItem:E,clearCart:C}),[a,z,d,m,h,D,_,k,S,A,L,E,C]);return(0,r.jsx)(i.Provider,{value:F,children:t})},d=()=>{let e=(0,l.useContext)(i);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e};var u=a(64269);function m(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,u.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function x(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,u.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function h(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,u.cn)("leading-none font-semibold",t),...a})}function p(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,u.cn)("text-muted-foreground text-sm",t),...a})}function f(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-action",className:(0,u.cn)("col-start-2 row-span-2 row-start-1 self-start justify-self-end",t),...a})}function g(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,u.cn)("px-6",t),...a})}function v(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-footer",className:(0,u.cn)("flex items-center px-6 [.border-t]:pt-6",t),...a})}var j=a(3998),b=a(12466),y=a(65142),w=a(76444);function N(e){let{amount:t,setAmount:a,cartTotal:n,refocusScanner:s,onNext:i,cartIsEmpty:o=!1}=e,c=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=()=>{try{c.current&&!o&&(c.current.focus(),c.current.select())}catch(e){}};return window.addEventListener("focusCashInput",e),()=>window.removeEventListener("focusCashInput",e)},[o]);let d=e=>{if("C"===e)a("");else if("⌫"===e)a(t.slice(0,-1));else{if("."===e&&t.includes("."))return;a(t+e)}s()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w.J,{className:"text-lg mb-2 font-medium",children:"Cash"}),(0,r.jsx)(y.p,{ref:c,"data-pos-cash-input":"true",className:"h-20 !text-5xl text-right font-medium mb-6 border-2 border-gray-300 shadow-sm placeholder:text-5xl placeholder:font-medium placeholder:text-gray-400",value:t,onChange:e=>{a(e.target.value),setTimeout(s,3e3)},onKeyDown:e=>{if(e.ctrlKey&&"Enter"===e.key){e.preventDefault(),e.stopPropagation();return}"Enter"!==e.key||e.ctrlKey||e.target!==c.current||(e.preventDefault(),e.stopPropagation(),window.dispatchEvent(new CustomEvent("pos:step-1-complete")))},onClick:e=>{e.stopPropagation(),c.current&&c.current.focus()},placeholder:"0.00",onBlur:s,disabled:o}),(0,r.jsxs)("div",{className:"flex-1 grid grid-cols-3 gap-2 bg-gray-50 p-3 rounded-lg",children:[[7,8,9,4,5,6,1,2,3].map(e=>(0,r.jsx)(j.$,{onClick:()=>d(e.toString()),variant:"outline",className:"h-16 text-2xl font-medium",disabled:o,children:e},e)),(0,r.jsx)(j.$,{onClick:()=>d("."),variant:"outline",className:"h-16 text-2xl font-medium",disabled:o,children:"."}),(0,r.jsx)(j.$,{onClick:()=>d("0"),variant:"outline",className:"h-16 text-2xl font-medium",disabled:o,children:"0"}),(0,r.jsx)(j.$,{onClick:()=>d("⌫"),variant:"outline",className:"h-16 text-2xl font-medium",disabled:o,children:"⌫"}),(0,r.jsx)(j.$,{onClick:()=>d("C"),variant:"outline",className:"h-16 text-2xl font-medium col-span-3",disabled:o,children:"Clear"})]}),(0,r.jsx)("div",{className:"px-4 pb-4 pt-4",children:(0,r.jsxs)(j.$,{className:"w-full h-14 text-xl font-medium",onClick:i,disabled:o||!t||parseFloat(t)<n,children:["Next ",(0,r.jsx)("span",{className:"ml-2 text-sm opacity-75",children:"(Ctrl+Enter)"})]})})]})}var C=a(20508),S=a(42529),k=a(6191);function E(e){let{customerQuery:t,setCustomerQuery:a,filteredCustomers:n,selectedCustomer:s,selectCustomer:i,clearCustomer:o,onAddCustomer:c}=e,d=(0,l.useId)(),u=(0,l.useRef)(null),m=1===n.length&&t.trim().length>=2&&!s;(0,l.useEffect)(()=>{let e=e=>{e.ctrlKey&&"c"===e.key.toLowerCase()&&(e.preventDefault(),e.stopPropagation(),u.current&&(u.current.focus(),u.current.select()))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]);let x=e=>{i(e),window.customerSearchActive=!1,u.current&&u.current.blur()};return(0,r.jsxs)("div",{className:"w-full mb-4",onClick:e=>{e.stopPropagation()},"data-customer-search":"true",children:[(0,r.jsxs)(w.J,{htmlFor:d,className:"mb-2 block",children:["Customer Name ",(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"(Ctrl+C)"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-400",children:(0,r.jsx)(C.A,{className:"w-4 h-4"})}),(0,r.jsx)(y.p,{ref:u,id:d,className:"pl-9 pr-10",placeholder:"Search Name (Ctrl+C to focus)",value:t,onChange:e=>{console.log("\uD83D\uDCDD CustomerSearch: Input changed to:",e.target.value),e.stopPropagation(),a(e.target.value),s&&o()},onKeyDown:e=>{if(e.stopPropagation(),e.ctrlKey){if("c"===e.key.toLowerCase())return;e.preventDefault();return}if("Enter"===e.key){if(n.length>0&&!s){e.preventDefault(),x(n[0]);return}if(s){e.preventDefault(),u.current&&u.current.blur(),window.customerSearchActive=!1;return}}},onFocus:e=>{window.customerSearchActive=!0,e.target.select()},onBlur:e=>{window.customerSearchActive=!1},onClick:e=>{e.stopPropagation(),u.current&&u.current.focus()},autoComplete:"off","data-customer-search":"true"}),m&&(0,r.jsx)(S.A,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-green-500 animate-pulse",size:16}),t&&!s&&(0,r.jsxs)("div",{className:"absolute z-10 left-0 right-0 bg-white border rounded shadow max-h-40 overflow-y-auto top-full mt-1",children:[0===n.length&&(0,r.jsx)("div",{className:"p-2 text-gray-500 text-center",children:"No results"}),n.map(e=>(0,r.jsxs)("div",{className:"p-2 hover:bg-gray-100 cursor-pointer flex justify-between ".concat(m?"bg-green-50 border-green-200":""),onClick:()=>x(e),children:[(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[e.name,m&&(0,r.jsx)("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full",children:"Auto-selecting..."})]}),(0,r.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:[e.points," pts"]})]},e.id))]})]}),(0,r.jsxs)(j.$,{type:"button",onClick:e=>{e.stopPropagation(),c()},className:"ml-2",children:[(0,r.jsx)(k.A,{className:"w-4 h-4 mr-1"})," Add"]})]})]})}function A(e){let{amount:t,cartTotal:a,change:l}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"py-5 border-t border-b",children:[(0,r.jsxs)("div",{className:"flex justify-between text-xl mb-3",children:[(0,r.jsx)("span",{children:"Amount Paid:"}),(0,r.jsxs)("span",{className:"font-medium",children:["₱ ",parseFloat(t).toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-xl mb-3",children:[(0,r.jsx)("span",{children:"Total:"}),(0,r.jsxs)("span",{className:"font-medium",children:["₱ ",a.toFixed(2)]})]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-3xl font-bold pt-5",children:[(0,r.jsx)("span",{children:"Change:"}),(0,r.jsxs)("span",{children:["₱ ",l.toFixed(2)]})]})]})}function L(e){let{selectedCustomer:t,cartTotal:a}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center flex-1",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold mb-4",children:"Transaction Successful!"}),(0,r.jsx)("p",{className:"mb-4",children:"Thank you for your purchase."})]})}var P=a(51834);function _(e){let{open:t,onOpenChange:a,onCustomerAdded:n}=e,[s,i]=(0,l.useState)(""),[o,c]=(0,l.useState)(!1),[d,u]=(0,l.useState)(!1),[m,x]=(0,l.useState)(null);(0,l.useEffect)(()=>{t||(i(""),x(null),c(!1),u(!1))},[t]);let h=e=>e.trim().toLowerCase(),p=async e=>{if(!e)return x(null),!0;u(!0);try{var t,a,r;let l=await b.A.get("/customers",{params:{name:e}}),n=null!=(r=null!=(a=null==l||null==(t=l.data)?void 0:t.data)?a:null==l?void 0:l.data)?r:[];if(Array.isArray(n)&&n.some(t=>{var a,r;let l=null!=(r=null!=(a=null==t?void 0:t.name)?a:null==t?void 0:t.full_name)?r:"";return h(l)===h(e)}))return x("A customer with this name already exists."),!1;return x(null),!0}catch(e){return console.warn("Customer validation failed:",e),x(null),!0}finally{u(!1)}},f=async()=>{let e=s.trim();if(0===e.length)return void x("Name cannot be empty.");if(await p(e)){c(!0);try{var t;let r=(await b.A.get("/customers",{params:{name:e}})).data;if((Array.isArray(r)?r:Array.isArray(null==r?void 0:r.data)?r.data:[]).some(t=>!!t&&"string"==typeof t.name&&h(t.name)===h(e))){x("A customer with this name already exists."),c(!1);return}let l=await b.A.post("/customers",{name:e}),s=l.data;if(l.status>=400||(null==s?void 0:s.success)===!1){let e=(null==s?void 0:s.message)||(null==s?void 0:s.error)||"Failed to add customer";throw Error(e)}let o=null!=(t=null==s?void 0:s.data)?t:s;i(""),a(!1),n(o)}catch(e){x((null==e?void 0:e.message)||"Failed to add customer")}finally{c(!1)}}},g=o||d||!!m||0===s.trim().length;return(0,r.jsx)(P.lG,{open:t,onOpenChange:a,children:(0,r.jsx)(P.Cf,{"data-add-customer-modal":"true",children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),f()},children:[(0,r.jsx)(P.c7,{children:(0,r.jsx)(P.L3,{className:"mb-2",children:"Add Customer"})}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(w.J,{htmlFor:"add-customer-name",children:"Name"}),(0,r.jsx)(y.p,{id:"add-customer-name",autoFocus:!0,value:s,onChange:e=>{i(e.target.value),m&&x(null)},onBlur:()=>{let e=s.trim();e&&p(e)}}),m&&(0,r.jsx)("span",{className:"text-red-500 text-sm",children:m}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)(j.$,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancel"}),(0,r.jsx)(j.$,{type:"submit",disabled:g,children:o?"Adding...":"Add"})]})]})]})})})}function D(e){let{step:t,setStep:n}=e,{cart:s,cartTotal:i,refocusScanner:o,clearCart:c}=d(),[u,x]=(0,l.useState)(""),[h,p]=(0,l.useState)(0),[f,y]=(0,l.useState)(!1),[w,C]=(0,l.useState)(!1);(0,l.useEffect)(()=>{p((parseFloat(u)||0)-i)},[u,i]);let{customerQuery:S,setCustomerQuery:k,filteredCustomers:P,selectedCustomer:D,selectCustomer:z,clearCustomer:F,allCustomers:M,setAllCustomers:q}=function(e){let[t,a]=(0,l.useState)(""),[r,n]=(0,l.useState)([]),[s,i]=(0,l.useState)([]),[o,c]=(0,l.useState)(null),d=(0,l.useCallback)(async()=>{try{let e=(await b.A.get("/customers")).data;e&&e.success&&Array.isArray(e.data)?n(e.data):n([])}catch(e){n([])}},[]);(0,l.useEffect)(()=>{d()},[d]),(0,l.useEffect)(()=>{i(r.filter(e=>{var a;return null==(a=e.name)?void 0:a.toLowerCase().includes(t.toLowerCase())}))},[t,r]),(0,l.useEffect)(()=>{if(1===s.length&&t.trim().length>=2&&e&&!o){let t=setTimeout(()=>{let t=s[0];console.log("\uD83C\uDFAF useCustomerTagging: About to auto-select customer:",t.name),e(t),u(t),a(t.name),setTimeout(()=>{console.log("\uD83C\uDFAF useCustomerTagging: Clearing global flag after auto-selection"),window.customerSearchActive=!1},200)},800);return()=>clearTimeout(t)}},[s,t,e,o]);let u=e=>{c(e),a(e.name),setTimeout(()=>{window.customerSearchActive=!1},100)};return{customerQuery:t,setCustomerQuery:a,filteredCustomers:s,selectedCustomer:o,selectCustomer:u,clearCustomer:()=>{console.log("\uD83E\uDDF9 useCustomerTagging: Clearing customer data"),c(null),a(""),window.customerSearchActive=!1},fetchCustomers:d,allCustomers:r,setAllCustomers:n}}((0,l.useCallback)(e=>{z(e),k(e.name)},[])),T=(0,l.useCallback)(()=>{let e=parseFloat(u)||0;e>=i?(p(e-i),n(2)):alert("Insufficient amount")},[u,i,n]),I=(0,l.useCallback)(async()=>{var e,t,a;if(!w&&0!==s.length)try{C(!0);let t={customer_id:(null==D?void 0:D.id)||null,total_purchase:i,items:s.map(e=>({product_id:e.product.id,quantity:e.quantity,price:e.product.price}))};await b.A.post("/sales",t);try{let t=await b.A.get("/customers");(null==(e=t.data)?void 0:e.success)&&Array.isArray(t.data.data)&&q(t.data.data)}catch(e){console.warn("Failed to refresh customer data:",e)}F(),n(1),x(""),p(0),c(),window.customerSearchActive=!1,setTimeout(()=>{o()},100)}catch(e){alert("Error saving sale: "+((null==(a=e.response)||null==(t=a.data)?void 0:t.error)||e.message||"Unknown error"))}finally{C(!1)}},[s,D,i,F,c,o,w,q]),R=(0,l.useCallback)(async()=>{if(w)return;let e=s.map(e=>{var t,a,r,l,n;return{desc:null!=(n=null!=(l=null==(t=e.product)?void 0:t.name)?l:null==(a=e.product)?void 0:a.barcode)?n:"Item",qty:Number(e.quantity||0),amount:Number((((null==(r=e.product)?void 0:r.price)||0)*e.quantity).toFixed(2))}}),t={customer:D||{name:"N/A"},cartTotal:Number(i||0),amount:Number(parseFloat(u)||i||0),change:Number(h||0),items:e};try{C(!0);let e=(await b.A.post("/receipt",t,{responseType:"blob"})).data,r=URL.createObjectURL(e);try{let e=(await a.e(62).then(a.t.bind(a,65062,23))).default;if(e)return void e({printable:r,type:"pdf",showModal:!1,onError:e=>alert("Print error: "+e),onLoadingEnd:()=>setTimeout(()=>URL.revokeObjectURL(r),1e4)})}catch(e){console.warn("print-js import failed, falling back to window.open",e)}try{window.open(r,"_blank"),setTimeout(()=>URL.revokeObjectURL(r),1e4)}catch(e){console.warn("Failed to open PDF in new tab:",e),setTimeout(()=>URL.revokeObjectURL(r),1e4)}}catch(e){var r,l;alert("Error printing receipt: "+((null==(l=e.response)||null==(r=l.data)?void 0:r.error)||e.message||"Unknown error"))}finally{C(!1)}},[s,D,i,u,h,w]);(0,l.useCallback)(()=>{try{window.print()}catch(e){console.warn("Print PDF failed:",e)}},[]);let K=(0,l.useCallback)(e=>{try{q(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[...t,e]}),y(!1),"function"==typeof z&&z(e)}catch(e){console.warn("handleCustomerAdded error:",e)}},[q,z]),$=(0,l.useCallback)(()=>{try{o()}catch(e){console.warn("handleCardClick error:",e)}},[o]),O=(0,l.useCallback)(()=>{var e,a;if(console.log("\uD83D\uDD25 RightColumn handlePosNext triggered:",{step:t,isProcessingSale:w,customerSearchActive:window.customerSearchActive,activeElement:document.activeElement,activeElementTag:null==(e=document.activeElement)?void 0:e.tagName}),w)return void console.log("❌ RightColumn: Processing sale, ignoring");if(2===t){console.log("✅ RightColumn: Step 2 -> Step 3 (forced bypass of customer-search guard)"),n(3);return}if(window.customerSearchActive)return void console.log("❌ RightColumn: Customer search globally active, ignoring");let r=document.activeElement;if(r&&("true"===r.getAttribute("data-customer-search")||(null==(a=r.placeholder)?void 0:a.toLowerCase().includes("search name"))||null!==r.closest("[data-customer-search]")))return void console.log("❌ RightColumn: Customer search active, ignoring");if(1===t)return void T();if(3===t){console.log("✅ RightColumn: Step 3 -> New Transaction"),I();return}},[t,w,I,T,n]);return(0,l.useEffect)(()=>(console.log("\uD83C\uDFAF RightColumn: Adding pos:next-step listener for step",t),window.addEventListener("pos:next-step",O),()=>{console.log("\uD83D\uDDD1️ RightColumn: Removing pos:next-step listener for step",t),window.removeEventListener("pos:next-step",O)}),[O,t]),(0,l.useEffect)(()=>{let e=e=>{2===t&&n(1)};return window.addEventListener("pos:step-1-back",e),()=>window.removeEventListener("pos:step-1-back",e)},[t,n]),(0,l.useEffect)(()=>{let e=e=>{y(!0)};return window.addEventListener("customer:add",e),()=>window.removeEventListener("customer:add",e)},[y]),(0,l.useEffect)(()=>{let e=e=>{3!==t||!e.shiftKey||e.ctrlKey||e.altKey||"p"!==e.key.toLowerCase()||(e.preventDefault(),e.stopPropagation(),R())};return document.addEventListener("keydown",e,{capture:!0}),()=>document.removeEventListener("keydown",e,{capture:!0})},[t,R]),(0,l.useEffect)(()=>{let e=e=>{1===t&&O()},a=e=>{2===t&&O()},r=e=>{3===t&&I()};return window.addEventListener("pos:step-1-complete",e),window.addEventListener("pos:step-2-complete",a),window.addEventListener("pos:step-3-complete",r),()=>{window.removeEventListener("pos:step-1-complete",e),window.removeEventListener("pos:step-2-complete",a),window.removeEventListener("pos:step-3-complete",r)}},[t,O]),(0,r.jsx)(m,{className:"h-full flex flex-col",onClick:$,children:(0,r.jsxs)(g,{className:"flex-1 flex flex-col p-4 pb-0",children:[(0,r.jsx)("h1",{className:"text-xl font-medium",children:"Total"}),(0,r.jsx)("div",{className:"w-full py-3 mb-2",children:(0,r.jsxs)("div",{className:"flex justify-between text-5xl font-medium",children:[(0,r.jsx)("h1",{children:"₱"}),(0,r.jsx)("h1",{children:i.toFixed(2)})]})}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col",children:[1===t&&(0,r.jsx)(N,{amount:u,setAmount:x,cartTotal:i,refocusScanner:o,onNext:T,cartIsEmpty:0===s.length}),2===t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(A,{amount:u,cartTotal:i,change:h}),(0,r.jsx)("div",{className:"flex-1"}),(0,r.jsx)(E,{customerQuery:S,setCustomerQuery:k,filteredCustomers:P,selectedCustomer:D,selectCustomer:z,clearCustomer:F,onAddCustomer:()=>y(!0)}),(0,r.jsx)(_,{open:f,onOpenChange:y,onCustomerAdded:K}),(0,r.jsxs)(v,{className:"px-4 pb-4 pt-4 flex flex-col gap-3",children:[(0,r.jsx)(j.$,{className:"w-full h-14 text-xl font-medium",variant:"outline",onClick:()=>n(1),disabled:w,children:"Back"}),(0,r.jsxs)(j.$,{className:"w-full h-14 text-xl font-medium",onClick:()=>n(3),disabled:w,children:["Finish Transaction ",(0,r.jsx)("span",{className:"ml-2 text-sm opacity-75",children:"(Ctrl+Enter)"})]})]})]}),3===t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L,{selectedCustomer:D,cartTotal:i}),(0,r.jsxs)(v,{className:"px-4 pb-4 pt-4 flex flex-col gap-2",children:[(0,r.jsx)(j.$,{className:"w-full h-14 text-xl font-medium",onClick:R,disabled:w,children:w?"Processing...":"Print Receipt"}),(0,r.jsxs)(j.$,{className:"w-full h-14 text-xl font-medium",variant:"outline",onClick:I,disabled:w,children:["Close ",(0,r.jsx)("span",{className:"ml-2 text-sm opacity-75",children:"(Ctrl+Enter)"})]})]})]})]})]})})}var z=a(5917),F=a(52583),M=a(67931);function q(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,r.jsx)("table",{"data-slot":"table",className:(0,u.cn)("w-full caption-bottom text-sm",t),...a})})}function T(e){let{className:t,...a}=e;return(0,r.jsx)("thead",{"data-slot":"table-header",className:(0,u.cn)("[&_tr]:border-b",t),...a})}function I(e){let{className:t,...a}=e;return(0,r.jsx)("tbody",{"data-slot":"table-body",className:(0,u.cn)("[&_tr:last-child]:border-0",t),...a})}function R(e){let{className:t,...a}=e;return(0,r.jsx)("tr",{"data-slot":"table-row",className:(0,u.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function K(e){let{className:t,...a}=e;return(0,r.jsx)("th",{"data-slot":"table-head",className:(0,u.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function $(e){let{className:t,...a}=e;return(0,r.jsx)("td",{"data-slot":"table-cell",className:(0,u.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}var O=a(35299);function U(e){let{cart:t,selectedRowId:a,selectRow:n,updateCartItemQuantity:s,updateCartItemPrice:i,deleteCartItem:o,refocusScanner:c,disabled:m=!1}=e,[x,h]=(0,l.useState)(!1),{lastAddedItemId:p}=d(),f=(0,l.useRef)(null);(0,l.useEffect)(()=>{p&&t.find(e=>e.id===p)&&f.current!==p&&(f.current=p,n(p))},[p,n,t]),(0,l.useEffect)(()=>{p&&!t.find(e=>e.id===p)&&(f.current=null)},[t,p]);let g=(e,t)=>{t.stopPropagation(),n(e),setTimeout(()=>c(),0)},v=(e,t)=>{let a=t.target;"INPUT"===a.tagName||"BUTTON"===a.tagName||a.closest("button")||g(e,t)};return 0===t.length?(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center w-full h-full",children:(0,r.jsx)("div",{className:"text-center space-y-4",children:(0,r.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDED2 Scan items to add to cart"})})}):(0,r.jsxs)(q,{children:[(0,r.jsx)(T,{children:(0,r.jsxs)(R,{children:[(0,r.jsx)(K,{className:"text-lg font-semibold py-3",children:"Barcode"}),(0,r.jsx)(K,{className:"text-lg font-semibold py-3",children:"Name"}),(0,r.jsx)(K,{className:"text-lg font-semibold py-3",children:"Price"}),(0,r.jsx)(K,{className:"text-lg font-semibold py-3",children:"Quantity"}),(0,r.jsx)(K,{className:"text-lg font-semibold py-3",children:"Actions"})]})}),(0,r.jsx)(I,{children:t.map(e=>{let t=a===e.id;return(0,r.jsxs)(R,{className:(0,u.cn)("hover:bg-gray-50 cursor-pointer transition-all duration-200",t?"bg-gray-100 dark:bg-gray-800":""),onClick:t=>g(e.id,t),"data-cart-selected":t,children:[(0,r.jsx)($,{className:"font-medium max-w-[140px] break-words whitespace-normal py-3 px-4",onClick:t=>v(e.id,t),children:e.product.barcode||"N/A"}),(0,r.jsx)($,{className:"min-w-0 max-w-[320px] break-words whitespace-normal py-3 px-4",onClick:t=>v(e.id,t),children:e.product.__placeholder?(0,r.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[(0,r.jsx)(O.A,{className:"h-4 w-4 animate-spin"}),(0,r.jsx)("span",{children:"Fetching product…"})]}):e.product.name}),(0,r.jsx)($,{className:"py-3 px-4",children:(0,r.jsx)(y.p,{type:"number",min:0,step:"0.01","data-cart-price-input":e.id,value:String(e.product.price),className:"w-20 h-8 text-sm",onFocus:()=>n(e.id),onChange:t=>{let a=Number(t.target.value),r=Number.isFinite(a)?Math.max(0,a):0;i(e.id,r)},onBlur:()=>c(),onKeyDown:e=>{"Enter"===e.key&&(e.target.blur(),c())},disabled:m})}),(0,r.jsx)($,{className:"py-3 px-4",children:(0,r.jsx)(y.p,{type:"number",min:1,"data-cart-qty-input":e.id,value:e.quantity,className:"w-16 h-8 text-sm",onFocus:()=>n(e.id),onChange:t=>{let a=Math.max(1,Number(t.target.value));s(e.id,a)},onBlur:()=>c(),onKeyDown:e=>{"Enter"===e.key&&(e.target.blur(),c())},disabled:m})}),(0,r.jsx)($,{className:"py-3 px-4",children:(0,r.jsx)("button",{type:"button",className:"text-sm text-red-600 hover:underline disabled:opacity-50",onClick:t=>{t.stopPropagation(),o(e.id),setTimeout(()=>c(!0),0)},disabled:m,children:"Delete"})})]},e.id)})})]})}var B=a(86651);function G(e){let{searchQuery:t,searchResults:a,showSearchResults:n,handleSearchChange:s,handleSearchSelect:i,refocusScanner:o,disabled:c=!1,inputRef:d}=e,u=1===a.length&&t.trim().length>=2,[m,x]=(0,l.useState)(-1),h=(0,l.useRef)(null);(0,l.useEffect)(()=>{x(a.length>0?0:-1)},[a,n]),(0,l.useEffect)(()=>{let e=null==d?void 0:d.current;if(!e)return;let t=e=>{n&&0!==a.length&&("ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),x(e=>Math.min(e+1,a.length-1)),p()):"ArrowUp"===e.key?(e.preventDefault(),e.stopPropagation(),x(e=>Math.max(e-1,0)),p()):"Enter"===e.key&&m>=0&&(e.preventDefault(),e.stopPropagation(),i(a[m]),x(-1),o()))};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)},[a,n,m,i,d]);let p=()=>{setTimeout(()=>{if(h.current){let e=h.current.querySelector('[data-highlighted="true"]');e&&e.scrollIntoView({block:"nearest"})}},0)};return(0,r.jsxs)("div",{className:"relative mb-6",children:[(0,r.jsxs)("div",{className:"relative flex items-center",children:[(0,r.jsx)(B.A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),(0,r.jsx)(y.p,{ref:d,className:"pl-9 w-full",placeholder:"Search by product name or barcode...",value:t,onChange:e=>s(e.target.value),onClick:e=>e.stopPropagation(),onBlur:()=>{o()},disabled:c}),u&&(0,r.jsx)(S.A,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-green-500 animate-pulse",size:20})]}),n&&a.length>0&&(0,r.jsx)("div",{ref:h,className:"absolute top-full left-0 right-0 bg-white border rounded-md shadow-lg z-10 max-h-[32rem] overflow-y-auto",children:a.map((e,t)=>(0,r.jsx)("div",{"data-highlighted":m===t,className:"p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0 ".concat(u?"bg-green-50 border-green-200":""," ").concat(m===t?"bg-blue-100":""),onClick:()=>i(e),children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsxs)("div",{className:"font-medium break-words whitespace-normal flex items-center gap-2",children:[e.name,u&&(0,r.jsx)("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full",children:"Auto-selecting..."})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["Barcode: ",e.barcode]})]}),(0,r.jsx)("div",{className:"text-right ml-4 flex-shrink-0",children:(0,r.jsxs)("div",{className:"font-medium",children:["₱ ",e.price.toFixed(2)]})})]})},e.id))}),n&&0===a.length&&t.length>=2&&(0,r.jsxs)("div",{className:"absolute top-full left-0 right-0 bg-white border rounded-md shadow-lg z-10 p-3 text-center text-gray-500",children:['No products found matching "',t,'"']})]})}function V(e){let{inputRef:t,barcodeInput:a,handleBarcodeChange:l,handleKeyPress:n,disabled:s=!1}=e;return(0,r.jsx)("input",{ref:t,id:"barcode-scanner",type:"text",value:a,onChange:l,onKeyDown:n,placeholder:"Scan barcode...","data-barcode-scanner":"true",disabled:s,autoComplete:"off",tabIndex:0,style:{position:"absolute",opacity:0,pointerEvents:"none",height:0,width:0,outline:"none",border:"none"}})}var H=a(35646);function Q(e){let{...t}=e;return(0,r.jsx)(H.bL,{"data-slot":"alert-dialog",...t})}function W(e){let{...t}=e;return(0,r.jsx)(H.ZL,{"data-slot":"alert-dialog-portal",...t})}function J(e){let{className:t,...a}=e;return(0,r.jsx)(H.hJ,{"data-slot":"alert-dialog-overlay",className:(0,u.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function X(e){let{className:t,...a}=e;return(0,r.jsxs)(W,{children:[(0,r.jsx)(J,{}),(0,r.jsx)(H.UC,{"data-slot":"alert-dialog-content",className:(0,u.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a})]})}function Y(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"alert-dialog-header",className:(0,u.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function Z(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"alert-dialog-footer",className:(0,u.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function ee(e){let{className:t,...a}=e;return(0,r.jsx)(H.hE,{"data-slot":"alert-dialog-title",className:(0,u.cn)("text-lg font-semibold",t),...a})}function et(e){let{className:t,...a}=e;return(0,r.jsx)(H.VY,{"data-slot":"alert-dialog-description",className:(0,u.cn)("text-muted-foreground text-sm",t),...a})}function ea(e){let{className:t,...a}=e;return(0,r.jsx)(H.rc,{className:(0,u.cn)((0,j.r)(),t),...a})}function er(e){let{className:t,...a}=e;return(0,r.jsx)(H.ZD,{className:(0,u.cn)((0,j.r)({variant:"outline"}),t),...a})}var el=a(9585);function en(e){let{step:t}=e,[a,i]=(0,l.useState)(!1),{selectedRowId:o,selectRow:c}=function(){let[e,t]=(0,l.useState)(null);return{selectedRowId:e,selectRow:e=>{t(e)},clearSelection:()=>{t(null)}}}(),{products:x}=(0,M.Q)(),{cart:h,updateCartItemQuantity:p,scanAndAddToCart:f,addProductToCart:v,setScannerRef:b,refocusScanner:y,updateCartItemPrice:w,deleteCartItem:N,lastAddedItemId:C}=d(),{barcodeInput:S,inputRef:k,handleBarcodeChange:E,handleKeyPress:A}=function(e){let[t,a]=(0,l.useState)(""),r=(0,l.useRef)(null),n=(0,l.useRef)(!1),s=(0,l.useRef)(""),i=(0,l.useRef)(0),o=(0,l.useCallback)(async t=>{let l=Date.now(),o=String(t).replace(/[\n\r\t]/g,"").trim();if(o&&!(o.length<2)&&!n.current&&(o!==s.current||!(l-i.current<400))){n.current=!0,s.current=o,i.current=l;try{await Promise.resolve(e(o))}catch(e){console.warn("[useBarcodeScan] scan error:",e)}finally{a(""),requestAnimationFrame(()=>{n.current=!1,r.current&&(r.current.value="")})}}},[e]),c=(0,l.useCallback)(e=>{let t=e.target.value;if(a(t),t.includes("\n")||t.includes("\r"))return void o(t.replace(/[\n\r]/g,"").trim());setTimeout(()=>{e.target.value===t&&t.trim().length>=3&&o(t)},80)},[o]),d=(0,l.useCallback)(e=>{if("Enter"===e.key){e.preventDefault();let a=t.trim();a&&o(a)}},[t,o]);return{barcodeInput:t,inputRef:r,handleBarcodeChange:c,handleKeyPress:d}}(ei),{setOpen:L,setBarcode:P}=(0,s.c)(),{cart:_,updateCartItemQuantity:D,refocusScanner:q,deleteCartItem:T}=d();(0,l.useEffect)(()=>{let e=e=>{var t,a,r;let l=e.target,n="INPUT"===l.tagName||"TEXTAREA"===l.tagName||l.isContentEditable,s="true"===l.getAttribute("data-barcode-scanner")||"barcode-scanner"===l.id,i=document.activeElement,c=(i&&"INPUT"===i.tagName&&((null==(t=i.placeholder)?void 0:t.toLowerCase().includes("search by product"))||"true"===i.getAttribute("data-product-search")||i.closest("[data-product-search]")),"INPUT"===l.tagName&&("true"===l.getAttribute("data-customer-search")||(null==(a=l.placeholder)?void 0:a.toLowerCase().includes("search name"))||(null==(r=l.placeholder)?void 0:r.toLowerCase().includes("customer"))||null!==l.closest("[data-customer-search]"))),d=window.posStep||1;if(e.ctrlKey&&e.shiftKey&&"c"===e.key.toLowerCase()){e.preventDefault(),e.stopPropagation();try{window.dispatchEvent(new CustomEvent("customer:add"))}catch(e){}return}if(2===d){if(e.ctrlKey&&!e.shiftKey&&"c"===e.key.toLowerCase()){e.preventDefault(),e.stopPropagation();let t=document.querySelector('input[data-customer-search="true"], input[placeholder*="customer"], input[placeholder*="search name"]');if(t)try{t.focus(),t.select(),window.customerSearchActive=!0;let e=()=>{try{window.customerSearchActive=!1}catch(e){}t.removeEventListener("blur",e)};t.addEventListener("blur",e)}catch(e){}return}if(e.ctrlKey&&!e.shiftKey&&"b"===e.key.toLowerCase()){e.preventDefault(),e.stopPropagation(),window.dispatchEvent(new CustomEvent("pos:step-1-back"));return}if("Enter"===e.key&&!e.ctrlKey){let t=document.activeElement;if(t&&"function"==typeof t.closest&&t.closest('[data-add-customer-modal="true"]'))return;let a=!!t&&"TEXTAREA"===t.tagName,r=!!t&&!0===t.isContentEditable;a||r||(e.preventDefault(),e.stopPropagation(),window.dispatchEvent(new CustomEvent("pos:step-2-complete")));return}}if(3===d&&"Enter"===e.key&&!e.ctrlKey){let t=document.activeElement,a=!!t&&"TEXTAREA"===t.tagName,r=!!t&&!0===t.isContentEditable;if(a||r)return;e.preventDefault(),e.stopPropagation();try{window.dispatchEvent(new CustomEvent("pos:step-3-complete"))}catch(e){}return}if(1===d){if("F2"===e.key)return;if((!n||s)&&("ArrowDown"===e.key||"ArrowUp"===e.key)){e.preventDefault(),e.stopPropagation(),"ArrowDown"===e.key?window.dispatchEvent(new CustomEvent("cart:select-next")):window.dispatchEvent(new CustomEvent("cart:select-prev"));return}if(e.ctrlKey&&e.shiftKey&&"p"===e.key.toLowerCase()){if(e.preventDefault(),e.stopPropagation(),o){let e=document.querySelector('input[data-cart-price-input="'.concat(o,'"]'));e&&(e.focus(),e.select())}return}if(e.ctrlKey&&!e.shiftKey&&"d"===e.key.toLowerCase()){if(e.preventDefault(),e.stopPropagation(),o){try{T(o)}catch(e){}q()}return}let t="+"===e.key||"NumpadAdd"===e.code||"Equal"===e.code&&e.shiftKey,a="-"===e.key||"NumpadSubtract"===e.code||"Minus"===e.code;if((t||a)&&!n){if(e.preventDefault(),e.stopPropagation(),!o)return void q();let a=_.find(e=>e.id===o);return a?(t?D(a.id,a.quantity+1):a.quantity>1&&D(a.id,a.quantity-1),void q()):void q()}if("Enter"===e.key&&!e.ctrlKey){if(i&&i.getAttribute&&i.getAttribute("data-cart-price-input")){e.preventDefault(),e.stopPropagation();try{i.blur()}catch(e){}q();}return}}let u="BODY"===l.tagName;if(e.ctrlKey&&"Enter"===e.key){let t=document.activeElement,a=t&&("true"===t.getAttribute("data-pos-cash-input")||"0.00"===t.getAttribute("placeholder"));if(1===d&&!a){let t=document.querySelector('input[placeholder="0.00"], input[data-pos-cash-input="true"]');t&&(t.focus(),t.select()),e.preventDefault(),e.stopPropagation();return}e.preventDefault(),e.stopPropagation(),1===d?window.dispatchEvent(new CustomEvent("pos:step-1-complete")):2===d?window.dispatchEvent(new CustomEvent("pos:step-2-complete")):3===d&&window.dispatchEvent(new CustomEvent("pos:step-3-complete"));return}if(e.ctrlKey&&"1"===e.key){let t=document.activeElement,a=t&&("true"===t.getAttribute("data-pos-cash-input")||"0.00"===t.getAttribute("placeholder"));if(1===d&&!a){let t=document.querySelector('input[placeholder="0.00"], input[data-pos-cash-input="true"]');t&&(t.focus(),t.select()),e.preventDefault(),e.stopPropagation();return}e.preventDefault(),e.stopPropagation(),1===d?window.dispatchEvent(new CustomEvent("pos:step-1-complete")):2===d&&window.dispatchEvent(new CustomEvent("pos:step-2-complete"));return}if("0"===e.key&&"Numpad0"===e.code||"F5"===e.key){(!n||s)&&(e.preventDefault(),e.stopPropagation(),q(),window.dispatchEvent(new Event("focusBarcodeScanner")));return}if(!o){n||u||q();return}if(!(u||s||!n&&!c))return;let m="+"===e.key||"NumpadAdd"===e.code||"Equal"===e.code&&e.shiftKey,x="-"===e.key||"NumpadSubtract"===e.code||"Minus"===e.code;if(m||x){e.preventDefault(),e.stopPropagation();let t=_.find(e=>e.id===o);if(!t)return;m?D(t.id,t.quantity+1):t.quantity>1&&D(t.id,t.quantity-1)}};return document.addEventListener("keydown",e,{capture:!0,passive:!1}),()=>document.removeEventListener("keydown",e,{capture:!0})},[o,_,D,q]);let I=e=>{v(e),B(),y(!0)},{searchQuery:R,searchResults:K,showSearchResults:$,handleSearchChange:O,clearSearch:B}=function(e,t){let[a,r]=(0,l.useState)(""),[n,s]=(0,l.useState)([]),[i,o]=(0,l.useState)(!1),c=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let r=String(a||"").trim().toLowerCase();if(c.current&&(clearTimeout(c.current),c.current=null),!r){s(e=>0===e.length?e:[]),o(e=>!1===e&&e);return}let l=e.filter(e=>{let t=String((null==e?void 0:e.name)||"").toLowerCase(),a=String((null==e?void 0:e.barcode)||"").toLowerCase();return t.includes(r)||a.includes(r)});s(e=>((e,t)=>{if(e===t)return!0;if(e.length!==t.length)return!1;for(let d=0;d<e.length;d++){var a,r,l,n,s,i,o,c;if(String(null!=(i=null!=(s=null==(a=e[d])?void 0:a.id)?s:null==(r=e[d])?void 0:r.barcode)?i:"")!==String(null!=(c=null!=(o=null==(l=t[d])?void 0:l.id)?o:null==(n=t[d])?void 0:n.barcode)?c:""))return!1}return!0})(e,l)?e:l),o(e=>e===l.length>0?e:l.length>0);let n=l.find(e=>String(e.barcode||"").toLowerCase()===r);return n?void t(n):(1===l.length&&r.length>=2&&(c.current=window.setTimeout(()=>{let r=String(a||"").trim().toLowerCase(),l=e.filter(e=>{let t=String((null==e?void 0:e.name)||"").toLowerCase(),a=String((null==e?void 0:e.barcode)||"").toLowerCase();return t.includes(r)||a.includes(r)});1===l.length&&t(l[0])},100)),()=>{c.current&&(clearTimeout(c.current),c.current=null)})},[a,e,t]),{searchQuery:a,searchResults:n,showSearchResults:i,handleSearchChange:e=>{r(e)},clearSearch:()=>{r(""),s([]),o(!1),c.current&&(clearTimeout(c.current),c.current=null)}}}(x,I),[H,W]=(0,l.useState)(!1),[J,en]=(0,l.useState)(null),es=(0,l.useRef)(null);async function ei(e){let t=e=>null==e?"":String(e).replace(/[\u0000-\u001F\u007F-\u009F]/g,"").trim(),a=t(e);if(!a||a.length<2)return;let r=e=>e.replace(/^0+/,"")||"0",l=r(a),s=x.find(e=>{let n=t(null==e?void 0:e.barcode);return!!n&&(n===a||r(n)===l)});if(s)return void await f(a,s);try{let e=await n.G.getByBarcode(a);if(e)return void await f(a,e)}catch(e){}en(a),W(!0)}(0,l.useEffect)(()=>{b(k)},[b,k]),(0,l.useEffect)(()=>{2===t||3===t?(null==k?void 0:k.current)&&k.current.blur():setTimeout(()=>{var e;null==k||null==(e=k.current)||e.focus()},100)},[t]),(0,l.useEffect)(()=>{let e=e=>{1===t&&"F2"===e.key&&(e.preventDefault(),es.current&&(es.current.focus(),es.current.select()))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t]),(0,l.useEffect)(()=>{let e=()=>{var e;if(!h||0===h.length)return;let t=h.findIndex(e=>e.id===o),a=t<0?0:Math.min(h.length-1,t+1),r=null==(e=h[a])?void 0:e.id;r&&c(r)},t=()=>{var e;if(!h||0===h.length)return;let t=h.findIndex(e=>e.id===o),a=null==(e=h[t<=0?0:t-1])?void 0:e.id;a&&c(a)};window.addEventListener("cart:select-next",e),window.addEventListener("cart:select-prev",t);let a=e=>{var t;let a=null!=(t=((null==e?void 0:e.detail)||{}).nextSelectedId)?t:null;if(a)return void c(a);h&&h.length>0?c(h[0].id):c("")};return window.addEventListener("cart:item-deleted",a),()=>{window.removeEventListener("cart:select-next",e),window.removeEventListener("cart:select-prev",t),window.removeEventListener("cart:item-deleted",a)}},[h,o,c,k]);let eo=()=>{y(!0),window.dispatchEvent(new Event("focusBarcodeScanner")),i(!0),setTimeout(()=>i(!1),1e3)};return(0,r.jsxs)("div",{className:"relative w-full h-full",children:[(0,r.jsxs)("div",{className:"absolute top-2 right-2 z-20 flex items-center gap-2",children:[2!==t&&3!==t&&(0,r.jsx)("div",{className:"bg-green-500 text-white px-2 py-1 rounded-md text-xs opacity-70",children:"Scanner Active"}),(0,r.jsxs)(j.$,{variant:"outline",size:"sm",className:"relative disabled:opacity-100",onClick:eo,disabled:2===t||3===t||a,children:[(0,r.jsx)("span",{className:(0,u.cn)("transition-all",a?"scale-100 opacity-100":"scale-0 opacity-0"),children:(0,r.jsx)(z.A,{className:"stroke-green-600 dark:stroke-green-400"})}),(0,r.jsx)("span",{className:(0,u.cn)("absolute start-4 transition-all",a?"scale-0 opacity-0":"scale-100 opacity-100"),children:(0,r.jsx)(F.A,{})}),a?"Focused!":"Refocus Scanner"]})]}),(0,r.jsx)(m,{className:"w-full h-full flex flex-col",children:(0,r.jsxs)(g,{className:"p-6 flex-1 flex flex-col min-h-0",onClick:e=>{e.target===e.currentTarget&&eo()},children:[(0,r.jsx)(V,{inputRef:k,barcodeInput:S,handleBarcodeChange:E,handleKeyPress:A,disabled:2===t||3===t}),(0,r.jsx)(G,{inputRef:es,searchQuery:R,searchResults:K,showSearchResults:$,handleSearchChange:O,handleSearchSelect:I,clearSearch:B,refocusScanner:y,disabled:2===t||3===t}),(0,r.jsx)("div",{className:"rounded-md border flex-1 overflow-auto",children:(0,r.jsx)(U,{cart:h,selectedRowId:o,selectRow:c,updateCartItemQuantity:p,updateCartItemPrice:w,deleteCartItem:N,refocusScanner:y,disabled:2===t||3===t})})]})}),(0,r.jsx)(el.default,{}),(0,r.jsx)(Q,{open:H,onOpenChange:W,children:(0,r.jsxs)(X,{children:[(0,r.jsxs)(Y,{children:[(0,r.jsx)(ee,{children:"Product Not Registered"}),(0,r.jsxs)(et,{children:["The scanned product (",(0,r.jsx)("span",{className:"font-bold",children:J}),") is not registered. Would you like to register it?"]})]}),(0,r.jsxs)(Z,{children:[(0,r.jsx)(er,{onClick:()=>W(!1),children:"Cancel"}),(0,r.jsx)(ea,{onClick:()=>J&&void(W(!1),P(J),L(!0)),children:"Register Product"})]})]})})]})}function es(){let[e,t]=(0,l.useState)(1);return(0,l.useEffect)(()=>{try{window.posStep=e}catch(e){}return()=>{try{delete window.posStep}catch(e){}}},[e]),(0,l.useEffect)(()=>{let e=()=>{try{window.dispatchEvent(new Event("focusBarcodeScanner"))}catch(e){}};e();let t=setTimeout(e,120);return window.addEventListener("focus",e),()=>{clearTimeout(t),window.removeEventListener("focus",e)}},[]),(0,l.useEffect)(()=>{let e=e=>{e.ctrlKey&&"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),window.dispatchEvent(new Event("focusCashInput")))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,r.jsx)(c,{children:(0,r.jsx)("div",{className:"flex flex-col w-full h-full py-4 px-4",children:(0,r.jsxs)("div",{className:"flex gap-2 h-full",children:[(0,r.jsx)("div",{className:"flex-[70%]",children:(0,r.jsx)(en,{step:e})}),(0,r.jsx)("div",{className:"flex flex-col flex-[30%] gap-2",children:(0,r.jsx)(D,{step:e,setStep:t})})]})})})}let ei=(0,l.memo)(function(){let{openModal:e}=(0,s.c)(),t=(0,l.useCallback)(()=>e("addCategory"),[e]),a=(0,l.useCallback)(()=>e("addProduct"),[e]),n="flex items-center justify-center gap-2 p-3";return(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold",children:"Products"}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)(j.$,{className:n,onClick:t,"aria-label":"Add category",children:[(0,r.jsx)(k.A,{size:16}),"Add Category"]}),(0,r.jsxs)(j.$,{className:n,onClick:a,"aria-label":"Add product",children:[(0,r.jsx)(k.A,{size:16}),"Add Product"]})]})]})});var eo=a(46512);let ec=()=>n.G.getAll();function ed(){let{data:e=[],isLoading:t}=(0,eo.Ay)("products:list",ec,{revalidateOnFocus:!1,dedupingInterval:3e4}),a=(0,l.useMemo)(()=>{let t=0,a=0,r=0,l=0;for(let n of e)n&&"number"==typeof n.quantity&&"number"==typeof n.price&&(t++,0===n.quantity?r++:n.quantity<5&&a++,l+=n.price*n.quantity);return{totalProducts:t,lowStockItems:a,outOfStockItems:r,totalValueFormatted:"₱ ".concat(l.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))}},[e]),n=[{title:"Total Products",content:t?"...":a.totalProducts},{title:"Low Stock Items",content:t?"...":a.lowStockItems},{title:"Out of Stock",content:t?"...":a.outOfStockItems},{title:"Total Value",content:t?"...":a.totalValueFormatted}];return(0,r.jsx)("div",{className:"grid grid-cols-4 gap-4 w-full h-full",children:n.map((e,t)=>(0,r.jsx)(m,{children:(0,r.jsxs)(g,{className:"flex flex-col justify-center items-start h-full",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold pb-4",children:e.title}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:e.content})]})},t))})}var eu=a(6259),em=a(12677),ex=a(24033),eh=a(12108);function ep(e){let{...t}=e;return(0,r.jsx)(em.bL,{"data-slot":"select",...t})}function ef(e){let{...t}=e;return(0,r.jsx)(em.WT,{"data-slot":"select-value",...t})}function eg(e){let{className:t,size:a="default",children:l,...n}=e;return(0,r.jsxs)(em.l9,{"data-slot":"select-trigger","data-size":a,className:(0,u.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n,children:[l,(0,r.jsx)(em.In,{asChild:!0,children:(0,r.jsx)(ex.A,{className:"size-4 opacity-50"})})]})}function ev(e){let{className:t,children:a,position:l="popper",...n}=e;return(0,r.jsx)(em.ZL,{children:(0,r.jsxs)(em.UC,{"data-slot":"select-content",className:(0,u.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:l,...n,children:[(0,r.jsx)(eb,{}),(0,r.jsx)(em.LM,{className:(0,u.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,r.jsx)(ey,{})]})})}function ej(e){let{className:t,children:a,...l}=e;return(0,r.jsxs)(em.q7,{"data-slot":"select-item",className:(0,u.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...l,children:[(0,r.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,r.jsx)(em.VF,{children:(0,r.jsx)(z.A,{className:"size-4"})})}),(0,r.jsx)(em.p4,{children:a})]})}function eb(e){let{className:t,...a}=e;return(0,r.jsx)(em.PP,{"data-slot":"select-scroll-up-button",className:(0,u.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,r.jsx)(eh.A,{className:"size-4"})})}function ey(e){let{className:t,...a}=e;return(0,r.jsx)(em.wn,{"data-slot":"select-scroll-down-button",className:(0,u.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,r.jsx)(ex.A,{className:"size-4"})})}var ew=a(66955),eN=a(89234);function eC(e){let{selectedCategory:t,setSelectedCategory:a,selectedProducts:n,setSelectedProducts:s,search:i,setSearch:o}=e,{categories:c,loading:d,error:u}=(0,eN.C)(),[m,x]=(0,l.useState)(""),h=(0,l.useCallback)(()=>{a("all"),s("all"),x(""),o("")},[a,s,o]),p=(0,l.useCallback)(e=>{o(e.target.value)},[o]),f=(0,l.useCallback)(e=>{x(e.target.value)},[]),g=(0,l.useMemo)(()=>{let e=null!=c?c:[],t=m.trim().toLowerCase();return t?e.filter(e=>e.name.toLowerCase().includes(t)):e},[c,m]),v=(0,l.useCallback)(e=>{a(e)},[a]),b=(0,l.useCallback)(e=>{s(e)},[s]);return(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,r.jsxs)("div",{className:"relative flex items-center flex-1 max-w-[700px]",children:[(0,r.jsx)(B.A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),(0,r.jsx)(y.p,{className:"pl-9 w-full",placeholder:"Search by product name or barcode...",value:i,onChange:p,onClick:e=>e.stopPropagation()})]}),(0,r.jsxs)(eu.rI,{children:[(0,r.jsx)(eu.ty,{asChild:!0,children:(0,r.jsxs)(j.$,{variant:"outline",className:"flex items-center gap-2",children:[(0,r.jsx)(ew.A,{}),"Filter"]})}),(0,r.jsxs)(eu.SQ,{className:"w-[320px]",children:[(0,r.jsx)("div",{className:"p-3",children:(0,r.jsx)("h3",{className:"text-sm font-medium",children:"Filter"})}),(0,r.jsx)(eu.mB,{}),(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsx)("h4",{className:"text-sm font-medium",children:"Category"}),(0,r.jsxs)(ep,{value:t,onValueChange:v,children:[(0,r.jsx)(eg,{className:"w-full mt-2",children:(0,r.jsx)(ef,{placeholder:"Category"})}),(0,r.jsxs)(ev,{children:[(0,r.jsx)("div",{className:"p-2",children:(0,r.jsx)(y.p,{placeholder:"Search category...",value:m,onChange:f,className:"mb-2"})}),(0,r.jsxs)("div",{className:"max-h-40 overflow-auto",children:[(0,r.jsx)(ej,{value:"all",children:"All Categories"}),d&&(0,r.jsx)(ej,{value:"loading",disabled:!0,children:"Loading categories..."}),u&&(0,r.jsx)(ej,{value:"error",disabled:!0,children:String(u)}),!d&&!u&&0===g.length&&(0,r.jsx)(ej,{value:"none",disabled:!0,children:"No categories found"}),!d&&!u&&g.map(e=>(0,r.jsx)(ej,{value:String(e.id),children:e.name},e.id))]})]})]})]}),(0,r.jsx)(eu.mB,{}),(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsx)("h4",{className:"text-sm font-medium",children:"Status"}),(0,r.jsxs)(ep,{value:n,onValueChange:b,children:[(0,r.jsx)(eg,{className:"w-full mt-2",children:(0,r.jsx)(ef,{placeholder:"Status"})}),(0,r.jsxs)(ev,{children:[(0,r.jsx)(ej,{value:"all",children:"All Stock"}),(0,r.jsx)(ej,{value:"in stock",children:"In Stock"}),(0,r.jsx)(ej,{value:"low stock",children:"Low Stock"}),(0,r.jsx)(ej,{value:"out of stock",children:"Out of Stock"})]})]})]}),(0,r.jsx)(eu.mB,{}),(0,r.jsx)("div",{className:"flex justify-end p-3",children:(0,r.jsx)(j.$,{variant:"ghost",className:"font-normal",onClick:h,children:"Reset All"})})]})]})]})}var eS=a(31342),ek=a(30563),eE=a(92273);function eA(e){let{columns:t,data:a,page:n,pageSize:s,onFilteredCountChange:i}=e,[o,c]=(0,l.useState)([]),d=(0,ek.N4)({data:a,columns:t,state:{sorting:o,pagination:{pageIndex:n}},onSortingChange:c,onPaginationChange:()=>{},getCoreRowModel:(0,eE.HT)(),getSortedRowModel:(0,eE.h5)()}),u=d.getRowModel().rows,m=(0,l.useMemo)(()=>u.slice(n*s,(n+1)*s),[u,n,s]),x=(0,l.useRef)(null),h=(0,l.useRef)(null),p=u.length;return(0,l.useEffect)(()=>{if(i)return x.current!==p&&(x.current=p,h.current&&(clearTimeout(h.current),h.current=null),h.current=setTimeout(()=>{i(p),h.current=null},0)),()=>{h.current&&(clearTimeout(h.current),h.current=null)}},[p,i]),(0,r.jsx)("div",{className:"rounded-md border",children:(0,r.jsxs)(q,{children:[(0,r.jsx)(T,{children:d.getHeaderGroups().map(e=>(0,r.jsx)(R,{children:e.headers.map(e=>(0,r.jsx)(K,{children:e.isPlaceholder?null:(0,ek.Kv)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,r.jsx)(I,{children:m.length>0?m.map(e=>(0,r.jsx)(R,{"data-state":e.getIsSelected()?"selected":void 0,children:e.getVisibleCells().map(e=>(0,r.jsx)($,{className:"align-top break-words whitespace-normal",children:(0,ek.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,r.jsx)(R,{children:(0,r.jsx)($,{colSpan:t.length,className:"h-24 text-center",children:"No results."})})})]})})}var eL=a(93341),eP=a(32467);let e_=(0,a(83101).F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function eD(e){let{className:t,variant:a,asChild:l=!1,...n}=e,s=l?eP.DX:"span";return(0,r.jsx)(s,{"data-slot":"badge",className:(0,u.cn)(e_({variant:a}),t),...n})}let ez={"in stock":{variant:"default",className:"bg-green-300 text-black"},"low stock":{variant:"secondary",className:"bg-yellow-500 text-black"},"out of stock":{variant:"destructive",className:"bg-red-500 text-white"}},eF=[{accessorKey:"productName",header:e=>{let{column:t}=e;return(0,r.jsxs)("button",{className:"flex items-center gap-2 font-medium focus:outline-none",onClick:()=>t.toggleSorting("asc"===t.getIsSorted()),children:["Product",(0,r.jsx)(eL.A,{className:"ml-1 h-4 w-4"})]})},cell:e=>{let{row:t}=e;return(0,r.jsx)("div",{className:"flex w-full",children:(0,r.jsx)("div",{className:"flex-1 flex flex-col items-start font-medium break-words whitespace-normal leading-tight",title:String(t.getValue("productName")),style:{wordBreak:"break-word",whiteSpace:"normal"},children:t.getValue("productName")})})}},{accessorKey:"barcode",header:"Barcode"},{accessorKey:"category",header:"Category"},{accessorKey:"currentStock",header:e=>{let{column:t}=e;return(0,r.jsxs)("button",{className:"flex items-center gap-2 font-medium focus:outline-none",onClick:()=>t.toggleSorting("asc"===t.getIsSorted()),children:["Current Stock",(0,r.jsx)(eL.A,{className:"ml-1 h-4 w-4"})]})},cell:e=>{let{row:t}=e;return(0,r.jsx)("div",{className:"flex items-center font-medium",children:t.getValue("currentStock")})}},{accessorKey:"productPrice",header:"Price"},{accessorKey:"status",header:"Status",cell:e=>{let{row:t}=e,a=t.original.status,l=ez[a],n=a.charAt(0).toUpperCase()+a.slice(1);return(0,r.jsx)(eD,{variant:l.variant,className:l.className,children:n})}},{id:"actions",header:()=>(0,r.jsx)("div",{className:"text-center font-medium",children:"Actions"}),cell:()=>(0,r.jsx)("div",{className:"flex gap-5 justify-center","aria-hidden":!0}),enableSorting:!1,enableHiding:!1}];var eM=a(90368),eq=a(27937),eT=a(37772);function eI(e){let{className:t,...a}=e;return(0,r.jsx)("nav",{role:"navigation","aria-label":"pagination","data-slot":"pagination",className:(0,u.cn)("mx-auto flex w-full justify-center",t),...a})}function eR(e){let{className:t,...a}=e;return(0,r.jsx)("ul",{"data-slot":"pagination-content",className:(0,u.cn)("flex flex-row items-center gap-1",t),...a})}function eK(e){let{...t}=e;return(0,r.jsx)("li",{"data-slot":"pagination-item",...t})}function e$(e){let{className:t,isActive:a,size:l="icon",...n}=e;return(0,r.jsx)("a",{"aria-current":a?"page":void 0,"data-slot":"pagination-link","data-active":a,className:(0,u.cn)((0,j.r)({variant:a?"outline":"ghost",size:l}),t),...n})}function eO(e){let{className:t,...a}=e;return(0,r.jsxs)(e$,{"aria-label":"Go to previous page",size:"default",className:(0,u.cn)("gap-1 px-2.5 sm:pl-2.5",t),...a,children:[(0,r.jsx)(eM.A,{}),(0,r.jsx)("span",{className:"hidden sm:block",children:"Previous"})]})}function eU(e){let{className:t,...a}=e;return(0,r.jsxs)(e$,{"aria-label":"Go to next page",size:"default",className:(0,u.cn)("gap-1 px-2.5 sm:pr-2.5",t),...a,children:[(0,r.jsx)("span",{className:"hidden sm:block",children:"Next"}),(0,r.jsx)(eq.A,{})]})}function eB(e){let{className:t,...a}=e;return(0,r.jsxs)("span",{"aria-hidden":!0,"data-slot":"pagination-ellipsis",className:(0,u.cn)("flex size-9 items-center justify-center",t),...a,children:[(0,r.jsx)(eT.A,{className:"size-4"}),(0,r.jsx)("span",{className:"sr-only",children:"More pages"})]})}function eG(e){let{page:t,pageCount:a,setPage:l,pageSize:n,onPageSizeChange:s}=e;if(a<=1)return null;let i=e=>r=>{null==r||r.preventDefault(),e<0&&(e=0),e>a-1&&(e=a-1),e!==t&&l(e)},o=(()=>{let e=[],r=Math.max(1,t-1),l=Math.min(a-2,t+1);e.push(0),r>1&&e.push("ellipsis");for(let t=r;t<=l;t++)e.push(t);return l<a-2&&e.push("ellipsis"),a>1&&e.push(a-1),e})();return(0,r.jsxs)(eI,{className:"mt-2 flex items-center gap-4",children:[(0,r.jsxs)(eR,{children:[(0,r.jsx)(eK,{children:(0,r.jsx)(eO,{href:"#",onClick:i(Math.max(t-1,0)),"aria-disabled":0===t})}),o.map((e,a)=>"ellipsis"===e?(0,r.jsx)(eK,{children:(0,r.jsx)(eB,{})},"e-".concat(a)):(0,r.jsx)(eK,{children:(0,r.jsx)(e$,{href:"#",isActive:e===t,onClick:i(e),children:e+1})},e)),(0,r.jsx)(eK,{children:(0,r.jsx)(eU,{href:"#",onClick:i(Math.min(t+1,a-1)),"aria-disabled":t===a-1})})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{htmlFor:"page-size",className:"text-sm",children:"Rows per page:"}),(0,r.jsx)("input",{id:"page-size",type:"number",min:1,max:100,value:n,onChange:e=>s(Number(e.target.value)||1),className:"border rounded px-2 py-1 w-16 text-sm"})]})]})}var eV=a(18514),eH=a(71360),eQ=a(63769);let eW="products:list",eJ=()=>n.G.getAll();function eX(e){let{selectedCategory:t,selectedStatus:a,onProductDeleted:s,search:i=""}=e,{data:o=[],isLoading:c,mutate:d}=(0,eo.Ay)(eW,eJ,{revalidateOnFocus:!1,revalidateOnReconnect:!0,dedupingInterval:1e4,errorRetryCount:2}),{categories:u=[]}=(0,eN.C)(),m=(0,l.useMemo)(()=>{let e=new Map;return u.forEach(t=>e.set(String(t.id),t.name)),e},[u]),[x,h]=(0,l.useState)(0),[p,f]=(0,l.useState)(6),[g,v]=(0,l.useState)(null),[b,N]=(0,l.useState)(!1),[C,S]=(0,l.useState)(!1),[k,E]=(0,l.useState)(null),[A,L]=(0,l.useState)(!1),[_,D]=(0,l.useState)(""),[z,F]=(0,l.useState)({name:"",barcode:"",category_id:"",price:0,quantity:0}),M=(0,l.useMemo)(()=>{let e=o;if("all"===t&&"all"===a&&!i.trim())return e;"all"!==t&&(e=e.filter(e=>String(e.category_id)===t)),"all"!==a&&(e=e.filter(e=>(0===e.quantity?"out of stock":e.quantity<5?"low stock":"in stock")===a));let r=i.trim().toLowerCase();return r&&(e=e.filter(e=>{var t,a;let l=(null==(t=e.name)?void 0:t.toLowerCase())||"",n=(null==(a=e.barcode)?void 0:a.toLowerCase())||"";return l.includes(r)||n.includes(r)})),e},[o,t,a,i]),q=(0,l.useMemo)(()=>M.map(e=>((e,t)=>{var a;let r=0===e.quantity?"out of stock":e.quantity<5?"low stock":"in stock",l=t.get(String(e.category_id))||"Category ".concat(e.category_id);return{id:String(e.id),productName:e.name,barcode:null!=(a=e.barcode)?a:"",category:l,currentStock:e.quantity,productPrice:e.price,status:r}})(e,m)),[M,m]);(0,l.useEffect)(()=>h(0),[t,a,i]);let T=Math.max(1,Math.ceil(q.length/p)),I=(0,l.useMemo)(()=>o.find(e=>e.id===g),[o,g]);(0,l.useEffect)(()=>{b&&I&&F({name:I.name||"",barcode:I.barcode||"",category_id:String(I.category_id||""),price:I.price||0,quantity:I.quantity||0})},[b,I]);let R=(0,l.useCallback)(e=>{v(Number(e.id)),N(!0),S(!1)},[]),K=(0,l.useCallback)(e=>{E(e),L(!0)},[]),$=(0,l.useCallback)(async()=>{if(!I)return;let e={name:z.name,barcode:z.barcode,category_id:Number(z.category_id),price:Number(z.price),quantity:Number(z.quantity)};try{let t={...I,...e};(0,eS.j)(eW,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(e=>e.id===I.id?t:e)},!1),await n.G.update(Number(I.id),e),(0,eQ.GF)("Product updated","".concat(z.name," has been updated.")),N(!1),S(!1),(0,eS.j)(eW)}catch(e){(0,eS.j)(eW),(0,eQ.Ni)("Failed to update product",(null==e?void 0:e.message)||"An error occurred.")}},[I,z]),O=(0,l.useCallback)(async()=>{if(!k)return;let e=Number(k.id);try{(0,eS.j)(eW,function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter(t=>t.id!==e)},!1),await n.G.delete(e),(0,eQ.GF)("Product deleted","".concat(k.productName," has been deleted.")),L(!1),E(null),null==s||s(e),(0,eS.j)(eW)}catch(e){(0,eS.j)(eW),(0,eQ.Ni)("Failed to delete product",(null==e?void 0:e.message)||"An error occurred.")}},[k,s]),U=(0,l.useMemo)(()=>eF.map(e=>"actions"===e.id?{...e,cell:e=>{let{row:t}=e;return(0,r.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,r.jsx)(j.$,{variant:"outline",size:"icon",onClick:()=>R(t.original),disabled:c,children:(0,r.jsx)(eV.A,{className:"w-4 h-4"})}),(0,r.jsx)(j.$,{variant:"outline",size:"icon",onClick:()=>K(t.original),disabled:c,children:(0,r.jsx)(eH.A,{className:"w-4 h-4"})})]})}}:e),[R,K,c]);return(0,r.jsxs)("div",{className:"w-full mt-4 relative",children:[c&&(0,r.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-blue-200 z-10",children:(0,r.jsx)("div",{className:"h-full bg-blue-500 animate-pulse"})}),(0,r.jsx)(eA,{columns:U,data:q,page:x,pageSize:p}),(0,r.jsx)("div",{className:"mt-7",children:(0,r.jsx)(eG,{page:x,pageCount:T,setPage:h,pageSize:p,onPageSizeChange:e=>{f(e),h(0)}})}),(0,r.jsx)(P.lG,{open:b,onOpenChange:N,children:(0,r.jsx)(P.Cf,{children:C?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,r.jsx)("h2",{className:"font-bold text-lg mb-2",children:"Are you absolutely sure?"}),(0,r.jsx)("p",{className:"mb-6 text-gray-500",children:"This will update the product details."}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(j.$,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),(0,r.jsx)(j.$,{onClick:$,children:"Continue"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(P.c7,{children:[(0,r.jsx)(P.L3,{children:"Edit Product"}),(0,r.jsx)(P.rr,{children:"Update product details below."})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"edit-name",children:"Product Name"}),(0,r.jsx)(y.p,{id:"edit-name",value:z.name,onChange:e=>F(t=>({...t,name:e.target.value}))})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"edit-barcode",children:"Barcode"}),(0,r.jsx)(y.p,{id:"edit-barcode",value:z.barcode,onChange:e=>F(t=>({...t,barcode:e.target.value}))})]}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"edit-category",children:"Category"}),(0,r.jsxs)(eu.rI,{children:[(0,r.jsx)(eu.ty,{asChild:!0,children:(0,r.jsx)(y.p,{readOnly:!0,value:m.get(z.category_id)||"",placeholder:"Select category",className:"cursor-pointer"})}),(0,r.jsx)(eu.SQ,{children:u.map(e=>(0,r.jsx)(eu._2,{onClick:()=>F(t=>({...t,category_id:String(e.id)})),children:e.name},e.id))})]})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"edit-price",children:"Price"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"₱"}),(0,r.jsx)(y.p,{id:"edit-price",type:"number",value:z.price||"",onChange:e=>F(t=>({...t,price:Number(e.target.value)||0})),className:"pl-8"})]})]}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"edit-quantity",children:"Quantity"}),(0,r.jsx)(y.p,{id:"edit-quantity",type:"number",value:z.quantity||"",onChange:e=>F(t=>({...t,quantity:Number(e.target.value)||0}))})]})]}),(0,r.jsxs)(P.Es,{children:[(0,r.jsx)(j.$,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),(0,r.jsx)(j.$,{onClick:()=>S(!0),children:"Update Product"})]})]})]})})}),(0,r.jsx)(P.lG,{open:A,onOpenChange:L,children:(0,r.jsxs)(P.Cf,{children:[(0,r.jsxs)(P.c7,{children:[(0,r.jsx)(P.L3,{children:"Are you absolutely sure?"}),(0,r.jsx)(P.rr,{children:"This action cannot be undone. This will permanently delete the product."})]}),(0,r.jsxs)(P.Es,{children:[(0,r.jsx)(j.$,{variant:"outline",onClick:()=>L(!1),children:"Cancel"}),(0,r.jsx)(j.$,{variant:"destructive",onClick:O,children:"Continue"})]})]})})]})}function eY(e){let{onProductDeleted:t}=e,[a,n]=(0,l.useState)("all"),[s,i]=(0,l.useState)("all"),[o,c]=(0,l.useState)("");return(0,r.jsxs)(m,{className:"h-full w-full",children:[(0,r.jsx)(x,{children:(0,r.jsx)("h2",{className:"text-2xl font-semibold",children:"Product Catalog"})}),(0,r.jsxs)(g,{children:[(0,r.jsx)(eC,{selectedCategory:a,setSelectedCategory:n,selectedProducts:s,setSelectedProducts:i,search:o,setSearch:c}),(0,r.jsx)(eX,{selectedCategory:a,selectedStatus:s,onProductDeleted:t,search:o})]})]})}var eZ=a(54636);function e0(){return(0,r.jsxs)("div",{className:"flex flex-col gap-4 h-full p-8",children:[(0,r.jsx)("div",{className:"flex-[7%]",children:(0,r.jsx)(ei,{})}),(0,r.jsx)("div",{className:"flex-[18%]",children:(0,r.jsx)(ed,{})}),(0,r.jsx)("div",{className:"flex-[75%]",children:(0,r.jsx)(eY,{})}),(0,r.jsx)(eZ.A,{})]})}var e1=a(91761),e2=a(26617),e4=a(10512);function e3(){let{products:e=[],loading:t}=(0,M.Q)(),{from:a,to:n}=function(){let e=new Date,t=new Date(e);t.setHours(0,0,0,0);let a=new Date(e);return a.setHours(23,59,59,999),{from:t.toISOString(),to:a.toISOString()}}(),{sales:s=[],loading:i}=(e=>{let[t,a]=(0,l.useState)([]),[r,n]=(0,l.useState)(!0),[s,i]=(0,l.useState)(null),o=async()=>{try{n(!0),i(null);let t=await b.A.get("/sales",{params:{from:null==e?void 0:e.from,to:null==e?void 0:e.to}});a(t.data.data||[])}catch(e){i(e instanceof Error?e.message:"Unknown error")}finally{n(!1)}};return(0,l.useEffect)(()=>{o()},[null==e?void 0:e.from,null==e?void 0:e.to]),{sales:t,loading:r,error:s,refetch:o}})({from:a,to:n}),{saleItems:o=[],loading:c}=(e=>{let[t,a]=(0,l.useState)([]),[r,n]=(0,l.useState)(!0),[s,i]=(0,l.useState)(null),o=async()=>{try{var t;n(!0),i(null);let r=new URLSearchParams;r.set("limit","all"),(null==e?void 0:e.from)&&r.set("from",e.from),(null==e?void 0:e.to)&&r.set("to",e.to);let l="/sales-items?".concat(r.toString()),s=(await b.A.get(l)).data;a(Array.isArray(s)?s:null!=(t=null==s?void 0:s.data)?t:[])}catch(e){i(e instanceof Error?e.message:"Unknown error"),a([])}finally{n(!1)}};return(0,l.useEffect)(()=>{o()},[null==e?void 0:e.from,null==e?void 0:e.to]),{saleItems:t,loading:r,error:s,refetch:o}})({from:a,to:n}),d=s.reduce((e,t)=>e+t.total_purchase,0),u=s.length,p=o.reduce((e,t)=>e+(Number(t.quantity)||0),0),f=[{title:"Today's Sales",content:i?"...":"₱ ".concat(d.toLocaleString()),icon:(0,r.jsx)(e1.A,{size:20})},{title:"Items Sold Today",content:c?"...":p.toLocaleString(),icon:(0,r.jsx)(e2.A,{size:20})},{title:"Today's Transactions",content:i?"...":u.toLocaleString(),icon:(0,r.jsx)(e4.A,{size:20})}];return(0,r.jsx)("div",{className:"grid grid-cols-3 gap-4 w-full h-full",children:f.map((e,t)=>(0,r.jsxs)(m,{className:"gap-0 flex justify-center",children:[(0,r.jsxs)(x,{className:"mb-4 flex flex-row justify-between items-center",children:[(0,r.jsx)(h,{className:"text-md font-semibold",children:e.title}),(0,r.jsx)("div",{className:"opacity-60",children:e.icon})]}),(0,r.jsx)(g,{children:(0,r.jsx)("div",{className:"text-3xl font-bold mb-6",children:e.content})})]},t))})}var e5=a(54485),e6=a(16485),e8=a(98128),e9=a(68425),e7=a(47734),te=a(30757),tt=a(3648),ta=a(74854),tr=a(63359);function tl(){let e=(0,tt._)(["rtl:**:[.rdp-button_next>svg]:rotate-180"],["rtl:**:[.rdp-button\\_next>svg]:rotate-180"]);return tl=function(){return e},e}function tn(){let e=(0,tt._)(["rtl:**:[.rdp-button_previous>svg]:rotate-180"],["rtl:**:[.rdp-button\\_previous>svg]:rotate-180"]);return tn=function(){return e},e}function ts(e){let{className:t,classNames:a,showOutsideDays:l=!0,captionLayout:n="label",buttonVariant:s="ghost",formatters:i,components:o,...c}=e,d=(0,ta.a)();return(0,r.jsx)(tr.h,{showOutsideDays:l,className:(0,u.cn)("bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw(tl()),String.raw(tn()),t),captionLayout:n,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...i},classNames:{root:(0,u.cn)("w-fit",d.root),months:(0,u.cn)("flex gap-4 flex-col md:flex-row relative",d.months),month:(0,u.cn)("flex flex-col w-full gap-4",d.month),nav:(0,u.cn)("flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",d.nav),button_previous:(0,u.cn)((0,j.r)({variant:s}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",d.button_previous),button_next:(0,u.cn)((0,j.r)({variant:s}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",d.button_next),month_caption:(0,u.cn)("flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",d.month_caption),dropdowns:(0,u.cn)("w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",d.dropdowns),dropdown_root:(0,u.cn)("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",d.dropdown_root),dropdown:(0,u.cn)("absolute bg-popover inset-0 opacity-0",d.dropdown),caption_label:(0,u.cn)("select-none font-medium","label"===n?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",d.caption_label),table:"w-full border-collapse",weekdays:(0,u.cn)("flex",d.weekdays),weekday:(0,u.cn)("text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",d.weekday),week:(0,u.cn)("flex w-full mt-2",d.week),week_number_header:(0,u.cn)("select-none w-(--cell-size)",d.week_number_header),week_number:(0,u.cn)("text-[0.8rem] select-none text-muted-foreground",d.week_number),day:(0,u.cn)("relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",d.day),range_start:(0,u.cn)("rounded-l-md bg-accent",d.range_start),range_middle:(0,u.cn)("rounded-none",d.range_middle),range_end:(0,u.cn)("rounded-r-md bg-accent",d.range_end),today:(0,u.cn)("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",d.today),outside:(0,u.cn)("text-muted-foreground aria-selected:text-muted-foreground",d.outside),disabled:(0,u.cn)("text-muted-foreground opacity-50",d.disabled),hidden:(0,u.cn)("invisible",d.hidden),...a},components:{Root:e=>{let{className:t,rootRef:a,...l}=e;return(0,r.jsx)("div",{"data-slot":"calendar",ref:a,className:(0,u.cn)(t),...l})},Chevron:e=>{let{className:t,orientation:a,...l}=e;return"left"===a?(0,r.jsx)(eM.A,{className:(0,u.cn)("size-4",t),...l}):"right"===a?(0,r.jsx)(eq.A,{className:(0,u.cn)("size-4",t),...l}):(0,r.jsx)(ex.A,{className:(0,u.cn)("size-4",t),...l})},DayButton:ti,WeekNumber:e=>{let{children:t,...a}=e;return(0,r.jsx)("td",{...a,children:(0,r.jsx)("div",{className:"flex size-(--cell-size) items-center justify-center text-center",children:t})})},...o},...c})}function ti(e){let{className:t,day:a,modifiers:n,...s}=e,i=(0,ta.a)(),o=l.useRef(null);return l.useEffect(()=>{var e;n.focused&&(null==(e=o.current)||e.focus())},[n.focused]),(0,r.jsx)(j.$,{ref:o,variant:"ghost",size:"icon","data-day":a.date.toLocaleDateString(),"data-selected-single":n.selected&&!n.range_start&&!n.range_end&&!n.range_middle,"data-range-start":n.range_start,"data-range-end":n.range_end,"data-range-middle":n.range_middle,className:(0,u.cn)("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",i.day,t),...s})}var to=a(26991),tc=a(23508),td=a(7620);let tu={light:"",dark:".dark"},tm=l.createContext(null);function tx(e){let{id:t,className:a,children:n,config:s,...i}=e,o=l.useId(),c="chart-".concat(t||o.replace(/:/g,""));return(0,r.jsx)(tm.Provider,{value:{config:s},children:(0,r.jsxs)("div",{"data-slot":"chart","data-chart":c,className:(0,u.cn)("[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",a),...i,children:[(0,r.jsx)(th,{id:c,config:s}),(0,r.jsx)(to.u,{children:n})]})})}let th=e=>{let{id:t,config:a}=e,l=Object.entries(a).filter(e=>{let[,t]=e;return t.theme||t.color});return l.length?(0,r.jsx)("style",{dangerouslySetInnerHTML:{__html:Object.entries(tu).map(e=>{let[a,r]=e;return"\n".concat(r," [data-chart=").concat(t,"] {\n").concat(l.map(e=>{var t;let[r,l]=e,n=(null==(t=l.theme)?void 0:t[a])||l.color;return n?"  --color-".concat(r,": ").concat(n,";"):null}).join("\n"),"\n}\n")}).join("\n")}}):null},tp=tc.m;function tf(e){let{active:t,payload:a,className:n,indicator:s="dot",hideLabel:i=!1,hideIndicator:o=!1,label:c,labelFormatter:d,labelClassName:m,formatter:x,color:h,nameKey:p,labelKey:f}=e,{config:g}=function(){let e=l.useContext(tm);if(!e)throw Error("useChart must be used within a <ChartContainer />");return e}(),v=l.useMemo(()=>{var e;if(i||!(null==a?void 0:a.length))return null;let[t]=a,l="".concat(f||(null==t?void 0:t.dataKey)||(null==t?void 0:t.name)||"value"),n=tg(g,t,l),s=f||"string"!=typeof c?null==n?void 0:n.label:(null==(e=g[c])?void 0:e.label)||c;return d?(0,r.jsx)("div",{className:(0,u.cn)("font-medium",m),children:d(s,a)}):s?(0,r.jsx)("div",{className:(0,u.cn)("font-medium",m),children:s}):null},[c,d,a,i,m,g,f]);if(!t||!(null==a?void 0:a.length))return null;let j=1===a.length&&"dot"!==s;return(0,r.jsxs)("div",{className:(0,u.cn)("border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",n),children:[j?null:v,(0,r.jsx)("div",{className:"grid gap-1.5",children:a.map((e,t)=>{let a="".concat(p||e.name||e.dataKey||"value"),l=tg(g,e,a),n=h||e.payload.fill||e.color;return(0,r.jsx)("div",{className:(0,u.cn)("[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5","dot"===s&&"items-center"),children:x&&(null==e?void 0:e.value)!==void 0&&e.name?x(e.value,e.name,e,t,e.payload):(0,r.jsxs)(r.Fragment,{children:[(null==l?void 0:l.icon)?(0,r.jsx)(l.icon,{}):!o&&(0,r.jsx)("div",{className:(0,u.cn)("shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)",{"h-2.5 w-2.5":"dot"===s,"w-1":"line"===s,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===s,"my-0.5":j&&"dashed"===s}),style:{"--color-bg":n,"--color-border":n}}),(0,r.jsxs)("div",{className:(0,u.cn)("flex flex-1 justify-between leading-none",j?"items-end":"items-center"),children:[(0,r.jsxs)("div",{className:"grid gap-1.5",children:[j?v:null,(0,r.jsx)("span",{className:"text-muted-foreground",children:(null==l?void 0:l.label)||e.name})]}),e.value&&(0,r.jsx)("span",{className:"text-foreground font-mono font-medium tabular-nums",children:e.value.toLocaleString()})]})]})},e.dataKey)})})]})}function tg(e,t,a){if("object"!=typeof t||null===t)return;let r="payload"in t&&"object"==typeof t.payload&&null!==t.payload?t.payload:void 0,l=a;return a in t&&"string"==typeof t[a]?l=t[a]:r&&a in r&&"string"==typeof r[a]&&(l=r[a]),l in e?e[l]:e[a]}td.s;var tv=a(82286);function tj(e){let{...t}=e;return(0,r.jsx)(tv.bL,{"data-slot":"popover",...t})}function tb(e){let{...t}=e;return(0,r.jsx)(tv.l9,{"data-slot":"popover-trigger",...t})}function ty(e){let{className:t,align:a="center",sideOffset:l=4,...n}=e;return(0,r.jsx)(tv.ZL,{children:(0,r.jsx)(tv.UC,{"data-slot":"popover-content",align:a,sideOffset:l,className:(0,u.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...n})})}var tw=a(17037);let tN={quantity:{label:"Transactions",color:"var(--color-primary)"}},tC=async e=>{var t;let a=await b.A.get(e);return(null==(t=a.data)?void 0:t.data)||a.data||[]};function tS(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),[a,n]=(0,l.useState)({from:t,to:e}),[s,i]=(0,l.useState)("recent"),o=(0,l.useMemo)(()=>{let e=new URLSearchParams;return(null==a?void 0:a.from)&&e.set("from",a.from.toISOString()),(null==a?void 0:a.to)&&e.set("to",a.to.toISOString()),"/sales-items?".concat(e.toString())},[a]),{data:c=[],error:d,isLoading:u}=(0,eo.Ay)(o,tC),y=(0,l.useMemo)(()=>{let e=c.map(e=>({category:e.category,quantity:Number(e.quantity)||0,last_purchase:e.last_purchase}));switch(s){case"asc":return[...e].sort((e,t)=>e.quantity-t.quantity);case"desc":return[...e].sort((e,t)=>t.quantity-e.quantity);case"recent":return[...e].sort((e,t)=>new Date(t.last_purchase).getTime()-new Date(e.last_purchase).getTime());default:return e}},[c,s]),w=(0,l.useMemo)(()=>y.reduce((e,t)=>e+t.quantity,0),[y]),[N,C]=(0,l.useState)(!1),[S,k]=(0,l.useState)(null),[E,A]=(0,l.useState)([]),[L,_]=(0,l.useState)("recent"),D=async e=>{var t;k(e.category),C(!0);let r=new URLSearchParams;r.set("category",e.category),(null==a?void 0:a.from)&&r.set("from",a.from.toISOString()),(null==a?void 0:a.to)&&r.set("to",a.to.toISOString()),A((null==(t=(await b.A.get("/products/by-category?".concat(r.toString()))).data)?void 0:t.data)||[])},z=(0,l.useMemo)(()=>{switch(L){case"asc":return[...E].sort((e,t)=>e.total-t.total);case"desc":return[...E].sort((e,t)=>t.total-e.total);default:return E}},[E,L]);return u?(0,r.jsx)("div",{children:"Loading..."}):d?(0,r.jsx)("div",{children:"Error loading product stats."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(m,{className:"@container/card w-full relative",children:[(0,r.jsxs)(x,{className:"flex flex-col border-b @md/card:grid",children:[(0,r.jsx)(h,{children:"Product Analytics"}),(0,r.jsx)(p,{children:"Showing most sold categories for this month."}),(0,r.jsx)(f,{className:"mt-2 @md/card:mt-0",children:(0,r.jsxs)("div",{className:"flex gap-2 items-center mt-2",children:[(0,r.jsx)(j.$,{onClick:()=>i("desc"),variant:"desc"===s?"default":"outline",size:"sm",children:(0,r.jsx)(ex.A,{size:16})}),(0,r.jsx)(j.$,{onClick:()=>i("recent"),variant:"recent"===s?"default":"outline",size:"sm",children:(0,r.jsx)(e5.A,{size:16})}),(0,r.jsx)(j.$,{onClick:()=>i("asc"),variant:"asc"===s?"default":"outline",size:"sm",children:(0,r.jsx)(eh.A,{size:16})}),(0,r.jsxs)(tj,{children:[(0,r.jsx)(tb,{asChild:!0,children:(0,r.jsxs)(j.$,{variant:"outline",children:[(0,r.jsx)(e6.A,{}),(null==a?void 0:a.from)&&(null==a?void 0:a.to)?"".concat(a.from.toLocaleDateString()," - ").concat(a.to.toLocaleDateString()):"".concat(t.toLocaleDateString()," - ").concat(e.toLocaleDateString())]})}),(0,r.jsx)(ty,{className:"w-auto p-0",align:"end",children:(0,r.jsx)(ts,{mode:"range",defaultMonth:null==a?void 0:a.from,selected:a,onSelect:n,fixedWeeks:!0,showOutsideDays:!0,disabled:{after:e}})})]})]})})]}),(0,r.jsx)(g,{className:"px-4",children:(0,r.jsx)(tx,{config:tN,className:"aspect-auto h-89 w-full",children:(0,r.jsxs)(e8.E,{data:y,margin:{left:12,right:12},children:[(0,r.jsx)(e9.d,{vertical:!1}),(0,r.jsx)(e7.W,{dataKey:"category",tickLine:!1,axisLine:!1,tickMargin:8,minTickGap:20}),(0,r.jsx)(tp,{content:(0,r.jsx)(tf,{className:"w-[150px]",nameKey:"quantity",labelFormatter:e=>e})}),(0,r.jsx)(te.y,{dataKey:"quantity",fill:"var(--color-quantity)",radius:4,onClick:D})]})})}),(0,r.jsx)(v,{className:"border-t",children:(0,r.jsxs)("div",{className:"text-sm",children:["Total sold: ",(0,r.jsx)("span",{className:"font-semibold",children:w.toLocaleString()})]})})]}),(0,r.jsx)(P.lG,{open:N,onOpenChange:C,children:(0,r.jsxs)(P.Cf,{className:"w-full max-w-5xl sm:max-w-4xl md:max-w-3xl lg:max-w-5xl xl:max-w-6xl",children:[(0,r.jsxs)(P.c7,{className:"flex flex-row items-center justify-between",children:[(0,r.jsx)(P.L3,{className:"text-lg font-semibold items-center",children:S}),(0,r.jsxs)("div",{className:"flex gap-2 pr-4",children:[(0,r.jsx)(j.$,{onClick:()=>_("desc"),variant:"desc"===L?"default":"outline",size:"icon",className:"w-8 h-8",children:(0,r.jsx)(ex.A,{size:16})}),(0,r.jsx)(j.$,{onClick:()=>_("recent"),variant:"recent"===L?"default":"outline",size:"icon",className:"w-8 h-8",children:(0,r.jsx)(e5.A,{size:16})}),(0,r.jsx)(j.$,{onClick:()=>_("asc"),variant:"asc"===L?"default":"outline",size:"icon",className:"w-8 h-8",children:(0,r.jsx)(eh.A,{size:16})})]})]}),(0,r.jsx)(tw.F,{className:"h-80 mt-4 rounded-md border bg-white",children:z.length>0?(0,r.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,r.jsx)("thead",{className:"bg-gray-100 sticky top-0",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-2 border text-left font-semibold",children:"Product"}),(0,r.jsx)("th",{className:"p-2 border text-center font-semibold",children:"Qty"}),(0,r.jsx)("th",{className:"p-2 border text-center font-semibold",children:"Price"}),(0,r.jsx)("th",{className:"p-2 border text-center font-semibold",children:"Total"})]})}),(0,r.jsx)("tbody",{children:z.map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50 transition",children:[(0,r.jsx)("td",{className:"p-2 border",children:e.name}),(0,r.jsx)("td",{className:"p-2 border text-center",children:e.qty}),(0,r.jsxs)("td",{className:"p-2 border text-left",children:["₱ ",e.price]}),(0,r.jsxs)("td",{className:"p-2 border text-left",children:["₱ ",e.total]})]},t))})]}):(0,r.jsx)("p",{className:"p-4 text-center text-gray-500",children:"No products found for this category."})})]})})]})}var tk=a(80019),tE=a(47643),tA=a(80003);let tL={customer:{label:"Total",color:"var(--color-primary)"}},tP=async e=>(await b.A.get(e)).data.data;function t_(){let{data:e=[],error:t,isLoading:a}=(0,eo.Ay)("/sales",tP),n=new Date,s=new Date(n.getFullYear(),n.getMonth(),1),[i,o]=l.useState({from:s,to:n}),[c,d]=l.useState("normal"),u=l.useMemo(()=>{let t={};return e.forEach(e=>{var a;let r=e.created_at.slice(0,10);t[r]=(t[r]||0)+(null!=(a=e.total_purchase)?a:0)}),Object.entries(t).map(e=>{let[t,a]=e;return{date:t,customer:a}})},[e]),b=l.useMemo(()=>(null==i?void 0:i.from)||(null==i?void 0:i.to)?u.filter(e=>{let t,a,r=new Date(e.date);return(!i.from||(t=i.from,r.setHours(0,0,0,0)>=t.setHours(0,0,0,0)))&&(!i.to||(a=i.to,r.setHours(0,0,0,0)<=a.setHours(0,0,0,0)))}):u,[i,u]),y=l.useMemo(()=>{let e=[...b];return"asc"===c?e.sort((e,t)=>e.customer-t.customer):"desc"===c&&e.sort((e,t)=>t.customer-e.customer),e},[b,c]),w=l.useMemo(()=>y.reduce((e,t)=>e+t.customer,0),[y]);return a?(0,r.jsx)("div",{children:"Loading..."}):t?(0,r.jsx)("div",{children:"Error loading sales data."}):(0,r.jsxs)(m,{className:"@container/card w-full",children:[(0,r.jsxs)(x,{className:"flex flex-col border-b @md/card:grid",children:[(0,r.jsx)(h,{children:"Sales Chart"}),(0,r.jsx)(p,{children:"Filter total sales by date range"}),(0,r.jsx)(f,{className:"mt-2 @md/card:mt-0",children:(0,r.jsxs)("div",{className:"flex gap-2 items-center mt-2",children:[(0,r.jsx)(j.$,{variant:"desc"===c?"default":"outline",size:"sm",onClick:()=>d("desc"),"aria-label":"Sort Descending",children:(0,r.jsx)(ex.A,{size:16})}),(0,r.jsx)(j.$,{variant:"normal"===c?"default":"outline",size:"sm",onClick:()=>d("normal"),"aria-label":"Follow Order",children:(0,r.jsx)(tA.A,{size:16})}),(0,r.jsx)(j.$,{variant:"asc"===c?"default":"outline",size:"sm",onClick:()=>d("asc"),"aria-label":"Sort Ascending",children:(0,r.jsx)(eh.A,{size:16})}),(0,r.jsxs)(tj,{children:[(0,r.jsx)(tb,{asChild:!0,children:(0,r.jsxs)(j.$,{variant:"outline",children:[(0,r.jsx)(e6.A,{}),(null==i?void 0:i.from)&&(null==i?void 0:i.to)?"".concat(i.from.toLocaleDateString()," - ").concat(i.to.toLocaleDateString()):"".concat(s.toLocaleDateString()," - ").concat(n.toLocaleDateString())]})}),(0,r.jsx)(ty,{className:"w-auto overflow-hidden p-0",align:"end",children:(0,r.jsx)(ts,{className:"w-full",mode:"range",defaultMonth:null==i?void 0:i.from,selected:i,onSelect:o,fixedWeeks:!0,showOutsideDays:!0,disabled:{after:n}})})]})]})})]}),(0,r.jsx)(g,{className:"px-4",children:(0,r.jsx)(tx,{config:tL,className:"aspect-auto h-89 w-full",children:(0,r.jsxs)(tk.b,{accessibilityLayer:!0,data:y,margin:{left:12,right:12},children:[(0,r.jsx)(e9.d,{vertical:!1}),(0,r.jsx)(e7.W,{dataKey:"date",tickLine:!1,axisLine:!1,tickMargin:8,minTickGap:20,tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{day:"numeric"})}),(0,r.jsx)(tp,{content:(0,r.jsx)(tf,{className:"w-[150px]",nameKey:"customer",labelFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})}),(0,r.jsx)(tE.N,{dataKey:"customer",type:"monotone",stroke:"var(--color-customer)",strokeWidth:2,dot:!1})]})})}),(0,r.jsx)(v,{className:"border-t",children:(0,r.jsxs)("div",{className:"text-sm",children:["You had ",(0,r.jsxs)("span",{className:"font-semibold",children:["₱ ",w.toLocaleString()]})," total sales for the selected period."]})})]})}function tD(){return(0,r.jsxs)("div",{className:"flex flex-col p-6 h-full gap-3",children:[(0,r.jsxs)("div",{className:"flex-[7%]",children:[(0,r.jsx)("h1",{className:"font-extrabold text-4xl",children:"Dashboard"}),(0,r.jsx)("p",{children:"Welcome Back! Here's your business overview!"})]}),(0,r.jsx)("div",{className:"flex-[20%]",children:(0,r.jsx)(e3,{})}),(0,r.jsxs)("div",{className:"flex-[78%] flex gap-3 flex-col",children:[(0,r.jsx)("div",{className:"flex-[50%] mb-2",children:(0,r.jsx)(tS,{})}),(0,r.jsx)("div",{className:"flex-[50%]",children:(0,r.jsx)(t_,{})})]})]})}var tz=a(65229),tF=a(57419),tM=a(74054),tq=a(93736);let tT=[{value:"widget-a",label:"Widget A"},{value:"widget-b",label:"Widget B"},{value:"gadget-x",label:"Gadget X"},{value:"gadget-y",label:"Gadget Y"},{value:"part-123",label:"Part 123"}];function tI(e){var t,a;let{onAdd:n}=e,[s,i]=(0,l.useState)(!1),[o,c]=(0,l.useState)(!1),[d,u]=(0,l.useState)(""),[m,x]=(0,l.useState)(""),[h,p]=(0,l.useState)(1),[f,g]=(0,l.useState)(""),v=(0,l.useRef)(null),b=(0,l.useRef)(null),[N,C]=(0,l.useState)(null),{products:S,loading:k,error:E}=(0,M.Q)(),A=(0,l.useMemo)(()=>S&&S.length>0?S.map(e=>{var t;return{value:String(e.id),label:null!=(t=e.name)?t:"#".concat(e.id)}}):tT,[S]);(0,l.useEffect)(()=>{s&&m&&setTimeout(()=>{var e;return null==(e=v.current)?void 0:e.focus()},60)},[s,m]),(0,l.useLayoutEffect)(()=>{let e=()=>{var e,t;return C(null!=(t=null==(e=b.current)?void 0:e.offsetWidth)?t:null)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,l.useEffect)(()=>{if(o){var e,t;C(null!=(t=null==(e=b.current)?void 0:e.offsetWidth)?t:null)}},[o,m]);let L=(0,l.useMemo)(()=>new tq.A(A,{keys:["label"],threshold:.3,ignoreLocation:!0,minMatchCharLength:1}),[A]),_=(0,l.useMemo)(()=>{let e=d.trim();if(!e)return A;let t=e.toLowerCase().split(/\s+/).filter(Boolean),a=A.filter(e=>{var a;let r=String(null!=(a=e.label)?a:"").normalize("NFKC").toLowerCase();return t.every(e=>r.includes(e))});return a.length>0?a:L.search(e).map(e=>e.item)},[L,d,A]);(0,l.useEffect)(()=>{try{var e;console.log("[AddProductModal] apiProducts.length=",null!=(e=null==S?void 0:S.length)?e:0),console.log("[AddProductModal] sample apiProducts=",(null!=S?S:[]).slice(0,5)),console.log("[AddProductModal] productItems.length=",A.length),console.log("[AddProductModal] sample productItems=",A.slice(0,8)),console.log("[AddProductModal] query=",JSON.stringify(d),"filtered.length=",_.length),console.log("[AddProductModal] sample filtered=",_.slice(0,8))}catch(e){console.error("[AddProductModal] debug error",e)}},[S,A,d,_]);let D=(0,l.useCallback)(e=>{var t,a,r,l;if(e.preventDefault(),!m||h<1||""===f||0>Number(f))return;let s=null!=(r=null==(t=A.find(e=>e.value===m))?void 0:t.label)?r:m,o=null!=(l=null==S||null==(a=S.find(e=>String(e.id)===m))?void 0:a.id)?l:null;if("function"==typeof n)n({name:s,qty:h,unitPrice:Number(f),productId:o});else try{window.dispatchEvent(new CustomEvent("stock:addProduct",{detail:{name:s,qty:h,unitPrice:Number(f),productId:o}}))}catch(e){}x(""),p(1),g(""),u(""),i(!1)},[m,h,f,A,n]);return(0,l.useEffect)(()=>{E&&console.error("useProducts error:",E)},[E]),(0,r.jsxs)(P.lG,{open:s,onOpenChange:i,children:[(0,r.jsx)(P.zM,{asChild:!0,children:(0,r.jsx)(j.$,{variant:"outline",className:"h-8",children:"Add"})}),(0,r.jsx)(P.Cf,{className:"sm:max-w-[425px]",children:(0,r.jsxs)("form",{onSubmit:D,children:[(0,r.jsxs)(P.c7,{children:[(0,r.jsx)(P.L3,{children:"Add Product"}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Search and add a product with quantity and unit price."})]}),(0,r.jsxs)("div",{className:"grid gap-4 py-2",children:[(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"product-combobox",children:"Product"}),(0,r.jsxs)(tj,{open:o,onOpenChange:c,children:[(0,r.jsx)(tb,{asChild:!0,children:(0,r.jsxs)(j.$,{variant:"outline",role:"combobox","aria-expanded":o,className:"w-full justify-between text-left overflow-hidden","aria-label":"Product combobox",id:"product-combobox",ref:b,type:"button",children:[(0,r.jsx)("span",{className:"flex-1 min-w-0 truncate pr-2 text-left",children:m?null!=(a=null==(t=A.find(e=>e.value===m))?void 0:t.label)?a:m:"Select product..."}),(0,r.jsx)(tM.A,{className:"opacity-50"})]})}),(0,r.jsx)(ty,{className:"p-3 min-w-[280px] max-w-[640px]",align:"start",side:"bottom",style:N?{width:"".concat(N,"px")}:void 0,children:(0,r.jsxs)("div",{children:[(0,r.jsx)(y.p,{placeholder:"Search product...",className:"h-9 mb-2",value:d,onChange:e=>u(e.target.value),autoFocus:!0}),k?(0,r.jsx)("div",{className:"p-2 text-sm",children:"Loading products..."}):0===_.length?(0,r.jsx)("div",{className:"p-2 text-sm text-muted-foreground",children:'No product found for "'.concat(d,'". products=').concat(A.length," filtered=").concat(_.length)}):(0,r.jsx)("ul",{className:"max-h-56 overflow-auto divide-y rounded-md bg-background",children:_.map(e=>(0,r.jsx)("li",{children:(0,r.jsx)("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-muted-foreground/5 flex items-center gap-3",onClick:()=>{x(e.value),c(!1),setTimeout(()=>{var e;return null==(e=v.current)?void 0:e.focus()},60)},children:(0,r.jsx)("span",{className:"flex-1 truncate",children:String(e.label)})})},e.value))})]})})]})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"qty",children:"Quantity"}),(0,r.jsx)(y.p,{id:"qty",ref:v,type:"number",min:1,value:String(h),onChange:e=>p(Math.max(1,Number(e.target.value)||1))})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"unit-price",children:"Unit price (purchased)"}),(0,r.jsx)(y.p,{id:"unit-price",type:"number",step:"0.01",min:0,value:""===f?"":String(f),onChange:e=>g(""===e.target.value?"":Math.max(0,Number(e.target.value))),placeholder:"0.00"})]})]}),(0,r.jsxs)(P.Es,{children:[(0,r.jsx)(P.HM,{asChild:!0,children:(0,r.jsx)(j.$,{variant:"outline",children:"Cancel"})}),(0,r.jsx)(j.$,{type:"submit",disabled:!m||h<1||""===f,children:"Add"})]})]})})]})}function tR(e){let{onSave:t}=e,[a,n]=(0,l.useState)(!1),[s,i]=(0,l.useState)(new Date);(0,l.useEffect)(()=>{let e=e=>{(null==e?void 0:e.detail)&&_(e.detail)};return window.addEventListener("stock:addProduct",e),()=>window.removeEventListener("stock:addProduct",e)},[]);let[o,c]=(0,l.useState)(""),[d,u]=(0,l.useState)(void 0),[v,w]=(0,l.useState)(""),[N,C]=(0,l.useState)([]),[S,E]=(0,l.useState)(!1),{mutate:A}=(0,tF.iX)(),L=async()=>{if(!o||0===N.length)return void alert("Company and at least one product are required.");let e={company_name:o,date:d?d.toISOString():new Date().toISOString(),total:Number(v)||0,items:N.map(e=>{var t,a;return{product_id:null!=(t=e.productId)?t:null,purchased_price:null!=(a=e.unitPrice)?a:Number(v)||0,quantity:e.qty}})};try{E(!0);let a="/stock-transactions",r=await b.A.post(a,e),l=r.data;if(r.status>=400)throw Error((null==l?void 0:l.message)||(null==l?void 0:l.error)||"Save failed");null==t||t({company:o,date:d?d.toISOString():new Date().toISOString(),price:Number(v)||0,products:N}),A(a),c(""),u(void 0),w(""),C([]),n(!1)}catch(e){var a;console.error("save stock error",e),alert("Save failed: ".concat(null!=(a=null==e?void 0:e.message)?a:e))}finally{E(!1)}},_=e=>{C(t=>{var a,r;let l=t.findIndex(t=>null!=e.productId?t.productId===e.productId:t.name===e.name);if(-1!==l){let r=[...t];return r[l]={...r[l],qty:r[l].qty+e.qty,unitPrice:e.unitPrice,productId:null!=(a=r[l].productId)?a:e.productId},r}return[...t,{id:"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,9)),productId:null!=(r=e.productId)?r:null,name:e.name,qty:e.qty,unitPrice:e.unitPrice}]})},D=(e,t,a)=>{C(r=>r.map(r=>{if(r.id!==e)return r;let l="qty"===t?Math.max(0,Math.floor(Number(a)||0)):Math.max(0,Number(a)||0);return{...r,[t]:l}}))};return N.reduce((e,t)=>e+t.qty*t.unitPrice,0),(0,r.jsxs)(P.lG,{open:a,onOpenChange:n,children:[(0,r.jsx)(P.zM,{asChild:!0,children:(0,r.jsxs)(j.$,{className:"h-full flex items-center gap-2",children:[(0,r.jsx)(k.A,{size:16}),"Add Stocks"]})}),(0,r.jsxs)(P.Cf,{className:" flex h-[calc(80vh-2rem)] min-w-[calc(80vw-2rem)] flex-col justify-between gap-0 p-0",children:[(0,r.jsxs)(tw.F,{className:"flex-1 overflow-hidden",children:[(0,r.jsxs)(P.c7,{className:"contents space-y-0 text-left",children:[(0,r.jsx)(P.L3,{className:"px-6 pt-6",children:"Add Stock"}),(0,r.jsx)(P.rr,{asChild:!0,children:(0,r.jsx)("div",{className:"pt-2 px-6",children:(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enter stock details and add products."})})})]}),(0,r.jsx)("div",{className:"px-6 pt-2",children:(0,r.jsxs)("div",{className:"flex w-full gap-6",children:[(0,r.jsxs)("div",{className:"flex-[40%] ",children:[(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("label",{className:"text-sm block mb-1",children:"Company"}),(0,r.jsx)(y.p,{value:o,onChange:e=>c(e.target.value),placeholder:"Company name"})]}),(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("label",{className:"text-sm block mb-1",children:"Date"}),(0,r.jsxs)(tj,{children:[(0,r.jsx)(tb,{asChild:!0,children:(0,r.jsxs)(j.$,{variant:"outline",className:"w-full h-10 justify-between text-left px-3",type:"button","aria-label":"Choose date",children:[(0,r.jsx)("span",{className:"truncate",children:d?d.toLocaleDateString():"mm/dd/yyyy"}),(0,r.jsx)(e6.A,{className:"ml-2 opacity-70"})]})}),(0,r.jsx)(ty,{className:"w-auto p-2",children:(0,r.jsxs)(m,{className:"w-[290px]",children:[(0,r.jsxs)(x,{className:"flex items-start gap-2",children:[(0,r.jsx)("div",{children:(0,r.jsxs)(p,{className:"text-xs text-muted-foreground",children:[(0,r.jsx)(h,{className:"text-sm",children:"Choose date"}),"Select a date for this stock entry"]})}),(0,r.jsx)(f,{children:(0,r.jsx)(j.$,{size:"sm",variant:"outline",onClick:()=>{let e=new Date;i(e),u(e)},children:"Today"})})]}),(0,r.jsx)(g,{className:"p-2",children:(0,r.jsx)(ts,{mode:"single",month:s,onMonthChange:i,selected:d,onSelect:u,className:"bg-transparent p-0 rounded-md"})})]})})]})]}),(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("label",{className:"text-sm block mb-1",children:"Price"}),(0,r.jsx)(y.p,{type:"number",step:"0.01",value:""===v?"":String(v),onChange:e=>w(""===e.target.value?"":Number(e.target.value)),placeholder:"0.00"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col h-full flex-[60%]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("h3",{className:"font-medium",children:"Products"}),(0,r.jsx)(tI,{onAdd:_})]}),(0,r.jsx)("div",{className:"[&>div]:max-h-[400px] [&>div]:rounded-sm [&>div]:border",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(q,{className:"table-fixed w-full",children:[(0,r.jsx)(T,{children:(0,r.jsxs)(R,{className:"bg-background sticky top-0",children:[(0,r.jsx)(K,{className:"w-[35%]",children:"Product"}),(0,r.jsx)(K,{className:"w-[10%] text-center",children:"Quantity"}),(0,r.jsx)(K,{className:"w-[10%] text-center",children:"Unit Price"}),(0,r.jsx)(K,{className:"w-[8%]"})]})}),(0,r.jsx)(I,{children:0===N.length?(0,r.jsx)(R,{children:(0,r.jsx)($,{colSpan:4,children:(0,r.jsx)("div",{className:"w-full h-24 flex items-center justify-center text-sm text-muted-foreground",children:"No products added."})})}):N.map(e=>(0,r.jsxs)(R,{children:[(0,r.jsx)($,{className:"min-w-0 break-words whitespace-normal pr-4",children:(0,r.jsx)("div",{className:"font-medium",children:e.name})}),(0,r.jsx)($,{className:"text-center align-middle",children:(0,r.jsx)(y.p,{type:"number",min:0,value:String(e.qty),onChange:t=>D(e.id,"qty",t.target.value),onBlur:t=>D(e.id,"qty",t.target.value),className:"focus-visible:ring-ring h-8 w-20 border-0 bg-transparent p-1 text-center focus-visible:ring-1 mx-auto","aria-label":"qty-".concat(e.id)})}),(0,r.jsx)($,{className:"text-center align-middle",children:(0,r.jsx)(y.p,{type:"number",step:"0.01",min:0,value:String(e.unitPrice),onChange:t=>D(e.id,"unitPrice",t.target.value),onBlur:t=>D(e.id,"unitPrice",t.target.value),className:"focus-visible:ring-ring h-8 w-24 border-0 bg-transparent p-1 text-center focus-visible:ring-1 mx-auto","aria-label":"unit-".concat(e.id)})}),(0,r.jsx)($,{className:"text-center align-middle",children:(0,r.jsx)(j.$,{variant:"ghost",size:"sm",onClick:()=>{var t;return t=e.id,void C(e=>e.filter(e=>e.id!==t))},"aria-label":"Remove product",children:(0,r.jsx)(tz.A,{className:"h-4 w-4"})})})]},e.id))})]})})})]})]})})]}),(0,r.jsxs)(P.Es,{className:"px-6 pb-6 sm:justify-end",children:[(0,r.jsx)(P.HM,{asChild:!0,children:(0,r.jsxs)(j.$,{variant:"outline",onClick:()=>n(!1),disabled:S,children:[(0,r.jsx)(eM.A,{}),"Back"]})}),(0,r.jsx)(j.$,{onClick:L,disabled:S,children:S?"Saving...":"Save"})]})]})]})}function tK(){return(0,r.jsxs)("div",{className:"flex justify-between items-center h-full",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Stock Movements"}),(0,r.jsx)("div",{className:"flex gap-3",children:(0,r.jsx)(tR,{})})]})}let t$=async e=>{var t,a;return null!=(a=null==(t=(await b.A.get(e)).data)?void 0:t.data)?a:[]};var tO=a(57828);let tU=[{accessorKey:"company_name",header:"Company Name",cell:e=>{let{row:t}=e;return(0,r.jsx)("div",{className:"font-medium",children:t.getValue("company_name")})}},{accessorKey:"date",header:"Date",cell:e=>{let{row:t}=e,a=t.getValue("date"),l=a?new Date(a).toLocaleDateString():"";return(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:l})}},{accessorKey:"total",header:()=>(0,r.jsx)("div",{className:"text-right",children:"Total"}),cell:e=>{var t;let{row:a}=e,l=parseFloat(String(null!=(t=a.getValue("total"))?t:0)),n=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(l);return(0,r.jsx)("div",{className:"text-right font-medium",children:n})}},{id:"actions",header:"",cell:e=>{var t,a,n,s;let{row:i}=e,o=String(null!=(a=i.getValue("company_name"))?a:""),c=String(null!=(n=i.getValue("date"))?n:""),d=c?new Date(c).toLocaleDateString():"",u=parseFloat(String(null!=(s=i.getValue("total"))?s:0)),m=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(u),x=null==(t=i.original)?void 0:t.id;return(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(e=>{var t,a,n,s;let{id:c}=e,[u,x]=l.useState(!1),[h,p]=l.useState(null),[f,g]=l.useState(!1),[v,y]=l.useState(null);l.useEffect(()=>{if(!u)return;let e=!0;return(async()=>{var t,a,r,l;g(!0),y(null);try{let l=await b.A.get("/stock-transactions/".concat(c)),n=l.data;if(l.status>=400)throw Error((null==n?void 0:n.message)||(null==n?void 0:n.error)||"Failed to load");let s=null!=(r=null!=(a=null==n?void 0:n.items)?a:null==n||null==(t=n.data)?void 0:t.items)?r:[];e&&p(Array.isArray(s)?s:[])}catch(t){console.error("load transaction items error",t),e&&y(null!=(l=null==t?void 0:t.message)?l:String(t))}finally{e&&g(!1)}})(),()=>{e=!1}},[u,c]);let w=null!=(s=null!=(n=null==(t=i.original)?void 0:t.items)?n:null==(a=i.original)?void 0:a.products)?s:[],N=null!=h?h:Array.isArray(w)?w:[];return(0,r.jsxs)(P.lG,{open:u,onOpenChange:x,children:[(0,r.jsx)(P.zM,{asChild:!0,children:(0,r.jsx)(j.$,{variant:"ghost",size:"sm","aria-label":"View details",children:(0,r.jsx)(tO.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(P.Cf,{className:"flex max-h-[min(640px,84vh)] flex-col gap-0 p-0 sm:max-w-lg",children:[(0,r.jsx)(P.c7,{className:"contents space-y-0 text-left",children:(0,r.jsxs)(tw.F,{className:"flex max-h-full flex-col overflow-hidden",children:[(0,r.jsx)(P.L3,{className:"px-6 pt-6 text-lg md:text-xl font-semibold text-foreground",children:"Transaction Details"}),(0,r.jsx)(P.rr,{asChild:!0,children:(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsxs)("div",{className:"flex items-baseline gap-3",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Company:"}),(0,r.jsx)("span",{className:"text-base font-medium text-foreground",children:o})]}),(0,r.jsxs)("div",{className:"flex items-baseline gap-3",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Date:"}),(0,r.jsx)("span",{className:"text-sm text-foreground",children:d})]}),(0,r.jsxs)("div",{className:"flex items-baseline gap-3",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total:"}),(0,r.jsx)("span",{className:"text-base font-semibold text-foreground",children:m})]})]}),(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-muted-foreground",children:"Products"}),f?(0,r.jsx)("div",{className:"text-sm text-muted-foreground mt-3",children:"Loading products…"}):v?(0,r.jsxs)("div",{className:"text-sm text-destructive mt-3",children:["Failed to load products: ",v]}):N&&0!==N.length?(0,r.jsx)("div",{className:"mt-3 overflow-auto rounded-sm border",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-muted/5",children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs text-muted-foreground",children:"Product"}),(0,r.jsx)("th",{className:"px-4 py-3 text-right text-xs text-muted-foreground",children:"Qty"}),(0,r.jsx)("th",{className:"px-4 py-3 text-right text-xs text-muted-foreground",children:"Unit"}),(0,r.jsx)("th",{className:"px-4 py-3 text-right text-xs text-muted-foreground",children:"Subtotal"})]})}),(0,r.jsx)("tbody",{children:N.map((e,t)=>{var a,l,n,s,i,o,c,d,u;let m=null!=(s=null!=(n=null!=(l=null==(a=e.product)?void 0:a.name)?l:e.product_name)?n:e.name)?s:e.product_id?"#".concat(e.product_id):"Item ".concat(t+1),x=Number(null!=(o=null!=(i=e.quantity)?i:e.qty)?o:0),h=Number(null!=(u=null!=(d=null!=(c=e.purchased_price)?c:e.unit_price)?d:e.price)?u:0),p=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(h),f=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(x*h);return(0,r.jsxs)("tr",{className:"border-t last:border-b",children:[(0,r.jsx)("td",{className:"px-4 py-3 align-top text-sm text-foreground max-w-[260px] break-words whitespace-normal",children:m}),(0,r.jsx)("td",{className:"px-4 py-3 align-top text-sm text-right text-foreground",children:x}),(0,r.jsx)("td",{className:"px-4 py-3 align-top text-sm text-right text-foreground",children:p}),(0,r.jsx)("td",{className:"px-4 py-3 align-top text-sm text-right font-medium text-foreground",children:f})]},t)})})]})}):(0,r.jsx)("div",{className:"text-sm text-muted-foreground mt-3",children:"No products available for this transaction."})]})]})})})]})}),(0,r.jsx)(P.Es,{className:"flex-row items-center justify-end border-t px-6 py-4",children:(0,r.jsx)(P.HM,{asChild:!0,children:(0,r.jsxs)(j.$,{variant:"outline",size:"sm",children:[(0,r.jsx)(eM.A,{}),"Back"]})})})]})]})},{id:x})})}}],tB=()=>{var e;let{data:t,loading:a,error:n}=function(){let{data:e,error:t,isValidating:a}=(0,eo.Ay)("/stock-transactions",t$,{revalidateOnFocus:!1});return{data:e,loading:!t&&!e&&a,error:t?t.message:null}}(),[s,i]=(0,l.useState)([]),[o,c]=(0,l.useState)([]),[d,u]=(0,l.useState)({}),[m,x]=(0,l.useState)({}),[h,p]=(0,l.useState)(""),f=(0,ek.N4)({data:null!=t?t:[],columns:tU,onSortingChange:i,onColumnFiltersChange:c,getCoreRowModel:(0,eE.HT)(),getPaginationRowModel:(0,eE.kW)(),getSortedRowModel:(0,eE.h5)(),getFilteredRowModel:(0,eE.hM)(),onColumnVisibilityChange:u,onRowSelectionChange:x,onGlobalFilterChange:p,globalFilterFn:"includesString",state:{sorting:s,columnFilters:o,columnVisibility:d,rowSelection:m,globalFilter:h}});return(0,r.jsxs)("div",{className:"w-full h-full",children:[(0,r.jsxs)("div",{className:"flex justify-between gap-2 pb-4 max-sm:flex-col sm:items-center",children:[(0,r.jsx)("div",{className:"flex items-center space-x-2",children:(0,r.jsx)(y.p,{placeholder:"Search all columns...",value:null!=h?h:"",onChange:e=>p(String(e.target.value)),className:"max-w-sm"})}),(0,r.jsx)("div",{className:"flex items-center space-x-2",children:(0,r.jsxs)("div",{className:"text-muted-foreground text-sm",children:[f.getSelectedRowModel().rows.length>0&&(0,r.jsxs)("span",{className:"mr-2",children:[f.getSelectedRowModel().rows.length," of ",f.getFilteredRowModel().rows.length," row(s) selected"]}),a&&(0,r.jsx)("span",{className:"ml-2",children:"Loading..."}),n&&(0,r.jsxs)("span",{className:"ml-2 text-destructive",children:["Error: ",n]})]})})]}),(0,r.jsx)("div",{className:"rounded-md border",children:(0,r.jsxs)(q,{children:[(0,r.jsx)(T,{children:f.getHeaderGroups().map(e=>(0,r.jsx)(R,{children:e.headers.map(e=>(0,r.jsx)(K,{children:e.isPlaceholder?null:(0,ek.Kv)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,r.jsx)(I,{children:(null==(e=f.getRowModel().rows)?void 0:e.length)?f.getRowModel().rows.map(e=>(0,r.jsx)(R,{"data-state":e.getIsSelected()&&"selected",children:e.getVisibleCells().map(e=>(0,r.jsx)($,{children:(0,ek.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,r.jsx)(R,{children:(0,r.jsx)($,{colSpan:tU.length,className:"h-24 text-center",children:"No results."})})})]})})]})};function tG(){return(0,r.jsx)(m,{className:"h-full border",children:(0,r.jsx)(g,{children:(0,r.jsx)(tB,{})})})}function tV(){return(0,r.jsxs)("div",{className:"flex flex-col gap-4 p-8 w-full h-full",children:[(0,r.jsx)("div",{className:"h-full flex-[10%]",children:(0,r.jsx)(tK,{})}),(0,r.jsx)("div",{className:" h-full flex-[90%]",children:(0,r.jsx)(tG,{})})]})}function tH(e){let{params:t}=e,{site:a}=(0,l.use)(t);switch(a){case"main":return(0,r.jsx)(es,{});case"db":return(0,r.jsx)(tD,{});case"products":return(0,r.jsx)(e0,{});case"stock":return(0,r.jsx)(tV,{});default:return(0,r.jsx)("div",{children:a})}}},75399:(e,t,a)=>{Promise.resolve().then(a.bind(a,44720))}},e=>{e.O(0,[557,720,159,193,585,441,255,358],()=>e(e.s=75399)),_N_E=e.O()}]);