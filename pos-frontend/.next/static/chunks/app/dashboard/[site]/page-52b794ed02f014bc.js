(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[759],{50477:()=>{},50792:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>tG});var l=a(95155),s=a(12115),r=a(36764),n=a(47943);let i=(0,s.createContext)(void 0),c=(e,t)=>(null==e?void 0:e.id)&&(null==t?void 0:t.id)?e.id===t.id:!!((null==e?void 0:e.barcode)&&(null==t?void 0:t.barcode)&&e.barcode===t.barcode),o=e=>{let{children:t}=e,[a,o]=(0,s.useState)([]),[d,u]=(0,s.useState)(null),[m,x]=(0,s.useState)(!1),[h,f]=(0,s.useState)(null),{setBarcode:p,openModal:g,setOpen:j}=(0,n.c)(),v=(0,s.useCallback)(()=>o([]),[]),b=(0,s.useCallback)(e=>{f(e)},[]),y=(0,s.useCallback)(()=>{try{(null==h?void 0:h.current)&&h.current.focus()}catch(e){}},[h]),N=(0,s.useCallback)((e,t)=>{o(a=>a.map(a=>a.id===e?{...a,quantity:t}:a))},[]),w=(0,s.useCallback)((e,t)=>{o(a=>a.map(a=>a.id===e?{...a,product:{...a.product,price:t}}:a))},[]),C=(0,s.useCallback)(e=>{o(t=>t.filter(t=>t.id!==e))},[]),S=(0,s.useCallback)(e=>{o(t=>t.find(t=>c(t.product,e))?t.map(t=>c(t.product,e)?{...t,quantity:t.quantity+1}:t):[...t,{product:e,quantity:1,id:"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():Date.now().toString()}])},[]),k=(0,s.useCallback)(async e=>{if(e)try{x(!0),u(null);let t=String(e).replace(/[\u0000-\u001F\u007F-\u009F]/g,"").trim();if(!t)return void u("Invalid barcode");let a=await r.G.getByBarcode(t);if(a)S(a);else{try{"function"==typeof p&&p(t),"function"==typeof g?g("addProduct"):"function"==typeof j&&j(!0)}catch(e){}u("Product not found: ".concat(t))}}catch(e){u(e instanceof Error?e.message:"Error scanning barcode")}finally{x(!1),y()}},[g,j,p,y,S]);(0,s.useEffect)(()=>{let e=e=>{let t=null==e?void 0:e.detail;if(!t)return;let a=t.product,l=t.barcode;a?S(a):l&&(async()=>{try{let e=await r.G.getByBarcode(l);e&&S(e)}catch(e){}})();try{let e=null==h?void 0:h.current;if(e){try{e.value=""}catch(e){}e.dispatchEvent(new Event("input",{bubbles:!0}));try{e.focus()}catch(e){}}}catch(e){}};return window.addEventListener("product:added",e),()=>window.removeEventListener("product:added",e)},[h,S]);let A=(0,s.useMemo)(()=>a.reduce((e,t)=>e+Number(t.product.price||0)*t.quantity,0),[a]),_=(0,s.useMemo)(()=>({cart:a,cartTotal:A,scanError:d,isScanning:m,scanAndAddToCart:k,refocusScanner:y,setScannerRef:b,updateCartItemQuantity:N,updateCartItemPrice:w,deleteCartItem:C,clearCart:v}),[a,A,d,m,k,y,b,N,w,C,v]);return(0,l.jsx)(i.Provider,{value:_,children:t})},d=()=>{let e=(0,s.useContext)(i);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e};var u=a(64269);function m(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card",className:(0,u.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function x(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-header",className:(0,u.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function h(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-title",className:(0,u.cn)("leading-none font-semibold",t),...a})}function f(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-description",className:(0,u.cn)("text-muted-foreground text-sm",t),...a})}function p(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-action",className:(0,u.cn)("col-start-2 row-span-2 row-start-1 self-start justify-self-end",t),...a})}function g(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-content",className:(0,u.cn)("px-6",t),...a})}function j(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-footer",className:(0,u.cn)("flex items-center px-6 [.border-t]:pt-6",t),...a})}var v=a(3998),b=a(65142),y=a(76444);function N(e){let{amount:t,setAmount:a,cartTotal:s,refocusScanner:r,onNext:n,cartIsEmpty:i=!1}=e,c=e=>{if("C"===e)a("");else if("⌫"===e)a(t.slice(0,-1));else{if("."===e&&t.includes("."))return;a(t+e)}r()};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(y.J,{className:"text-lg mb-2 font-medium",children:"Cash"}),(0,l.jsx)(b.p,{className:"h-20 !text-5xl text-right font-medium mb-6 border-2 border-gray-300 shadow-sm placeholder:text-5xl placeholder:font-medium placeholder:text-gray-400",value:t,onChange:e=>{a(e.target.value),setTimeout(r,3e3)},placeholder:"0.00",onBlur:r,onClick:e=>e.stopPropagation(),disabled:i}),(0,l.jsxs)("div",{className:"flex-1 grid grid-cols-3 gap-2 bg-gray-50 p-3 rounded-lg",children:[[7,8,9,4,5,6,1,2,3].map(e=>(0,l.jsx)(v.$,{onClick:()=>c(e.toString()),variant:"outline",className:"h-16 text-2xl font-medium",disabled:i,children:e},e)),(0,l.jsx)(v.$,{onClick:()=>c("."),variant:"outline",className:"h-16 text-2xl font-medium",disabled:i,children:"."}),(0,l.jsx)(v.$,{onClick:()=>c("0"),variant:"outline",className:"h-16 text-2xl font-medium",disabled:i,children:"0"}),(0,l.jsx)(v.$,{onClick:()=>c("⌫"),variant:"outline",className:"h-16 text-2xl font-medium",disabled:i,children:"⌫"}),(0,l.jsx)(v.$,{onClick:()=>c("C"),variant:"outline",className:"h-16 text-2xl font-medium col-span-3",disabled:i,children:"Clear"})]}),(0,l.jsx)("div",{className:"px-4 pb-4 pt-4",children:(0,l.jsx)(v.$,{className:"w-full h-14 text-xl font-medium",onClick:n,disabled:i||!t||parseFloat(t)<s,children:"Next"})})]})}var w=a(20508),C=a(6191);function S(e){let{customerQuery:t,setCustomerQuery:a,filteredCustomers:r,selectedCustomer:n,selectCustomer:i,clearCustomer:c,onAddCustomer:o}=e,d=(0,s.useId)();return(0,l.jsxs)("div",{className:"w-full mb-4",children:[(0,l.jsx)(y.J,{htmlFor:d,className:"mb-2 block",children:"Customer Name"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("div",{className:"relative flex-1",children:[(0,l.jsx)("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-400",children:(0,l.jsx)(w.A,{className:"w-4 h-4"})}),(0,l.jsx)(b.p,{id:d,className:"pl-9",placeholder:"Search Name",value:n?n.name:t,onChange:e=>{a(e.target.value),c()},autoComplete:"off"}),t&&!n&&(0,l.jsxs)("div",{className:"absolute z-10 left-0 right-0 bg-white border rounded shadow max-h-40 overflow-y-auto",children:[0===r.length&&(0,l.jsx)("div",{className:"p-2 text-gray-500 text-center",children:"No results"}),r.map(e=>(0,l.jsxs)("div",{className:"p-2 hover:bg-gray-100 cursor-pointer flex justify-between",onClick:()=>{i(e),a(e.name)},children:[(0,l.jsx)("span",{children:e.name}),(0,l.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:[e.points," pts"]})]},e.id))]})]}),(0,l.jsxs)(v.$,{type:"button",onClick:o,className:"ml-2",children:[(0,l.jsx)(C.A,{className:"w-4 h-4 mr-1"})," Add"]})]})]})}function k(e){let{amount:t,cartTotal:a,change:s}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"py-5 border-t border-b",children:[(0,l.jsxs)("div",{className:"flex justify-between text-xl mb-3",children:[(0,l.jsx)("span",{children:"Amount Paid:"}),(0,l.jsxs)("span",{className:"font-medium",children:["₱ ",parseFloat(t).toFixed(2)]})]}),(0,l.jsxs)("div",{className:"flex justify-between text-xl mb-3",children:[(0,l.jsx)("span",{children:"Total:"}),(0,l.jsxs)("span",{className:"font-medium",children:["₱ ",a.toFixed(2)]})]})]}),(0,l.jsxs)("div",{className:"flex justify-between text-3xl font-bold pt-5",children:[(0,l.jsx)("span",{children:"Change:"}),(0,l.jsxs)("span",{children:["₱ ",s.toFixed(2)]})]})]})}function A(e){let{selectedCustomer:t,cartTotal:a}=e;return(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center flex-1",children:[(0,l.jsx)("h2",{className:"text-3xl font-bold mb-4",children:"Transaction Successful!"}),(0,l.jsx)("p",{className:"mb-8",children:"Thank you for your purchase."})]})}var _=a(51834);function E(e){let{open:t,onOpenChange:a,onCustomerAdded:r}=e,[n,i]=(0,s.useState)(""),[c,o]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),[m,x]=(0,s.useState)(null);(0,s.useEffect)(()=>{t||(i(""),x(null),o(!1),u(!1))},[t]);let h=e=>e.trim().toLowerCase(),f=async()=>{let e=n.trim();if(x(null),0===e.length)return void x("Name cannot be empty.");o(!0),u(!0);try{var t;let l="http://3.25.180.232:5000/api".replace(/\/$/,""),s="".concat(l,"/customers?name=").concat(encodeURIComponent(e)),n=await fetch(s),c=await n.json().catch(()=>({}));if((Array.isArray(c)?c:Array.isArray(null==c?void 0:c.data)?c.data:[]).some(t=>!!t&&"string"==typeof t.name&&h(t.name)===h(e))){x("A customer with this name already exists."),o(!1),u(!1);return}let d=await fetch("".concat(l,"/customers"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})}),m=await d.json().catch(()=>({}));if(!d.ok||!1===m.success){let e=m.message||m.error||"Failed to add customer";throw Error(e)}let f=null!=(t=m.data)?t:m;i(""),a(!1),r(f)}catch(e){x((null==e?void 0:e.message)||"Failed to add customer")}finally{o(!1),u(!1)}},p=c||d||0===n.trim().length;return(0,l.jsx)(_.lG,{open:t,onOpenChange:a,children:(0,l.jsxs)(_.Cf,{children:[(0,l.jsx)(_.c7,{children:(0,l.jsx)(_.L3,{children:"Add Customer"})}),(0,l.jsxs)("div",{className:"flex flex-col gap-2 my-2",children:[(0,l.jsx)(y.J,{htmlFor:"customer-name",children:"Name"}),(0,l.jsx)(b.p,{id:"customer-name",value:n,onChange:e=>{i(e.target.value),x(null)},placeholder:"Enter customer name",disabled:c}),d&&(0,l.jsx)("span",{className:"text-gray-500 text-sm",children:"Checking name..."}),m&&(0,l.jsx)("span",{className:"text-red-500 text-sm",children:m})]}),(0,l.jsxs)(_.Es,{children:[(0,l.jsx)(v.$,{variant:"outline",onClick:()=>a(!1),disabled:c,children:"Cancel"}),(0,l.jsx)(v.$,{onClick:f,disabled:p,children:c?"Adding...":"Add"})]})]})})}var L=a(20931);let P=L.vv.create({page:{backgroundColor:"#fff",color:"#262626",fontFamily:"Roboto",fontSize:12,padding:12},header:{textAlign:"center",marginBottom:4},pharmacy:{fontSize:18,fontWeight:"bold",marginBottom:2},address:{fontSize:10,marginBottom:6},divider:{borderBottomWidth:1.5,borderBottomColor:"#000",borderStyle:"dashed",marginVertical:8},row:{flexDirection:"row",justifyContent:"space-between",marginBottom:2},bold:{fontWeight:"bold"},tableHeader:{flexDirection:"row",borderBottomWidth:1.5,borderBottomColor:"#000",borderStyle:"dashed",marginBottom:2,fontWeight:"bold",paddingTop:4,paddingBottom:4},colDesc:{width:"45%"},colQty:{width:"20%",textAlign:"center"},colAmount:{width:"35%",textAlign:"right"},totalRow:{flexDirection:"row",justifyContent:"flex-end",marginTop:8,fontWeight:"bold",fontSize:13},footer:{textAlign:"center",marginTop:8,fontSize:10},solution:{textAlign:"center",marginTop:8,fontSize:10,fontWeight:"bold"}});L.KQ.register({family:"Roboto",src:"/fonts/Roboto/Roboto-VariableFont_wdth,wght.ttf"});let z=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"2-digit"});function F(e){let{cartTotal:t,amount:a,change:s,customer:r,items:n}=e,i=280+20*n.length;return(0,l.jsx)(L.yo,{children:(0,l.jsxs)(L.YW,{size:[227,i],style:P.page,children:[(0,l.jsxs)(L.Ss,{style:P.header,children:[(0,l.jsx)(L.EY,{style:P.pharmacy,children:"STORE DA"}),(0,l.jsx)(L.EY,{style:P.address,children:"Itoy Igid"})]}),(0,l.jsx)(L.Ss,{style:P.divider}),(0,l.jsxs)(L.Ss,{style:P.row,children:[(0,l.jsx)(L.EY,{style:P.bold,children:"Customer:"}),(0,l.jsx)(L.EY,{children:(null==r?void 0:r.name)||"N/A"})]}),(0,l.jsx)(L.Ss,{style:P.row,children:(0,l.jsxs)(L.EY,{children:[(0,l.jsx)(L.EY,{style:P.bold,children:"Date:"})," ",z]})}),(0,l.jsx)(L.Ss,{style:P.divider}),(0,l.jsxs)(L.Ss,{style:P.tableHeader,children:[(0,l.jsx)(L.EY,{style:P.colDesc,children:"Description"}),(0,l.jsx)(L.EY,{style:P.colQty,children:"Qty"}),(0,l.jsx)(L.EY,{style:P.colAmount,children:"Amount"})]}),n.map((e,t)=>(0,l.jsxs)(L.Ss,{style:P.row,children:[(0,l.jsx)(L.EY,{style:P.colDesc,children:e.desc}),(0,l.jsx)(L.EY,{style:P.colQty,children:e.qty}),(0,l.jsx)(L.EY,{style:P.colAmount,children:e.amount.toFixed(2)})]},t)),(0,l.jsx)(L.Ss,{style:P.divider}),(0,l.jsxs)(L.Ss,{style:P.totalRow,children:[(0,l.jsx)(L.EY,{children:"Total: "}),(0,l.jsxs)(L.EY,{style:{fontWeight:"bold",marginLeft:8},children:["₱",t.toFixed(2)]})]}),(0,l.jsxs)(L.Ss,{style:P.row,children:[(0,l.jsx)(L.EY,{children:"Amount:"}),(0,l.jsxs)(L.EY,{children:["₱",parseFloat(a||"0").toFixed(2)]})]}),(0,l.jsxs)(L.Ss,{style:P.row,children:[(0,l.jsx)(L.EY,{children:"Change:"}),(0,l.jsxs)(L.EY,{children:["₱",s.toFixed(2)]})]}),(0,l.jsx)(L.Ss,{style:P.divider}),(0,l.jsx)(L.EY,{style:P.solution,children:"GATANG KA MANNEN!"})]})})}function M(e){let{step:t,setStep:a}=e,{cart:r,cartTotal:n,refocusScanner:i,clearCart:c}=d(),[o,u]=(0,s.useState)(""),[x,h]=(0,s.useState)(0),[f,p]=(0,s.useState)(!1);(0,s.useEffect)(()=>{h((parseFloat(o)||0)-n)},[o,n]);let{customerQuery:b,setCustomerQuery:y,filteredCustomers:w,selectedCustomer:C,selectCustomer:_,clearCustomer:P,fetchCustomers:z,allCustomers:M,setAllCustomers:D}=function(){let[e,t]=(0,s.useState)(""),[a,l]=(0,s.useState)([]),[r,n]=(0,s.useState)([]),[i,c]=(0,s.useState)(null),o=async()=>{try{let e=await fetch("".concat("http://3.25.180.232:5000/api","/customers")),t=await e.json();t.success&&Array.isArray(t.data)?l(t.data):l([])}catch(e){l([])}};return(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat("http://3.25.180.232:5000/api","/customers")),t=await e.json();t.success&&Array.isArray(t.data)?l(t.data):l([])}catch(e){l([])}})()},[]),(0,s.useEffect)(()=>{n(a.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())))},[e,a]),(0,s.useEffect)(()=>{o()},[]),{customerQuery:e,setCustomerQuery:t,filteredCustomers:r,selectedCustomer:i,selectCustomer:e=>{c(e),t(e.name)},clearCustomer:()=>c(null),fetchCustomers:o,allCustomers:a,setAllCustomers:l}}(),q=async()=>{let e=await (0,L.x8)((0,l.jsx)(F,{cartTotal:n,amount:o,change:x,customer:C,items:r.map(e=>({desc:e.product.name,qty:e.quantity,amount:e.product.price*e.quantity}))})).toBlob(),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="receipt-".concat(Date.now(),".pdf"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)},T=async()=>{await fetch("http://3.25.180.232:5000/api/sales",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_id:(null==C?void 0:C.id)||null,total_purchase:n,items:r.map(e=>({product_id:e.product.id,quantity:e.quantity,price:e.product.price}))})}),a(1),u(""),P(),h(0),i(),c()};return(0,l.jsx)(m,{className:"h-full flex flex-col",onClick:()=>i(),children:(0,l.jsxs)(g,{className:"flex-1 flex flex-col p-4 pb-0",children:[(0,l.jsx)("h1",{className:"text-xl font-medium",children:"Total"}),(0,l.jsx)("div",{className:"w-full py-3 mb-2",children:(0,l.jsxs)("div",{className:"flex justify-between text-5xl font-medium",children:[(0,l.jsx)("h1",{children:"₱"}),(0,l.jsx)("h1",{children:n.toFixed(2)})]})}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col",children:[1===t&&(0,l.jsx)(N,{amount:o,setAmount:u,cartTotal:n,refocusScanner:i,onNext:()=>{let e=parseFloat(o)||0;e>=n?(h(e-n),a(2)):alert("Insufficient amount")},cartIsEmpty:0===r.length}),2===t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(k,{amount:o,cartTotal:n,change:x}),(0,l.jsx)("div",{className:"flex-1"}),(0,l.jsx)(S,{customerQuery:b,setCustomerQuery:y,filteredCustomers:w,selectedCustomer:C,selectCustomer:_,clearCustomer:P,onAddCustomer:()=>p(!0)}),(0,l.jsx)(E,{open:f,onOpenChange:p,onCustomerAdded:e=>{D(t=>[...t,e]),_(e),y(e.name)}}),(0,l.jsxs)(j,{className:"px-4 pb-4 pt-4 flex flex-col gap-3",children:[(0,l.jsx)(v.$,{className:"w-full h-14 text-xl font-medium",variant:"outline",onClick:()=>a(1),children:"Back"}),(0,l.jsx)(v.$,{className:"w-full h-14 text-xl font-medium",onClick:()=>a(3),children:"Finish Transaction"})]})]}),3===t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(A,{selectedCustomer:C,cartTotal:n}),(0,l.jsxs)(j,{className:"px-4 pb-4 pt-4 flex flex-col gap-2",children:[(0,l.jsx)(v.$,{className:"w-full h-14 text-xl font-medium",onClick:q,children:"Print Receipt"}),(0,l.jsx)(v.$,{className:"w-full h-14 text-xl font-medium",variant:"outline",onClick:T,children:"Close"})]})]})]})]})})}var D=a(67931);function q(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,l.jsx)("table",{"data-slot":"table",className:(0,u.cn)("w-full caption-bottom text-sm",t),...a})})}function T(e){let{className:t,...a}=e;return(0,l.jsx)("thead",{"data-slot":"table-header",className:(0,u.cn)("[&_tr]:border-b",t),...a})}function R(e){let{className:t,...a}=e;return(0,l.jsx)("tbody",{"data-slot":"table-body",className:(0,u.cn)("[&_tr:last-child]:border-0",t),...a})}function $(e){let{className:t,...a}=e;return(0,l.jsx)("tr",{"data-slot":"table-row",className:(0,u.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function B(e){let{className:t,...a}=e;return(0,l.jsx)("th",{"data-slot":"table-head",className:(0,u.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function O(e){let{className:t,...a}=e;return(0,l.jsx)("td",{"data-slot":"table-cell",className:(0,u.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function I(e){let{cart:t,selectedRowId:a,selectRow:s,updateCartItemQuantity:r,updateCartItemPrice:n,deleteCartItem:i,disabled:c=!1}=e;return 0===t.length?(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center w-full h-full",children:(0,l.jsx)("span",{className:"text-center text-gray-500",children:"\uD83D\uDED2 Scan items to add to cart"})}):(0,l.jsxs)(q,{children:[(0,l.jsx)(T,{children:(0,l.jsxs)($,{children:[(0,l.jsx)(B,{className:"text-lg font-semibold",children:"Barcode"}),(0,l.jsx)(B,{className:"text-lg font-semibold",children:"Name"}),(0,l.jsx)(B,{className:"text-lg font-semibold",children:"Price"}),(0,l.jsx)(B,{className:"text-lg font-semibold",children:"Quantity"}),(0,l.jsx)(B,{className:"text-lg font-semibold",children:"Actions"})]})}),(0,l.jsx)(R,{children:t.map(e=>(0,l.jsxs)($,{className:"hover:bg-gray-50 cursor-pointer ".concat(a===e.id?"bg-gray-100":""),onClick:()=>s(e.id),children:[(0,l.jsx)(O,{className:"font-medium max-w-[140px] break-words whitespace-normal",children:e.product.barcode||"N/A"}),(0,l.jsx)(O,{className:"min-w-0 max-w-[320px] break-words whitespace-normal",children:e.product.name}),(0,l.jsx)(O,{children:(0,l.jsx)(b.p,{type:"number",min:0,step:"0.01",value:String(e.product.price),className:"w-28",onClick:e=>e.stopPropagation(),onChange:t=>{let a=Number(t.target.value),l=Number.isFinite(a)?Math.max(0,a):0;n(e.id,l)},disabled:c})}),(0,l.jsx)(O,{children:(0,l.jsx)(b.p,{type:"number",min:1,value:e.quantity,className:"w-16",onClick:e=>e.stopPropagation(),onChange:t=>{let a=Math.max(1,Number(t.target.value));r(e.id,a)},disabled:c})}),(0,l.jsx)(O,{children:(0,l.jsx)("button",{type:"button",className:"text-sm text-red-600 hover:underline disabled:opacity-50",onClick:t=>{t.stopPropagation(),i(e.id)},disabled:c,children:"Delete"})})]},e.id))})]})}var K=a(86651);function Y(e){let{searchQuery:t,searchResults:a,showSearchResults:s,handleSearchChange:r,handleSearchSelect:n,refocusScanner:i,disabled:c=!1}=e;return(0,l.jsxs)("div",{className:"relative mb-6",children:[(0,l.jsxs)("div",{className:"relative flex items-center",children:[(0,l.jsx)(K.A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),(0,l.jsx)(b.p,{className:"pl-9 w-full",placeholder:"Search by product name or barcode...",value:t,onChange:e=>r(e.target.value),onClick:e=>e.stopPropagation(),onBlur:i,disabled:c})]}),s&&a.length>0&&(0,l.jsx)("div",{className:"absolute top-full left-0 right-0 bg-white border rounded-md shadow-lg z-10 max-h-60 overflow-y-auto",children:a.map(e=>(0,l.jsx)("div",{className:"p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0",onClick:()=>n(e),children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"min-w-0",children:[" ",(0,l.jsx)("div",{className:"font-medium break-words whitespace-normal",children:e.name}),(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:["Barcode: ",e.barcode]})]}),(0,l.jsx)("div",{className:"text-right ml-4 flex-shrink-0",children:(0,l.jsxs)("div",{className:"font-medium",children:["₱ ",e.price.toFixed(2)]})})]})},e.id))}),s&&0===a.length&&t.length>=2&&(0,l.jsxs)("div",{className:"absolute top-full left-0 right-0 bg-white border rounded-md shadow-lg z-10 p-3 text-center text-gray-500",children:['No products found matching "',t,'"']})]})}function G(e){let{inputRef:t,barcodeInput:a,handleBarcodeChange:r,handleKeyPress:n,disabled:i=!1}=e;return(0,s.useEffect)(()=>{let e=e=>{let a=null==e?void 0:e.detail;if(null==a?void 0:a.preventScan)return;let l=null==t?void 0:t.current;if(l){try{l.focus()}catch(e){}try{l.value=""}catch(e){}try{r({target:l})}catch(e){l.dispatchEvent(new Event("input",{bubbles:!0}))}}},a=()=>{let e=null==t?void 0:t.current;if(e){try{e.focus()}catch(e){}try{e.value=""}catch(e){}try{r({target:e})}catch(t){e.dispatchEvent(new Event("input",{bubbles:!0}))}}};return window.addEventListener("product:added",e),window.addEventListener("focusBarcodeScanner",a),()=>{window.removeEventListener("product:added",e),window.removeEventListener("focusBarcodeScanner",a)}},[t,r]),(0,l.jsx)(b.p,{ref:t,className:"opacity-0 absolute -top-1000",value:a,onChange:r,onKeyPress:n,placeholder:"Scanner input...",disabled:i})}var U=a(35646);function W(e){let{...t}=e;return(0,l.jsx)(U.bL,{"data-slot":"alert-dialog",...t})}function H(e){let{...t}=e;return(0,l.jsx)(U.ZL,{"data-slot":"alert-dialog-portal",...t})}function Q(e){let{className:t,...a}=e;return(0,l.jsx)(U.hJ,{"data-slot":"alert-dialog-overlay",className:(0,u.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function V(e){let{className:t,...a}=e;return(0,l.jsxs)(H,{children:[(0,l.jsx)(Q,{}),(0,l.jsx)(U.UC,{"data-slot":"alert-dialog-content",className:(0,u.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a})]})}function J(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"alert-dialog-header",className:(0,u.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function Z(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"alert-dialog-footer",className:(0,u.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function X(e){let{className:t,...a}=e;return(0,l.jsx)(U.hE,{"data-slot":"alert-dialog-title",className:(0,u.cn)("text-lg font-semibold",t),...a})}function ee(e){let{className:t,...a}=e;return(0,l.jsx)(U.VY,{"data-slot":"alert-dialog-description",className:(0,u.cn)("text-muted-foreground text-sm",t),...a})}function et(e){let{className:t,...a}=e;return(0,l.jsx)(U.rc,{className:(0,u.cn)((0,v.r)(),t),...a})}function ea(e){let{className:t,...a}=e;return(0,l.jsx)(U.ZD,{className:(0,u.cn)((0,v.r)({variant:"outline"}),t),...a})}var el=a(13904);function es(e){let{step:t}=e,{selectedRowId:a,selectRow:i}=function(){let[e,t]=(0,s.useState)(null);return{selectedRowId:e,selectRow:e=>t(e),clearSelection:()=>t(null)}}(),{products:c}=(0,D.Q)(),{cart:o,updateCartItemQuantity:u,scanAndAddToCart:x,setScannerRef:h,refocusScanner:f,updateCartItemPrice:p,deleteCartItem:j}=d(),{barcodeInput:v,inputRef:b,handleBarcodeChange:y,handleKeyPress:N}=function(e){let[t,a]=(0,s.useState)(""),l=(0,s.useRef)(null),r=(0,s.useRef)(!1);(0,s.useEffect)(()=>{try{var e;null==(e=l.current)||e.focus()}catch(e){}},[]);let n=async t=>{let a=String(t).replace(/[\n\r]/g,"").trim();if(a&&!r.current){r.current=!0;try{await Promise.resolve(e(a))}catch(e){}finally{try{l.current&&(l.current.value="")}catch(e){}window.setTimeout(()=>{r.current=!1;try{var e;null==(e=l.current)||e.focus()}catch(e){}},200)}}},i=(0,s.useCallback)(()=>{a("");try{l.current&&(l.current.value="",l.current.focus())}catch(e){}},[]);return{barcodeInput:t,inputRef:l,handleBarcodeChange:e=>{let t=e.target.value;if(a(t),t.includes("\n")||t.includes("\r")){let e=t.replace(/[\n\r]/g,"").trim();e&&n(e),a("")}},handleKeyPress:e=>{if("Enter"===e.key){e.preventDefault();let l=t.trim();l&&(n(l),a(""))}},refocusScanner:()=>{try{var e;null==(e=l.current)||e.focus()}catch(e){}},reset:i,isProcessing:()=>r.current}}(T),{setOpen:w,setBarcode:C}=(0,n.c)(),{cart:S,updateCartItemQuantity:k}=d();(0,s.useEffect)(()=>{let e=e=>{if(a){if("+"===e.key){let e=S.find(e=>e.id===a);e&&k(e.id,e.quantity+1)}if("-"===e.key){let e=S.find(e=>e.id===a);e&&e.quantity>1&&k(e.id,e.quantity-1)}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,S,k]);let{searchQuery:A,searchResults:_,showSearchResults:E,handleSearchChange:L,clearSearch:P}=(e=>{let[t,a]=(0,s.useState)(""),[l,r]=(0,s.useState)(!1),n=(0,s.useMemo)(()=>t.trim().length<2?[]:e.filter(e=>{var a;return e.name.toLowerCase().includes(t.toLowerCase())||(null==(a=e.barcode)?void 0:a.includes(t))}),[e,t]);return{searchQuery:t,searchResults:n,showSearchResults:l,handleSearchChange:e=>{a(e),r(e.trim().length>=2)},clearSearch:()=>{a(""),r(!1)}}})(c),[z,F]=(0,s.useState)(!1),[M,q]=(0,s.useState)(null);async function T(e){let t=e=>null==e?"":String(e).replace(/[\u0000-\u001F\u007F-\u009F]/g,"").trim(),a=t(e);if(c.find(e=>t(null==e?void 0:e.barcode)===a)){await x(a),f();return}try{if(await r.G.getByBarcode(a)){await x(a),f();return}}catch(e){}q(a),F(!0)}return(0,s.useEffect)(()=>{h(b)},[h,b]),(0,s.useEffect)(()=>{(2===t||3===t)&&(null==b?void 0:b.current)&&b.current.blur()},[t]),(0,l.jsxs)("div",{className:"relative w-full h-full",children:[(0,l.jsx)(m,{className:"w-full h-full flex flex-col",onClick:()=>f(),children:(0,l.jsxs)(g,{className:"p-6 flex-1 flex flex-col min-h-0",children:[(0,l.jsx)(G,{inputRef:b,barcodeInput:v,handleBarcodeChange:y,handleKeyPress:N,disabled:2===t||3===t}),(0,l.jsx)(Y,{searchQuery:A,searchResults:_,showSearchResults:E,handleSearchChange:L,handleSearchSelect:e=>{x(e.barcode||""),P(),f()},clearSearch:P,refocusScanner:f,disabled:2===t||3===t}),(0,l.jsx)("div",{className:"rounded-md border flex-1 flex flex-col min-h-0 overflow-auto relative",children:(0,l.jsx)(I,{cart:o,selectedRowId:a,selectRow:i,updateCartItemQuantity:u,updateCartItemPrice:p,deleteCartItem:j,disabled:2===t||3===t})})]})}),(0,l.jsx)(el.default,{}),(0,l.jsx)(W,{open:z,onOpenChange:F,children:(0,l.jsxs)(V,{children:[(0,l.jsxs)(J,{children:[(0,l.jsx)(X,{children:"Product Not Registered"}),(0,l.jsxs)(ee,{children:["The scanned product (",(0,l.jsx)("span",{className:"font-bold",children:M}),") is not registered. Would you like to register it?"]})]}),(0,l.jsxs)(Z,{children:[(0,l.jsx)(ea,{onClick:()=>F(!1),children:"Cancel"}),(0,l.jsx)(et,{onClick:()=>M&&void(F(!1),C(M),w(!0)),children:"Register Product"})]})]})})]})}function er(){let[e,t]=(0,s.useState)(1);return(0,s.useEffect)(()=>{let e=()=>{try{window.dispatchEvent(new Event("focusBarcodeScanner"))}catch(e){}};e();let t=setTimeout(e,120);return window.addEventListener("focus",e),()=>{clearTimeout(t),window.removeEventListener("focus",e)}},[]),(0,l.jsx)(o,{children:(0,l.jsx)("div",{className:"flex flex-col w-full h-full py-4 px-4",children:(0,l.jsxs)("div",{className:"flex gap-2 h-full",children:[(0,l.jsx)("div",{className:"flex-[70%]",children:(0,l.jsx)(es,{step:e})}),(0,l.jsx)("div",{className:"flex flex-col flex-[30%] gap-2",children:(0,l.jsx)(M,{step:e,setStep:t})})]})})})}let en=(0,s.memo)(function(){let{openModal:e}=(0,n.c)(),t=(0,s.useCallback)(()=>e("addCategory"),[e]),a=(0,s.useCallback)(()=>e("addProduct"),[e]),r="flex items-center justify-center gap-2 p-3";return(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold",children:"Products"}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsxs)(v.$,{className:r,onClick:t,"aria-label":"Add category",children:[(0,l.jsx)(C.A,{size:16}),"Add Category"]}),(0,l.jsxs)(v.$,{className:r,onClick:a,"aria-label":"Add product",children:[(0,l.jsx)(C.A,{size:16}),"Add Product"]})]})]})});var ei=a(46512);let ec=()=>r.G.getAll();function eo(){let{data:e=[],isLoading:t}=(0,ei.Ay)("/api/products",ec,{revalidateOnFocus:!1,dedupingInterval:6e4}),{totalProducts:a,lowStockItems:r,outOfStockItems:n,totalValueFormatted:i}=(0,s.useMemo)(()=>{let t=0,a=0,l=0,s=0;for(let r of e)r&&"number"==typeof r.quantity&&"number"==typeof r.price&&(t++,0===r.quantity?l++:r.quantity<5&&a++,s+=r.price*r.quantity);return{totalProducts:t,lowStockItems:a,outOfStockItems:l,totalValueFormatted:"₱ ".concat(s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))}},[e]);return(0,l.jsx)("div",{className:"grid grid-cols-4 gap-4 w-full h-full",children:[{title:"Total Products",content:t?"...":a},{title:"Low Stock Items",content:t?"...":r},{title:"Out of Stock",content:t?"...":n},{title:"Total Value",content:t?"...":i}].map((e,t)=>(0,l.jsx)(m,{children:(0,l.jsxs)(g,{className:"flex flex-col justify-center items-start h-full",children:[(0,l.jsx)("h1",{className:"text-xl font-semibold pb-4",children:e.title}),(0,l.jsx)("p",{className:"text-2xl font-bold ",children:e.content})]})},t))})}var ed=a(6259),eu=a(12677),em=a(24033),ex=a(5917),eh=a(12108);function ef(e){let{...t}=e;return(0,l.jsx)(eu.bL,{"data-slot":"select",...t})}function ep(e){let{...t}=e;return(0,l.jsx)(eu.WT,{"data-slot":"select-value",...t})}function eg(e){let{className:t,size:a="default",children:s,...r}=e;return(0,l.jsxs)(eu.l9,{"data-slot":"select-trigger","data-size":a,className:(0,u.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...r,children:[s,(0,l.jsx)(eu.In,{asChild:!0,children:(0,l.jsx)(em.A,{className:"size-4 opacity-50"})})]})}function ej(e){let{className:t,children:a,position:s="popper",...r}=e;return(0,l.jsx)(eu.ZL,{children:(0,l.jsxs)(eu.UC,{"data-slot":"select-content",className:(0,u.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,...r,children:[(0,l.jsx)(eb,{}),(0,l.jsx)(eu.LM,{className:(0,u.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,l.jsx)(ey,{})]})})}function ev(e){let{className:t,children:a,...s}=e;return(0,l.jsxs)(eu.q7,{"data-slot":"select-item",className:(0,u.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...s,children:[(0,l.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,l.jsx)(eu.VF,{children:(0,l.jsx)(ex.A,{className:"size-4"})})}),(0,l.jsx)(eu.p4,{children:a})]})}function eb(e){let{className:t,...a}=e;return(0,l.jsx)(eu.PP,{"data-slot":"select-scroll-up-button",className:(0,u.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,l.jsx)(eh.A,{className:"size-4"})})}function ey(e){let{className:t,...a}=e;return(0,l.jsx)(eu.wn,{"data-slot":"select-scroll-down-button",className:(0,u.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,l.jsx)(em.A,{className:"size-4"})})}var eN=a(66955),ew=a(83303);function eC(e){let{selectedCategory:t,setSelectedCategory:a,selectedProducts:r,setSelectedProducts:n,search:i,setSearch:c}=e,{categories:o,loading:d,error:u}=(0,ew.C)(),[m,x]=(0,s.useState)(""),h=(0,s.useCallback)(()=>{a("all"),n("all"),x(""),c("")},[a,n,c]),f=(0,s.useCallback)(e=>{c(e.target.value)},[c]),p=(0,s.useCallback)(e=>{x(e.target.value)},[]),g=(0,s.useMemo)(()=>{let e=null!=o?o:[],t=m.trim().toLowerCase();return t?e.filter(e=>e.name.toLowerCase().includes(t)):e},[o,m]),j=(0,s.useCallback)(e=>{a(e)},[a]),y=(0,s.useCallback)(e=>{n(e)},[n]);return(0,l.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,l.jsxs)("div",{className:"relative flex items-center flex-1 max-w-[700px]",children:[(0,l.jsx)(K.A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),(0,l.jsx)(b.p,{className:"pl-9 w-full",placeholder:"Search by product name or barcode...",value:i,onChange:f,onClick:e=>e.stopPropagation()})]}),(0,l.jsxs)(ed.rI,{children:[(0,l.jsx)(ed.ty,{asChild:!0,children:(0,l.jsxs)(v.$,{variant:"outline",className:"flex items-center gap-2",children:[(0,l.jsx)(eN.A,{}),"Filter"]})}),(0,l.jsxs)(ed.SQ,{className:"w-[320px]",children:[(0,l.jsx)("div",{className:"p-3",children:(0,l.jsx)("h3",{className:"text-sm font-medium",children:"Filter"})}),(0,l.jsx)(ed.mB,{}),(0,l.jsxs)("div",{className:"p-3",children:[(0,l.jsx)("h4",{className:"text-sm font-medium",children:"Category"}),(0,l.jsxs)(ef,{value:t,onValueChange:j,children:[(0,l.jsx)(eg,{className:"w-full mt-2",children:(0,l.jsx)(ep,{placeholder:"Category"})}),(0,l.jsxs)(ej,{children:[(0,l.jsx)("div",{className:"p-2",children:(0,l.jsx)(b.p,{placeholder:"Search category...",value:m,onChange:p,className:"mb-2"})}),(0,l.jsxs)("div",{className:"max-h-40 overflow-auto",children:[(0,l.jsx)(ev,{value:"all",children:"All Categories"}),d&&(0,l.jsx)(ev,{value:"loading",disabled:!0,children:"Loading categories..."}),u&&(0,l.jsx)(ev,{value:"error",disabled:!0,children:String(u)}),!d&&!u&&0===g.length&&(0,l.jsx)(ev,{value:"none",disabled:!0,children:"No categories found"}),!d&&!u&&g.map(e=>(0,l.jsx)(ev,{value:String(e.id),children:e.name},e.id))]})]})]})]}),(0,l.jsx)(ed.mB,{}),(0,l.jsxs)("div",{className:"p-3",children:[(0,l.jsx)("h4",{className:"text-sm font-medium",children:"Status"}),(0,l.jsxs)(ef,{value:r,onValueChange:y,children:[(0,l.jsx)(eg,{className:"w-full mt-2",children:(0,l.jsx)(ep,{placeholder:"Status"})}),(0,l.jsxs)(ej,{children:[(0,l.jsx)(ev,{value:"all",children:"All Stock"}),(0,l.jsx)(ev,{value:"in stock",children:"In Stock"}),(0,l.jsx)(ev,{value:"low stock",children:"Low Stock"}),(0,l.jsx)(ev,{value:"out of stock",children:"Out of Stock"})]})]})]}),(0,l.jsx)(ed.mB,{}),(0,l.jsx)("div",{className:"flex justify-end p-3",children:(0,l.jsx)(v.$,{variant:"ghost",className:"font-normal",onClick:h,children:"Reset All"})})]})]})]})}var eS=a(31342),ek=a(30563),eA=a(92273);function e_(e){let{columns:t,data:a,page:r,pageSize:n,onFilteredCountChange:i}=e,[c,o]=(0,s.useState)([]),d=(0,ek.N4)({data:a,columns:t,state:{sorting:c,pagination:{pageIndex:r}},onSortingChange:o,onPaginationChange:()=>{},getCoreRowModel:(0,eA.HT)(),getSortedRowModel:(0,eA.h5)()}),u=d.getRowModel().rows,m=(0,s.useMemo)(()=>u.slice(r*n,(r+1)*n),[u,r,n]),x=(0,s.useRef)(null),h=(0,s.useRef)(null),f=u.length;return(0,s.useEffect)(()=>{if(i)return x.current!==f&&(x.current=f,h.current&&(clearTimeout(h.current),h.current=null),h.current=setTimeout(()=>{i(f),h.current=null},0)),()=>{h.current&&(clearTimeout(h.current),h.current=null)}},[f,i]),(0,l.jsx)("div",{className:"rounded-md border",children:(0,l.jsxs)(q,{children:[(0,l.jsx)(T,{children:d.getHeaderGroups().map(e=>(0,l.jsx)($,{children:e.headers.map(e=>(0,l.jsx)(B,{children:e.isPlaceholder?null:(0,ek.Kv)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,l.jsx)(R,{children:m.length>0?m.map(e=>(0,l.jsx)($,{"data-state":e.getIsSelected()?"selected":void 0,children:e.getVisibleCells().map(e=>(0,l.jsx)(O,{children:(0,ek.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,l.jsx)($,{children:(0,l.jsx)(O,{colSpan:t.length,className:"h-24 text-center",children:"No results."})})})]})})}var eE=a(93341),eL=a(32467);let eP=(0,a(83101).F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function ez(e){let{className:t,variant:a,asChild:s=!1,...r}=e,n=s?eL.DX:"span";return(0,l.jsx)(n,{"data-slot":"badge",className:(0,u.cn)(eP({variant:a}),t),...r})}let eF={"in stock":{variant:"default",className:"bg-green-300 text-black"},"low stock":{variant:"secondary",className:"bg-yellow-500 text-black"},"out of stock":{variant:"destructive",className:"bg-red-500 text-white"}},eM=[{accessorKey:"productName",header:e=>{let{column:t}=e;return(0,l.jsxs)("button",{className:"flex items-center gap-2 font-medium focus:outline-none",onClick:()=>t.toggleSorting("asc"===t.getIsSorted()),children:["Product",(0,l.jsx)(eE.A,{className:"ml-1 h-4 w-4"})]})},cell:e=>{let{row:t}=e;return(0,l.jsx)("div",{className:"flex items-center font-medium max-w-[420px] whitespace-normal break-words leading-tight",title:String(t.getValue("productName")),children:t.getValue("productName")})}},{accessorKey:"barcode",header:"Barcode"},{accessorKey:"category",header:"Category"},{accessorKey:"currentStock",header:e=>{let{column:t}=e;return(0,l.jsxs)("button",{className:"flex items-center gap-2 font-medium focus:outline-none",onClick:()=>t.toggleSorting("asc"===t.getIsSorted()),children:["Current Stock",(0,l.jsx)(eE.A,{className:"ml-1 h-4 w-4"})]})},cell:e=>{let{row:t}=e;return(0,l.jsx)("div",{className:"flex items-center font-medium",children:t.getValue("currentStock")})}},{accessorKey:"productPrice",header:"Price"},{accessorKey:"status",header:"Status",cell:e=>{let{row:t}=e,a=t.original.status,s=eF[a],r=a.charAt(0).toUpperCase()+a.slice(1);return(0,l.jsx)(ez,{variant:s.variant,className:s.className,children:r})}},{id:"actions",header:()=>(0,l.jsx)("div",{className:"text-center font-medium",children:"Actions"}),cell:()=>(0,l.jsx)("div",{className:"flex gap-5 justify-center","aria-hidden":!0}),enableSorting:!1,enableHiding:!1}];var eD=a(90368),eq=a(27937),eT=a(37772);function eR(e){let{className:t,...a}=e;return(0,l.jsx)("nav",{role:"navigation","aria-label":"pagination","data-slot":"pagination",className:(0,u.cn)("mx-auto flex w-full justify-center",t),...a})}function e$(e){let{className:t,...a}=e;return(0,l.jsx)("ul",{"data-slot":"pagination-content",className:(0,u.cn)("flex flex-row items-center gap-1",t),...a})}function eB(e){let{...t}=e;return(0,l.jsx)("li",{"data-slot":"pagination-item",...t})}function eO(e){let{className:t,isActive:a,size:s="icon",...r}=e;return(0,l.jsx)("a",{"aria-current":a?"page":void 0,"data-slot":"pagination-link","data-active":a,className:(0,u.cn)((0,v.r)({variant:a?"outline":"ghost",size:s}),t),...r})}function eI(e){let{className:t,...a}=e;return(0,l.jsxs)(eO,{"aria-label":"Go to previous page",size:"default",className:(0,u.cn)("gap-1 px-2.5 sm:pl-2.5",t),...a,children:[(0,l.jsx)(eD.A,{}),(0,l.jsx)("span",{className:"hidden sm:block",children:"Previous"})]})}function eK(e){let{className:t,...a}=e;return(0,l.jsxs)(eO,{"aria-label":"Go to next page",size:"default",className:(0,u.cn)("gap-1 px-2.5 sm:pr-2.5",t),...a,children:[(0,l.jsx)("span",{className:"hidden sm:block",children:"Next"}),(0,l.jsx)(eq.A,{})]})}function eY(e){let{className:t,...a}=e;return(0,l.jsxs)("span",{"aria-hidden":!0,"data-slot":"pagination-ellipsis",className:(0,u.cn)("flex size-9 items-center justify-center",t),...a,children:[(0,l.jsx)(eT.A,{className:"size-4"}),(0,l.jsx)("span",{className:"sr-only",children:"More pages"})]})}function eG(e){let{page:t,pageCount:a,setPage:s,pageSize:r,onPageSizeChange:n}=e;if(a<=1)return null;let i=e=>l=>{null==l||l.preventDefault(),e<0&&(e=0),e>a-1&&(e=a-1),e!==t&&s(e)},c=(()=>{let e=[],l=Math.max(1,t-1),s=Math.min(a-2,t+1);e.push(0),l>1&&e.push("ellipsis");for(let t=l;t<=s;t++)e.push(t);return s<a-2&&e.push("ellipsis"),a>1&&e.push(a-1),e})();return(0,l.jsxs)(eR,{className:"mt-2 flex items-center gap-4",children:[(0,l.jsxs)(e$,{children:[(0,l.jsx)(eB,{children:(0,l.jsx)(eI,{href:"#",onClick:i(Math.max(t-1,0)),"aria-disabled":0===t})}),c.map((e,a)=>"ellipsis"===e?(0,l.jsx)(eB,{children:(0,l.jsx)(eY,{})},"e-".concat(a)):(0,l.jsx)(eB,{children:(0,l.jsx)(eO,{href:"#",isActive:e===t,onClick:i(e),children:e+1})},e)),(0,l.jsx)(eB,{children:(0,l.jsx)(eK,{href:"#",onClick:i(Math.min(t+1,a-1)),"aria-disabled":t===a-1})})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("label",{htmlFor:"page-size",className:"text-sm",children:"Rows per page:"}),(0,l.jsx)("input",{id:"page-size",type:"number",min:1,max:100,value:r,onChange:e=>n(Number(e.target.value)||1),className:"border rounded px-2 py-1 w-16 text-sm"})]})]})}var eU=a(71360),eW=a(18514),eH=a(18720);let eQ=()=>r.G.getAll();function eV(e){var t;let{selectedCategory:a,selectedStatus:n,onProductDeleted:i,search:c=""}=e,{data:o=[],isLoading:d,error:u}=(0,ei.Ay)("/api/products",eQ,{revalidateOnFocus:!1,dedupingInterval:6e4}),[m,x]=(0,s.useState)(0),[h,f]=(0,s.useState)(6),[p,g]=(0,s.useState)(null),[j,N]=(0,s.useState)(!1),[w,C]=(0,s.useState)(!1),[S,k]=(0,s.useState)(null),[A,E]=(0,s.useState)(!1),{categories:L=[],loading:P,error:z}=(0,ew.C)(),[F,M]=(0,s.useState)(""),[D,q]=(0,s.useState)({name:"",barcode:"",category_id:"",price:0,quantity:0}),T=(0,s.useMemo)(()=>{let e=null!=o?o:[];a&&"all"!==a&&(e=e.filter(e=>String(e.category_id)===a)),n&&"all"!==n&&(e=e.filter(e=>(0===e.quantity?"out of stock":e.quantity<5?"low stock":"in stock")===n));let t=(c||"").trim().toLowerCase();return t&&(e=e.filter(e=>{var a,l;let s=String(null!=(a=e.name)?a:"").toLowerCase(),r=String(null!=(l=e.barcode)?l:"").toLowerCase();return s.includes(t)||r.includes(t)})),e},[o,a,n,c]);(0,s.useEffect)(()=>x(0),[a,n,c]);let R=(0,s.useMemo)(()=>(null!=T?T:[]).map(e=>(function(e,t){var a;let l=0===e.quantity?"out of stock":e.quantity<5?"low stock":"in stock",s=t.find(t=>String(t.id)===String(e.category_id));return{id:String(e.id),productName:e.name,barcode:null!=(a=e.barcode)?a:"",category:s?s.name:"Category ".concat(e.category_id),currentStock:e.quantity,productPrice:e.price,status:l}})(e,L)),[T,L]),$=(0,s.useMemo)(()=>Math.max(1,Math.ceil(((null==R?void 0:R.length)||0)/h)),[R,h]),B=(0,s.useMemo)(()=>o.find(e=>String(e.id)===String(p)),[o,p]);(0,s.useEffect)(()=>{if(j&&B){var e,t,a,l,s;q({name:null!=(e=B.name)?e:"",barcode:null!=(t=B.barcode)?t:"",category_id:String(null!=(a=B.category_id)?a:""),price:null!=(l=B.price)?l:0,quantity:null!=(s=B.quantity)?s:0})}},[j,B]);let O=(0,s.useCallback)(e=>{let t=null==e?void 0:e.id;g(null!=t?Number(t):null),N(!0),C(!1)},[]),I=(0,s.useCallback)(e=>{k(e),E(!0)},[]),K=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60;return e?e.length>t?e.slice(0,t)+"...":e:""},[]),Y=(0,s.useCallback)(async()=>{if(C(!1),!B)return void(0,eH.oR)("Product data not loaded",{description:"Please try again."});try{await r.G.update(B.id,{name:D.name,barcode:D.barcode,category_id:Number(D.category_id),price:Number(D.price),quantity:Number(D.quantity)}),(0,eH.oR)("Product updated",{description:"".concat(K(D.name,60)," has been updated.")}),N(!1),(0,eS.j)("/api/products")}catch(e){(0,eH.oR)("Failed to update product",{description:(null==e?void 0:e.message)||"An error occurred."})}},[B,D,K]),G=(0,s.useCallback)(async()=>{if(S)try{await r.G.delete(Number(S.id)),(0,eH.oR)("Product deleted",{description:(0,l.jsxs)("span",{className:"text-red-600",children:[K(S.productName,60)," has been deleted."]}),icon:(0,l.jsx)(eU.A,{className:"w-4 h-4 text-red-600"})}),E(!1),k(null),(0,eS.j)("/api/products"),i&&i(Number(S.id))}catch(e){(0,eH.oR)("Failed to delete product",{description:(null==e?void 0:e.message)||"An error occurred."})}},[S,i,K]);return(0,l.jsxs)("div",{className:"w-full mt-4 relative",children:[(0,l.jsx)(e_,{columns:eM.map(e=>"actions"===e.id?{...e,cell:e=>{let{row:t}=e;return(0,l.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,l.jsx)(v.$,{variant:"outline",size:"icon",onClick:()=>O(t.original),disabled:d,children:(0,l.jsx)(eW.A,{className:"w-4 h-4"})}),(0,l.jsx)(v.$,{variant:"outline",size:"icon",onClick:()=>I(t.original),children:(0,l.jsx)(eU.A,{className:"w-4 h-4"})})]})}}:e),data:R,page:m,pageSize:h}),(0,l.jsx)("div",{className:"mt-7",children:(0,l.jsx)(eG,{page:m,pageCount:$,setPage:x,pageSize:h,onPageSizeChange:e=>{f(e),x(0)}})}),(0,l.jsx)(_.lG,{open:j,onOpenChange:N,children:(0,l.jsx)(_.Cf,{children:B?w?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,l.jsx)("h2",{className:"font-bold text-lg mb-2",children:"Are you absolutely sure?"}),(0,l.jsx)("p",{className:"mb-6 text-gray-500",children:"This will update the product details."}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(v.$,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),(0,l.jsx)(v.$,{onClick:Y,children:"Continue"})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(_.c7,{children:[(0,l.jsx)(_.L3,{children:"Product"}),(0,l.jsx)(_.rr,{children:"Fill in the details below to update the product."})]}),(0,l.jsxs)("div",{className:"flex-col gap-4",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(y.J,{htmlFor:"edit-name",children:"Product Name"}),(0,l.jsx)(b.p,{id:"edit-name",name:"name",value:D.name,onChange:e=>q(t=>({...t,name:e.target.value}))})]}),(0,l.jsxs)("div",{className:"flex flex-row gap-2 mt-4",children:[(0,l.jsxs)("div",{className:"flex-[50%] flex flex-col gap-2",children:[(0,l.jsx)(y.J,{htmlFor:"edit-barcode",children:"Barcode"}),(0,l.jsx)(b.p,{id:"edit-barcode",name:"barcode",value:D.barcode,onChange:e=>q(t=>({...t,barcode:e.target.value}))})]}),(0,l.jsxs)("div",{className:"flex-[50%] flex flex-col gap-2",children:[(0,l.jsx)(y.J,{htmlFor:"edit-category",children:"Category"}),(0,l.jsxs)(ed.rI,{children:[(0,l.jsx)(ed.ty,{asChild:!0,children:(0,l.jsx)(b.p,{id:"edit-category",readOnly:!0,value:(null==(t=L.find(e=>String(e.id)===String(D.category_id)))?void 0:t.name)||"",placeholder:"Select category",className:"cursor-pointer"})}),(0,l.jsxs)(ed.SQ,{className:"w-64",children:[(0,l.jsx)("div",{className:"p-2",children:(0,l.jsx)(b.p,{placeholder:"Search category...",value:F,onChange:e=>M(e.target.value),className:"mb-2"})}),P&&(0,l.jsx)("div",{className:"p-2 text-gray-400",children:"Loading..."}),z&&(0,l.jsx)("div",{className:"p-2 text-red-500",children:z}),!P&&!z&&L.filter(e=>e.name.toLowerCase().includes(F.toLowerCase())).map(e=>(0,l.jsx)(ed._2,{onClick:()=>{q(t=>({...t,category_id:String(e.id)})),M("")},children:e.name},e.id)),!P&&!z&&0===L.filter(e=>e.name.toLowerCase().includes(F.toLowerCase())).length&&(0,l.jsx)("div",{className:"p-2 text-gray-400",children:"No categories found."})]})]})]})]}),(0,l.jsxs)("div",{className:"flex flex-row gap-2 my-4",children:[(0,l.jsxs)("div",{className:"flex-[50%] flex flex-col gap-2",children:[(0,l.jsx)(y.J,{htmlFor:"edit-price",children:"Price"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 pointer-events-none",children:"₱"}),(0,l.jsx)(b.p,{id:"edit-price",name:"price",type:"number",value:0===D.price?"":String(D.price),onChange:e=>q(t=>({...t,price:""===e.target.value?0:Number(e.target.value)})),className:"pl-8"})]})]}),(0,l.jsxs)("div",{className:"flex-[50%] flex flex-col gap-2",children:[(0,l.jsx)(y.J,{htmlFor:"edit-quantity",children:"Quantity"}),(0,l.jsx)(b.p,{id:"edit-quantity",name:"quantity",type:"number",value:0===D.quantity?"":String(D.quantity),onChange:e=>q(t=>({...t,quantity:""===e.target.value?0:Number(e.target.value)}))})]})]}),(0,l.jsxs)(_.Es,{children:[(0,l.jsx)(_.HM,{asChild:!0,children:(0,l.jsx)(v.$,{variant:"outline",onClick:()=>N(!1),children:"Cancel"})}),(0,l.jsx)(v.$,{onClick:()=>C(!0),children:"Update Product"})]})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(_.L3,{children:"Loading"}),(0,l.jsx)(_.rr,{children:"Loading product data..."}),(0,l.jsx)("div",{className:"p-4 text-center",children:"Loading..."})]})})}),(0,l.jsx)(_.lG,{open:A,onOpenChange:E,children:(0,l.jsxs)(_.Cf,{children:[(0,l.jsxs)(_.c7,{children:[(0,l.jsx)(_.L3,{children:"Are you absolutely sure?"}),(0,l.jsx)(_.rr,{children:"This action cannot be undone. This will permanently delete the product and remove it from your database."})]}),(0,l.jsxs)(_.Es,{children:[(0,l.jsx)(v.$,{variant:"outline",onClick:()=>E(!1),children:"Cancel"}),(0,l.jsx)(v.$,{variant:"destructive",onClick:G,disabled:!S,children:"Continue"})]})]})})]})}function eJ(e){let{onProductDeleted:t}=e,[a,r]=(0,s.useState)("all"),[n,i]=(0,s.useState)("all"),[c,o]=(0,s.useState)("");return(0,l.jsxs)(m,{className:"h-full w-full",children:[(0,l.jsx)(x,{children:(0,l.jsx)("h2",{className:"text-2xl font-semibold",children:"Product Catalog"})}),(0,l.jsxs)(g,{children:[(0,l.jsx)(eC,{selectedCategory:a,setSelectedCategory:r,selectedProducts:n,setSelectedProducts:i,search:c,setSearch:o}),(0,l.jsx)(eV,{selectedCategory:a,selectedStatus:n,onProductDeleted:t,search:c})]})]})}var eZ=a(54636);function eX(){return(0,l.jsxs)("div",{className:"flex flex-col gap-4 h-full p-8",children:[(0,l.jsx)("div",{className:"flex-[7%]",children:(0,l.jsx)(en,{})}),(0,l.jsx)("div",{className:"flex-[18%]",children:(0,l.jsx)(eo,{})}),(0,l.jsx)("div",{className:"flex-[75%]",children:(0,l.jsx)(eJ,{})}),(0,l.jsx)(eZ.A,{})]})}var e0=a(91761),e1=a(26617),e2=a(10512),e5=a(95125);function e4(){let{saleItems:e,loading:t}=(()=>{let[e,t]=(0,s.useState)([]),[a,l]=(0,s.useState)(!0),[r,n]=(0,s.useState)(null),i=async()=>{try{l(!0),n(null);let e=await e5.A.get("http://3.25.180.232:5000/api/sales-items");t(e.data.data)}catch(e){n(e instanceof Error?e.message:"Unknown error")}finally{l(!1)}};return(0,s.useEffect)(()=>{i()},[]),{saleItems:e,loading:a,error:r,refetch:i}})(),{products:a,loading:r}=(0,D.Q)(),{sales:n,loading:i}=(()=>{let[e,t]=(0,s.useState)([]),[a,l]=(0,s.useState)(!0),[r,n]=(0,s.useState)(null),i=async()=>{try{l(!0),n(null);let e=await e5.A.get("http://3.25.180.232:5000/api/sales");t(e.data.data)}catch(e){n(e instanceof Error?e.message:"Unknown error")}finally{l(!1)}};return(0,s.useEffect)(()=>{i()},[]),{sales:e,loading:a,error:r,refetch:i}})(),c=e=>("string"==typeof e?new Date(e):e).toISOString().slice(0,10),o=c(new Date),d=n.filter(e=>c(e.created_at)===o),u=d.reduce((e,t)=>e+t.total_purchase,0),f=d.length;a.length;let p=e.filter(e=>c(e.created_at)===o).reduce((e,t)=>e+t.quantity,0),j=[{title:"Today's Sales",content:i?"...":"₱ ".concat(u.toLocaleString()),icon:(0,l.jsx)(e0.A,{size:20})},{title:"Items Sold Today",content:t?"...":p.toLocaleString(),icon:(0,l.jsx)(e1.A,{size:20})},{title:"Today's Transactions",content:i?"...":f.toLocaleString(),icon:(0,l.jsx)(e2.A,{size:20})}];return(0,l.jsx)("div",{className:"grid grid-cols-3 gap-4 w-full h-full",children:j.map((e,t)=>(0,l.jsxs)(m,{className:"gap-0 flex justify-center",children:[(0,l.jsxs)(x,{className:"mb-4 flex flex-row justify-between items-center",children:[(0,l.jsx)(h,{className:"text-md font-semibold",children:e.title}),(0,l.jsx)("div",{className:"opacity-60",children:e.icon})]}),(0,l.jsx)(g,{children:(0,l.jsx)("div",{className:"text-3xl font-bold mb-6",children:e.content})})]},t))})}var e3=a(80003),e6=a(16485),e8=a(98128),e7=a(68425),e9=a(47734),te=a(30757),tt=a(3648),ta=a(74854),tl=a(63359);function ts(){let e=(0,tt._)(["rtl:**:[.rdp-button_next>svg]:rotate-180"],["rtl:**:[.rdp-button\\_next>svg]:rotate-180"]);return ts=function(){return e},e}function tr(){let e=(0,tt._)(["rtl:**:[.rdp-button_previous>svg]:rotate-180"],["rtl:**:[.rdp-button\\_previous>svg]:rotate-180"]);return tr=function(){return e},e}function tn(e){let{className:t,classNames:a,showOutsideDays:s=!0,captionLayout:r="label",buttonVariant:n="ghost",formatters:i,components:c,...o}=e,d=(0,ta.a)();return(0,l.jsx)(tl.h,{showOutsideDays:s,className:(0,u.cn)("bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw(ts()),String.raw(tr()),t),captionLayout:r,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...i},classNames:{root:(0,u.cn)("w-fit",d.root),months:(0,u.cn)("flex gap-4 flex-col md:flex-row relative",d.months),month:(0,u.cn)("flex flex-col w-full gap-4",d.month),nav:(0,u.cn)("flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",d.nav),button_previous:(0,u.cn)((0,v.r)({variant:n}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",d.button_previous),button_next:(0,u.cn)((0,v.r)({variant:n}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",d.button_next),month_caption:(0,u.cn)("flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",d.month_caption),dropdowns:(0,u.cn)("w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",d.dropdowns),dropdown_root:(0,u.cn)("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",d.dropdown_root),dropdown:(0,u.cn)("absolute bg-popover inset-0 opacity-0",d.dropdown),caption_label:(0,u.cn)("select-none font-medium","label"===r?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",d.caption_label),table:"w-full border-collapse",weekdays:(0,u.cn)("flex",d.weekdays),weekday:(0,u.cn)("text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",d.weekday),week:(0,u.cn)("flex w-full mt-2",d.week),week_number_header:(0,u.cn)("select-none w-(--cell-size)",d.week_number_header),week_number:(0,u.cn)("text-[0.8rem] select-none text-muted-foreground",d.week_number),day:(0,u.cn)("relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",d.day),range_start:(0,u.cn)("rounded-l-md bg-accent",d.range_start),range_middle:(0,u.cn)("rounded-none",d.range_middle),range_end:(0,u.cn)("rounded-r-md bg-accent",d.range_end),today:(0,u.cn)("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",d.today),outside:(0,u.cn)("text-muted-foreground aria-selected:text-muted-foreground",d.outside),disabled:(0,u.cn)("text-muted-foreground opacity-50",d.disabled),hidden:(0,u.cn)("invisible",d.hidden),...a},components:{Root:e=>{let{className:t,rootRef:a,...s}=e;return(0,l.jsx)("div",{"data-slot":"calendar",ref:a,className:(0,u.cn)(t),...s})},Chevron:e=>{let{className:t,orientation:a,...s}=e;return"left"===a?(0,l.jsx)(eD.A,{className:(0,u.cn)("size-4",t),...s}):"right"===a?(0,l.jsx)(eq.A,{className:(0,u.cn)("size-4",t),...s}):(0,l.jsx)(em.A,{className:(0,u.cn)("size-4",t),...s})},DayButton:ti,WeekNumber:e=>{let{children:t,...a}=e;return(0,l.jsx)("td",{...a,children:(0,l.jsx)("div",{className:"flex size-(--cell-size) items-center justify-center text-center",children:t})})},...c},...o})}function ti(e){let{className:t,day:a,modifiers:r,...n}=e,i=(0,ta.a)(),c=s.useRef(null);return s.useEffect(()=>{var e;r.focused&&(null==(e=c.current)||e.focus())},[r.focused]),(0,l.jsx)(v.$,{ref:c,variant:"ghost",size:"icon","data-day":a.date.toLocaleDateString(),"data-selected-single":r.selected&&!r.range_start&&!r.range_end&&!r.range_middle,"data-range-start":r.range_start,"data-range-end":r.range_end,"data-range-middle":r.range_middle,className:(0,u.cn)("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",i.day,t),...n})}var tc=a(26991),to=a(23508),td=a(7620);let tu={light:"",dark:".dark"},tm=s.createContext(null);function tx(e){let{id:t,className:a,children:r,config:n,...i}=e,c=s.useId(),o="chart-".concat(t||c.replace(/:/g,""));return(0,l.jsx)(tm.Provider,{value:{config:n},children:(0,l.jsxs)("div",{"data-slot":"chart","data-chart":o,className:(0,u.cn)("[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",a),...i,children:[(0,l.jsx)(th,{id:o,config:n}),(0,l.jsx)(tc.u,{children:r})]})})}let th=e=>{let{id:t,config:a}=e,s=Object.entries(a).filter(e=>{let[,t]=e;return t.theme||t.color});return s.length?(0,l.jsx)("style",{dangerouslySetInnerHTML:{__html:Object.entries(tu).map(e=>{let[a,l]=e;return"\n".concat(l," [data-chart=").concat(t,"] {\n").concat(s.map(e=>{var t;let[l,s]=e,r=(null==(t=s.theme)?void 0:t[a])||s.color;return r?"  --color-".concat(l,": ").concat(r,";"):null}).join("\n"),"\n}\n")}).join("\n")}}):null},tf=to.m;function tp(e){let{active:t,payload:a,className:r,indicator:n="dot",hideLabel:i=!1,hideIndicator:c=!1,label:o,labelFormatter:d,labelClassName:m,formatter:x,color:h,nameKey:f,labelKey:p}=e,{config:g}=function(){let e=s.useContext(tm);if(!e)throw Error("useChart must be used within a <ChartContainer />");return e}(),j=s.useMemo(()=>{var e;if(i||!(null==a?void 0:a.length))return null;let[t]=a,s="".concat(p||(null==t?void 0:t.dataKey)||(null==t?void 0:t.name)||"value"),r=tg(g,t,s),n=p||"string"!=typeof o?null==r?void 0:r.label:(null==(e=g[o])?void 0:e.label)||o;return d?(0,l.jsx)("div",{className:(0,u.cn)("font-medium",m),children:d(n,a)}):n?(0,l.jsx)("div",{className:(0,u.cn)("font-medium",m),children:n}):null},[o,d,a,i,m,g,p]);if(!t||!(null==a?void 0:a.length))return null;let v=1===a.length&&"dot"!==n;return(0,l.jsxs)("div",{className:(0,u.cn)("border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",r),children:[v?null:j,(0,l.jsx)("div",{className:"grid gap-1.5",children:a.map((e,t)=>{let a="".concat(f||e.name||e.dataKey||"value"),s=tg(g,e,a),r=h||e.payload.fill||e.color;return(0,l.jsx)("div",{className:(0,u.cn)("[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5","dot"===n&&"items-center"),children:x&&(null==e?void 0:e.value)!==void 0&&e.name?x(e.value,e.name,e,t,e.payload):(0,l.jsxs)(l.Fragment,{children:[(null==s?void 0:s.icon)?(0,l.jsx)(s.icon,{}):!c&&(0,l.jsx)("div",{className:(0,u.cn)("shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)",{"h-2.5 w-2.5":"dot"===n,"w-1":"line"===n,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===n,"my-0.5":v&&"dashed"===n}),style:{"--color-bg":r,"--color-border":r}}),(0,l.jsxs)("div",{className:(0,u.cn)("flex flex-1 justify-between leading-none",v?"items-end":"items-center"),children:[(0,l.jsxs)("div",{className:"grid gap-1.5",children:[v?j:null,(0,l.jsx)("span",{className:"text-muted-foreground",children:(null==s?void 0:s.label)||e.name})]}),e.value&&(0,l.jsx)("span",{className:"text-foreground font-mono font-medium tabular-nums",children:e.value.toLocaleString()})]})]})},e.dataKey)})})]})}function tg(e,t,a){if("object"!=typeof t||null===t)return;let l="payload"in t&&"object"==typeof t.payload&&null!==t.payload?t.payload:void 0,s=a;return a in t&&"string"==typeof t[a]?s=t[a]:l&&a in l&&"string"==typeof l[a]&&(s=l[a]),s in e?e[s]:e[a]}td.s;var tj=a(82286);function tv(e){let{...t}=e;return(0,l.jsx)(tj.bL,{"data-slot":"popover",...t})}function tb(e){let{...t}=e;return(0,l.jsx)(tj.l9,{"data-slot":"popover-trigger",...t})}function ty(e){let{className:t,align:a="center",sideOffset:s=4,...r}=e;return(0,l.jsx)(tj.ZL,{children:(0,l.jsx)(tj.UC,{"data-slot":"popover-content",align:a,sideOffset:s,className:(0,u.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...r})})}let tN={quantity:{label:"Quantity Sold",color:"var(--color-primary)"}},tw=async e=>{let t=await fetch(e);return(await t.json()).data};function tC(){let e="http://3.25.180.232:5000/api",{data:t=[],error:a,isLoading:r}=(0,ei.Ay)("".concat(e,"/sales-items"),tw),{data:n=[],error:i,isLoading:c}=(0,ei.Ay)("".concat(e,"/products"),tw),o=new Date,d=new Date(o.getFullYear(),o.getMonth(),1),[u,b]=(0,s.useState)({from:d,to:o}),[y,N]=(0,s.useState)("normal"),w=(0,s.useMemo)(()=>{let e={};return n.forEach(t=>{e[t.id]=t.name}),e},[n]),C=(0,s.useMemo)(()=>{let e={};t.forEach(t=>{let a,l,s=new Date(t.created_at);(!(null==u?void 0:u.from)||(a=u.from,s.setHours(0,0,0,0)>=a.setHours(0,0,0,0)))&&(!(null==u?void 0:u.to)||(l=u.to,s.setHours(0,0,0,0)<=l.setHours(0,0,0,0)))&&(e[t.product_id]=(e[t.product_id]||0)+t.quantity)});let a=Object.entries(e).map(e=>{let[t,a]=e;return{product:w[Number(t)]||"Product ".concat(t),quantity:a}});return"asc"===y?a=a.sort((e,t)=>e.quantity-t.quantity):"desc"===y&&(a=a.sort((e,t)=>t.quantity-e.quantity)),a},[t,u,w,y]),S=(0,s.useMemo)(()=>C.reduce((e,t)=>e+t.quantity,0),[C]);return r||c?(0,l.jsx)("div",{children:"Loading..."}):a||i?(0,l.jsx)("div",{children:"Error loading product stats."}):(0,l.jsxs)(m,{className:"@container/card w-full",children:[(0,l.jsxs)(x,{className:"flex flex-col border-b @md/card:grid",children:[(0,l.jsx)(h,{children:"Product Analytics"}),(0,l.jsx)(f,{children:"Showing most sold products for this month."}),(0,l.jsx)(p,{className:"mt-2 @md/card:mt-0",children:(0,l.jsxs)("div",{className:"flex gap-2 items-center mt-2",children:[(0,l.jsx)(v.$,{variant:"desc"===y?"default":"outline",size:"sm",onClick:()=>N("desc"),"aria-label":"Sort Descending",children:(0,l.jsx)(em.A,{size:16})}),(0,l.jsx)(v.$,{variant:"normal"===y?"default":"outline",size:"sm",onClick:()=>N("normal"),"aria-label":"Follow Order",children:(0,l.jsx)(e3.A,{size:16})}),(0,l.jsx)(v.$,{variant:"asc"===y?"default":"outline",size:"sm",onClick:()=>N("asc"),"aria-label":"Sort Ascending",children:(0,l.jsx)(eh.A,{size:16})}),(0,l.jsxs)(tv,{children:[(0,l.jsx)(tb,{asChild:!0,children:(0,l.jsxs)(v.$,{variant:"outline",children:[(0,l.jsx)(e6.A,{}),(null==u?void 0:u.from)&&(null==u?void 0:u.to)?"".concat(u.from.toLocaleDateString()," - ").concat(u.to.toLocaleDateString()):"".concat(d.toLocaleDateString()," - ").concat(o.toLocaleDateString())]})}),(0,l.jsx)(ty,{className:"w-auto overflow-hidden p-0",align:"end",children:(0,l.jsx)(tn,{className:"w-full",mode:"range",defaultMonth:null==u?void 0:u.from,selected:u,onSelect:b,fixedWeeks:!0,showOutsideDays:!0,disabled:{after:o}})})]})]})})]}),(0,l.jsx)(g,{className:"px-4",children:(0,l.jsx)(tx,{config:tN,className:"aspect-auto h-89 w-full",children:(0,l.jsxs)(e8.E,{accessibilityLayer:!0,data:C,margin:{left:12,right:12},children:[(0,l.jsx)(e7.d,{vertical:!1}),(0,l.jsx)(e9.W,{dataKey:"product",tickLine:!1,axisLine:!1,tickMargin:8,minTickGap:20}),(0,l.jsx)(tf,{content:(0,l.jsx)(tp,{className:"w-[150px]",nameKey:"quantity",labelFormatter:e=>e})}),(0,l.jsx)(te.y,{dataKey:"quantity",fill:"var(--color-quantity)",radius:4})]})})}),(0,l.jsx)(j,{className:"border-t",children:(0,l.jsxs)("div",{className:"text-sm",children:["Total sold: ",(0,l.jsx)("span",{className:"font-semibold",children:S.toLocaleString()})]})})]})}var tS=a(80019),tk=a(47643);let tA={customer:{label:"Total",color:"var(--color-primary)"}},t_=async e=>{let t=await fetch(e);return(await t.json()).data};function tE(){let{data:e=[],error:t,isLoading:a}=(0,ei.Ay)("".concat("http://3.25.180.232:5000/api","/sales"),t_),r=new Date,n=new Date(r.getFullYear(),r.getMonth(),1),[i,c]=s.useState({from:n,to:r}),[o,d]=s.useState("normal"),u=s.useMemo(()=>{let t={};return e.forEach(e=>{var a;let l=e.created_at.slice(0,10);t[l]=(t[l]||0)+(null!=(a=e.total_purchase)?a:0)}),Object.entries(t).map(e=>{let[t,a]=e;return{date:t,customer:a}})},[e]),b=s.useMemo(()=>(null==i?void 0:i.from)||(null==i?void 0:i.to)?u.filter(e=>{let t,a,l=new Date(e.date);return(!i.from||(t=i.from,l.setHours(0,0,0,0)>=t.setHours(0,0,0,0)))&&(!i.to||(a=i.to,l.setHours(0,0,0,0)<=a.setHours(0,0,0,0)))}):u,[i,u]),y=s.useMemo(()=>{let e=[...b];return"asc"===o?e.sort((e,t)=>e.customer-t.customer):"desc"===o&&e.sort((e,t)=>t.customer-e.customer),e},[b,o]),N=s.useMemo(()=>y.reduce((e,t)=>e+t.customer,0),[y]);return a?(0,l.jsx)("div",{children:"Loading..."}):t?(0,l.jsx)("div",{children:"Error loading sales data."}):(0,l.jsxs)(m,{className:"@container/card w-full",children:[(0,l.jsxs)(x,{className:"flex flex-col border-b @md/card:grid",children:[(0,l.jsx)(h,{children:"Sales Chart"}),(0,l.jsx)(f,{children:"Filter total sales by date range"}),(0,l.jsx)(p,{className:"mt-2 @md/card:mt-0",children:(0,l.jsxs)("div",{className:"flex gap-2 items-center mt-2",children:[(0,l.jsx)(v.$,{variant:"desc"===o?"default":"outline",size:"sm",onClick:()=>d("desc"),"aria-label":"Sort Descending",children:(0,l.jsx)(em.A,{size:16})}),(0,l.jsx)(v.$,{variant:"normal"===o?"default":"outline",size:"sm",onClick:()=>d("normal"),"aria-label":"Follow Order",children:(0,l.jsx)(e3.A,{size:16})}),(0,l.jsx)(v.$,{variant:"asc"===o?"default":"outline",size:"sm",onClick:()=>d("asc"),"aria-label":"Sort Ascending",children:(0,l.jsx)(eh.A,{size:16})}),(0,l.jsxs)(tv,{children:[(0,l.jsx)(tb,{asChild:!0,children:(0,l.jsxs)(v.$,{variant:"outline",children:[(0,l.jsx)(e6.A,{}),(null==i?void 0:i.from)&&(null==i?void 0:i.to)?"".concat(i.from.toLocaleDateString()," - ").concat(i.to.toLocaleDateString()):"".concat(n.toLocaleDateString()," - ").concat(r.toLocaleDateString())]})}),(0,l.jsx)(ty,{className:"w-auto overflow-hidden p-0",align:"end",children:(0,l.jsx)(tn,{className:"w-full",mode:"range",defaultMonth:null==i?void 0:i.from,selected:i,onSelect:c,fixedWeeks:!0,showOutsideDays:!0,disabled:{after:r}})})]})]})})]}),(0,l.jsx)(g,{className:"px-4",children:(0,l.jsx)(tx,{config:tA,className:"aspect-auto h-89 w-full",children:(0,l.jsxs)(tS.b,{accessibilityLayer:!0,data:y,margin:{left:12,right:12},children:[(0,l.jsx)(e7.d,{vertical:!1}),(0,l.jsx)(e9.W,{dataKey:"date",tickLine:!1,axisLine:!1,tickMargin:8,minTickGap:20,tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{day:"numeric"})}),(0,l.jsx)(tf,{content:(0,l.jsx)(tp,{className:"w-[150px]",nameKey:"customer",labelFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})}),(0,l.jsx)(tk.N,{dataKey:"customer",type:"monotone",stroke:"var(--color-customer)",strokeWidth:2,dot:!1})]})})}),(0,l.jsx)(j,{className:"border-t",children:(0,l.jsxs)("div",{className:"text-sm",children:["You had ",(0,l.jsxs)("span",{className:"font-semibold",children:["₱ ",N.toLocaleString()]})," total sales for the selected period."]})})]})}function tL(){return(0,l.jsxs)("div",{className:"flex flex-col p-6 h-full gap-3",children:[(0,l.jsxs)("div",{className:"flex-[7%]",children:[(0,l.jsx)("h1",{className:"font-extrabold text-4xl",children:"Dashboard"}),(0,l.jsx)("p",{children:"Welcome Back! Here's your business overview!"})]}),(0,l.jsx)("div",{className:"flex-[20%]",children:(0,l.jsx)(e4,{})}),(0,l.jsxs)("div",{className:"flex-[78%] flex 2xl:flex-row gap-3 flex-col",children:[(0,l.jsx)("div",{className:"flex-[50%]",children:(0,l.jsx)(tC,{})}),(0,l.jsx)("div",{className:"flex-[50%]",children:(0,l.jsx)(tE,{})})]})]})}var tP=a(65229),tz=a(57419),tF=a(17037),tM=a(74054),tD=a(93736);let tq=[{value:"widget-a",label:"Widget A"},{value:"widget-b",label:"Widget B"},{value:"gadget-x",label:"Gadget X"},{value:"gadget-y",label:"Gadget Y"},{value:"part-123",label:"Part 123"}];function tT(e){var t,a;let{onAdd:r}=e,[n,i]=(0,s.useState)(!1),[c,o]=(0,s.useState)(!1),[d,u]=(0,s.useState)(""),[m,x]=(0,s.useState)(""),[h,f]=(0,s.useState)(1),[p,g]=(0,s.useState)(""),j=(0,s.useRef)(null),N=(0,s.useRef)(null),[w,C]=(0,s.useState)(null),{products:S,loading:k,error:A}=(0,D.Q)(),E=(0,s.useMemo)(()=>S&&S.length>0?S.map(e=>{var t;return{value:String(e.id),label:null!=(t=e.name)?t:"#".concat(e.id)}}):tq,[S]);(0,s.useEffect)(()=>{n&&m&&setTimeout(()=>{var e;return null==(e=j.current)?void 0:e.focus()},60)},[n,m]),(0,s.useLayoutEffect)(()=>{let e=()=>{var e,t;return C(null!=(t=null==(e=N.current)?void 0:e.offsetWidth)?t:null)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{if(c){var e,t;C(null!=(t=null==(e=N.current)?void 0:e.offsetWidth)?t:null)}},[c,m]);let L=(0,s.useMemo)(()=>new tD.A(E,{keys:["label"],threshold:.3,ignoreLocation:!0,minMatchCharLength:1}),[E]),P=(0,s.useMemo)(()=>{let e=d.trim();if(!e)return E;let t=e.toLowerCase().split(/\s+/).filter(Boolean),a=E.filter(e=>{var a;let l=String(null!=(a=e.label)?a:"").normalize("NFKC").toLowerCase();return t.every(e=>l.includes(e))});return a.length>0?a:L.search(e).map(e=>e.item)},[L,d,E]);(0,s.useEffect)(()=>{try{var e;console.log("[AddProductModal] apiProducts.length=",null!=(e=null==S?void 0:S.length)?e:0),console.log("[AddProductModal] sample apiProducts=",(null!=S?S:[]).slice(0,5)),console.log("[AddProductModal] productItems.length=",E.length),console.log("[AddProductModal] sample productItems=",E.slice(0,8)),console.log("[AddProductModal] query=",JSON.stringify(d),"filtered.length=",P.length),console.log("[AddProductModal] sample filtered=",P.slice(0,8))}catch(e){console.error("[AddProductModal] debug error",e)}},[S,E,d,P]);let z=(0,s.useCallback)(e=>{var t,a;if(e.preventDefault(),!m||h<1||""===p||0>Number(p))return;let l=null!=(a=null==(t=E.find(e=>e.value===m))?void 0:t.label)?a:m;if("function"==typeof r)r({name:l,qty:h,unitPrice:Number(p)});else try{window.dispatchEvent(new CustomEvent("stock:addProduct",{detail:{name:l,qty:h,unitPrice:Number(p)}}))}catch(e){}x(""),f(1),g(""),u(""),i(!1)},[m,h,p,E,r]);return(0,s.useEffect)(()=>{A&&console.error("useProducts error:",A)},[A]),(0,l.jsxs)(_.lG,{open:n,onOpenChange:i,children:[(0,l.jsx)(_.zM,{asChild:!0,children:(0,l.jsx)(v.$,{variant:"outline",className:"h-8",children:"Add"})}),(0,l.jsx)(_.Cf,{className:"sm:max-w-[425px]",children:(0,l.jsxs)("form",{onSubmit:z,children:[(0,l.jsxs)(_.c7,{children:[(0,l.jsx)(_.L3,{children:"Add Product"}),(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:"Search and add a product with quantity and unit price."})]}),(0,l.jsxs)("div",{className:"grid gap-4 py-2",children:[(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)(y.J,{htmlFor:"product-combobox",children:"Product"}),(0,l.jsxs)(tv,{open:c,onOpenChange:o,children:[(0,l.jsx)(tb,{asChild:!0,children:(0,l.jsxs)(v.$,{variant:"outline",role:"combobox","aria-expanded":c,className:"w-full justify-between text-left overflow-hidden","aria-label":"Product combobox",id:"product-combobox",ref:N,type:"button",children:[(0,l.jsx)("span",{className:"flex-1 min-w-0 truncate pr-2 text-left",children:m?null!=(a=null==(t=E.find(e=>e.value===m))?void 0:t.label)?a:m:"Select product..."}),(0,l.jsx)(tM.A,{className:"opacity-50"})]})}),(0,l.jsx)(ty,{className:"p-3 min-w-[280px] max-w-[640px]",align:"start",side:"bottom",style:w?{width:"".concat(w,"px")}:void 0,children:(0,l.jsxs)("div",{children:[(0,l.jsx)(b.p,{placeholder:"Search product...",className:"h-9 mb-2",value:d,onChange:e=>u(e.target.value),autoFocus:!0}),k?(0,l.jsx)("div",{className:"p-2 text-sm",children:"Loading products..."}):0===P.length?(0,l.jsx)("div",{className:"p-2 text-sm text-muted-foreground",children:'No product found for "'.concat(d,'". products=').concat(E.length," filtered=").concat(P.length)}):(0,l.jsx)("ul",{className:"max-h-56 overflow-auto divide-y rounded-md bg-background",children:P.map(e=>(0,l.jsx)("li",{children:(0,l.jsx)("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-muted-foreground/5 flex items-center gap-3",onClick:()=>{x(e.value),o(!1),setTimeout(()=>{var e;return null==(e=j.current)?void 0:e.focus()},60)},children:(0,l.jsx)("span",{className:"flex-1 truncate",children:String(e.label)})})},e.value))})]})})]})]}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)(y.J,{htmlFor:"qty",children:"Quantity"}),(0,l.jsx)(b.p,{id:"qty",ref:j,type:"number",min:1,value:String(h),onChange:e=>f(Math.max(1,Number(e.target.value)||1))})]}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)(y.J,{htmlFor:"unit-price",children:"Unit price (purchased)"}),(0,l.jsx)(b.p,{id:"unit-price",type:"number",step:"0.01",min:0,value:""===p?"":String(p),onChange:e=>g(""===e.target.value?"":Math.max(0,Number(e.target.value))),placeholder:"0.00"})]})]}),(0,l.jsxs)(_.Es,{children:[(0,l.jsx)(_.HM,{asChild:!0,children:(0,l.jsx)(v.$,{variant:"outline",children:"Cancel"})}),(0,l.jsx)(v.$,{type:"submit",disabled:!m||h<1||""===p,children:"Add"})]})]})})]})}function tR(e){let{onSave:t}=e,[a,r]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=e=>{(null==e?void 0:e.detail)&&j(e.detail)};return window.addEventListener("stock:addProduct",e),()=>window.removeEventListener("stock:addProduct",e)},[]);let[n,i]=(0,s.useState)(""),[c,o]=(0,s.useState)(""),[d,u]=(0,s.useState)(""),[m,x]=(0,s.useState)([]),[h,f]=(0,s.useState)(!1),{mutate:p}=(0,tz.iX)(),g=async()=>{var e,a;if(!n||0===m.length)return void alert("Company and at least one product are required.");let l={company_name:n,date:c||new Date().toISOString(),total:Number(d)||0,items:m.map(e=>{var t;return{product_id:null,purchased_price:null!=(t=e.unitPrice)?t:Number(d)||0,quantity:e.qty}})};try{f(!0);let a=(e="http://3.25.180.232:5000/api",void 0!==e)?e:"",s="".concat(a,"/stock-transactions"),h=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),g=await h.json();if(!h.ok)throw Error((null==g?void 0:g.message)||(null==g?void 0:g.error)||"Save failed");null==t||t({company:n,date:c,price:Number(d)||0,products:m}),p(s),i(""),o(""),u(""),x([]),r(!1)}catch(e){console.error("save stock error",e),alert("Save failed: ".concat(null!=(a=null==e?void 0:e.message)?a:e))}finally{f(!1)}},j=e=>{x(t=>{let a=t.findIndex(t=>t.name===e.name);if(-1!==a){let l=[...t];return l[a]={...l[a],qty:l[a].qty+e.qty,unitPrice:e.unitPrice},l}return[...t,{id:"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,9)),name:e.name,qty:e.qty,unitPrice:e.unitPrice}]})},y=(e,t,a)=>{x(l=>l.map(l=>{if(l.id!==e)return l;let s="qty"===t?Math.max(0,Math.floor(Number(a)||0)):Math.max(0,Number(a)||0);return{...l,[t]:s}}))};return m.reduce((e,t)=>e+t.qty*t.unitPrice,0),(0,l.jsxs)(_.lG,{open:a,onOpenChange:r,children:[(0,l.jsx)(_.zM,{asChild:!0,children:(0,l.jsxs)(v.$,{className:"h-full flex items-center gap-2",children:[(0,l.jsx)(C.A,{size:16}),"Add Stocks"]})}),(0,l.jsxs)(_.Cf,{className:" flex h-[calc(100vh-2rem)] min-w-[calc(100vw-2rem)] flex-col justify-between gap-0 p-0",children:[(0,l.jsxs)(tF.F,{className:"flex-1 overflow-hidden",children:[(0,l.jsxs)(_.c7,{className:"contents space-y-0 text-left",children:[(0,l.jsx)(_.L3,{className:"px-6 pt-6",children:"Add Stock"}),(0,l.jsx)(_.rr,{asChild:!0,children:(0,l.jsx)("div",{className:"pt-2 px-6",children:(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enter stock details and add products."})})})]}),(0,l.jsx)("div",{className:"px-6 pt-2",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm block mb-1",children:"Company"}),(0,l.jsx)(b.p,{value:n,onChange:e=>i(e.target.value),placeholder:"Company name"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm block mb-1",children:"Date"}),(0,l.jsx)(b.p,{type:"date",value:c,onChange:e=>o(e.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm block mb-1",children:"Price"}),(0,l.jsx)(b.p,{type:"number",step:"0.01",value:""===d?"":String(d),onChange:e=>u(""===e.target.value?"":Number(e.target.value)),placeholder:"0.00"})]})]}),(0,l.jsxs)("div",{className:"flex flex-col h-full",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsx)("h3",{className:"font-medium",children:"Products"}),(0,l.jsx)(tT,{onAdd:j})]}),(0,l.jsx)("div",{className:"[&>div]:max-h-[400px] [&>div]:rounded-sm [&>div]:border",children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)(q,{className:"table-fixed w-full",children:[(0,l.jsx)(T,{children:(0,l.jsxs)($,{className:"bg-background sticky top-0",children:[(0,l.jsx)(B,{className:"w-[35%]",children:"Product"}),(0,l.jsx)(B,{className:"w-[10%] text-center",children:"Quantity"}),(0,l.jsx)(B,{className:"w-[10%] text-center",children:"Unit Price"}),(0,l.jsx)(B,{className:"w-[8%]"})]})}),(0,l.jsx)(R,{children:0===m.length?(0,l.jsx)($,{children:(0,l.jsx)(O,{colSpan:4,children:(0,l.jsx)("div",{className:"w-full h-24 flex items-center justify-center text-sm text-muted-foreground",children:"No products added."})})}):m.map(e=>(0,l.jsxs)($,{children:[(0,l.jsx)(O,{className:"min-w-0 break-words whitespace-normal pr-4",children:(0,l.jsx)("div",{className:"font-medium",children:e.name})}),(0,l.jsx)(O,{className:"text-center align-middle",children:(0,l.jsx)(b.p,{type:"number",min:0,value:String(e.qty),onChange:t=>y(e.id,"qty",t.target.value),onBlur:t=>y(e.id,"qty",t.target.value),className:"focus-visible:ring-ring h-8 w-20 border-0 bg-transparent p-1 text-center focus-visible:ring-1 mx-auto","aria-label":"qty-".concat(e.id)})}),(0,l.jsx)(O,{className:"text-center align-middle",children:(0,l.jsx)(b.p,{type:"number",step:"0.01",min:0,value:String(e.unitPrice),onChange:t=>y(e.id,"unitPrice",t.target.value),onBlur:t=>y(e.id,"unitPrice",t.target.value),className:"focus-visible:ring-ring h-8 w-24 border-0 bg-transparent p-1 text-center focus-visible:ring-1 mx-auto","aria-label":"unit-".concat(e.id)})}),(0,l.jsx)(O,{className:"text-center align-middle",children:(0,l.jsx)(v.$,{variant:"ghost",size:"sm",onClick:()=>{var t;return t=e.id,void x(e=>e.filter(e=>e.id!==t))},"aria-label":"Remove product",children:(0,l.jsx)(tP.A,{className:"h-4 w-4"})})})]},e.id))})]})})})]})]})})]}),(0,l.jsxs)(_.Es,{className:"px-6 pb-6 sm:justify-end",children:[(0,l.jsx)(_.HM,{asChild:!0,children:(0,l.jsxs)(v.$,{variant:"outline",onClick:()=>r(!1),disabled:h,children:[(0,l.jsx)(eD.A,{}),"Back"]})}),(0,l.jsx)(v.$,{onClick:g,disabled:h,children:h?"Saving...":"Save"})]})]})]})}function t$(){return(0,l.jsxs)("div",{className:"flex justify-between items-center h-full",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold",children:"Stock Movements"}),(0,l.jsx)("div",{className:"flex gap-3",children:(0,l.jsx)(tR,{})})]})}let tB=async e=>{var t;let a=await fetch(e);if(!a.ok)throw Error("HTTP ".concat(a.status));let l=await a.json();return null!=(t=null==l?void 0:l.data)?t:[]},tO=[{accessorKey:"company_name",header:"Company Name",cell:e=>{let{row:t}=e;return(0,l.jsx)("div",{className:"font-medium",children:t.getValue("company_name")})}},{accessorKey:"date",header:"Date",cell:e=>{let{row:t}=e,a=t.getValue("date"),s=a?new Date(a).toLocaleDateString():"";return(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:s})}},{accessorKey:"total",header:()=>(0,l.jsx)("div",{className:"text-right",children:"Total"}),cell:e=>{var t;let{row:a}=e,s=parseFloat(String(null!=(t=a.getValue("total"))?t:0)),r=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s);return(0,l.jsx)("div",{className:"text-right font-medium",children:r})}}],tI=()=>{var e;let{data:t,loading:a,error:r}=function(){let{data:e,error:t,isValidating:a,mutate:l}=(0,ei.Ay)("".concat("http://3.25.180.232:5000/api","/stock-transactions"),tB,{revalidateOnFocus:!1});return{data:e,loading:!t&&!e&&a,error:t?t.message:null}}(),[n,i]=(0,s.useState)([]),[c,o]=(0,s.useState)([]),[d,u]=(0,s.useState)({}),[m,x]=(0,s.useState)({}),[h,f]=(0,s.useState)(""),p=(0,ek.N4)({data:null!=t?t:[],columns:tO,onSortingChange:i,onColumnFiltersChange:o,getCoreRowModel:(0,eA.HT)(),getPaginationRowModel:(0,eA.kW)(),getSortedRowModel:(0,eA.h5)(),getFilteredRowModel:(0,eA.hM)(),onColumnVisibilityChange:u,onRowSelectionChange:x,onGlobalFilterChange:f,globalFilterFn:"includesString",state:{sorting:n,columnFilters:c,columnVisibility:d,rowSelection:m,globalFilter:h}});return(0,l.jsxs)("div",{className:"w-full h-full",children:[(0,l.jsxs)("div",{className:"flex justify-between gap-2 pb-4 max-sm:flex-col sm:items-center",children:[(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsx)(b.p,{placeholder:"Search all columns...",value:null!=h?h:"",onChange:e=>f(String(e.target.value)),className:"max-w-sm"})}),(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsxs)("div",{className:"text-muted-foreground text-sm",children:[p.getSelectedRowModel().rows.length>0&&(0,l.jsxs)("span",{className:"mr-2",children:[p.getSelectedRowModel().rows.length," of ",p.getFilteredRowModel().rows.length," row(s) selected"]}),a&&(0,l.jsx)("span",{className:"ml-2",children:"Loading..."}),r&&(0,l.jsxs)("span",{className:"ml-2 text-destructive",children:["Error: ",r]})]})})]}),(0,l.jsx)("div",{className:"rounded-md border",children:(0,l.jsxs)(q,{children:[(0,l.jsx)(T,{children:p.getHeaderGroups().map(e=>(0,l.jsx)($,{children:e.headers.map(e=>(0,l.jsx)(B,{children:e.isPlaceholder?null:(0,ek.Kv)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,l.jsx)(R,{children:(null==(e=p.getRowModel().rows)?void 0:e.length)?p.getRowModel().rows.map(e=>(0,l.jsx)($,{"data-state":e.getIsSelected()&&"selected",children:e.getVisibleCells().map(e=>(0,l.jsx)(O,{children:(0,ek.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,l.jsx)($,{children:(0,l.jsx)(O,{colSpan:tO.length,className:"h-24 text-center",children:"No results."})})})]})})]})};function tK(){return(0,l.jsx)(m,{className:"h-full border",children:(0,l.jsx)(g,{children:(0,l.jsx)(tI,{})})})}function tY(){return(0,l.jsxs)("div",{className:"flex flex-col gap-4 p-8 w-full h-full",children:[(0,l.jsx)("div",{className:"h-full flex-[10%]",children:(0,l.jsx)(t$,{})}),(0,l.jsx)("div",{className:" h-full flex-[90%]",children:(0,l.jsx)(tK,{})})]})}function tG(e){let{params:t}=e,{site:a}=(0,s.use)(t);switch(a){case"db":return(0,l.jsx)(tL,{});case"main":return(0,l.jsx)(er,{});case"products":return(0,l.jsx)(eX,{});case"stock":return(0,l.jsx)(tY,{});default:return(0,l.jsx)("div",{children:a})}}},68529:(e,t,a)=>{Promise.resolve().then(a.bind(a,50792))}},e=>{e.O(0,[247,788,746,792,720,953,290,904,441,255,358],()=>e(e.s=68529)),_N_E=e.O()}]);