(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[759],{52387:(e,t,a)=>{Promise.resolve().then(a.bind(a,61295))},61295:(e,t,a)=>{"use strict";a.d(t,{default:()=>ar});var l=a(95155),r=a(12115),s=a(36764),n=a(47943),o=a(25959),c=a(89863);let i=(e,t)=>(null==e?void 0:e.id)&&(null==t?void 0:t.id)?e.id===t.id:!!((null==e?void 0:e.barcode)&&(null==t?void 0:t.barcode)&&e.barcode===t.barcode),d=(0,o.v)()((0,c.Zr)((e,t)=>({cart:[],lastAddedItemId:null,scanError:null,isScanning:!1,addProductToCart:a=>{let{cart:l}=t(),r=l.find(e=>i(e.product,a));if(r)return e({cart:l.map(e=>i(e.product,a)?{...e,quantity:e.quantity+1}:e),lastAddedItemId:r.id}),r.id;{let t={product:a,quantity:1,id:"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():Date.now().toString()};return e({cart:[t,...l],lastAddedItemId:t.id}),t.id}},updateCartItemQuantity:(t,a)=>{e(e=>({cart:e.cart.map(e=>e.id===t?{...e,quantity:Math.max(0,Number(a)||0)}:e)}))},updateCartItemPrice:(t,a)=>{e(e=>({cart:e.cart.map(e=>e.id===t?{...e,product:{...e.product,price:Number(isFinite(Number(a))?a:0)}}:e)}))},deleteCartItem:t=>{e(e=>({cart:e.cart.filter(e=>e.id!==t),lastAddedItemId:e.lastAddedItemId===t?null:e.lastAddedItemId}))},clearCart:()=>{e({cart:[],lastAddedItemId:null})},setScanError:t=>{e({scanError:t})},setIsScanning:t=>{e({isScanning:t})},setLastAddedItemId:t=>{e({lastAddedItemId:t})}}),{name:"pos-cart-storage-".concat((()=>{let e=sessionStorage.getItem("pos-tab-id");return e||(e="tab-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),sessionStorage.setItem("pos-tab-id",e)),e})()),partialize:e=>({cart:e.cart,lastAddedItemId:e.lastAddedItemId})})),u=(0,r.createContext)(void 0),m=e=>{let{children:t}=e,{cart:a,lastAddedItemId:o,scanError:c,isScanning:i,addProductToCart:m,updateCartItemQuantity:x,updateCartItemPrice:h,deleteCartItem:f,clearCart:g,setScanError:p,setIsScanning:v,setLastAddedItemId:j}=d(),b=d(e=>e.cart).reduce((e,t)=>e+Number(t.product.price||0)*t.quantity,0),[y,w]=r.useState(new Set),N=(0,r.useRef)(new Map),{setBarcode:C,openModal:S,setOpen:k}=(0,n.c)(),E=(0,r.useCallback)(()=>{g(),N.current=new Map},[g]),A=(0,r.useCallback)(e=>{let t=null;if(a.length>0){let s=a.findIndex(t=>t.id===e);if(a.length>1){var l,r;t=s>0?a[s-1].id:null!=(r=null==(l=a[1])?void 0:l.id)?r:null}}f(e);try{window.dispatchEvent(new CustomEvent("cart:item-deleted",{detail:{deletedId:e,nextSelectedId:t}}))}catch(e){}},[a,f]),D=(0,r.useCallback)((e,t)=>{x(e,t)},[x]),_=(0,r.useCallback)((e,t)=>{h(e,t)},[h]),L=(0,r.useCallback)(e=>m(e),[m]),P=(0,r.useCallback)(e=>L(e),[L]),T=(0,r.useCallback)(async(e,t)=>{if(!e)return;let a=String(e).replace(/[\u0000-\u001F\u007F-\u009F]/g,"").trim();if(!a)return void p("Invalid barcode");if(!y.has(a))try{v(!0),p(null),w(e=>new Set([...e,a]));let e=null!=t?t:null;if(!e)try{e=await s.G.getByBarcode(a)}catch(t){e=null}if(e)L(e),p(null);else{try{window.dispatchEvent(new CustomEvent("unregistered-barcode",{detail:{barcode:a}}))}catch(e){}p("Product not found: ".concat(a))}}catch(e){p(e instanceof Error?e.message:"Error scanning barcode"),console.warn("[scanAndAddToCart] Error:",e)}finally{w(e=>{let t=new Set(e);return t.delete(a),t}),v(!1)}},[y,L,p,v]);(0,r.useEffect)(()=>{let e=e=>{let t=null==e?void 0:e.detail;if(!t)return;let a=t.product,l=t.barcode;a?L(a):l&&(async()=>{try{let e=await s.G.getByBarcode(l);e&&L(e)}catch(e){}})()};return window.addEventListener("product:added",e),()=>window.removeEventListener("product:added",e)},[L]);let I=(0,r.useMemo)(()=>({cart:a,cartTotal:b,scanError:c,isScanning:i,lastAddedItemId:o,scanAndAddToCart:T,addProductToCart:P,updateCartItemQuantity:D,updateCartItemPrice:_,deleteCartItem:A,clearCart:E,setScanError:p,setIsScanning:v,setLastAddedItemId:j}),[a,b,c,i,o,T,P,D,_,A,E,p,v,j]);return(0,l.jsx)(u.Provider,{value:I,children:t})},x=()=>{let e=(0,r.useContext)(u);if(!e)throw Error("useCart must be used within a CartProvider");return e};var h=a(64269);function f(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card",className:(0,h.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function g(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-header",className:(0,h.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function p(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-title",className:(0,h.cn)("leading-none font-semibold",t),...a})}function v(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-description",className:(0,h.cn)("text-muted-foreground text-sm",t),...a})}function j(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-action",className:(0,h.cn)("col-start-2 row-span-2 row-start-1 self-start justify-self-end",t),...a})}function b(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-content",className:(0,h.cn)("px-6",t),...a})}function y(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-footer",className:(0,h.cn)("flex items-center px-6 [.border-t]:pt-6",t),...a})}var w=a(3998),N=a(12466),C=a(65142),S=a(76444);function k(e){let{amount:t,setAmount:a,cartTotal:s,cartIsEmpty:n=!1}=e,o=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=()=>{try{o.current&&!n&&(o.current.focus(),o.current.select())}catch(e){console.warn("Failed to focus cash input:",e)}};return window.addEventListener("focusCashInput",e),()=>window.removeEventListener("focusCashInput",e)},[n]);let c=(0,r.useMemo)(()=>{let e=parseFloat(String(t||"0"));return Number.isFinite(e)?e:0},[t]),i=(0,r.useMemo)(()=>c-(s||0),[c,s]),d=String(null!=t?t:"").trim().length>0;return(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)(S.J,{htmlFor:"pos-cash",className:"block mb-2 text-sm md:text-base font-medium text-gray-700",children:"Cash Payment"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("span",{className:"pointer-events-none absolute inset-y-0 left-3 flex items-center text-gray-400 font-semibold",children:"₱"}),(0,l.jsx)(C.p,{id:"pos-cash",ref:o,"data-pos-cash-input":"true",value:t,onChange:e=>{a(e.target.value)},onKeyDown:e=>{if(e.ctrlKey&&"Enter"===e.key){e.preventDefault(),e.stopPropagation();return}"Enter"!==e.key||e.ctrlKey||(e.preventDefault(),e.stopPropagation(),window.dispatchEvent(new CustomEvent("pos:next-step")))},placeholder:"0.00",disabled:n,autoComplete:"off",className:"h-12 md:h-14 pl-8 text-base md:text-lg text-left font-medium tabular-nums border-2 border-gray-200 bg-gray-50 focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-0 placeholder:text-gray-400 rounded-xl",inputMode:"decimal"})]}),d&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)(S.J,{className:"block mb-2 text-sm md:text-base font-medium text-gray-700",children:"Change"}),(0,l.jsxs)("div",{className:"h-12 md:h-14 rounded-xl border-2 bg-white flex items-center justify-between px-4",children:[(0,l.jsx)("span",{className:"text-sm md:text-base text-gray-600",children:"₱"}),(0,l.jsx)("span",{className:["tabular-nums font-semibold text-base md:text-lg",i>=0?"text-green-600":"text-red-600"].join(" "),children:Math.abs(i).toFixed(2)})]})]})]})}var E=a(20508),A=a(42529),D=a(6191);function _(e){let{customerQuery:t,setCustomerQuery:a,filteredCustomers:s,selectedCustomer:n,selectCustomer:o,clearCustomer:c,onAddCustomer:i,onCustomerSelected:d}=e,u=(0,r.useId)(),m=(0,r.useRef)(null),[x,h]=(0,r.useState)(-1),f=1===s.length&&t.trim().length>=2&&!n;(0,r.useEffect)(()=>{h(-1)},[s]),(0,r.useEffect)(()=>{let e=e=>{if(e.ctrlKey&&"c"===e.key.toLowerCase()){var t,a;e.preventDefault(),e.stopPropagation(),null==(t=m.current)||t.focus(),null==(a=m.current)||a.select()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]);let g=e=>{var t;o(e),h(-1),window.customerSearchActive=!1,null==(t=m.current)||t.blur()},p=s.slice(0,4);return(0,l.jsxs)("div",{className:"w-full mb-4",onClick:e=>{e.stopPropagation()},"data-customer-search":"true",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)(S.J,{htmlFor:u,className:"uppercase tracking-wide text-sm font-semibold",children:"Customer Name"}),(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"(Ctrl+C)"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 relative",children:[(0,l.jsxs)("div",{className:"relative flex-1",children:[(0,l.jsx)("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-400",children:(0,l.jsx)(E.A,{className:"w-4 h-4"})}),(0,l.jsx)(C.p,{ref:m,id:u,className:"pl-9 pr-10",placeholder:"Search Name",value:t,onChange:e=>{e.stopPropagation(),a(e.target.value),h(-1),n&&c()},onKeyDown:e=>{if(e.stopPropagation(),e.ctrlKey&&"c"!==e.key.toLowerCase())return void e.preventDefault();if("ArrowDown"===e.key){e.preventDefault(),s.length>0&&h(e=>e<s.length-1?e+1:0);return}if("ArrowUp"===e.key){e.preventDefault(),s.length>0&&h(e=>e>0?e-1:s.length-1);return}if("Enter"===e.key){if(e.preventDefault(),x>=0&&x<s.length)return void g(s[x]);if(s.length>0&&!n)return void g(s[0]);n&&(null==d||d())}if("Escape"===e.key){var t;e.preventDefault(),h(-1),null==(t=m.current)||t.blur()}},onFocus:()=>{var e;window.customerSearchActive=!0,null==(e=m.current)||e.select()},onBlur:()=>{setTimeout(()=>{window.customerSearchActive=!1},150)},autoComplete:"off","data-customer-search":"true"}),f&&(0,l.jsx)(A.A,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-green-500 animate-pulse",size:16})]}),(0,l.jsx)(w.$,{type:"button",onClick:()=>i(),className:"ml-2 rounded-lg",children:(0,l.jsx)(D.A,{className:"w-4 h-4 mr-1"})}),t&&!n&&(0,l.jsx)("div",{className:"   absolute left-0 right-0 top-full mt-2   bg-white border rounded-xl shadow-lg   z-50   max-h-72 overflow-auto   ",children:0===p.length?(0,l.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500 text-center",children:"No results"}):p.map((e,t)=>(0,l.jsx)("button",{type:"button",onClick:()=>g(e),className:"w-full text-left px-4 py-3 text-sm \n                              ".concat(x===t?"bg-blue-50":"hover:bg-gray-50"),children:(0,l.jsx)("span",{className:"block truncate",children:e.name})},e.id))})]})]})}function L(e){let{amount:t,cartTotal:a,change:r}=e,s=parseFloat(String(t||"0"));(!Number.isFinite(s)||isNaN(s))&&(s=0);let n=s>=a;return(0,l.jsxs)("div",{className:" mt-2",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between text-base md:text-md leading-6",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Amount Paid:"}),(0,l.jsxs)("span",{className:"tabular-nums font-medium",children:["₱",s.toFixed(2)]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-base md:text-md leading-6 mt-3",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Total:"}),(0,l.jsxs)("span",{className:"tabular-nums font-medium",children:["₱",a.toFixed(2)]})]}),(0,l.jsx)("hr",{className:"my-4 border-gray-200"}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-base md:text-lg",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Change:"}),(0,l.jsxs)("span",{className:["tabular-nums font-semibold",n?"text-green-600":"text-red-600"].join(" "),children:["₱",r.toFixed(2)]})]})]})}function P(e){let{selectedCustomer:t,cartTotal:a}=e,r=a>0?Number(a/1e4):0,s=t&&"number"==typeof t.points?Number(t.points):null,n=e=>Number(e.toFixed(2)).toString();return(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center flex-1",children:[(0,l.jsx)("h2",{className:"text-3xl font-bold mb-4",children:"Transaction Successful!"}),t?(0,l.jsxs)("div",{className:"text-lg mb-1",children:["Customer: ",(0,l.jsx)("span",{className:"font-medium",children:t.name})]}):null,(0,l.jsx)("p",{className:"mb-4",children:"Thank you for your purchase."}),(0,l.jsxs)("div",{className:"text-lg mb-1",children:["Points earned: ",(0,l.jsx)("span",{className:"font-medium",children:n(r)})]}),null!==s?(0,l.jsxs)("div",{className:"text-lg",children:["Customer points: ",(0,l.jsx)("span",{className:"font-medium",children:n(s)})]}):null]})}var T=a(51834);function I(e){let{open:t,onOpenChange:a,onCustomerAdded:s}=e,[n,o]=(0,r.useState)(""),[c,i]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(null);(0,r.useEffect)(()=>{t||(o(""),x(null),i(!1),u(!1))},[t]);let h=e=>e.trim().toLowerCase(),f=async e=>{if(!e)return x(null),!0;u(!0);try{var t,a,l;let r=await N.A.get("/customers",{params:{name:e}}),s=null!=(l=null!=(a=null==r||null==(t=r.data)?void 0:t.data)?a:null==r?void 0:r.data)?l:[];if(Array.isArray(s)&&s.some(t=>{var a,l;let r=null!=(l=null!=(a=null==t?void 0:t.name)?a:null==t?void 0:t.full_name)?l:"";return h(r)===h(e)}))return x("A customer with this name already exists."),!1;return x(null),!0}catch(e){return console.warn("Customer validation failed:",e),x(null),!0}finally{u(!1)}},g=async()=>{let e=n.trim();if(0===e.length)return void x("Name cannot be empty.");if(await f(e)){i(!0);try{var t;let l=(await N.A.get("/customers",{params:{name:e}})).data;if((Array.isArray(l)?l:Array.isArray(null==l?void 0:l.data)?l.data:[]).some(t=>!!t&&"string"==typeof t.name&&h(t.name)===h(e))){x("A customer with this name already exists."),i(!1);return}let r=await N.A.post("/customers",{name:e}),n=r.data;if(r.status>=400||(null==n?void 0:n.success)===!1){let e=(null==n?void 0:n.message)||(null==n?void 0:n.error)||"Failed to add customer";throw Error(e)}let c=null!=(t=null==n?void 0:n.data)?t:n;o(""),a(!1),s(c)}catch(e){x((null==e?void 0:e.message)||"Failed to add customer")}finally{i(!1)}}},p=c||d||!!m||0===n.trim().length;return(0,l.jsx)(T.lG,{open:t,onOpenChange:a,children:(0,l.jsx)(T.Cf,{"data-add-customer-modal":"true",children:(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),g()},children:[(0,l.jsx)(T.c7,{children:(0,l.jsx)(T.L3,{className:"mb-2",children:"Add Customer"})}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)(S.J,{htmlFor:"add-customer-name",children:"Name"}),(0,l.jsx)(C.p,{id:"add-customer-name",autoFocus:!0,value:n,onChange:e=>{o(e.target.value),m&&x(null)},onBlur:()=>{let e=n.trim();e&&f(e)}}),m&&(0,l.jsx)("span",{className:"text-red-500 text-sm",children:m}),(0,l.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,l.jsx)(w.$,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancel"}),(0,l.jsx)(w.$,{type:"submit",disabled:p,children:c?"Adding...":"Add"})]})]})]})})})}var M=a(68267);function F(){return window.__TAURI__}function z(e,t){let a=String(null!=e?e:"");return a.length>=t?a.slice(0,t):" ".repeat(t-a.length)+a}function q(e,t){let a=String(null!=e?e:"");return a.length>=t?a.slice(0,t):a+" ".repeat(t-a.length)}function R(e,t){let a=String(null!=e?e:"");if(a.length>=t)return a;let l=Math.floor((t-a.length)/2),r=t-a.length-l;return" ".repeat(l)+a+" ".repeat(r)}function U(e){let{step:t,setStep:a}=e,{cart:s,cartTotal:n,clearCart:o}=x(),[c,i]=(0,r.useState)(""),[d,u]=(0,r.useState)(0),[m,h]=(0,r.useState)(!1),[g,p]=(0,r.useState)(!1),[v,j]=(0,r.useState)(!1),[C,S]=(0,r.useState)(!1),{printReceipt:E}=function(){let e=async e=>{if(!F())throw Error("Direct printing is only available in the desktop app");try{if(console.log("[DIRECT PRINT] Starting direct print process..."),!e.items||0===e.items.length)throw Error("No items to print");let t=function(e){var t,a,l,r,s;let n=new Date().toLocaleDateString("en-PH",{year:"numeric",month:"long",day:"2-digit"}),o="";for(let c of(o+="\x1b@",o+="\x1bt\0",o+="\x1ba\x01",(null==(t=e.store)?void 0:t.name)&&(o+=R(e.store.name,48)+"\n"),(null==(a=e.store)?void 0:a.address1)&&(o+=R(e.store.address1,48)+"\n"),(null==(l=e.store)?void 0:l.address2)&&(o+=R(e.store.address2,48)+"\n"),o+="\n",o+="\x1ba\0",o+="Customer: ".concat((null==(r=e.customer)?void 0:r.name)||"N/A","\n"),o+="Date: ".concat(n,"\n"),o+="".padEnd(48,"-")+"\n",o+=q("Item",24)+z("QTY",4)+z("Price",10)+z("Amount",10)+"\n",o+="".padEnd(48,"-")+"\n",Array.isArray(e.items)?e.items:[])){let e=String(c.desc||"").trim(),t=[];for(let a=0;a<e.length;a+=24)t.push(e.slice(a,a+24));let a=z(c.qty||0,4),l=z("P".concat((null!=(s=c.price)?s:(c.amount||0)/Math.max(1,c.qty||1)).toFixed(2)),10),r=z("P".concat((c.amount||0).toFixed(2)),10);o+=q(t[0],24)+a+l+r+"\n";for(let e=1;e<t.length;e++)o+=q(t[e],24)+"\n";o+="\n"}return o+="".padEnd(48,"-")+"\n",o+=z("TOTAL:",38)+z("P".concat((e.cartTotal||0).toFixed(2)),10)+"\n",o+=z("AMOUNT:",38)+z("P".concat((e.amount||0).toFixed(2)),10)+"\n",o+=z("CHANGE:",38)+z("P".concat((e.change||0).toFixed(2)),10)+"\n",o+="".padEnd(48,"-")+"\n",o+="Customer Points: ".concat(Number(e.points||0),"\n"),o+="".padEnd(48,"-")+"\n\n",o+="\x1ba\x01",o+="CUSTOMER COPY - NOT AN OFFICIAL RECEIPT\n",o+="THANK YOU - GATANG KA MANEN!\n",o+="\x1ba\0",o+="\n\n",o+="\x1bd\x07",o+="\x1dV\0"}(e);console.log("[DIRECT PRINT] Generated receipt content, length:",t.length),console.log("[DIRECT PRINT] Items:",e.items.length);let a=await (0,M.lA)("print_receipt_direct",{receiptData:t,itemCount:e.items.length,printerName:e.printerName||null});return console.log("[DIRECT PRINT] Print successful:",a),a}catch(e){throw console.error("[DIRECT PRINT] Print error:",e),Error("Print failed: ".concat(e.message||e))}},t=async()=>{if(!F())throw Error("Test connection only available in desktop app");return await e({store:{name:"YZY",address1:"Eastern Slide, Tuding"},customer:{name:"N/A"},cartTotal:23,amount:50,change:27,points:0,items:[{desc:"Debug Product 1",qty:1,price:10,amount:10},{desc:"MAGIC SARAP TRIPID 21G",qty:1,price:13,amount:13}]})};return{printReceipt:e,testConnection:t,getAvailablePrinters:async()=>[{name:"Default Printer",status:"Available",isDefault:!0}],isTauri:F(),isDirect:!0}}();(0,r.useEffect)(()=>{u((parseFloat(c)||0)-n)},[c,n]);let A=(0,r.useCallback)(()=>{j(!0)},[]),{customerQuery:D,setCustomerQuery:U,filteredCustomers:O,selectedCustomer:G,selectCustomer:B,clearCustomer:$,allCustomers:K,setAllCustomers:Y}=function(e){let[t,a]=(0,r.useState)(""),[l,s]=(0,r.useState)([]),[n,o]=(0,r.useState)(null),c=(0,r.useCallback)(async()=>{try{let e=(await N.A.get("/customers")).data;e&&e.success&&Array.isArray(e.data)?s(e.data):(console.warn("Invalid customer response format:",e),s([]))}catch(e){console.error("Error fetching customers:",e),s([])}},[]);(0,r.useEffect)(()=>{c()},[c]);let i=l.filter(e=>e.name.toLowerCase().includes(t.toLowerCase()));return{customerQuery:t,setCustomerQuery:a,filteredCustomers:i,selectedCustomer:n,selectCustomer:e=>{o(e),a(e.name)},clearCustomer:()=>{o(null),a("")},allCustomers:l,setAllCustomers:s,refetchCustomers:c}}(),V=(0,r.useCallback)(()=>{let e=parseFloat(c)||0;e>=n?(u(e-n),a(2)):alert("Insufficient amount")},[c,n,a]);(0,r.useCallback)(async()=>{var e,t,l;if(!g&&0!==s.length)try{p(!0);let t={customer_id:(null==G?void 0:G.id)||null,total_purchase:n,items:s.map(e=>({product_id:e.product.id,quantity:e.quantity,price:e.product.price}))};await N.A.post("/sales",t);try{let t=await N.A.get("/customers");(null==(e=t.data)?void 0:e.success)&&Array.isArray(t.data.data)&&Y(t.data.data)}catch(e){console.warn("Operation failed:",e)}$(),a(1),i(""),u(0),o(),window.customerSearchActive=!1}catch(e){alert("Error saving sale: "+((null==(l=e.response)||null==(t=l.data)?void 0:t.error)||e.message||"Unknown error"))}finally{p(!1)}},[s,G,n,$,o,Y,g]);let Q=(0,r.useCallback)(async()=>{var e,t,l;if(!g&&0!==s.length)try{if(p(!0),s.some(e=>{let t=e.product.id;return"string"==typeof t&&t.startsWith("debug-")})){a(3),p(!1);return}let t={customer_id:(null==G?void 0:G.id)||null,total_purchase:n,items:s.map(e=>({product_id:e.product.id,quantity:e.quantity,price:e.product.price}))},l=await N.A.post("/sales",t),r=null==l?void 0:l.data;(null==r||null==(e=r.data)?void 0:e.customer)&&(Y(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.findIndex(e=>String(e.id)===String(r.data.customer.id));if(t>=0){let a=[...e];return a[t]=r.data.customer,a}return[...e,r.data.customer]}),B(r.data.customer)),a(3)}catch(e){alert("Error finalizing sale: "+((null==(l=e.response)||null==(t=l.data)?void 0:t.error)||e.message||"Unknown error"))}finally{p(!1)}},[s,G,n,Y,B,a,g]),W=(0,r.useCallback)(()=>{try{$(),a(1),i(""),u(0),o(),window.customerSearchActive=!1}catch(e){console.warn("Transaction operation failed:",e)}},[$,a,i,u,o]),J=(0,r.useCallback)(()=>{var e;if(g)return;if(2===t)return void Q();if(3===t)return void W();if(window.customerSearchActive)return;let a=document.activeElement;if(!(a&&("true"===a.getAttribute("data-customer-search")||(null==(e=a.placeholder)?void 0:e.toLowerCase().includes("search name"))||a.closest("[data-customer-search]")))&&1===t)return void V()},[t,g,Q,V,W,a]);(0,r.useEffect)(()=>(window.addEventListener("pos:next-step",J),()=>{window.removeEventListener("pos:next-step",J)}),[J,t]),(0,r.useEffect)(()=>{let e=()=>{2===t&&a(1)};return window.addEventListener("pos:step-1-back",e),()=>window.removeEventListener("pos:step-1-back",e)},[t,a]),(0,r.useEffect)(()=>{let e=()=>h(!0);return window.addEventListener("customer:add",e),()=>window.removeEventListener("customer:add",e)},[h]),(0,r.useEffect)(()=>{let e=e=>{if(2!==t&&3!==t||window.customerSearchActive||g||e.ctrlKey||e.shiftKey||e.altKey)return;let a=document.activeElement;a&&("INPUT"===a.tagName||"TEXTAREA"===a.tagName||"true"===a.contentEditable)||(e.preventDefault(),2===t?Q():3===t&&W())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,g,Q,W]),(0,r.useEffect)(()=>{if(!v)return},[v]);let H=(0,r.useCallback)(async()=>{if(g||C)return;let e=s.map(e=>{var t,a,l,r,s,n;return{desc:null!=(n=null!=(s=null==(t=e.product)?void 0:t.name)?s:null==(a=e.product)?void 0:a.barcode)?n:"Item",qty:Number(e.quantity||0),price:Number((null==(l=e.product)?void 0:l.price)||0),amount:Number((((null==(r=e.product)?void 0:r.price)||0)*e.quantity).toFixed(2))}});try{var t;S(!0);let a=await E({store:{name:"YZY STORE",address1:"Eastern Slide, Tuding"},customer:G||{name:"N/A"},cartTotal:Number(n||0),amount:Number(parseFloat(c)||n||0),change:Number(d||0),points:Number(null!=(t=null==G?void 0:G.points)?t:0),items:e,printerName:null});j(!1),alert("Print successful: ".concat(a))}catch(e){console.error("[PRINT ERROR]",e),alert("Print failed: ".concat((null==e?void 0:e.message)||String(e)))}finally{S(!1)}},[g,C,s,G,n,c,d,E]),Z=s.some(e=>{let t=e.product.id;return"string"==typeof t&&t.startsWith("debug-")});return(0,l.jsxs)(f,{className:"h-full flex flex-col",children:[(0,l.jsxs)(b,{className:"flex-1 flex flex-col p-4 pb-0",children:[(0,l.jsxs)("div",{className:"text-center mb-4",children:[(0,l.jsx)("div",{className:"text-sm md:text-base text-gray-600",children:"Total"}),(0,l.jsxs)("div",{className:"mt-1 flex items-baseline justify-center gap-1 tabular-nums",children:[(0,l.jsx)("span",{className:"text-2xl md:text-3xl font-bold",children:"₱"}),(0,l.jsx)("span",{className:"text-4xl md:text-5xl font-extrabold leading-none",children:n.toFixed(2)})]}),(0,l.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:[s.length," ",1===s.length?"item":"items"]})]}),Z&&(0,l.jsxs)("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-2",children:[(0,l.jsx)("strong",{children:"Debug Mode:"})," This transaction will not be saved to the database."]}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col",children:[1===t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(k,{amount:c,setAmount:i,cartTotal:n,cartIsEmpty:0===s.length}),(0,l.jsxs)("div",{className:"w-full grid grid-cols-3 gap-3 mt-3",children:[[50,100,200,500,1e3].map(e=>(0,l.jsx)("div",{className:"col-span-1",children:(0,l.jsxs)("button",{type:"button",onClick:()=>i(String(e)),className:"block w-full h-10 rounded-lg border border-gray-200 bg-white hover:bg-gray-50   text-sm font-medium text-center",children:["₱",e]})},e)),(0,l.jsx)("div",{className:"col-span-1",children:(0,l.jsx)("button",{type:"button",onClick:()=>i(String(n.toFixed(2))),className:"block w-full h-10 rounded-lg border border-gray-200 bg-white hover:bg-gray-50   text-sm font-medium text-center",children:"Exact"})})]}),(0,l.jsx)("div",{className:"flex-1"}),(0,l.jsx)(y,{className:"px-0 pb-4 pt-4",children:(0,l.jsx)(w.$,{className:"w-full h-12 md:h-14 text-base md:text-lg  bg-[#0B1220] text-white hover:bg-[#0b1220]/90",onClick:V,disabled:0===s.length||!c||parseFloat(c)<n||g,children:"Next"})})]}),2===t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(L,{amount:c,cartTotal:n,change:d}),(0,l.jsx)("div",{className:"flex-1"}),(0,l.jsx)(_,{customerQuery:D,setCustomerQuery:U,filteredCustomers:O,selectedCustomer:G,selectCustomer:B,clearCustomer:$,onAddCustomer:()=>h(!0),onCustomerSelected:()=>{G&&Q()}}),(0,l.jsx)(I,{open:m,onOpenChange:h,onCustomerAdded:e=>{try{Y(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[...t,e]}),h(!1),"function"==typeof B&&B(e)}catch(e){console.warn("Operation failed:",e)}}}),(0,l.jsxs)(y,{className:"px-0 pb-4 pt-4 flex flex-col gap-3",children:[(0,l.jsx)(w.$,{className:"w-full h-12 text-base font-medium",variant:"outline",onClick:()=>a(1),disabled:g,children:"Back"}),(0,l.jsx)(w.$,{className:"w-full h-12 text-base font-medium",onClick:()=>void Q(),disabled:g,children:"Finish Transaction"})]})]}),3===t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(P,{selectedCustomer:G,cartTotal:n}),(0,l.jsxs)(y,{className:"px-4 pb-4 pt-4 flex flex-col gap-2",children:[(0,l.jsx)(w.$,{className:"w-full h-14 text-xl font-medium",onClick:A,disabled:g,children:g?"Processing...":"Print Receipt"}),(0,l.jsx)(w.$,{className:"w-full h-14 text-xl font-medium",variant:"outline",onClick:W,disabled:g,children:"Close"})]})]})]})]}),(0,l.jsx)(T.lG,{open:v,onOpenChange:j,children:(0,l.jsxs)(T.Cf,{className:"sm:max-w-md",children:[(0,l.jsx)(T.c7,{children:(0,l.jsx)(T.L3,{children:"Print Receipt"})}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("p",{className:"text-center text-gray-600",children:"Print receipt to default printer?"}),(0,l.jsx)("div",{className:"bg-blue-50 p-3 rounded-lg",children:(0,l.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,l.jsx)("strong",{children:"Note:"})," Receipt will be sent to your default printer automatically."]})})]}),(0,l.jsxs)(T.Es,{className:"gap-2",children:[(0,l.jsx)(w.$,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),(0,l.jsx)(w.$,{onClick:H,disabled:C,children:C?"Printing...":"Print Receipt"})]})]})})]})}var O=a(67931),G=a(93736),B=a(47957),$=a.n(B);let K=e=>/^debug\d+$/i.test(e.trim());function Y(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,l.jsx)("table",{"data-slot":"table",className:(0,h.cn)("w-full caption-bottom text-sm",t),...a})})}function V(e){let{className:t,...a}=e;return(0,l.jsx)("thead",{"data-slot":"table-header",className:(0,h.cn)("[&_tr]:border-b",t),...a})}function Q(e){let{className:t,...a}=e;return(0,l.jsx)("tbody",{"data-slot":"table-body",className:(0,h.cn)("[&_tr:last-child]:border-0",t),...a})}function W(e){let{className:t,...a}=e;return(0,l.jsx)("tr",{"data-slot":"table-row",className:(0,h.cn)("hover:bg-muted/50 data-[state=]:bg-muted border-b transition-colors",t),...a})}function J(e){let{className:t,...a}=e;return(0,l.jsx)("th",{"data-slot":"table-head",className:(0,h.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function H(e){let{className:t,...a}=e;return(0,l.jsx)("td",{"data-slot":"table-cell",className:(0,h.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}var Z=a(35299);function X(e){let{cart:t,selectedRowId:a,selectRow:s,updateCartItemQuantity:n,updateCartItemPrice:o,deleteCartItem:c,disabled:i=!1}=e,{lastAddedItemId:d}=x(),u=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(!d||u.current===d)return;let e=!1,a=0,l=()=>{if(!e){if(t.some(e=>e.id===d)){u.current=d;try{s(d)}catch(e){console.warn("Failed to select row:",e)}return}++a<20&&requestAnimationFrame(l)}};return requestAnimationFrame(l),()=>{e=!0}},[d,t,s]),(0,r.useEffect)(()=>{u.current&&!t.find(e=>e.id===u.current)&&(u.current=null)},[t]);let m=(e,t)=>{t.stopPropagation(),s(e)},f=(e,t)=>{let a=t.target;"INPUT"===a.tagName||"BUTTON"===a.tagName||a.closest("button")||m(e,t)},g=(0,r.useRef)({}),p=(0,r.useCallback)(()=>{requestAnimationFrame(()=>{var e;let t=document.querySelector('[data-product-search="true"]');null==t||t.focus(),null==t||null==(e=t.select)||e.call(t)})},[]);(0,r.useEffect)(()=>{function e(e){var a;let l=null==(a=e.detail)?void 0:a.id,r=t.find(e=>e.id===l);r&&(n(l,r.quantity+1),s(l))}function l(e){var a;let l=null==(a=e.detail)?void 0:a.id,r=t.find(e=>e.id===l);r&&(n(l,Math.max(1,r.quantity-1)),s(l))}function r(e){var t;let a=null==(t=e.detail)?void 0:t.id;a&&(s(a),setTimeout(()=>{var e;let t=g.current[a];null==t||t.focus(),null==t||null==(e=t.select)||e.call(t)},0))}function o(e){var t;let a=null==(t=e.detail)?void 0:t.id;a&&(c(a),p())}let d=()=>{var e;return(null==(e=document.querySelector('[data-product-search="true"]'))?void 0:e.getAttribute("data-search-open"))==="true"};function u(){var e,l,r;if(i||d())return;let n=null!=(r=null!=a?a:null==(e=t[0])?void 0:e.id)?r:null;if(!n)return;let o=t.findIndex(e=>e.id===n),c=Math.min(t.length-1,o+1),u=null==(l=t[c])?void 0:l.id;u&&s(u)}function m(){var e,l,r;if(i||d())return;let n=null!=(r=null!=a?a:null==(e=t[0])?void 0:e.id)?r:null;if(!n)return;let o=Math.max(0,t.findIndex(e=>e.id===n)-1),c=null==(l=t[o])?void 0:l.id;c&&s(c)}return window.addEventListener("cart:increment-qty",e),window.addEventListener("cart:decrement-qty",l),window.addEventListener("cart:edit-price",r),window.addEventListener("cart:delete-item",o),window.addEventListener("cart:select-next",u),window.addEventListener("cart:select-prev",m),()=>{window.removeEventListener("cart:increment-qty",e),window.removeEventListener("cart:decrement-qty",l),window.removeEventListener("cart:edit-price",r),window.removeEventListener("cart:delete-item",o),window.removeEventListener("cart:select-next",u),window.removeEventListener("cart:select-prev",m)}},[t,n,s,c,p,i,a]);let v=e=>{var t;let{item:a}=e,[n,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(String(null!=(t=a.product.price)?t:0)),m=(0,r.useRef)(null);(0,r.useEffect)(()=>(g.current[a.id]=m.current,()=>{g.current[a.id]=null}),[a.id]),(0,r.useEffect)(()=>{var e;n||u(String(null!=(e=a.product.price)?e:0))},[a.product.price,n]);let x=(0,r.useCallback)(()=>{c(!1);let e=Number(String(d).replace(/,/g,"")),t=Number.isFinite(e)?e:0;o(a.id,t),p()},[d,a.id,o]);return(0,l.jsx)(C.p,{ref:m,type:"text","data-cart-price-input":a.id,value:d,className:"w-20 h-8 text-sm",onFocus:()=>{s(a.id),c(!0)},onChange:e=>u(e.target.value),onBlur:x,onKeyDown:e=>{if("Enter"===e.key)e.target.blur();else if("Escape"===e.key){var t;c(!1),u(String(null!=(t=a.product.price)?t:0)),p()}},disabled:i})},j=e=>{let{value:t,onChange:a,onFocus:s,onBlur:n,onKeyDown:o,disabled:c,itemId:i}=e,[d,u]=(0,r.useState)(t.toString()),[m,x]=(0,r.useState)(!1),h=(0,r.useRef)(null);(0,r.useEffect)(()=>{m||u(t.toString())},[t,m]),(0,r.useEffect)(()=>{if(m&&h.current){let e=e=>{let t=e.relatedTarget;(!t||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName)&&(t&&t!==document.body||(e.preventDefault(),setTimeout(()=>{h.current&&m&&h.current.focus()},0)))},t=h.current;return t.addEventListener("blur",e),()=>{t.removeEventListener("blur",e)}}},[m]);let f=()=>{let e,t;if(x(!1),""===d||"."===d)e=1,t="1";else{let a=parseFloat(d);isNaN(a)||a<=0?(e=1,t="1"):(e=a,t=a%1==0?a.toString():a.toFixed(2).replace(/\.?0+$/,""))}u(t),a(e),n()};return(0,l.jsx)(C.p,{ref:h,type:"text","data-cart-qty-input":i,value:d,className:"w-16 h-8 text-sm",onFocus:()=>{x(!0),s()},onChange:e=>{let t=e.target.value;(""===t||"."===t||/^\d*\.?\d*$/.test(t))&&u(t)},onBlur:f,onKeyDown:e=>{if("Enter"===e.key)return void f();-1!==[8,9,27,46,110,190].indexOf(e.keyCode)||65===e.keyCode&&!0===e.ctrlKey||67===e.keyCode&&!0===e.ctrlKey||86===e.keyCode&&!0===e.ctrlKey||88===e.keyCode&&!0===e.ctrlKey||e.keyCode>=35&&e.keyCode<=40||e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105||e.preventDefault()},disabled:c,placeholder:"1"})};return 0===t.length?(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center w-full h-full",children:(0,l.jsx)("div",{className:"text-center space-y-4",children:(0,l.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDED2 Scan or search to add products"})})}):(0,l.jsxs)(Y,{children:[(0,l.jsx)(V,{children:(0,l.jsxs)(W,{children:[(0,l.jsx)(J,{className:"text-sm md:text-base font-semibold py-3",children:"Barcode"}),(0,l.jsx)(J,{className:"text-sm md:text-base font-semibold py-3",children:"Name"}),(0,l.jsx)(J,{className:"text-sm md:text-base font-semibold py-3",children:"Price"}),(0,l.jsx)(J,{className:"text-sm md:text-base font-semibold py-3",children:"Quantity"}),(0,l.jsx)(J,{className:"text-sm md:text-base font-semibold py-3",children:"Actions"})]})}),(0,l.jsx)(Q,{children:t.map(e=>{let t=a===e.id;return(0,l.jsxs)(W,{"data-cart-id":e.id,className:(0,h.cn)("hover:bg-gray-50 cursor-pointer transition-all duration-200",t?"bg-gray-100 dark:bg-gray-800":""),onClick:t=>m(e.id,t),"data-cart-selected":t,children:[(0,l.jsx)(H,{className:"font-medium max-w-[140px] break-words whitespace-normal py-3 px-4",onClick:t=>f(e.id,t),children:e.product.barcode||"N/A"}),(0,l.jsx)(H,{className:"min-w-0 max-w-[320px] break-words whitespace-normal py-3 px-4",onClick:t=>f(e.id,t),children:e.product.__placeholder?(0,l.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[(0,l.jsx)(Z.A,{className:"h-4 w-4 animate-spin"}),(0,l.jsx)("span",{children:"Fetching product…"})]}):e.product.name}),(0,l.jsx)(H,{className:"py-3 px-4",children:(0,l.jsx)(v,{item:e})}),(0,l.jsx)(H,{className:"py-3 px-4",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(j,{value:e.quantity,onChange:t=>n(e.id,t),onFocus:()=>s(e.id),onBlur:p,onKeyDown:e=>{"Enter"===e.key&&(e.target.blur(),p())},disabled:i,itemId:e.id}),(0,l.jsx)("span",{className:"text-sm text-gray-600 font-medium",children:e.product.unit||"pcs"})]})}),(0,l.jsx)(H,{className:"py-3 px-4",children:(0,l.jsx)("button",{type:"button",className:"text-sm text-red-600 hover:underline disabled:opacity-50",onClick:t=>{t.stopPropagation(),c(e.id),p()},disabled:i,children:"Delete"})})]},e.id)})})]})}var ee=a(86651);function et(e){let{searchQuery:t,searchResults:a,showSearchResults:s,handleSearchChange:n,handleSearchSelect:o,clearSearch:c,disabled:i=!1,inputRef:d,isScannerInputRef:u,isLoading:m,onAddProduct:x,handleDebugProductSelect:h,isDebugCheatCode:f}=e,g=1===a.length&&t.trim().length>=2,[p,v]=(0,r.useState)(-1),j=(0,r.useRef)(null);(0,r.useEffect)(()=>{v(a.length>0?0:-1)},[a,s]),(0,r.useEffect)(()=>{let e=null==d?void 0:d.current;if(!e)return;let l=l=>{if("ArrowDown"===l.key)l.preventDefault(),l.stopPropagation(),v(e=>e<a.length-1?e+1:0),b();else if("ArrowUp"===l.key)l.preventDefault(),l.stopPropagation(),v(e=>e>0?e-1:a.length-1),b();else if("Enter"===l.key){if(p>=0&&p<a.length){l.preventDefault(),l.stopPropagation();let r=a[p];f&&h&&f(t)?h(t):o(r),c(),requestAnimationFrame(()=>{var t;e.focus(),null==(t=e.select)||t.call(e)})}}else"Escape"===l.key&&(l.preventDefault(),l.stopPropagation(),c(),requestAnimationFrame(()=>{var t;e.focus(),null==(t=e.select)||t.call(e)}))};return e.addEventListener("keydown",l),()=>e.removeEventListener("keydown",l)},[a,p,o,c,d,h,f,t]);let b=()=>{setTimeout(()=>{if(j.current){let e=j.current.querySelector('[data-highlighted="true"]');e&&e.scrollIntoView({block:"nearest"})}},0)},y=s&&!(null==u?void 0:u.current)&&a.length>0;return(0,l.jsxs)("div",{className:"relative mb-6",children:[(0,l.jsxs)("div",{className:"relative flex items-center",children:[(0,l.jsx)(ee.A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),(0,l.jsx)(C.p,{ref:d,"data-product-search":"true","data-search-open":s?"true":"false",className:"pl-9 w-full",placeholder:"Search by product name or barcode...",value:t,onChange:e=>n(e.target.value),onClick:e=>e.stopPropagation(),disabled:i}),g&&!(null==u?void 0:u.current)&&(0,l.jsx)(A.A,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-green-500 animate-pulse",size:20})]}),m&&(0,l.jsx)("div",{className:"absolute top-full left-0 right-0 bg-white border rounded-md shadow-lg z-10 p-3 text-center text-gray-500",children:"Searching..."}),y&&(0,l.jsx)("div",{ref:j,className:"absolute top-full left-0 right-0 bg-white border rounded-md shadow-lg z-10 max-h-[32rem] overflow-y-auto",children:a.map((e,a)=>(0,l.jsx)("div",{"data-highlighted":p===a,className:"p-3 cursor-pointer border-b last:border-b-0 ".concat(p===a?"bg-blue-100":"hover:bg-gray-50"),onClick:()=>{f&&h&&f(t)?h(t):o(e),c(),requestAnimationFrame(()=>{var e,t,a;null==d||null==(e=d.current)||e.focus(),null==d||null==(a=d.current)||null==(t=a.select)||t.call(a)})},children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"min-w-0",children:[(0,l.jsxs)("div",{className:"font-medium break-words whitespace-normal flex items-center gap-2",children:[e.name,f&&f(t)&&(0,l.jsx)("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:"DEBUG"})]}),(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:["Barcode: ",e.barcode]})]}),(0,l.jsx)("div",{className:"text-right ml-4 flex-shrink-0",children:(0,l.jsxs)("div",{className:"font-medium",children:["₱ ",e.price.toFixed(2)]})})]})},e.id))}),s&&!(null==u?void 0:u.current)&&0===a.length&&t.length>=2&&!m&&(0,l.jsxs)("div",{className:"absolute top-full left-0 right-0 bg-white border rounded-md shadow-lg z-10 p-3 text-center text-gray-500",children:[(0,l.jsxs)("div",{className:"mb-2",children:['No product found matching "',t,'"']}),x&&(0,l.jsx)("button",{onClick:x,className:"text-blue-600 hover:text-blue-800 hover:underline text-sm font-medium",children:"Add new product"})]})]})}var ea=a(35646);function el(e){let{...t}=e;return(0,l.jsx)(ea.bL,{"data-slot":"alert-dialog",...t})}function er(e){let{...t}=e;return(0,l.jsx)(ea.ZL,{"data-slot":"alert-dialog-portal",...t})}function es(e){let{className:t,...a}=e;return(0,l.jsx)(ea.hJ,{"data-slot":"alert-dialog-overlay",className:(0,h.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function en(e){let{className:t,...a}=e;return(0,l.jsxs)(er,{children:[(0,l.jsx)(es,{}),(0,l.jsx)(ea.UC,{"data-slot":"alert-dialog-content",className:(0,h.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a})]})}function eo(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"alert-dialog-header",className:(0,h.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function ec(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"alert-dialog-footer",className:(0,h.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function ei(e){let{className:t,...a}=e;return(0,l.jsx)(ea.hE,{"data-slot":"alert-dialog-title",className:(0,h.cn)("text-lg font-semibold",t),...a})}function ed(e){let{className:t,...a}=e;return(0,l.jsx)(ea.VY,{"data-slot":"alert-dialog-description",className:(0,h.cn)("text-muted-foreground text-sm",t),...a})}function eu(e){let{className:t,...a}=e;return(0,l.jsx)(ea.rc,{className:(0,h.cn)((0,w.r)(),t),...a})}function em(e){let{className:t,...a}=e;return(0,l.jsx)(ea.ZD,{className:(0,h.cn)((0,w.r)({variant:"outline"}),t),...a})}var ex=a(9585);function eh(e){let{step:t}=e,{selectedRowId:a,selectRow:s,clearSelection:o}=function(){let[e,t]=(0,r.useState)(null);return{selectedRowId:e,selectRow:e=>{t(e)},clearSelection:()=>{t(null)}}}(),{products:c}=(0,O.Q)(),{cart:i,updateCartItemQuantity:d,scanAndAddToCart:u,addProductToCart:m,updateCartItemPrice:h,deleteCartItem:g,scanError:p,setScanError:v}=x(),{setOpen:j,setBarcode:y}=(0,n.c)();(0,r.useEffect)(()=>{let e=(e,t)=>window.dispatchEvent(new CustomEvent(e,{detail:t})),t=t=>{var l,r,s,n,o;let c=document.activeElement,i=(null==c||null==(l=c.getAttribute)?void 0:l.call(c,"data-product-search"))==="true",d=(null==c||null==(r=c.getAttribute)?void 0:r.call(c,"data-search-open"))==="true",u=t.key;if(!i||!d){if("ArrowDown"===u)t.preventDefault(),e("cart:select-next",{id:a});else if("ArrowUp"===u)t.preventDefault(),e("cart:select-prev",{id:a});else if("+"===u||"="===u)t.preventDefault(),e("cart:increment-qty",{id:a});else if("-"===u)t.preventDefault(),e("cart:decrement-qty",{id:a});else if(t.ctrlKey&&t.shiftKey&&"p"===u.toLowerCase()){t.preventDefault();let l=document.querySelector('[data-product-search="true"]');null==l||l.blur();let r=a||(null==(s=document.querySelector('[data-cart-selected="true"]'))?void 0:s.getAttribute("data-cart-id"))||null;r&&e("cart:edit-price",{id:r})}else if("Enter"===u&&t.ctrlKey)t.preventDefault(),e("cart:focus-cash",{id:a});else if(t.ctrlKey&&"q"===u.toLowerCase()){t.preventDefault(),t.stopPropagation();let e=a||(null==(n=document.querySelector('[data-cart-selected="true"]'))?void 0:n.getAttribute("data-cart-id"))||null;if(e){let t=document.querySelector('[data-cart-qty-input="'.concat(e,'"]'));t&&requestAnimationFrame(()=>{t.focus(),t.select()})}}else if(t.ctrlKey&&"d"===u.toLowerCase()){t.preventDefault(),t.stopPropagation();let l=a||(null==(o=document.querySelector('[data-cart-selected="true"]'))?void 0:o.getAttribute("data-cart-id"))||null;l&&e("cart:delete-item",{id:l})}}};return window.addEventListener("keydown",t,{capture:!0}),()=>window.removeEventListener("keydown",t,{capture:!0})},[a]);let w=(0,r.useRef)(null),C=(0,r.useCallback)(()=>{requestAnimationFrame(()=>{var e;let t=document.querySelector('[data-product-search="true"]');null==t||t.focus(),null==t||null==(e=t.select)||e.call(t)})},[]),S=(0,r.useRef)(!1);(0,r.useEffect)(()=>{let e=()=>{S.current||C()};return window.addEventListener("focusBarcodeScanner",e),()=>{window.removeEventListener("focusBarcodeScanner",e)}},[C]),(0,r.useEffect)(()=>{let e=()=>{S.current=!0,setTimeout(()=>S.current=!1,600)};return window.addEventListener("cart:edit-price",e),()=>window.removeEventListener("cart:edit-price",e)},[]);let k=(0,r.useCallback)(e=>{m(e),setTimeout(()=>{try{var e,t,a;null==(e=w.current)||e.focus(),null==(a=w.current)||null==(t=a.select)||t.call(a)}catch(e){console.warn("Failed to focus search input:",e)}},100)},[m]),{searchQuery:E,searchResults:A,showSearchResults:D,handleSearchChange:_,clearSearch:L,isScannerInputRef:P,isLoading:T,handleDebugProductSelect:I,isDebugCheatCode:M}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0,[l,s]=(0,r.useState)(""),[n,o]=(0,r.useState)([]),[c,i]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!1),m=(0,r.useMemo)(()=>t.length?new G.A(t,{keys:[{name:"name",weight:.7},{name:"barcode",weight:.3}],threshold:.1,includeScore:!0,minMatchCharLength:2,ignoreLocation:!0,findAllMatches:!1,shouldSort:!0,includeMatches:!1}):null,[t]),x=(0,r.useRef)(null),h=(0,r.useRef)(!1),f=(0,r.useRef)(""),g=(0,r.useRef)(e);g.current=e;let p=(0,r.useRef)(new Map),v=(0,r.useCallback)(e=>{(e=>{let t=e.match(/debug(\d+)/i),a=t?parseInt(t[1]):1,l=[];for(let t=0;t<a;t++)l.push({id:"debug-".concat(t+1),name:"Debug Product ".concat(t+1),barcode:"".concat(e,"-").concat(t+1),price:10,quantity:1,category_id:1,unit:"pcs"});return l})(e).forEach(e=>{g.current(e)}),s(""),o([]),i(!1)},[]),j=(0,r.useCallback)($()(async e=>{if(!e||e.trim().length<2){o([]),i(!1),u(!1);return}if(K(e)){o([(e=>{let t=e.match(/debug(\d+)/i),a=t?parseInt(t[1]):1;return{id:"debug-".concat(a),name:"Debug Product ".concat(a),barcode:e,price:10,quantity:a,category_id:1,unit:"pcs"}})(e)]),i(!0),u(!1);return}let l=e.toLowerCase().trim();if(p.current.has(l)){o(p.current.get(l)),i(!0),u(!1);let t=p.current.get(l);if(1===t.length&&!K(e)){let a=t[0],l=a.barcode&&e.trim()===a.barcode.trim(),r=a.name.toLowerCase().trim()===e.toLowerCase().trim();(h.current||l||r)&&setTimeout(()=>{g.current(a),h.current&&(s(""),o([]),i(!1),f.current="")},100)}return}if(1===e.trim().length){o(t.filter(t=>t.name.toLowerCase().startsWith(e.toLowerCase())).slice(0,5)),i(!0),u(!1);return}u(!0);try{let n=[],c=e;if((h.current||/^\d+$/.test(e))&&(c=(e=>{if(/^\d+$/.test(e)&&e.length>10){for(let t of[8,10,12,13,14,15])if(e.length%t==0){let a=e.substring(0,t);if(a.repeat(e.length/t)===e)return a}for(let t=1;t<=e.length/2;t++){let a=e.substring(0,t);if(e===a.repeat(Math.floor(e.length/t)))return a}}return e})(e)),m&&t.length>0){let e=t.find(e=>e.barcode&&e.barcode.trim()===c.trim());if(e)n=[e];else{let e=t.find(e=>e.name.toLowerCase().trim()===c.toLowerCase().trim());if(e)n=[e];else{let e=t.filter(e=>e.name.toLowerCase().includes(c.toLowerCase()));n=e.length>0?e.slice(0,50):m.search(c).slice(0,50).map(e=>e.item)}}}else{var r;let{data:e}=await N.A.get("/products/search?q=".concat(encodeURIComponent(c)));n=null!=(r=null==e?void 0:e.data)?r:[]}if(n=n.slice(0,50),p.current.set(l,n),o(n),i(!0),u(!1),1!==n.length||K(e))0===n.length&&h.current&&/^\d+$/.test(c)&&setTimeout(()=>{a&&a(c),s(""),o([]),i(!1),f.current=""},100);else{let e=n[0],t=e.barcode&&c.trim()===e.barcode.trim(),a=e.name.toLowerCase().trim()===c.toLowerCase().trim();(h.current||t||a)&&setTimeout(()=>{g.current(e),h.current&&(s(""),o([]),i(!1),f.current="")},100)}}catch(e){"object"==typeof e&&null!==e&&"name"in e&&"AbortError"!==e.name&&"CanceledError"!==e.name&&console.error("Search error:",e),u(!1)}},100),[m,t]);return(0,r.useEffect)(()=>{j(l)},[l,j]),{searchQuery:l,searchResults:n,showSearchResults:c,setShowSearchResults:i,handleSearchChange:e=>{let t=Date.now();if(x.current){let a=t-x.current;a<50&&e.length>3?h.current=!0:a>150&&(h.current=!1)}x.current=t,s(e)},clearSearch:()=>{s(""),o([]),i(!1),u(!1),f.current=""},isScannerInputRef:h,isLoading:d,handleDebugProductSelect:v,isDebugCheatCode:K}}(k,c,(0,r.useCallback)(async e=>{console.log("\uD83D\uDD0D DEBUG - handleScanAndAddToCart called with:",e);try{await u(e),console.log("\uD83D\uDD0D DEBUG - scanAndAddToCart completed"),setTimeout(()=>{try{var e,t,a;null==(e=w.current)||e.focus(),null==(a=w.current)||null==(t=a.select)||t.call(a)}catch(e){console.warn("Failed to focus search input:",e)}},100)}catch(e){console.error("Scan error:",e)}},[u])),[F,z]=(0,r.useState)(!1),[q,R]=(0,r.useState)(null);(0,r.useEffect)(()=>{console.log("\uD83D\uDD0D DEBUG - Modal state changed:",{showRegisterDialog:F,unregisteredBarcode:q,scanError:p,timestamp:new Date().toISOString()})},[F,q,p]),(0,r.useEffect)(()=>{let e=()=>{L(),setTimeout(()=>{try{var e,t,a;null==(e=w.current)||e.focus(),null==(a=w.current)||null==(t=a.select)||t.call(a)}catch(e){console.warn("Failed to focus search input:",e)}},100)};return window.addEventListener("product:added",e),()=>window.removeEventListener("product:added",e)},[L]);let U=(0,r.useCallback)(e=>{console.log("\uD83D\uDD0D DEBUG - handleUnregisteredBarcode called with:",e),console.log("\uD83D\uDD0D DEBUG - Current state before setting:",{showRegisterDialog:F,unregisteredBarcode:q,scanError:p}),R(e),z(!0),console.log("\uD83D\uDD0D DEBUG - State setters called, modal should show")},[]);(0,r.useEffect)(()=>{let e=e=>{let t=null==e?void 0:e.detail;console.log("\uD83D\uDD0D DEBUG - Unregistered barcode event received:",t),console.log("\uD83D\uDD0D DEBUG - Current modal state before handling:",{showRegisterDialog:F,unregisteredBarcode:q,scanError:p}),(null==t?void 0:t.barcode)&&(console.log("\uD83D\uDD0D DEBUG - Calling handleUnregisteredBarcode with:",t.barcode),U(t.barcode))};return console.log("\uD83D\uDD0D DEBUG - Setting up unregistered barcode event listener"),window.addEventListener("unregistered-barcode",e),()=>{console.log("\uD83D\uDD0D DEBUG - Removing unregistered barcode event listener"),window.removeEventListener("unregistered-barcode",e)}},[U,F,q,p]);let B=(0,r.useCallback)(()=>{console.log("\uD83D\uDD0D DEBUG - Modal close button clicked"),console.log("\uD83D\uDD0D DEBUG - Current state before close:",{showRegisterDialog:F,unregisteredBarcode:q,scanError:p}),z(!1),R(null),v(null),console.log("\uD83D\uDD0D DEBUG - Modal closed, all states cleared"),setTimeout(()=>{try{var e,t,a;null==(e=w.current)||e.focus(),null==(a=w.current)||null==(t=a.select)||t.call(a)}catch(e){console.warn("Operation failed:",e)}},100)},[v]),Y=(0,r.useCallback)(()=>{console.log("\uD83D\uDD0D DEBUG - Modal confirm button clicked"),console.log("\uD83D\uDD0D DEBUG - Current state before confirm:",{showRegisterDialog:F,unregisteredBarcode:q,scanError:p}),z(!1),q&&(y(q),j(!0)),R(null),v(null),console.log("\uD83D\uDD0D DEBUG - Modal confirmed, opening product register modal"),setTimeout(()=>{try{var e,t,a;null==(e=w.current)||e.focus(),null==(a=w.current)||null==(t=a.select)||t.call(a)}catch(e){console.warn("Operation failed:",e)}},100)},[q,y,j,v]);return(0,r.useEffect)(()=>{p&&v(null)},[E,p,v]),(0,r.useEffect)(()=>{console.log("Modal state changed:",{showRegisterDialog:F,unregisteredBarcode:q,scanError:p})},[F,q,p]),(0,r.useEffect)(()=>{F&&(console.log("\uD83D\uDD0D DEBUG - Modal should be visible now!"),console.log("\uD83D\uDD0D DEBUG - Checking DOM for AlertDialog..."),setTimeout(()=>{let e=document.querySelector('[role="dialog"]');console.log("\uD83D\uDD0D DEBUG - Modal in DOM:",e),console.log("\uD83D\uDD0D DEBUG - Modal visible:",null==e?void 0:e.getAttribute("aria-hidden"))},100))},[F]),(0,l.jsxs)("div",{className:"flex flex-col h-full",children:[(0,l.jsx)(f,{className:"flex-1 overflow-hidden",children:(0,l.jsxs)(b,{className:"p-4 h-full flex flex-col",children:[(0,l.jsx)(et,{searchQuery:E,searchResults:A,showSearchResults:D,handleSearchChange:_,handleSearchSelect:k,clearSearch:L,disabled:1!==t,inputRef:w,isScannerInputRef:P,isLoading:T,onAddProduct:()=>{y(E),j(!0)},handleDebugProductSelect:I,isDebugCheatCode:M}),p&&(0,l.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),(0,l.jsx)("span",{className:"text-red-700 text-sm",children:p}),(0,l.jsx)("button",{onClick:()=>{},className:"ml-auto text-red-500 hover:text-red-700 text-lg font-bold",children:"\xd7"})]})}),T&&(0,l.jsx)("div",{className:"text-center text-gray-500 py-4",children:"Searching..."}),(0,l.jsx)(X,{cart:i,selectedRowId:a,selectRow:s,updateCartItemQuantity:d,updateCartItemPrice:h,deleteCartItem:g,disabled:1!==t})]})}),(0,l.jsx)(el,{open:F,onOpenChange:z,children:(0,l.jsxs)(en,{children:[(0,l.jsxs)(eo,{children:[(0,l.jsx)(ei,{children:"Product Not Found"}),(0,l.jsxs)(ed,{children:['The barcode "',q,'" is not registered in the system. Would you like to add this product?']})]}),(0,l.jsxs)(ec,{children:[(0,l.jsx)(em,{onClick:B,children:"Cancel"}),(0,l.jsx)(eu,{onClick:Y,children:"Add Product"})]})]})}),(0,l.jsx)(ex.default,{})]})}function ef(){let[e,t]=(0,r.useState)(1);return(0,r.useEffect)(()=>{try{window.posStep=e}catch(e){console.warn("Operation failed:",e)}return()=>{try{delete window.posStep}catch(e){console.warn("Operation failed:",e)}}},[e]),(0,r.useEffect)(()=>{let t=t=>{var a,l;if(1!==e||window.customerSearchActive)return;let r=t.key;if(null==(l=document.activeElement)||null==(a=l.matches)||a.call(l,'input, textarea, [contenteditable="true"]'),"F2"===r){t.preventDefault(),t.stopPropagation(),window.dispatchEvent(new Event("focusBarcodeScanner"));return}if(t.ctrlKey&&"Enter"===r){t.preventDefault(),t.stopPropagation(),window.dispatchEvent(new Event("focusCashInput"));return}if(t.ctrlKey&&!t.shiftKey&&"q"===r.toLowerCase()){t.preventDefault(),t.stopPropagation(),window.dispatchEvent(new CustomEvent("cart:focus-qty"));return}if(t.ctrlKey&&t.shiftKey&&"p"===r.toLowerCase()){t.preventDefault(),t.stopPropagation(),window.dispatchEvent(new CustomEvent("cart:edit-price"));return}};return window.addEventListener("keydown",t,!0),()=>window.removeEventListener("keydown",t,!0)},[e]),(0,r.useEffect)(()=>{let e=()=>{try{window.dispatchEvent(new Event("focusBarcodeScanner"))}catch(e){console.warn("Operation failed:",e)}};e();let t=setTimeout(e,120);return window.addEventListener("focus",e),()=>{clearTimeout(t),window.removeEventListener("focus",e)}},[]),(0,r.useEffect)(()=>{let e=e=>{e.ctrlKey&&"b"===e.key.toLowerCase()&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),window.dispatchEvent(new Event("pos:step-1-back")))};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[]),(0,l.jsx)(m,{children:(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row w-full h-full py-4 px-4 gap-2",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)(eh,{step:e})}),(0,l.jsx)("div",{className:"hidden lg:flex flex-col basis-[30%] gap-2",children:(0,l.jsx)(U,{step:e,setStep:t})})]})})}let eg=(0,r.memo)(function(){let{openModal:e}=(0,n.c)(),t=(0,r.useCallback)(()=>e("addCategory"),[e]),a=(0,r.useCallback)(()=>e("addProduct"),[e]),s="flex items-center justify-center gap-2 p-3";return(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("h1",{className:"text-4xl font-bold",children:"Products"}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsxs)(w.$,{className:s,onClick:t,"aria-label":"Add category",children:[(0,l.jsx)(D.A,{size:16}),"Add Category"]}),(0,l.jsxs)(w.$,{className:s,onClick:a,"aria-label":"Add product",children:[(0,l.jsx)(D.A,{size:16}),"Add Product"]})]})]})});var ep=a(46512);let ev=()=>s.G.getAll();function ej(){let{data:e=[],isLoading:t}=(0,ep.Ay)("products:list",ev,{revalidateOnFocus:!1,dedupingInterval:3e4}),a=(0,r.useMemo)(()=>{let t=0,a=0,l=0,r=0;for(let s of e)s&&"number"==typeof s.quantity&&"number"==typeof s.price&&(t++,0===s.quantity?l++:s.quantity<5&&a++,r+=s.price*s.quantity);return{totalProducts:t,lowStockItems:a,outOfStockItems:l,totalValueFormatted:"₱ ".concat(r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))}},[e]),s=[{title:"Total Products",content:t?"...":a.totalProducts},{title:"Low Stock Items",content:t?"...":a.lowStockItems},{title:"Out of Stock",content:t?"...":a.outOfStockItems},{title:"Total Value",content:t?"...":a.totalValueFormatted}];return(0,l.jsx)("div",{className:"grid grid-cols-4 gap-4 w-full h-full",children:s.map((e,t)=>(0,l.jsx)(f,{children:(0,l.jsxs)(b,{className:"flex flex-col justify-center items-start h-full",children:[(0,l.jsx)("h1",{className:"text-xl font-semibold pb-4",children:e.title}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:e.content})]})},t))})}var eb=a(6259),ey=a(12677),ew=a(24033),eN=a(5917),eC=a(12108);function eS(e){let{...t}=e;return(0,l.jsx)(ey.bL,{"data-slot":"select",...t})}function ek(e){let{...t}=e;return(0,l.jsx)(ey.WT,{"data-slot":"select-value",...t})}function eE(e){let{className:t,size:a="default",children:r,...s}=e;return(0,l.jsxs)(ey.l9,{"data-slot":"select-trigger","data-size":a,className:(0,h.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s,children:[r,(0,l.jsx)(ey.In,{asChild:!0,children:(0,l.jsx)(ew.A,{className:"size-4 opacity-50"})})]})}function eA(e){let{className:t,children:a,position:r="popper",...s}=e;return(0,l.jsx)(ey.ZL,{children:(0,l.jsxs)(ey.UC,{"data-slot":"select-content",className:(0,h.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...s,children:[(0,l.jsx)(e_,{}),(0,l.jsx)(ey.LM,{className:(0,h.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,l.jsx)(eL,{})]})})}function eD(e){let{className:t,children:a,...r}=e;return(0,l.jsxs)(ey.q7,{"data-slot":"select-item",className:(0,h.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...r,children:[(0,l.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,l.jsx)(ey.VF,{children:(0,l.jsx)(eN.A,{className:"size-4"})})}),(0,l.jsx)(ey.p4,{children:a})]})}function e_(e){let{className:t,...a}=e;return(0,l.jsx)(ey.PP,{"data-slot":"select-scroll-up-button",className:(0,h.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,l.jsx)(eC.A,{className:"size-4"})})}function eL(e){let{className:t,...a}=e;return(0,l.jsx)(ey.wn,{"data-slot":"select-scroll-down-button",className:(0,h.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,l.jsx)(ew.A,{className:"size-4"})})}var eP=a(66955),eT=a(89234);function eI(e){let{selectedCategory:t,setSelectedCategory:a,selectedProducts:s,setSelectedProducts:n,search:o,setSearch:c}=e,{categories:i,loading:d,error:u}=(0,eT.C)(),[m,x]=(0,r.useState)(""),h=(0,r.useCallback)(()=>{a("all"),n("all"),x(""),c("")},[a,n,c]),f=(0,r.useCallback)(e=>{c(e.target.value)},[c]),g=(0,r.useCallback)(e=>{x(e.target.value)},[]),p=(0,r.useMemo)(()=>{let e=null!=i?i:[],t=m.trim().toLowerCase();return t?e.filter(e=>e.name.toLowerCase().includes(t)):e},[i,m]),v=(0,r.useCallback)(e=>{a(e)},[a]),j=(0,r.useCallback)(e=>{n(e)},[n]);return(0,l.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,l.jsxs)("div",{className:"relative flex items-center flex-1 max-w-[700px]",children:[(0,l.jsx)(ee.A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),(0,l.jsx)(C.p,{className:"pl-9 w-full",placeholder:"Search by product name or barcode...",value:o,onChange:f,onClick:e=>e.stopPropagation()})]}),(0,l.jsxs)(eb.rI,{children:[(0,l.jsx)(eb.ty,{asChild:!0,children:(0,l.jsxs)(w.$,{variant:"outline",className:"flex items-center gap-2",children:[(0,l.jsx)(eP.A,{}),"Filter"]})}),(0,l.jsxs)(eb.SQ,{className:"w-[320px]",children:[(0,l.jsx)("div",{className:"p-3",children:(0,l.jsx)("h3",{className:"text-sm font-medium",children:"Filter"})}),(0,l.jsx)(eb.mB,{}),(0,l.jsxs)("div",{className:"p-3",children:[(0,l.jsx)("h4",{className:"text-sm font-medium",children:"Category"}),(0,l.jsxs)(eS,{value:t,onValueChange:v,children:[(0,l.jsx)(eE,{className:"w-full mt-2",children:(0,l.jsx)(ek,{placeholder:"Category"})}),(0,l.jsxs)(eA,{children:[(0,l.jsx)("div",{className:"p-2",children:(0,l.jsx)(C.p,{placeholder:"Search category...",value:m,onChange:g,className:"mb-2"})}),(0,l.jsxs)("div",{className:"max-h-40 overflow-auto",children:[(0,l.jsx)(eD,{value:"all",children:"All Categories"}),d&&(0,l.jsx)(eD,{value:"loading",disabled:!0,children:"Loading categories..."}),u&&(0,l.jsx)(eD,{value:"error",disabled:!0,children:String(u)}),!d&&!u&&0===p.length&&(0,l.jsx)(eD,{value:"none",disabled:!0,children:"No categories found"}),!d&&!u&&p.map(e=>(0,l.jsx)(eD,{value:String(e.id),children:e.name},e.id))]})]})]})]}),(0,l.jsx)(eb.mB,{}),(0,l.jsxs)("div",{className:"p-3",children:[(0,l.jsx)("h4",{className:"text-sm font-medium",children:"Status"}),(0,l.jsxs)(eS,{value:s,onValueChange:j,children:[(0,l.jsx)(eE,{className:"w-full mt-2",children:(0,l.jsx)(ek,{placeholder:"Status"})}),(0,l.jsxs)(eA,{children:[(0,l.jsx)(eD,{value:"all",children:"All Stock"}),(0,l.jsx)(eD,{value:"in stock",children:"In Stock"}),(0,l.jsx)(eD,{value:"low stock",children:"Low Stock"}),(0,l.jsx)(eD,{value:"out of stock",children:"Out of Stock"})]})]})]}),(0,l.jsx)(eb.mB,{}),(0,l.jsx)("div",{className:"flex justify-end p-3",children:(0,l.jsx)(w.$,{variant:"ghost",className:"font-normal",onClick:h,children:"Reset All"})})]})]})]})}var eM=a(31342),eF=a(30563),ez=a(92273);function eq(e){let{columns:t,data:a,page:s,pageSize:n,onFilteredCountChange:o}=e,[c,i]=(0,r.useState)([]),d=(0,eF.N4)({data:a,columns:t,state:{sorting:c,pagination:{pageIndex:s}},onSortingChange:i,onPaginationChange:()=>{},getCoreRowModel:(0,ez.HT)(),getSortedRowModel:(0,ez.h5)()}),u=d.getRowModel().rows,m=(0,r.useMemo)(()=>u.slice(s*n,(s+1)*n),[u,s,n]),x=(0,r.useRef)(null),h=(0,r.useRef)(null),f=u.length;return(0,r.useEffect)(()=>{if(o)return x.current!==f&&(x.current=f,h.current&&(clearTimeout(h.current),h.current=null),h.current=setTimeout(()=>{o(f),h.current=null},0)),()=>{h.current&&(clearTimeout(h.current),h.current=null)}},[f,o]),(0,l.jsx)("div",{className:"rounded-md border",children:(0,l.jsxs)(Y,{children:[(0,l.jsx)(V,{children:d.getHeaderGroups().map(e=>(0,l.jsx)(W,{children:e.headers.map(e=>(0,l.jsx)(J,{children:e.isPlaceholder?null:(0,eF.Kv)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,l.jsx)(Q,{children:m.length>0?m.map(e=>(0,l.jsx)(W,{"data-state":e.getIsSelected()?"selected":void 0,children:e.getVisibleCells().map(e=>(0,l.jsx)(H,{className:"align-top break-words whitespace-normal",children:(0,eF.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,l.jsx)(W,{children:(0,l.jsx)(H,{colSpan:t.length,className:"h-24 text-center",children:"No results."})})})]})})}var eR=a(93341),eU=a(32467);let eO=(0,a(83101).F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function eG(e){let{className:t,variant:a,asChild:r=!1,...s}=e,n=r?eU.DX:"span";return(0,l.jsx)(n,{"data-slot":"badge",className:(0,h.cn)(eO({variant:a}),t),...s})}let eB={"in stock":{variant:"default",className:"bg-green-300 text-black"},"low stock":{variant:"secondary",className:"bg-yellow-500 text-black"},"out of stock":{variant:"destructive",className:"bg-red-500 text-white"}},e$=[{accessorKey:"productName",header:e=>{let{column:t}=e;return(0,l.jsxs)("button",{className:"flex items-center gap-2 font-medium focus:outline-none",onClick:()=>t.toggleSorting("asc"===t.getIsSorted()),children:["Product",(0,l.jsx)(eR.A,{className:"ml-1 h-4 w-4"})]})},cell:e=>{let{row:t}=e;return(0,l.jsx)("div",{className:"flex w-full",children:(0,l.jsx)("div",{className:"flex-1 flex flex-col items-start font-medium break-words whitespace-normal leading-tight",title:String(t.getValue("productName")),style:{wordBreak:"break-word",whiteSpace:"normal"},children:t.getValue("productName")})})}},{accessorKey:"barcode",header:"Barcode"},{accessorKey:"category",header:"Category"},{accessorKey:"currentStock",header:e=>{let{column:t}=e;return(0,l.jsxs)("button",{className:"flex items-center gap-2 font-medium focus:outline-none",onClick:()=>t.toggleSorting("asc"===t.getIsSorted()),children:["Current Stock",(0,l.jsx)(eR.A,{className:"ml-1 h-4 w-4"})]})},cell:e=>{let{row:t}=e;return(0,l.jsx)("div",{className:"flex items-center font-medium",children:t.getValue("currentStock")})}},{accessorKey:"productPrice",header:"Price"},{accessorKey:"status",header:"Status",cell:e=>{let{row:t}=e,a=t.original.status,r=eB[a],s=a.charAt(0).toUpperCase()+a.slice(1);return(0,l.jsx)(eG,{variant:r.variant,className:r.className,children:s})}},{id:"actions",header:()=>(0,l.jsx)("div",{className:"text-center font-medium",children:"Actions"}),cell:()=>(0,l.jsx)("div",{className:"flex gap-5 justify-center","aria-hidden":!0}),enableSorting:!1,enableHiding:!1}];var eK=a(90368),eY=a(27937),eV=a(37772);function eQ(e){let{className:t,...a}=e;return(0,l.jsx)("nav",{role:"navigation","aria-label":"pagination","data-slot":"pagination",className:(0,h.cn)("mx-auto flex w-full justify-center",t),...a})}function eW(e){let{className:t,...a}=e;return(0,l.jsx)("ul",{"data-slot":"pagination-content",className:(0,h.cn)("flex flex-row items-center gap-1",t),...a})}function eJ(e){let{...t}=e;return(0,l.jsx)("li",{"data-slot":"pagination-item",...t})}function eH(e){let{className:t,isActive:a,size:r="icon",...s}=e;return(0,l.jsx)("a",{"aria-current":a?"page":void 0,"data-slot":"pagination-link","data-active":a,className:(0,h.cn)((0,w.r)({variant:a?"outline":"ghost",size:r}),t),...s})}function eZ(e){let{className:t,...a}=e;return(0,l.jsxs)(eH,{"aria-label":"Go to previous page",size:"default",className:(0,h.cn)("gap-1 px-2.5 sm:pl-2.5",t),...a,children:[(0,l.jsx)(eK.A,{}),(0,l.jsx)("span",{className:"hidden sm:block",children:"Previous"})]})}function eX(e){let{className:t,...a}=e;return(0,l.jsxs)(eH,{"aria-label":"Go to next page",size:"default",className:(0,h.cn)("gap-1 px-2.5 sm:pr-2.5",t),...a,children:[(0,l.jsx)("span",{className:"hidden sm:block",children:"Next"}),(0,l.jsx)(eY.A,{})]})}function e0(e){let{className:t,...a}=e;return(0,l.jsxs)("span",{"aria-hidden":!0,"data-slot":"pagination-ellipsis",className:(0,h.cn)("flex size-9 items-center justify-center",t),...a,children:[(0,l.jsx)(eV.A,{className:"size-4"}),(0,l.jsx)("span",{className:"sr-only",children:"More pages"})]})}function e1(e){let{page:t,pageCount:a,setPage:r,pageSize:s,onPageSizeChange:n}=e;if(a<=1)return null;let o=e=>l=>{null==l||l.preventDefault(),e<0&&(e=0),e>a-1&&(e=a-1),e!==t&&r(e)},c=(()=>{let e=[],l=Math.max(1,t-1),r=Math.min(a-2,t+1);e.push(0),l>1&&e.push("ellipsis");for(let t=l;t<=r;t++)e.push(t);return r<a-2&&e.push("ellipsis"),a>1&&e.push(a-1),e})();return(0,l.jsxs)(eQ,{className:"mt-2 flex items-center gap-4",children:[(0,l.jsxs)(eW,{children:[(0,l.jsx)(eJ,{children:(0,l.jsx)(eZ,{href:"#",onClick:o(Math.max(t-1,0)),"aria-disabled":0===t})}),c.map((e,a)=>"ellipsis"===e?(0,l.jsx)(eJ,{children:(0,l.jsx)(e0,{})},"e-".concat(a)):(0,l.jsx)(eJ,{children:(0,l.jsx)(eH,{href:"#",isActive:e===t,onClick:o(e),children:e+1})},e)),(0,l.jsx)(eJ,{children:(0,l.jsx)(eX,{href:"#",onClick:o(Math.min(t+1,a-1)),"aria-disabled":t===a-1})})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("label",{htmlFor:"page-size",className:"text-sm",children:"Rows per page:"}),(0,l.jsx)("input",{id:"page-size",type:"number",min:1,max:100,value:s,onChange:e=>n(Number(e.target.value)||1),className:"border rounded px-2 py-1 w-16 text-sm"})]})]})}var e2=a(18514),e4=a(71360),e5=a(63769);let e3="products:list",e6=()=>s.G.getAll();function e8(e){let{selectedCategory:t,selectedStatus:a,onProductDeleted:n,search:o=""}=e,{data:c=[],isLoading:i,mutate:d}=(0,ep.Ay)(e3,e6,{revalidateOnFocus:!1,revalidateOnReconnect:!0,dedupingInterval:1e4,errorRetryCount:2}),{categories:u=[]}=(0,eT.C)(),m=(0,r.useMemo)(()=>{let e=new Map;return u.forEach(t=>e.set(String(t.id),t.name)),e},[u]),[x,h]=(0,r.useState)(0),[f,g]=(0,r.useState)(6),[p,v]=(0,r.useState)(null),[j,b]=(0,r.useState)(!1),[y,N]=(0,r.useState)(!1),[k,E]=(0,r.useState)(null),[A,D]=(0,r.useState)(!1),[_,L]=(0,r.useState)(""),[P,I]=(0,r.useState)({name:"",barcode:"",category_id:"",price:0,quantity:0,unit:"pcs"}),M=(0,r.useMemo)(()=>{let e=c;if("all"===t&&"all"===a&&!o.trim())return e;"all"!==t&&(e=e.filter(e=>String(e.category_id)===t)),"all"!==a&&(e=e.filter(e=>(0===e.quantity?"out of stock":e.quantity<5?"low stock":"in stock")===a));let l=o.trim().toLowerCase();return l&&(e=e.filter(e=>{var t,a;let r=(null==(t=e.name)?void 0:t.toLowerCase())||"",s=(null==(a=e.barcode)?void 0:a.toLowerCase())||"";return r.includes(l)||s.includes(l)})),e},[c,t,a,o]),F=(0,r.useMemo)(()=>M.map(e=>((e,t)=>{var a;let l=0===e.quantity?"out of stock":e.quantity<5?"low stock":"in stock",r=t.get(String(e.category_id))||"Category ".concat(e.category_id);return{id:String(e.id),productName:e.name,barcode:null!=(a=e.barcode)?a:"",category:r,currentStock:e.quantity,productPrice:e.price,status:l}})(e,m)),[M,m]);(0,r.useEffect)(()=>h(0),[t,a,o]);let z=Math.max(1,Math.ceil(F.length/f)),q=(0,r.useMemo)(()=>c.find(e=>e.id===p),[c,p]);(0,r.useEffect)(()=>{j&&q&&I({name:q.name||"",barcode:q.barcode||"",category_id:String(q.category_id||""),price:q.price||0,quantity:q.quantity||0,unit:q.unit||"pcs"})},[j,q]);let R=(0,r.useCallback)(e=>{v(Number(e.id)),b(!0),N(!1)},[]),U=(0,r.useCallback)(e=>{E(e),D(!0)},[]),O=(0,r.useCallback)(async()=>{if(!q)return;let e={name:P.name,barcode:P.barcode,category_id:Number(P.category_id),price:Number(P.price),quantity:Number(P.quantity),unit:P.unit};try{let t={...q,...e};(0,eM.j)(e3,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(e=>e.id===q.id?t:e)},!1),await s.G.update(Number(q.id),e),(0,e5.GF)("Product updated","".concat(P.name," has been updated.")),b(!1),N(!1),(0,eM.j)(e3)}catch(e){(0,eM.j)(e3),(0,e5.Ni)("Failed to update product",(null==e?void 0:e.message)||"An error occurred.")}},[q,P]),G=(0,r.useCallback)(async()=>{if(!k)return;let e=Number(k.id);try{(0,eM.j)(e3,function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter(t=>t.id!==e)},!1),await s.G.delete(e),(0,e5.GF)("Product deleted","".concat(k.productName," has been deleted.")),D(!1),E(null),null==n||n(e),(0,eM.j)(e3)}catch(e){(0,eM.j)(e3),(0,e5.Ni)("Failed to delete product",(null==e?void 0:e.message)||"An error occurred.")}},[k,n]),B=(0,r.useMemo)(()=>e$.map(e=>"actions"===e.id?{...e,cell:e=>{let{row:t}=e;return(0,l.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,l.jsx)(w.$,{variant:"outline",size:"icon",onClick:()=>R(t.original),disabled:i,children:(0,l.jsx)(e2.A,{className:"w-4 h-4"})}),(0,l.jsx)(w.$,{variant:"outline",size:"icon",onClick:()=>U(t.original),disabled:i,children:(0,l.jsx)(e4.A,{className:"w-4 h-4"})})]})}}:e),[R,U,i]);return(0,l.jsxs)("div",{className:"w-full mt-4 relative",children:[i&&(0,l.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-blue-200 z-10",children:(0,l.jsx)("div",{className:"h-full bg-blue-500 animate-pulse"})}),(0,l.jsx)(eq,{columns:B,data:F,page:x,pageSize:f}),(0,l.jsx)("div",{className:"mt-7",children:(0,l.jsx)(e1,{page:x,pageCount:z,setPage:h,pageSize:f,onPageSizeChange:e=>{g(e),h(0)}})}),(0,l.jsx)(T.lG,{open:j,onOpenChange:b,children:(0,l.jsx)(T.Cf,{children:y?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-8",children:[(0,l.jsx)("h2",{className:"font-bold text-lg mb-2",children:"Are you absolutely sure?"}),(0,l.jsx)("p",{className:"mb-6 text-gray-500",children:"This will update the product details."}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(w.$,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),(0,l.jsx)(w.$,{onClick:O,children:"Continue"})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(T.c7,{children:[(0,l.jsx)(T.L3,{children:"Edit Product"}),(0,l.jsx)(T.rr,{children:"Update product details below."})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(S.J,{htmlFor:"edit-name",children:"Product Name"}),(0,l.jsx)(C.p,{id:"edit-name",value:P.name,onChange:e=>I(t=>({...t,name:e.target.value}))})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,l.jsx)(S.J,{htmlFor:"edit-barcode",children:"Barcode"}),(0,l.jsx)(C.p,{id:"edit-barcode",value:P.barcode,onChange:e=>I(t=>({...t,barcode:e.target.value}))})]}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,l.jsx)(S.J,{htmlFor:"edit-category",children:"Category"}),(0,l.jsxs)(eb.rI,{children:[(0,l.jsx)(eb.ty,{asChild:!0,children:(0,l.jsx)(C.p,{readOnly:!0,value:m.get(P.category_id)||"",placeholder:"Select category",className:"cursor-pointer"})}),(0,l.jsx)(eb.SQ,{children:u.map(e=>(0,l.jsx)(eb._2,{onClick:()=>I(t=>({...t,category_id:String(e.id)})),children:e.name},e.id))})]})]})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,l.jsx)(S.J,{htmlFor:"edit-price",children:"Price"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"₱"}),(0,l.jsx)(C.p,{id:"edit-price",type:"number",value:P.price||"",onChange:e=>I(t=>({...t,price:Number(e.target.value)||0})),className:"pl-8"})]})]}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,l.jsx)(S.J,{htmlFor:"edit-quantity",children:"Quantity"}),(0,l.jsx)(C.p,{id:"edit-quantity",type:"number",value:P.quantity||"",onChange:e=>I(t=>({...t,quantity:Number(e.target.value)||0}))})]})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(S.J,{htmlFor:"edit-unit",children:"Unit"}),(0,l.jsxs)(eb.rI,{children:[(0,l.jsx)(eb.ty,{asChild:!0,children:(0,l.jsxs)(w.$,{variant:"outline",className:"w-full justify-between",children:["pcs"===P.unit?"pcs (pieces)":"kg"===P.unit?"kg (kilogram)":"pck"===P.unit?"pck (pack)":"pcs (pieces)",(0,l.jsx)(ew.A,{className:"h-4 w-4"})]})}),(0,l.jsxs)(eb.SQ,{align:"start",className:"w-full",children:[(0,l.jsx)(eb._2,{onClick:()=>I(e=>({...e,unit:"pcs"})),children:"pcs (pieces)"}),(0,l.jsx)(eb._2,{onClick:()=>I(e=>({...e,unit:"kg"})),children:"kg (kilogram)"}),(0,l.jsx)(eb._2,{onClick:()=>I(e=>({...e,unit:"pck"})),children:"pck (pack)"})]})]})]}),(0,l.jsxs)(T.Es,{children:[(0,l.jsx)(w.$,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),(0,l.jsx)(w.$,{onClick:()=>N(!0),children:"Update Product"})]})]})]})})}),(0,l.jsx)(T.lG,{open:A,onOpenChange:D,children:(0,l.jsxs)(T.Cf,{children:[(0,l.jsxs)(T.c7,{children:[(0,l.jsx)(T.L3,{children:"Are you absolutely sure?"}),(0,l.jsx)(T.rr,{children:"This action cannot be undone. This will permanently delete the product."})]}),(0,l.jsxs)(T.Es,{children:[(0,l.jsx)(w.$,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),(0,l.jsx)(w.$,{variant:"destructive",onClick:G,children:"Continue"})]})]})})]})}function e7(e){let{onProductDeleted:t}=e,[a,s]=(0,r.useState)("all"),[n,o]=(0,r.useState)("all"),[c,i]=(0,r.useState)("");return(0,l.jsxs)(f,{className:"h-full w-full",children:[(0,l.jsx)(g,{children:(0,l.jsx)("h2",{className:"text-2xl font-semibold",children:"Product Catalog"})}),(0,l.jsxs)(b,{children:[(0,l.jsx)(eI,{selectedCategory:a,setSelectedCategory:s,selectedProducts:n,setSelectedProducts:o,search:c,setSearch:i}),(0,l.jsx)(e8,{selectedCategory:a,selectedStatus:n,onProductDeleted:t,search:c})]})]})}var e9=a(54636);function te(){return(0,l.jsxs)("div",{className:"flex flex-col gap-4 h-full p-8",children:[(0,l.jsx)("div",{className:"flex-[7%]",children:(0,l.jsx)(eg,{})}),(0,l.jsx)("div",{className:"flex-[18%]",children:(0,l.jsx)(ej,{})}),(0,l.jsx)("div",{className:"flex-[75%]",children:(0,l.jsx)(e7,{})}),(0,l.jsx)(e9.A,{})]})}var tt=a(91761),ta=a(26617),tl=a(10512);function tr(){let[e,t]=(0,r.useState)({todaysSales:0,todaysTransactions:0,itemsSoldToday:0}),[a,s]=(0,r.useState)(!0),n=async()=>{try{s(!0),console.log("\uD83D\uDCCA Fetching today's stats...");let e=(await N.A.get("/sales/stats")).data.data;console.log("\uD83D\uDCCA Stats received:",e),e&&"object"==typeof e?t({todaysSales:e.todaysSales||0,todaysTransactions:e.todaysTransactions||0,itemsSoldToday:e.itemsSoldToday||0}):console.warn("\uD83D\uDCCA Invalid stats data received:",e)}catch(e){console.error("\uD83D\uDCCA Stats error:",e)}finally{s(!1)}};(0,r.useEffect)(()=>{n()},[]);let o=[{title:"Today's Sales",content:a?"...":"₱ ".concat(e.todaysSales.toLocaleString()),icon:(0,l.jsx)(tt.A,{size:20})},{title:"Items Sold Today",content:a?"...":e.itemsSoldToday.toLocaleString(),icon:(0,l.jsx)(ta.A,{size:20})},{title:"Today's Transactions",content:a?"...":e.todaysTransactions.toLocaleString(),icon:(0,l.jsx)(tl.A,{size:20})}];return(0,l.jsx)("div",{className:"grid grid-cols-3 gap-4 w-full h-full",children:o.map((e,t)=>(0,l.jsxs)(f,{className:"gap-0 flex justify-center",children:[(0,l.jsxs)(g,{className:"mb-4 flex flex-row justify-between items-center",children:[(0,l.jsx)(p,{className:"text-md font-semibold",children:e.title}),(0,l.jsx)("div",{className:"opacity-60",children:e.icon})]}),(0,l.jsx)(b,{children:(0,l.jsx)("div",{className:"text-3xl font-bold mb-6",children:e.content})})]},t))})}var ts=a(54485),tn=a(16485),to=a(98128),tc=a(68425),ti=a(47734),td=a(30757),tu=a(73699),tm=a(74854),tx=a(26649);function th(){let e=(0,tu._)(["rtl:**:[.rdp-button_next>svg]:rotate-180"],["rtl:**:[.rdp-button\\_next>svg]:rotate-180"]);return th=function(){return e},e}function tf(){let e=(0,tu._)(["rtl:**:[.rdp-button_previous>svg]:rotate-180"],["rtl:**:[.rdp-button\\_previous>svg]:rotate-180"]);return tf=function(){return e},e}function tg(e){let{className:t,classNames:a,showOutsideDays:r=!0,captionLayout:s="label",buttonVariant:n="ghost",formatters:o,components:c,...i}=e,d=(0,tm.a)();return(0,l.jsx)(tx.h,{showOutsideDays:r,className:(0,h.cn)("bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw(th()),String.raw(tf()),t),captionLayout:s,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...o},classNames:{root:(0,h.cn)("w-fit",d.root),months:(0,h.cn)("flex gap-4 flex-col md:flex-row relative",d.months),month:(0,h.cn)("flex flex-col w-full gap-4",d.month),nav:(0,h.cn)("flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",d.nav),button_previous:(0,h.cn)((0,w.r)({variant:n}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",d.button_previous),button_next:(0,h.cn)((0,w.r)({variant:n}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",d.button_next),month_caption:(0,h.cn)("flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",d.month_caption),dropdowns:(0,h.cn)("w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",d.dropdowns),dropdown_root:(0,h.cn)("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",d.dropdown_root),dropdown:(0,h.cn)("absolute bg-popover inset-0 opacity-0",d.dropdown),caption_label:(0,h.cn)("select-none font-medium","label"===s?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",d.caption_label),table:"w-full border-collapse",weekdays:(0,h.cn)("flex",d.weekdays),weekday:(0,h.cn)("text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",d.weekday),week:(0,h.cn)("flex w-full mt-2",d.week),week_number_header:(0,h.cn)("select-none w-(--cell-size)",d.week_number_header),week_number:(0,h.cn)("text-[0.8rem] select-none text-muted-foreground",d.week_number),day:(0,h.cn)("relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",d.day),range_start:(0,h.cn)("rounded-l-md bg-accent",d.range_start),range_middle:(0,h.cn)("rounded-none",d.range_middle),range_end:(0,h.cn)("rounded-r-md bg-accent",d.range_end),today:(0,h.cn)("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",d.today),outside:(0,h.cn)("text-muted-foreground aria-selected:text-muted-foreground",d.outside),disabled:(0,h.cn)("text-muted-foreground opacity-50",d.disabled),hidden:(0,h.cn)("invisible",d.hidden),...a},components:{Root:e=>{let{className:t,rootRef:a,...r}=e;return(0,l.jsx)("div",{"data-slot":"calendar",ref:a,className:(0,h.cn)(t),...r})},Chevron:e=>{let{className:t,orientation:a,...r}=e;return"left"===a?(0,l.jsx)(eK.A,{className:(0,h.cn)("size-4",t),...r}):"right"===a?(0,l.jsx)(eY.A,{className:(0,h.cn)("size-4",t),...r}):(0,l.jsx)(ew.A,{className:(0,h.cn)("size-4",t),...r})},DayButton:tp,WeekNumber:e=>{let{children:t,...a}=e;return(0,l.jsx)("td",{...a,children:(0,l.jsx)("div",{className:"flex size-(--cell-size) items-center justify-center text-center",children:t})})},...c},...i})}function tp(e){let{className:t,day:a,modifiers:s,...n}=e,o=(0,tm.a)(),c=r.useRef(null);return r.useEffect(()=>{var e;s.focused&&(null==(e=c.current)||e.focus())},[s.focused]),(0,l.jsx)(w.$,{ref:c,variant:"ghost",size:"icon","data-day":a.date.toLocaleDateString(),"data-selected-single":s.selected&&!s.range_start&&!s.range_end&&!s.range_middle,"data-range-start":s.range_start,"data-range-end":s.range_end,"data-range-middle":s.range_middle,className:(0,h.cn)("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",o.day,t),...n})}var tv=a(26991),tj=a(23508),tb=a(7620);let ty={light:"",dark:".dark"},tw=r.createContext(null);function tN(e){let{id:t,className:a,children:s,config:n,...o}=e,c=r.useId(),i="chart-".concat(t||c.replace(/:/g,""));return(0,l.jsx)(tw.Provider,{value:{config:n},children:(0,l.jsxs)("div",{"data-slot":"chart","data-chart":i,className:(0,h.cn)("[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",a),...o,children:[(0,l.jsx)(tC,{id:i,config:n}),(0,l.jsx)(tv.u,{children:s})]})})}let tC=e=>{let{id:t,config:a}=e,r=Object.entries(a).filter(e=>{let[,t]=e;return t.theme||t.color});return r.length?(0,l.jsx)("style",{dangerouslySetInnerHTML:{__html:Object.entries(ty).map(e=>{let[a,l]=e;return"\n".concat(l," [data-chart=").concat(t,"] {\n").concat(r.map(e=>{var t;let[l,r]=e,s=(null==(t=r.theme)?void 0:t[a])||r.color;return s?"  --color-".concat(l,": ").concat(s,";"):null}).join("\n"),"\n}\n")}).join("\n")}}):null},tS=tj.m;function tk(e){let{active:t,payload:a,className:s,indicator:n="dot",hideLabel:o=!1,hideIndicator:c=!1,label:i,labelFormatter:d,labelClassName:u,formatter:m,color:x,nameKey:f,labelKey:g}=e,{config:p}=function(){let e=r.useContext(tw);if(!e)throw Error("useChart must be used within a <ChartContainer />");return e}(),v=r.useMemo(()=>{var e;if(o||!(null==a?void 0:a.length))return null;let[t]=a,r="".concat(g||(null==t?void 0:t.dataKey)||(null==t?void 0:t.name)||"value"),s=tE(p,t,r),n=g||"string"!=typeof i?null==s?void 0:s.label:(null==(e=p[i])?void 0:e.label)||i;return d?(0,l.jsx)("div",{className:(0,h.cn)("font-medium",u),children:d(n,a)}):n?(0,l.jsx)("div",{className:(0,h.cn)("font-medium",u),children:n}):null},[i,d,a,o,u,p,g]);if(!t||!(null==a?void 0:a.length))return null;let j=1===a.length&&"dot"!==n;return(0,l.jsxs)("div",{className:(0,h.cn)("border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",s),children:[j?null:v,(0,l.jsx)("div",{className:"grid gap-1.5",children:a.map((e,t)=>{let a="".concat(f||e.name||e.dataKey||"value"),r=tE(p,e,a),s=x||e.payload.fill||e.color;return(0,l.jsx)("div",{className:(0,h.cn)("[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5","dot"===n&&"items-center"),children:m&&(null==e?void 0:e.value)!==void 0&&e.name?m(e.value,e.name,e,t,e.payload):(0,l.jsxs)(l.Fragment,{children:[(null==r?void 0:r.icon)?(0,l.jsx)(r.icon,{}):!c&&(0,l.jsx)("div",{className:(0,h.cn)("shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)",{"h-2.5 w-2.5":"dot"===n,"w-1":"line"===n,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===n,"my-0.5":j&&"dashed"===n}),style:{"--color-bg":s,"--color-border":s}}),(0,l.jsxs)("div",{className:(0,h.cn)("flex flex-1 justify-between leading-none",j?"items-end":"items-center"),children:[(0,l.jsxs)("div",{className:"grid gap-1.5",children:[j?v:null,(0,l.jsx)("span",{className:"text-muted-foreground",children:(null==r?void 0:r.label)||e.name})]}),e.value&&(0,l.jsx)("span",{className:"text-foreground font-mono font-medium tabular-nums",children:e.value.toLocaleString()})]})]})},e.dataKey)})})]})}function tE(e,t,a){if("object"!=typeof t||null===t)return;let l="payload"in t&&"object"==typeof t.payload&&null!==t.payload?t.payload:void 0,r=a;return a in t&&"string"==typeof t[a]?r=t[a]:l&&a in l&&"string"==typeof l[a]&&(r=l[a]),r in e?e[r]:e[a]}tb.s;var tA=a(82286);function tD(e){let{...t}=e;return(0,l.jsx)(tA.bL,{"data-slot":"popover",...t})}function t_(e){let{...t}=e;return(0,l.jsx)(tA.l9,{"data-slot":"popover-trigger",...t})}function tL(e){let{className:t,align:a="center",sideOffset:r=4,...s}=e;return(0,l.jsx)(tA.ZL,{children:(0,l.jsx)(tA.UC,{"data-slot":"popover-content",align:a,sideOffset:r,className:(0,h.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...s})})}var tP=a(17037),tT=a(20243);let tI={total_sales:{label:"Total Sales",color:"var(--color-primary)"}},tM=async e=>{var t;let a=await N.A.get(e);return(null==(t=a.data)?void 0:t.data)||a.data||[]},tF=async()=>{var e;let t=await N.A.get("/products?limit=all");return(null==(e=t.data)?void 0:e.data)||t.data||[]};function tz(e){let t=e.getFullYear();return new Date(Date.UTC(t,e.getMonth(),e.getDate(),0,0,0)-288e5).toISOString()}function tq(e){let t=e.getFullYear();return new Date(Date.UTC(t,e.getMonth(),e.getDate(),0,0,0)-288e5+864e5).toISOString()}function tR(){var e,t;let a=new Date,s=new Date(a.getFullYear(),a.getMonth(),1),[n,o]=(0,r.useState)({from:s,to:a}),[c,i]=(0,r.useState)("recent"),[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(null),[h,C]=(0,r.useState)([]),[S,k]=(0,r.useState)(!1),[E,A]=(0,r.useState)("recent"),D=(0,r.useMemo)(()=>{if(!(null==n?void 0:n.from)||!(null==n?void 0:n.to))return"/sales-items";let e=tz(n.from),t=tq(n.to);return console.log("\uD83D\uDD0D CATEGORY ANALYTICS DEBUGGING:"),console.log("Selected range:",{from:n.from.toISOString(),to:n.to.toISOString()}),console.log("Converted to Manila UTC:",{fromIso:e,toIso:t}),console.log("Category Analytics URL:","/sales-items?from=".concat(encodeURIComponent(e),"&to=").concat(encodeURIComponent(t))),"/sales-items?from=".concat(encodeURIComponent(e),"&to=").concat(encodeURIComponent(t))},[null==n||null==(e=n.from)?void 0:e.getTime(),null==n||null==(t=n.to)?void 0:t.getTime()]),{data:_=[],error:L,isLoading:P,isValidating:I}=(0,ep.Ay)(D,tM,{keepPreviousData:!0,revalidateOnFocus:!1});(0,r.useEffect)(()=>{_.length>0&&(console.log("\uD83D\uDCCA CATEGORY ANALYTICS DATA:"),console.log("Raw sale items count:",_.length),console.log("Raw sale items sample:",_.slice(0,3)),console.log("Raw total from saleItems:",_.reduce((e,t)=>e+(t.total_sales||0),0)))},[_]);let{data:M=[]}=(0,ep.Ay)("/products?limit=all",tF,{keepPreviousData:!0,revalidateOnFocus:!1}),F=(0,r.useMemo)(()=>{let e=new Map;return M.forEach(t=>{t.category_id&&t.unit&&(e.set("Category ".concat(t.category_id),t.unit),t.category_name&&e.set(t.category_name,t.unit))}),e},[M]),z=async e=>{x(e.category),u(!0),k(!0);try{var t;let a=new URLSearchParams;a.set("category_name",e.category),(null==n?void 0:n.from)&&a.set("from_date",tz(n.from)),(null==n?void 0:n.to)&&a.set("to_date",tq(n.to));let l="/sales-items/products-by-category?".concat(a.toString()),r=await N.A.get(l),s=(null==(t=r.data)?void 0:t.data)||r.data||[],o=M.find(t=>t.category_name===e.category||t.category_id&&"Category ".concat(t.category_id)===e.category);o&&o.unit&&o.unit;let c=s.map(e=>({name:e.product_name||"Unknown Product",qty:e.qty||0,price:e.price||0,total:e.total||0,unit:e.unit||"pcs",last_purchase:e.last_purchase}));C(c),c.reduce((e,t)=>e+(Number(t.total)||0),0)}catch(e){console.error("Error fetching products by category:",e),C([])}finally{k(!1)}},q=(0,r.useMemo)(()=>{switch(E){case"asc":return[...h].sort((e,t)=>(e.total||0)-(t.total||0));case"desc":return[...h].sort((e,t)=>(t.total||0)-(e.total||0));default:return[...h].sort((e,t)=>{let a=e.last_purchase?new Date(e.last_purchase).getTime():0;return(t.last_purchase?new Date(t.last_purchase).getTime():0)-a})}},[h,E]),R=h.reduce((e,t)=>e+(Number(t.total)||0),0),U=P&&0===_.length,O=I&&_.length>0,G=(0,r.useMemo)(()=>{let e=_.map(e=>{let t="pcs";if(F.has(e.category))t=F.get(e.category);else{let a=M.find(t=>t.category_name===e.category||t.category_id&&"Category ".concat(t.category_id)===e.category);a&&a.unit&&(t=a.unit)}let a=Number(e.total_sales)||0;return{category:e.category,quantity:Number(e.quantity)||0,total_sales:a,last_purchase:e.last_purchase,unit:t}});switch(c){case"asc":return[...e].sort((e,t)=>e.total_sales-t.total_sales);case"desc":default:return[...e].sort((e,t)=>t.total_sales-e.total_sales);case"recent":return[...e].sort((e,t)=>new Date(t.last_purchase).getTime()-new Date(e.last_purchase).getTime())}},[_,c,F,M]),B=(0,r.useMemo)(()=>G.reduce((e,t)=>e+t.total_sales,0),[G]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(f,{className:"@container/card w-full relative",children:[(0,l.jsxs)(g,{className:"flex flex-col border-b @md/card:grid",children:[(0,l.jsx)(p,{children:"Category Analytics"}),(0,l.jsx)(v,{children:"Showing most sold categories for this month."}),(0,l.jsx)(j,{className:"mt-2 @md/card:mt-0",children:(0,l.jsxs)("div",{className:"flex gap-2 items-center mt-2",children:[(0,l.jsx)(w.$,{onClick:()=>i("desc"),variant:"desc"===c?"default":"outline",size:"sm",children:(0,l.jsx)(ew.A,{size:16})}),(0,l.jsx)(w.$,{onClick:()=>i("recent"),variant:"recent"===c?"default":"outline",size:"sm",children:(0,l.jsx)(ts.A,{size:16})}),(0,l.jsx)(w.$,{onClick:()=>i("asc"),variant:"asc"===c?"default":"outline",size:"sm",children:(0,l.jsx)(eC.A,{size:16})}),(0,l.jsxs)(tD,{children:[(0,l.jsx)(t_,{asChild:!0,children:(0,l.jsxs)(w.$,{variant:"outline",children:[(0,l.jsx)(tn.A,{}),(null==n?void 0:n.from)&&(null==n?void 0:n.to)?"".concat(n.from.toLocaleDateString()," - ").concat(n.to.toLocaleDateString()):"".concat(s.toLocaleDateString()," - ").concat(a.toLocaleDateString())]})}),(0,l.jsx)(tL,{className:"w-auto p-0",align:"end",children:(0,l.jsx)(tg,{mode:"range",defaultMonth:null==n?void 0:n.from,selected:n,onSelect:o,fixedWeeks:!0,showOutsideDays:!0,disabled:{after:a}})})]})]})})]}),(0,l.jsx)(b,{className:"px-4",children:(0,l.jsxs)("div",{className:"relative h-89 w-full",children:[(0,l.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center",children:G.length>0?(0,l.jsx)("div",{className:"w-full h-full",children:(0,l.jsx)(tN,{config:tI,className:"aspect-auto h-89 w-full",children:(0,l.jsxs)(to.E,{data:G,margin:{left:12,right:12},children:[(0,l.jsx)(tc.d,{vertical:!1}),(0,l.jsx)(ti.W,{dataKey:"category",tickLine:!1,axisLine:!1,tickMargin:8,minTickGap:20}),(0,l.jsx)(tS,{content:(0,l.jsx)(tk,{className:"w-[150px]",nameKey:"total_sales",labelFormatter:e=>e,formatter:(e,t,a)=>["₱ ".concat(Number(e).toLocaleString()),""]})}),(0,l.jsx)(td.y,{dataKey:"total_sales",fill:"var(--color-total_sales)",radius:4,onClick:z})]})})}):(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center px-4",children:L?(0,l.jsx)("div",{className:"text-sm text-red-600",children:"Error loading product stats."}):P||0!==_.length?(0,l.jsx)("div",{className:"w-full h-full"}):(0,l.jsx)("div",{className:"text-sm text-gray-600",children:"No data for the selected range."})})}),(0,l.jsx)("div",{"aria-hidden":!0,className:"absolute inset-0 z-20 flex items-end px-4 pointer-events-none transition-opacity duration-300 ease-in-out ".concat(O||U?"opacity-100":"opacity-0"),children:(0,l.jsx)("div",{className:"flex w-full h-full items-end gap-3",children:Array.from({length:Math.max(6,G.length||6)}).map((e,t)=>{let a=[28,44,60,36,52,40],r=a[t%a.length];return(0,l.jsx)("div",{className:"flex-1 flex items-end justify-center",children:(0,l.jsx)("div",{className:"w-3/4",children:(0,l.jsx)(tT.E,{className:"rounded-t-md animate-pulse",style:{height:"".concat(r,"%")}})})},t)})})})]})}),(0,l.jsx)(y,{className:"border-t",children:(0,l.jsxs)("div",{className:"text-sm",children:["Total sales: ",(0,l.jsxs)("span",{className:"font-semibold",children:["₱ ",B.toLocaleString()]})]})})]}),(0,l.jsx)(T.lG,{open:d,onOpenChange:u,children:(0,l.jsxs)(T.Cf,{className:"w-full max-w-5xl sm:max-w-4xl md:max-w-3xl lg:max-w-5xl xl:max-w-6xl",children:[(0,l.jsxs)(T.c7,{className:"flex flex-row items-center justify-between",children:[(0,l.jsx)(T.L3,{className:"text-lg font-semibold items-center",children:m?"".concat(m," — Total Amount: ₱ ").concat(R.toLocaleString()):"₱ ".concat(R.toLocaleString())}),(0,l.jsxs)("div",{className:"flex gap-2 pr-4",children:[(0,l.jsx)(w.$,{onClick:()=>A("desc"),variant:"desc"===E?"default":"outline",size:"icon",className:"w-8 h-8",children:(0,l.jsx)(ew.A,{size:16})}),(0,l.jsx)(w.$,{onClick:()=>A("recent"),variant:"recent"===E?"default":"outline",size:"icon",className:"w-8 h-8",children:(0,l.jsx)(ts.A,{size:16})}),(0,l.jsx)(w.$,{onClick:()=>A("asc"),variant:"asc"===E?"default":"outline",size:"icon",className:"w-8 h-8",children:(0,l.jsx)(eC.A,{size:16})})]})]}),(0,l.jsxs)(tP.F,{className:"h-80 mt-4 rounded-md border bg-white",children:[S&&0===h.length&&(0,l.jsx)("div",{className:"p-4 text-center text-gray-600",children:"Loading products…"}),q.length>0?(0,l.jsxs)(l.Fragment,{children:[S&&(0,l.jsx)("div",{className:"p-2 text-sm text-gray-600 border-b",children:"Updating products…"}),(0,l.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,l.jsx)("thead",{className:"bg-gray-100 sticky top-0",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"p-2 border text-left font-semibold",children:"Product"}),(0,l.jsx)("th",{className:"p-2 border text-center font-semibold",children:"Quantity Sold"}),(0,l.jsx)("th",{className:"p-2 border text-center font-semibold",children:"Unit Price"}),(0,l.jsx)("th",{className:"p-2 border text-center font-semibold",children:"Total"})]})}),(0,l.jsx)("tbody",{children:q.map((e,t)=>(0,l.jsxs)("tr",{className:"hover:bg-gray-50 transition",children:[(0,l.jsx)("td",{className:"p-2 border font-medium",children:e.name}),(0,l.jsxs)("td",{className:"p-2 border text-center font-semibold text-blue-600",children:[e.qty.toLocaleString()," ",e.unit]}),(0,l.jsxs)("td",{className:"p-2 border text-left",children:["₱ ",e.price.toLocaleString()]}),(0,l.jsxs)("td",{className:"p-2 border text-left font-semibold",children:["₱ ",(e.total||0).toLocaleString()]})]},t))})]})]}):!S&&(0,l.jsx)("p",{className:"p-4 text-center text-gray-500",children:"No products found for this category."})]})]})})]})}var tU=a(80019),tO=a(47643),tG=a(80003);let tB={customer:{label:"Total",color:"var(--color-primary)"}},t$=async e=>{var t;return(null==(t=(await N.A.get(e)).data)?void 0:t.data)||[]};function tK(e){let t=e.getFullYear();return new Date(Date.UTC(t,e.getMonth(),e.getDate(),0,0,0)-288e5).toISOString()}function tY(e){let t=e.getFullYear();return new Date(Date.UTC(t,e.getMonth(),e.getDate(),0,0,0)-288e5+864e5).toISOString()}function tV(e){let[t,a,l]=e.split("-").map(Number);return new Date(t,a-1,l)}function tQ(){var e,t,a,s;let n=new Date,o=new Date(n.getFullYear(),n.getMonth(),1),[c,i]=r.useState({from:o,to:n}),[d,u]=r.useState("normal"),m=r.useMemo(()=>{if(!(null==c?void 0:c.from)||!(null==c?void 0:c.to))return"/sales?aggregate=daily";let e=tK(c.from),t=tY(c.to);return"/sales?aggregate=daily&from=".concat(encodeURIComponent(e),"&to=").concat(encodeURIComponent(t))},[null==c||null==(e=c.from)?void 0:e.getTime(),null==c||null==(t=c.to)?void 0:t.getTime()]),{data:x=[],error:h,isLoading:N,isValidating:C}=(0,ep.Ay)(m,t$,{keepPreviousData:!0,revalidateOnFocus:!1}),S=r.useMemo(()=>{let e=new Map;return x.forEach(t=>{if("sale_date"in t)e.set(t.sale_date,t.total_sales||0);else{let a=function(e){let t=new Date(new Date(e).getTime()+288e5),a=t.getUTCFullYear(),l=String(t.getUTCMonth()+1).padStart(2,"0"),r=String(t.getUTCDate()).padStart(2,"0");return"".concat(a,"-").concat(l,"-").concat(r)}(t.created_at);e.set(a,(e.get(a)||0)+(t.total_purchase||0))}}),e},[x]),k=r.useMemo(()=>{let e,t;if((null==c?void 0:c.from)&&(null==c?void 0:c.to))e=new Date(c.from.getFullYear(),c.from.getMonth(),c.from.getDate()),t=new Date(c.to.getFullYear(),c.to.getMonth(),c.to.getDate());else if(x.length>0){let a=Array.from(S.keys()).sort(),l=tV(a[0]),r=tV(a[a.length-1]);e=new Date(l.getFullYear(),l.getMonth(),l.getDate()),t=new Date(r.getFullYear(),r.getMonth(),r.getDate())}else{let a=new Date;t=e=new Date(a.getFullYear(),a.getMonth(),a.getDate())}return(function(e,t){let a=[],l=new Date(e.getFullYear(),e.getMonth(),e.getDate()),r=new Date(t.getFullYear(),t.getMonth(),t.getDate());for(;l<=r;)a.push(new Date(l)),l.setDate(l.getDate()+1);return a})(e,t).map(e=>{let t=function(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(l)}(e);return{date:t,customer:S.get(t)||0}})},[null==c||null==(a=c.from)?void 0:a.getTime(),null==c||null==(s=c.to)?void 0:s.getTime(),x,S]),E=r.useMemo(()=>{if("normal"===d)return k;let e=[...k];return"asc"===d?e.sort((e,t)=>e.customer-t.customer):"desc"===d&&e.sort((e,t)=>t.customer-e.customer),e},[k,d]);r.useMemo(()=>{let e=[...k];return"asc"===d?e.sort((e,t)=>e.customer-t.customer):"desc"===d&&e.sort((e,t)=>t.customer-e.customer),e},[k,d]);let A=r.useMemo(()=>k.reduce((e,t)=>e+t.customer,0),[k]),D=r.useMemo(()=>k.length>0&&k.every(e=>{var t;return(null!=(t=e.customer)?t:0)===0}),[k]),_=N&&0===x.length,L=C&&x.length>0;return(r.useEffect(()=>{if((null==c?void 0:c.from)&&(null==c?void 0:c.to)){let e=tK(c.from),t=tY(c.to);console.log("\uD83D\uDD0D DEBUGGING SALES CHART:"),console.log("Selected range:",{from:c.from.toISOString(),to:c.to.toISOString()}),console.log("Converted to Manila UTC:",{fromIso:e,toIso:t}),console.log("Sales URL:",m),console.log("Raw sales data count:",x.length),console.log("Raw sales data sample:",x.slice(0,3));let a=x.length>0&&"sale_date"in x[0]?"aggregated":"individual";console.log("Data type:",a),"aggregated"===a?console.log("✅ Using aggregated data!"):console.log("❌ Still using individual sales data - backend not working!"),console.log("Grouped by date map:",Object.fromEntries(S)),console.log("Chart series length:",k.length),console.log("Chart series sample:",k.slice(0,5))}},[c,x,m,S,k]),h&&!x.length)?(0,l.jsx)("div",{children:"Error loading sales data."}):(0,l.jsxs)(f,{className:"@container/card w-full",children:[(0,l.jsxs)(g,{className:"flex flex-col border-b @md/card:grid",children:[(0,l.jsx)(p,{children:"Sales Chart"}),(0,l.jsx)(v,{children:"Filter total sales by date range"}),(0,l.jsx)(j,{className:"mt-2 @md/card:mt-0",children:(0,l.jsxs)("div",{className:"flex gap-2 items-center mt-2",children:[(0,l.jsx)(w.$,{variant:"desc"===d?"default":"outline",size:"sm",onClick:()=>u("desc"),"aria-label":"Sort Descending",children:(0,l.jsx)(ew.A,{size:16})}),(0,l.jsx)(w.$,{variant:"normal"===d?"default":"outline",size:"sm",onClick:()=>u("normal"),"aria-label":"Follow Order",children:(0,l.jsx)(tG.A,{size:16})}),(0,l.jsx)(w.$,{variant:"asc"===d?"default":"outline",size:"sm",onClick:()=>u("asc"),"aria-label":"Sort Ascending",children:(0,l.jsx)(eC.A,{size:16})}),(0,l.jsxs)(tD,{children:[(0,l.jsx)(t_,{asChild:!0,children:(0,l.jsxs)(w.$,{variant:"outline",children:[(0,l.jsx)(tn.A,{}),(null==c?void 0:c.from)&&(null==c?void 0:c.to)?"".concat(c.from.toLocaleDateString()," - ").concat(c.to.toLocaleDateString()):"".concat(o.toLocaleDateString()," - ").concat(n.toLocaleDateString())]})}),(0,l.jsx)(tL,{className:"w-auto overflow-hidden p-0",align:"end",children:(0,l.jsx)(tg,{className:"w-full",mode:"range",defaultMonth:null==c?void 0:c.from,selected:c,onSelect:i,fixedWeeks:!0,showOutsideDays:!0,disabled:{after:n}})})]})]})})]}),(0,l.jsx)(b,{className:"px-4",children:(0,l.jsxs)("div",{className:"relative h-89 w-full",children:[_&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-end px-4",children:(0,l.jsx)("div",{className:"flex w-full h-full items-end gap-3",children:Array.from({length:Math.max(6,k.length||6)}).map((e,t)=>{let a=[28,44,60,36,52,40],r=a[t%a.length];return(0,l.jsx)("div",{className:"flex-1 flex items-end justify-center",children:(0,l.jsx)("div",{className:"w-3/4",children:(0,l.jsx)(tT.E,{className:"rounded-t-md animate-pulse",style:{height:"".concat(r,"%")}})})},t)})})}),!_&&D&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,l.jsx)("div",{className:"text-center text-sm text-gray-500",children:"No sales found for the selected period"})}),!_&&!D&&(0,l.jsx)("div",{className:"absolute inset-0 w-full h-full",children:(0,l.jsx)(tN,{config:tB,className:"aspect-auto h-89 w-full",children:(0,l.jsxs)(tU.b,{accessibilityLayer:!0,data:E,margin:{left:12,right:12},children:[(0,l.jsx)(tc.d,{vertical:!1}),(0,l.jsx)(ti.W,{dataKey:"date",tickLine:!1,axisLine:!1,tickMargin:8,minTickGap:20,tickFormatter:e=>tV(String(e)).toLocaleDateString(void 0,{month:"short",day:"numeric"})}),(0,l.jsx)(tS,{content:(0,l.jsx)(tk,{className:"w-[200px]",nameKey:"customer",labelFormatter:e=>tV(String(e)).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})})}),(0,l.jsx)(tO.N,{dataKey:"customer",type:"monotone",stroke:"var(--color-customer)",strokeWidth:2,dot:!1})]})})}),!_&&L&&!D&&(0,l.jsx)("div",{"aria-hidden":!0,className:"absolute inset-0 flex items-end px-4 pointer-events-none transition-opacity duration-300 ease-in-out z-20",children:(0,l.jsx)("div",{className:"flex w-full h-full items-end gap-3",children:Array.from({length:Math.max(6,k.length||6)}).map((e,t)=>{let a=[28,44,60,36,52,40],r=a[t%a.length];return(0,l.jsx)("div",{className:"flex-1 flex items-end justify-center",children:(0,l.jsx)("div",{className:"w-3/4",children:(0,l.jsx)(tT.E,{className:"rounded-t-md animate-pulse",style:{height:"".concat(r,"%")}})})},t)})})})]})}),(0,l.jsx)(y,{className:"border-t",children:(0,l.jsxs)("div",{className:"text-sm",children:["You had ",(0,l.jsxs)("span",{className:"font-semibold",children:["₱ ",A.toLocaleString()]})," total sales for the selected period."]})})]})}let tW={total_sales:{label:"Total Sales",color:"var(--color-primary)"}},tJ=async e=>{var t;let a=await N.A.get(e);return(null==(t=a.data)?void 0:t.data)||a.data||[]};function tH(e){let t=e.getFullYear();return new Date(Date.UTC(t,e.getMonth(),e.getDate(),0,0,0)-288e5).toISOString()}function tZ(e){let t=e.getFullYear();return new Date(Date.UTC(t,e.getMonth(),e.getDate(),0,0,0)-288e5+864e5).toISOString()}function tX(){var e,t;let a=new Date,s=new Date(a.getFullYear(),a.getMonth(),1),[n,o]=(0,r.useState)({from:s,to:a}),[c,i]=(0,r.useState)("desc"),[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(null),[h,C]=(0,r.useState)([]),[S,k]=(0,r.useState)(!1),[E,A]=(0,r.useState)("desc"),[D,_]=(0,r.useState)(15),L=(0,r.useMemo)(()=>{if(!(null==n?void 0:n.from)||!(null==n?void 0:n.to))return"/sales-items/products";let e=tH(n.from),t=tZ(n.to);return"/sales-items/products?from=".concat(encodeURIComponent(e),"&to=").concat(encodeURIComponent(t))},[null==n||null==(e=n.from)?void 0:e.getTime(),null==n||null==(t=n.to)?void 0:t.getTime()]),{data:P=[],error:I,isLoading:M,isValidating:F}=(0,ep.Ay)(L,tJ,{keepPreviousData:!0,revalidateOnFocus:!1}),z=(0,r.useMemo)(()=>P.length?P.map(e=>({product_name:e.product_name||"Unknown Product",total_sales:Number(e.total_sales||e.total)||0,quantity:Number(e.total_quantity||e.quantity)||0,price:Number(e.average_price||e.price)||0,unit:e.unit||"pcs",last_purchase:e.last_purchase})):[],[P]),q=async e=>{x(e.product_name),u(!0),k(!0);try{var t;let a=tH((null==n?void 0:n.from)||new Date),l=tZ((null==n?void 0:n.to)||new Date),r=(null==(t=(await N.A.get("/sales-items/product-details",{params:{product_name:e.product_name,from:a,to:l}})).data)?void 0:t.data)||[];C(r),console.log("Loaded ".concat(r.length," transactions for ").concat(e.product_name))}catch(e){console.error("Error fetching product details:",e),C([])}finally{k(!1)}},R=(0,r.useMemo)(()=>{switch(E){case"asc":return[...h].sort((e,t)=>(e.total||0)-(t.total||0));case"desc":return[...h].sort((e,t)=>(t.total||0)-(e.total||0));default:return[...h].sort((e,t)=>{let a=e.last_purchase?new Date(e.last_purchase).getTime():0;return(t.last_purchase?new Date(t.last_purchase).getTime():0)-a})}},[h,E]),U=h.reduce((e,t)=>e+(Number(t.total)||0),0),O=(0,r.useMemo)(()=>{let e;switch(c){case"asc":e=[...z].sort((e,t)=>e.total_sales-t.total_sales);break;case"desc":default:e=[...z].sort((e,t)=>t.total_sales-e.total_sales);break;case"recent":e=[...z].sort((e,t)=>new Date(t.last_purchase).getTime()-new Date(e.last_purchase).getTime())}let t=e.slice(0,D);return console.log("\uD83D\uDD0D PRODUCT ANALYTICS DEBUG:"),console.log("Total products from API:",z.length),console.log("Product limit setting:",D),console.log("Chart data length after limit:",t.length),console.log("Chart data sample:",t.slice(0,3).map(e=>e.product_name)),t},[z,c,D]),G=(0,r.useMemo)(()=>O.reduce((e,t)=>e+t.total_sales,0),[O]),B=M&&0===z.length,$=F&&z.length>0;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(f,{className:"@container/card w-full relative",children:[(0,l.jsxs)(g,{className:"flex flex-col border-b @md/card:grid",children:[(0,l.jsx)(p,{children:"Product Analytics"}),(0,l.jsx)(v,{children:"Showing highest selling products for this month."}),(0,l.jsx)(j,{className:"mt-2 @md/card:mt-0",children:(0,l.jsxs)("div",{className:"flex gap-2 items-center mt-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium",children:"Show:"}),(0,l.jsx)("input",{type:"number",min:"5",max:"50",value:D,onChange:e=>_(Number(e.target.value)),className:"w-16 px-2 py-1 border rounded text-sm text-center"}),(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"products"})]}),(0,l.jsx)(w.$,{onClick:()=>i("desc"),variant:"desc"===c?"default":"outline",size:"sm",children:(0,l.jsx)(ew.A,{size:16})}),(0,l.jsx)(w.$,{onClick:()=>i("recent"),variant:"recent"===c?"default":"outline",size:"sm",children:(0,l.jsx)(ts.A,{size:16})}),(0,l.jsx)(w.$,{onClick:()=>i("asc"),variant:"asc"===c?"default":"outline",size:"sm",children:(0,l.jsx)(eC.A,{size:16})}),(0,l.jsxs)(tD,{children:[(0,l.jsx)(t_,{asChild:!0,children:(0,l.jsxs)(w.$,{variant:"outline",children:[(0,l.jsx)(tn.A,{}),(null==n?void 0:n.from)&&(null==n?void 0:n.to)?"".concat(n.from.toLocaleDateString()," - ").concat(n.to.toLocaleDateString()):"".concat(s.toLocaleDateString()," - ").concat(a.toLocaleDateString())]})}),(0,l.jsx)(tL,{className:"w-auto p-0",align:"end",children:(0,l.jsx)(tg,{mode:"range",defaultMonth:null==n?void 0:n.from,selected:n,onSelect:o,fixedWeeks:!0,showOutsideDays:!0,disabled:{after:a}})})]})]})})]}),(0,l.jsx)(b,{className:"px-4",children:(0,l.jsxs)("div",{className:"relative h-89 w-full",children:[(0,l.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center",children:O.length>0?(0,l.jsx)(tN,{config:tW,className:"aspect-auto h-89 w-full",children:(0,l.jsxs)(to.E,{data:O,margin:{left:12,right:12},children:[(0,l.jsx)(tc.d,{vertical:!1}),(0,l.jsx)(ti.W,{dataKey:"product_name",tickLine:!1,axisLine:!1,tickMargin:8,minTickGap:20,angle:-45,textAnchor:"end",height:100,interval:0,fontSize:10}),(0,l.jsx)(tS,{content:(0,l.jsx)(tk,{className:"w-[200px]",nameKey:"total_sales",labelFormatter:e=>e,formatter:e=>["₱ ".concat(Number(e).toLocaleString()),""]})}),(0,l.jsx)(td.y,{dataKey:"total_sales",fill:"var(--color-total_sales)",radius:4,onClick:q})]})}):(0,l.jsx)("div",{className:"text-sm text-gray-600",children:"No data for the selected range."})}),(0,l.jsx)("div",{"aria-hidden":!0,className:"absolute inset-0 z-20 flex items-end px-4 pointer-events-none transition-opacity duration-300 ease-in-out ".concat($||B?"opacity-100":"opacity-0"),children:(0,l.jsx)("div",{className:"flex w-full h-full items-end gap-3",children:Array.from({length:Math.max(6,O.length||6)}).map((e,t)=>{let a=[28,44,60,36,52,40],r=a[t%a.length];return(0,l.jsx)("div",{className:"flex-1 flex items-end justify-center",children:(0,l.jsx)("div",{className:"w-3/4",children:(0,l.jsx)(tT.E,{className:"rounded-t-md animate-pulse",style:{height:"".concat(r,"%")}})})},t)})})})]})}),(0,l.jsx)(y,{className:"border-t",children:(0,l.jsxs)("div",{className:"text-sm",children:["Total sales: ",(0,l.jsxs)("span",{className:"font-semibold",children:["₱ ",G.toLocaleString()]})]})})]}),(0,l.jsx)(T.lG,{open:d,onOpenChange:u,children:(0,l.jsxs)(T.Cf,{className:"w-full max-w-5xl",children:[(0,l.jsx)(T.c7,{className:"flex flex-row items-center justify-between",children:(0,l.jsx)(T.L3,{children:m?"".concat(m," — Total Amount: ₱ ").concat(U.toLocaleString()):"₱ ".concat(U.toLocaleString())})}),(0,l.jsx)(tP.F,{className:"h-80 mt-4 rounded-md border bg-white",children:R.length>0?(0,l.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,l.jsx)("thead",{className:"bg-gray-100 sticky top-0",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"p-2 border text-left",children:"Product"}),(0,l.jsx)("th",{className:"p-2 border text-center",children:"Quantity Sold"}),(0,l.jsx)("th",{className:"p-2 border text-center",children:"Unit Price"}),(0,l.jsx)("th",{className:"p-2 border text-center",children:"Total"})]})}),(0,l.jsx)("tbody",{children:R.map((e,t)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"p-2 border",children:e.name}),(0,l.jsxs)("td",{className:"p-2 border text-center",children:[e.qty.toLocaleString()," ",e.unit]}),(0,l.jsxs)("td",{className:"p-2 border text-center",children:["₱ ",e.price.toLocaleString()]}),(0,l.jsxs)("td",{className:"p-2 border text-center",children:["₱ ",e.total.toLocaleString()]})]},t))})]}):(0,l.jsx)("p",{className:"p-4 text-center text-gray-500",children:"No details found for this product."})})]})})]})}function t0(){return(0,l.jsxs)("div",{className:"flex flex-col p-6 h-full gap-3",children:[(0,l.jsxs)("div",{className:"flex-[7%]",children:[(0,l.jsx)("h1",{className:"font-extrabold text-4xl",children:"Dashboard"}),(0,l.jsx)("p",{children:"Welcome Back! Here's your business overview!"})]}),(0,l.jsx)("div",{className:"flex-[20%]",children:(0,l.jsx)(tr,{})}),(0,l.jsxs)("div",{className:"flex-[78%] flex gap-3 flex-col",children:[(0,l.jsx)("div",{className:"flex-[50%] mb-4",children:(0,l.jsx)(tQ,{})}),(0,l.jsx)("div",{className:"flex-[50%] mb-2",children:(0,l.jsx)(tR,{})}),(0,l.jsx)("div",{className:"flex-[50%] mb-2",children:(0,l.jsx)(tX,{})})]})]})}var t1=a(65229),t2=a(57419),t4=a(74054);let t5=[{value:"widget-a",label:"Widget A"},{value:"widget-b",label:"Widget B"},{value:"gadget-x",label:"Gadget X"},{value:"gadget-y",label:"Gadget Y"},{value:"part-123",label:"Part 123"}];function t3(e){var t,a;let{onAdd:s}=e,[n,o]=(0,r.useState)(!1),[c,i]=(0,r.useState)(!1),[d,u]=(0,r.useState)(""),[m,x]=(0,r.useState)(""),[h,f]=(0,r.useState)(1),[g,p]=(0,r.useState)(""),v=(0,r.useRef)(null),j=(0,r.useRef)(null),[b,y]=(0,r.useState)(null),{products:N,loading:k,error:E}=(0,O.Q)(),A=(0,r.useMemo)(()=>N&&N.length>0?N.map(e=>{var t;return{value:String(e.id),label:null!=(t=e.name)?t:"#".concat(e.id)}}):t5,[N]);(0,r.useEffect)(()=>{n&&m&&setTimeout(()=>{var e;return null==(e=v.current)?void 0:e.focus()},60)},[n,m]),(0,r.useLayoutEffect)(()=>{let e=()=>{var e,t;return y(null!=(t=null==(e=j.current)?void 0:e.offsetWidth)?t:null)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,r.useEffect)(()=>{if(c){var e,t;y(null!=(t=null==(e=j.current)?void 0:e.offsetWidth)?t:null)}},[c,m]);let D=(0,r.useMemo)(()=>new G.A(A,{keys:["label"],threshold:.3,ignoreLocation:!0,minMatchCharLength:1}),[A]),_=(0,r.useMemo)(()=>{let e=d.trim();if(!e)return A;let t=e.toLowerCase().split(/\s+/).filter(Boolean),a=A.filter(e=>{var a;let l=String(null!=(a=e.label)?a:"").normalize("NFKC").toLowerCase();return t.every(e=>l.includes(e))});return a.length>0?a:D.search(e).map(e=>e.item)},[D,d,A]);(0,r.useEffect)(()=>{try{var e;console.log("[AddProductModal] apiProducts.length=",null!=(e=null==N?void 0:N.length)?e:0),console.log("[AddProductModal] sample apiProducts=",(null!=N?N:[]).slice(0,5)),console.log("[AddProductModal] productItems.length=",A.length),console.log("[AddProductModal] sample productItems=",A.slice(0,8)),console.log("[AddProductModal] query=",JSON.stringify(d),"filtered.length=",_.length),console.log("[AddProductModal] sample filtered=",_.slice(0,8))}catch(e){console.error("[AddProductModal] debug error",e)}},[N,A,d,_]);let L=(0,r.useCallback)(e=>{var t,a,l,r;if(e.preventDefault(),!m||h<1||""===g||0>Number(g))return;let n=null!=(l=null==(t=A.find(e=>e.value===m))?void 0:t.label)?l:m,c=null!=(r=null==N||null==(a=N.find(e=>String(e.id)===m))?void 0:a.id)?r:null;if("function"==typeof s)s({name:n,qty:h,unitPrice:Number(g),productId:c});else try{window.dispatchEvent(new CustomEvent("stock:addProduct",{detail:{name:n,qty:h,unitPrice:Number(g),productId:c}}))}catch(e){}x(""),f(1),p(""),u(""),o(!1)},[m,h,g,A,s]);return(0,r.useEffect)(()=>{E&&console.error("useProducts error:",E)},[E]),(0,l.jsxs)(T.lG,{open:n,onOpenChange:o,children:[(0,l.jsx)(T.zM,{asChild:!0,children:(0,l.jsx)(w.$,{variant:"outline",className:"h-8",children:"Add"})}),(0,l.jsx)(T.Cf,{className:"sm:max-w-[425px]",children:(0,l.jsxs)("form",{onSubmit:L,children:[(0,l.jsxs)(T.c7,{children:[(0,l.jsx)(T.L3,{children:"Add Product"}),(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:"Search and add a product with quantity and unit price."})]}),(0,l.jsxs)("div",{className:"grid gap-4 py-2",children:[(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)(S.J,{htmlFor:"product-combobox",children:"Product"}),(0,l.jsxs)(tD,{open:c,onOpenChange:i,children:[(0,l.jsx)(t_,{asChild:!0,children:(0,l.jsxs)(w.$,{variant:"outline",role:"combobox","aria-expanded":c,className:"w-full justify-between text-left overflow-hidden","aria-label":"Product combobox",id:"product-combobox",ref:j,type:"button",children:[(0,l.jsx)("span",{className:"flex-1 min-w-0 truncate pr-2 text-left",children:m?null!=(a=null==(t=A.find(e=>e.value===m))?void 0:t.label)?a:m:"Select product..."}),(0,l.jsx)(t4.A,{className:"opacity-50"})]})}),(0,l.jsx)(tL,{className:"p-3 min-w-[280px] max-w-[640px]",align:"start",side:"bottom",style:b?{width:"".concat(b,"px")}:void 0,children:(0,l.jsxs)("div",{children:[(0,l.jsx)(C.p,{placeholder:"Search product...",className:"h-9 mb-2",value:d,onChange:e=>u(e.target.value),autoFocus:!0}),k?(0,l.jsx)("div",{className:"p-2 text-sm",children:"Loading products..."}):0===_.length?(0,l.jsx)("div",{className:"p-2 text-sm text-muted-foreground",children:'No product found for "'.concat(d,'". products=').concat(A.length," filtered=").concat(_.length)}):(0,l.jsx)("ul",{className:"max-h-56 overflow-auto divide-y rounded-md bg-background",children:_.map(e=>(0,l.jsx)("li",{children:(0,l.jsx)("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-muted-foreground/5 flex items-center gap-3",onClick:()=>{x(e.value),i(!1),setTimeout(()=>{var e;return null==(e=v.current)?void 0:e.focus()},60)},children:(0,l.jsx)("span",{className:"flex-1 truncate",children:String(e.label)})})},e.value))})]})})]})]}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)(S.J,{htmlFor:"qty",children:"Quantity"}),(0,l.jsx)(C.p,{id:"qty",ref:v,type:"number",min:1,value:String(h),onChange:e=>f(Math.max(1,Number(e.target.value)||1))})]}),(0,l.jsxs)("div",{className:"grid gap-2",children:[(0,l.jsx)(S.J,{htmlFor:"unit-price",children:"Unit price (purchased)"}),(0,l.jsx)(C.p,{id:"unit-price",type:"number",step:"0.01",min:0,value:""===g?"":String(g),onChange:e=>p(""===e.target.value?"":Math.max(0,Number(e.target.value))),placeholder:"0.00"})]})]}),(0,l.jsxs)(T.Es,{children:[(0,l.jsx)(T.HM,{asChild:!0,children:(0,l.jsx)(w.$,{variant:"outline",children:"Cancel"})}),(0,l.jsx)(w.$,{type:"submit",disabled:!m||h<1||""===g,children:"Add"})]})]})})]})}function t6(e){let{onSave:t}=e,[a,s]=(0,r.useState)(!1),[n,o]=(0,r.useState)(new Date);(0,r.useEffect)(()=>{let e=e=>{(null==e?void 0:e.detail)&&_(e.detail)};return window.addEventListener("stock:addProduct",e),()=>window.removeEventListener("stock:addProduct",e)},[]);let[c,i]=(0,r.useState)(""),[d,u]=(0,r.useState)(void 0),[m,x]=(0,r.useState)(""),[h,y]=(0,r.useState)([]),[S,k]=(0,r.useState)(!1),{mutate:E}=(0,t2.iX)(),A=async()=>{if(!c||0===h.length)return void alert("Company and at least one product are required.");let e={company_name:c,date:d?d.toISOString():new Date().toISOString(),total:Number(m)||0,items:h.map(e=>{var t,a;return{product_id:null!=(t=e.productId)?t:null,purchased_price:null!=(a=e.unitPrice)?a:Number(m)||0,quantity:e.qty}})};try{k(!0);let a="/stock-transactions",l=await N.A.post(a,e),r=l.data;if(l.status>=400)throw Error((null==r?void 0:r.message)||(null==r?void 0:r.error)||"Save failed");null==t||t({company:c,date:d?d.toISOString():new Date().toISOString(),price:Number(m)||0,products:h}),E(a),i(""),u(void 0),x(""),y([]),s(!1)}catch(e){var a;console.error("save stock error",e),alert("Save failed: ".concat(null!=(a=null==e?void 0:e.message)?a:e))}finally{k(!1)}},_=e=>{y(t=>{var a,l;let r=t.findIndex(t=>null!=e.productId?t.productId===e.productId:t.name===e.name);if(-1!==r){let l=[...t];return l[r]={...l[r],qty:l[r].qty+e.qty,unitPrice:e.unitPrice,productId:null!=(a=l[r].productId)?a:e.productId},l}return[...t,{id:"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,9)),productId:null!=(l=e.productId)?l:null,name:e.name,qty:e.qty,unitPrice:e.unitPrice}]})},L=(e,t,a)=>{y(l=>l.map(l=>{if(l.id!==e)return l;let r="qty"===t?Math.max(0,Math.floor(Number(a)||0)):Math.max(0,Number(a)||0);return{...l,[t]:r}}))};return h.reduce((e,t)=>e+t.qty*t.unitPrice,0),(0,l.jsxs)(T.lG,{open:a,onOpenChange:s,children:[(0,l.jsx)(T.zM,{asChild:!0,children:(0,l.jsxs)(w.$,{className:"h-full flex items-center gap-2",children:[(0,l.jsx)(D.A,{size:16}),"Add Stocks"]})}),(0,l.jsxs)(T.Cf,{className:" flex h-[calc(80vh-2rem)] min-w-[calc(80vw-2rem)] flex-col justify-between gap-0 p-0",children:[(0,l.jsxs)(tP.F,{className:"flex-1 overflow-hidden",children:[(0,l.jsxs)(T.c7,{className:"contents space-y-0 text-left",children:[(0,l.jsx)(T.L3,{className:"px-6 pt-6",children:"Add Stock"}),(0,l.jsx)(T.rr,{asChild:!0,children:(0,l.jsx)("div",{className:"pt-2 px-6",children:(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enter stock details and add products."})})})]}),(0,l.jsx)("div",{className:"px-6 pt-2",children:(0,l.jsxs)("div",{className:"flex w-full gap-6",children:[(0,l.jsxs)("div",{className:"flex-[40%] ",children:[(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("label",{className:"text-sm block mb-1",children:"Company"}),(0,l.jsx)(C.p,{value:c,onChange:e=>i(e.target.value),placeholder:"Company name"})]}),(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("label",{className:"text-sm block mb-1",children:"Date"}),(0,l.jsxs)(tD,{children:[(0,l.jsx)(t_,{asChild:!0,children:(0,l.jsxs)(w.$,{variant:"outline",className:"w-full h-10 justify-between text-left px-3",type:"button","aria-label":"Choose date",children:[(0,l.jsx)("span",{className:"truncate",children:d?d.toLocaleDateString():"mm/dd/yyyy"}),(0,l.jsx)(tn.A,{className:"ml-2 opacity-70"})]})}),(0,l.jsx)(tL,{className:"w-auto p-2",children:(0,l.jsxs)(f,{className:"w-[290px]",children:[(0,l.jsxs)(g,{className:"flex items-start gap-2",children:[(0,l.jsx)("div",{children:(0,l.jsxs)(v,{className:"text-xs text-muted-foreground",children:[(0,l.jsx)(p,{className:"text-sm",children:"Choose date"}),"Select a date for this stock entry"]})}),(0,l.jsx)(j,{children:(0,l.jsx)(w.$,{size:"sm",variant:"outline",onClick:()=>{let e=new Date;o(e),u(e)},children:"Today"})})]}),(0,l.jsx)(b,{className:"p-2",children:(0,l.jsx)(tg,{mode:"single",month:n,onMonthChange:o,selected:d,onSelect:u,className:"bg-transparent p-0 rounded-md"})})]})})]})]}),(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("label",{className:"text-sm block mb-1",children:"Price"}),(0,l.jsx)(C.p,{type:"number",step:"0.01",value:""===m?"":String(m),onChange:e=>x(""===e.target.value?"":Number(e.target.value)),placeholder:"0.00"})]})]}),(0,l.jsxs)("div",{className:"flex flex-col h-full flex-[60%]",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsx)("h3",{className:"font-medium",children:"Products"}),(0,l.jsx)(t3,{onAdd:_})]}),(0,l.jsx)("div",{className:"[&>div]:max-h-[400px] [&>div]:rounded-sm [&>div]:border",children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)(Y,{className:"table-fixed w-full",children:[(0,l.jsx)(V,{children:(0,l.jsxs)(W,{className:"bg-background sticky top-0",children:[(0,l.jsx)(J,{className:"w-[35%]",children:"Product"}),(0,l.jsx)(J,{className:"w-[10%] text-center",children:"Quantity"}),(0,l.jsx)(J,{className:"w-[10%] text-center",children:"Unit Price"}),(0,l.jsx)(J,{className:"w-[8%]"})]})}),(0,l.jsx)(Q,{children:0===h.length?(0,l.jsx)(W,{children:(0,l.jsx)(H,{colSpan:4,children:(0,l.jsx)("div",{className:"w-full h-24 flex items-center justify-center text-sm text-muted-foreground",children:"No products added."})})}):h.map(e=>(0,l.jsxs)(W,{children:[(0,l.jsx)(H,{className:"min-w-0 break-words whitespace-normal pr-4",children:(0,l.jsx)("div",{className:"font-medium",children:e.name})}),(0,l.jsx)(H,{className:"text-center align-middle",children:(0,l.jsx)(C.p,{type:"number",min:0,value:String(e.qty),onChange:t=>L(e.id,"qty",t.target.value),onBlur:t=>L(e.id,"qty",t.target.value),className:"focus-visible:ring-ring h-8 w-20 border-0 bg-transparent p-1 text-center focus-visible:ring-1 mx-auto","aria-label":"qty-".concat(e.id)})}),(0,l.jsx)(H,{className:"text-center align-middle",children:(0,l.jsx)(C.p,{type:"number",step:"0.01",min:0,value:String(e.unitPrice),onChange:t=>L(e.id,"unitPrice",t.target.value),onBlur:t=>L(e.id,"unitPrice",t.target.value),className:"focus-visible:ring-ring h-8 w-24 border-0 bg-transparent p-1 text-center focus-visible:ring-1 mx-auto","aria-label":"unit-".concat(e.id)})}),(0,l.jsx)(H,{className:"text-center align-middle",children:(0,l.jsx)(w.$,{variant:"ghost",size:"sm",onClick:()=>{var t;return t=e.id,void y(e=>e.filter(e=>e.id!==t))},"aria-label":"Remove product",children:(0,l.jsx)(t1.A,{className:"h-4 w-4"})})})]},e.id))})]})})})]})]})})]}),(0,l.jsxs)(T.Es,{className:"px-6 pb-6 sm:justify-end",children:[(0,l.jsx)(T.HM,{asChild:!0,children:(0,l.jsxs)(w.$,{variant:"outline",onClick:()=>s(!1),disabled:S,children:[(0,l.jsx)(eK.A,{}),"Back"]})}),(0,l.jsx)(w.$,{onClick:A,disabled:S,children:S?"Saving...":"Save"})]})]})]})}function t8(){return(0,l.jsxs)("div",{className:"flex justify-between items-center h-full",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold",children:"Stock Movements"}),(0,l.jsx)("div",{className:"flex gap-3",children:(0,l.jsx)(t6,{})})]})}let t7=async e=>{var t,a;return null!=(a=null==(t=(await N.A.get(e)).data)?void 0:t.data)?a:[]};var t9=a(57828);let ae=[{accessorKey:"company_name",header:"Company Name",cell:e=>{let{row:t}=e;return(0,l.jsx)("div",{className:"font-medium",children:t.getValue("company_name")})}},{accessorKey:"date",header:"Date",cell:e=>{let{row:t}=e,a=t.getValue("date"),r=a?new Date(a).toLocaleDateString():"";return(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:r})}},{accessorKey:"total",header:()=>(0,l.jsx)("div",{className:"text-right",children:"Total"}),cell:e=>{var t;let{row:a}=e,r=parseFloat(String(null!=(t=a.getValue("total"))?t:0)),s=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r);return(0,l.jsx)("div",{className:"text-right font-medium",children:s})}},{id:"actions",header:"",cell:e=>{var t,a,s,n;let{row:o}=e,c=String(null!=(a=o.getValue("company_name"))?a:""),i=String(null!=(s=o.getValue("date"))?s:""),d=i?new Date(i).toLocaleDateString():"",u=parseFloat(String(null!=(n=o.getValue("total"))?n:0)),m=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(u),x=null==(t=o.original)?void 0:t.id;return(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsx)(e=>{var t,a,s,n;let{id:i}=e,[u,x]=r.useState(!1),[h,f]=r.useState(null),[g,p]=r.useState(!1),[v,j]=r.useState(null);r.useEffect(()=>{if(!u)return;let e=!0;return(async()=>{var t,a,l,r;p(!0),j(null);try{let r=await N.A.get("/stock-transactions/".concat(i)),s=r.data;if(r.status>=400)throw Error((null==s?void 0:s.message)||(null==s?void 0:s.error)||"Failed to load");let n=null!=(l=null!=(a=null==s?void 0:s.items)?a:null==s||null==(t=s.data)?void 0:t.items)?l:[];e&&f(Array.isArray(n)?n:[])}catch(t){console.error("load transaction items error",t),e&&j(null!=(r=null==t?void 0:t.message)?r:String(t))}finally{e&&p(!1)}})(),()=>{e=!1}},[u,i]);let b=null!=(n=null!=(s=null==(t=o.original)?void 0:t.items)?s:null==(a=o.original)?void 0:a.products)?n:[],y=null!=h?h:Array.isArray(b)?b:[];return(0,l.jsxs)(T.lG,{open:u,onOpenChange:x,children:[(0,l.jsx)(T.zM,{asChild:!0,children:(0,l.jsx)(w.$,{variant:"ghost",size:"sm","aria-label":"View details",children:(0,l.jsx)(t9.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(T.Cf,{className:"flex max-h-[min(640px,84vh)] flex-col gap-0 p-0 sm:max-w-lg",children:[(0,l.jsx)(T.c7,{className:"contents space-y-0 text-left",children:(0,l.jsxs)(tP.F,{className:"flex max-h-full flex-col overflow-hidden",children:[(0,l.jsx)(T.L3,{className:"px-6 pt-6 text-lg md:text-xl font-semibold text-foreground",children:"Transaction Details"}),(0,l.jsx)(T.rr,{asChild:!0,children:(0,l.jsx)("div",{className:"p-6",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsxs)("div",{className:"flex items-baseline gap-3",children:[(0,l.jsx)("span",{className:"text-sm text-muted-foreground",children:"Company:"}),(0,l.jsx)("span",{className:"text-base font-medium text-foreground",children:c})]}),(0,l.jsxs)("div",{className:"flex items-baseline gap-3",children:[(0,l.jsx)("span",{className:"text-sm text-muted-foreground",children:"Date:"}),(0,l.jsx)("span",{className:"text-sm text-foreground",children:d})]}),(0,l.jsxs)("div",{className:"flex items-baseline gap-3",children:[(0,l.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total:"}),(0,l.jsx)("span",{className:"text-base font-semibold text-foreground",children:m})]})]}),(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-muted-foreground",children:"Products"}),g?(0,l.jsx)("div",{className:"text-sm text-muted-foreground mt-3",children:"Loading products…"}):v?(0,l.jsxs)("div",{className:"text-sm text-destructive mt-3",children:["Failed to load products: ",v]}):y&&0!==y.length?(0,l.jsx)("div",{className:"mt-3 overflow-auto rounded-sm border",children:(0,l.jsxs)("table",{className:"w-full text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"bg-muted/5",children:[(0,l.jsx)("th",{className:"px-4 py-3 text-left text-xs text-muted-foreground",children:"Product"}),(0,l.jsx)("th",{className:"px-4 py-3 text-right text-xs text-muted-foreground",children:"Qty"}),(0,l.jsx)("th",{className:"px-4 py-3 text-right text-xs text-muted-foreground",children:"Unit"}),(0,l.jsx)("th",{className:"px-4 py-3 text-right text-xs text-muted-foreground",children:"Subtotal"})]})}),(0,l.jsx)("tbody",{children:y.map((e,t)=>{var a,r,s,n,o,c,i,d,u;let m=null!=(n=null!=(s=null!=(r=null==(a=e.product)?void 0:a.name)?r:e.product_name)?s:e.name)?n:e.product_id?"#".concat(e.product_id):"Item ".concat(t+1),x=Number(null!=(c=null!=(o=e.quantity)?o:e.qty)?c:0),h=Number(null!=(u=null!=(d=null!=(i=e.purchased_price)?i:e.unit_price)?d:e.price)?u:0),f=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(h),g=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(x*h);return(0,l.jsxs)("tr",{className:"border-t last:border-b",children:[(0,l.jsx)("td",{className:"px-4 py-3 align-top text-sm text-foreground max-w-[260px] break-words whitespace-normal",children:m}),(0,l.jsx)("td",{className:"px-4 py-3 align-top text-sm text-right text-foreground",children:x}),(0,l.jsx)("td",{className:"px-4 py-3 align-top text-sm text-right text-foreground",children:f}),(0,l.jsx)("td",{className:"px-4 py-3 align-top text-sm text-right font-medium text-foreground",children:g})]},t)})})]})}):(0,l.jsx)("div",{className:"text-sm text-muted-foreground mt-3",children:"No products available for this transaction."})]})]})})})]})}),(0,l.jsx)(T.Es,{className:"flex-row items-center justify-end border-t px-6 py-4",children:(0,l.jsx)(T.HM,{asChild:!0,children:(0,l.jsxs)(w.$,{variant:"outline",size:"sm",children:[(0,l.jsx)(eK.A,{}),"Back"]})})})]})]})},{id:x})})}}],at=()=>{var e;let{data:t,loading:a,error:s}=function(){let{data:e,error:t,isValidating:a}=(0,ep.Ay)("/stock-transactions",t7,{revalidateOnFocus:!1});return{data:e,loading:!t&&!e&&a,error:t?t.message:null}}(),[n,o]=(0,r.useState)([]),[c,i]=(0,r.useState)([]),[d,u]=(0,r.useState)({}),[m,x]=(0,r.useState)({}),[h,f]=(0,r.useState)(""),g=(0,eF.N4)({data:null!=t?t:[],columns:ae,onSortingChange:o,onColumnFiltersChange:i,getCoreRowModel:(0,ez.HT)(),getPaginationRowModel:(0,ez.kW)(),getSortedRowModel:(0,ez.h5)(),getFilteredRowModel:(0,ez.hM)(),onColumnVisibilityChange:u,onRowSelectionChange:x,onGlobalFilterChange:f,globalFilterFn:"includesString",state:{sorting:n,columnFilters:c,columnVisibility:d,rowSelection:m,globalFilter:h}});return(0,l.jsxs)("div",{className:"w-full h-full",children:[(0,l.jsxs)("div",{className:"flex justify-between gap-2 pb-4 max-sm:flex-col sm:items-center",children:[(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsx)(C.p,{placeholder:"Search all columns...",value:null!=h?h:"",onChange:e=>f(String(e.target.value)),className:"max-w-sm"})}),(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsxs)("div",{className:"text-muted-foreground text-sm",children:[g.getSelectedRowModel().rows.length>0&&(0,l.jsxs)("span",{className:"mr-2",children:[g.getSelectedRowModel().rows.length," of ",g.getFilteredRowModel().rows.length," row(s) selected"]}),a&&(0,l.jsx)("span",{className:"ml-2",children:"Loading..."}),s&&(0,l.jsxs)("span",{className:"ml-2 text-destructive",children:["Error: ",s]})]})})]}),(0,l.jsx)("div",{className:"rounded-md border",children:(0,l.jsxs)(Y,{children:[(0,l.jsx)(V,{children:g.getHeaderGroups().map(e=>(0,l.jsx)(W,{children:e.headers.map(e=>(0,l.jsx)(J,{children:e.isPlaceholder?null:(0,eF.Kv)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,l.jsx)(Q,{children:(null==(e=g.getRowModel().rows)?void 0:e.length)?g.getRowModel().rows.map(e=>(0,l.jsx)(W,{"data-state":e.getIsSelected()&&"selected",children:e.getVisibleCells().map(e=>(0,l.jsx)(H,{children:(0,eF.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,l.jsx)(W,{children:(0,l.jsx)(H,{colSpan:ae.length,className:"h-24 text-center",children:"No results."})})})]})})]})};function aa(){return(0,l.jsx)(f,{className:"h-full border",children:(0,l.jsx)(b,{children:(0,l.jsx)(at,{})})})}function al(){return(0,l.jsxs)("div",{className:"flex flex-col gap-4 p-8 w-full h-full",children:[(0,l.jsx)("div",{className:"h-full flex-[10%]",children:(0,l.jsx)(t8,{})}),(0,l.jsx)("div",{className:" h-full flex-[90%]",children:(0,l.jsx)(aa,{})})]})}function ar(e){let{site:t}=e;switch(t){case"main":return(0,l.jsx)(ef,{});case"db":return(0,l.jsx)(t0,{});case"products":return(0,l.jsx)(te,{});case"stock":return(0,l.jsx)(al,{});default:return null}}}},e=>{e.O(0,[843,720,721,911,523,441,255,358],()=>e(e.s=52387)),_N_E=e.O()}]);