"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[523],{3998:(e,t,a)=>{a.d(t,{$:()=>i,r:()=>o});var r=a(95155);a(12115);var n=a(32467),s=a(83101),l=a(64269);let o=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function i(e){let{className:t,variant:a,size:s,asChild:i=!1,...d}=e,c=i?n.DX:"button";return(0,r.jsx)(c,{"data-slot":"button",className:(0,l.cn)(o({variant:a,size:s,className:t})),...d})}},6259:(e,t,a)=>{a.d(t,{SQ:()=>i,_2:()=>d,lp:()=>c,mB:()=>u,rI:()=>l,ty:()=>o});var r=a(95155);a(12115);var n=a(95736),s=a(64269);function l(e){let{...t}=e;return(0,r.jsx)(n.bL,{"data-slot":"dropdown-menu",...t})}function o(e){let{...t}=e;return(0,r.jsx)(n.l9,{"data-slot":"dropdown-menu-trigger",...t})}function i(e){let{className:t,sideOffset:a=4,...l}=e;return(0,r.jsx)(n.ZL,{children:(0,r.jsx)(n.UC,{"data-slot":"dropdown-menu-content",sideOffset:a,className:(0,s.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...l})})}function d(e){let{className:t,inset:a,variant:l="default",...o}=e;return(0,r.jsx)(n.q7,{"data-slot":"dropdown-menu-item","data-inset":a,"data-variant":l,className:(0,s.cn)("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...o})}function c(e){let{className:t,inset:a,...l}=e;return(0,r.jsx)(n.JU,{"data-slot":"dropdown-menu-label","data-inset":a,className:(0,s.cn)("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",t),...l})}function u(e){let{className:t,...a}=e;return(0,r.jsx)(n.wv,{"data-slot":"dropdown-menu-separator",className:(0,s.cn)("bg-border -mx-1 my-1 h-px",t),...a})}},9585:(e,t,a)=>{a.d(t,{default:()=>q});var r=a(95155),n=a(12115),s=a(47943),l=a(13501),o=a(54636),i=a(51834),d=a(22544),c=a(66942),u=a(63769),m=a(31342),g=a(36764);let p="products:list";var v=a(67931),f=a(89234),h=a(3998),x=a(41508);let y=e=>{var t,a,r,n,s;return null!=(s=null!=(n=null!=(r=null!=(a=null!=(t=null==e?void 0:e.id)?t:null==e?void 0:e._id)?a:null==e?void 0:e.category_id)?r:null==e?void 0:e.categoryId)?n:null==e?void 0:e.ID)?s:null},b=x.Ikc({name:x.YjP().min(1,"Product name is required").max(100,"Product name must be less than 100 characters").trim(),barcode:x.YjP().min(1,"Barcode is required").regex(/^\d+$/,"Barcode must contain only digits").min(3,"Barcode must be at least 3 digits").max(20,"Barcode must be less than 20 digits").trim(),category_id:x.aig().int("Category must be a valid selection").min(1,"Please select a valid category"),price:x.aig().min(0,"Price must be 0 or greater").max(999999.99,"Price is too high"),quantity:x.aig().int("Quantity must be a whole number").min(0,"Quantity must be 0 or greater").max(999999,"Quantity is too high"),unit:x.YjP().min(1,"Unit is required").refine(e=>["pcs","kg","pck"].includes(e),{message:"Unit must be pcs, kg, or pck"})});var j=a(65142),w=a(76444),N=a(6191),C=a(6259),S=a(17037);function k(e){let{form:t,errors:a,selectedCategoryName:l,onSelectCategory:o}=e,{categories:i,loading:d,error:c}=(0,f.C)(),{openModal:u}=(0,s.c)(),[m,g]=(0,n.useState)(""),p=(0,n.useMemo)(()=>{if(!i)return[];let e=m.trim().toLowerCase();return e?i.filter(t=>((null==t?void 0:t.name)||"").toLowerCase().includes(e)):i},[i,m]);return(0,r.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"category-1",children:"Category"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(C.rI,{children:[(0,r.jsx)(C.ty,{asChild:!0,children:(0,r.jsx)(j.p,{id:"category-1",readOnly:!0,value:l,placeholder:"Select category",className:"cursor-pointer ".concat(a.category_id?"border-red-500":"")})}),(0,r.jsxs)(C.SQ,{className:"w-64 p-0",children:[(0,r.jsx)("div",{className:"p-2",children:(0,r.jsx)(j.p,{placeholder:"Search category...",value:m,onChange:e=>g(e.target.value),className:"mb-2"})}),d&&(0,r.jsx)("div",{className:"p-2 text-gray-400",children:"Loading..."}),c&&(0,r.jsx)("div",{className:"p-2 text-red-500",children:c}),!d&&!c&&(0,r.jsx)(S.F,{className:"h-40",children:(0,r.jsxs)("div",{className:"p-2",children:[p.map(e=>{let t=String(y(e));return(0,r.jsx)(C._2,{onClick:()=>o(e),children:e.name},t)}),0===p.length&&(0,r.jsx)("div",{className:"p-2 text-gray-400",children:"No categories found."})]})})]})]}),(0,r.jsx)(h.$,{variant:"outline",size:"icon",onClick:()=>"function"==typeof u?u("addCategory"):null,"aria-label":"Add Category",children:(0,r.jsx)(N.A,{className:"w-4 h-4"})})]}),a.category_id&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:a.category_id.message})]})}var A=a(24033);function _(e){let{form:t,errors:a,onFieldChangeStore:n}=e,{register:s,setValue:l,watch:o}=t,i=o("price"),d=o("quantity"),c=o("unit"),u=[{value:"pcs",label:"pcs (pieces)"},{value:"kg",label:"kg (kilogram)"},{value:"pck",label:"pck (pack)"}],m=u.find(e=>e.value===c)||u[0];return(0,r.jsxs)("div",{className:"flex flex-col gap-4 my-4",children:[(0,r.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,r.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"price-1",children:"Price"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 pointer-events-none",children:"₱"}),(0,r.jsx)(j.p,{id:"price-1",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:i||"",onChange:e=>{let t=e.target.value,a=""===t?0:Number(t);isNaN(a)||l("price",a,{shouldValidate:!0}),n("price",t)},className:"pl-8 ".concat(a.price?"border-red-500":"")})]}),a.price&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:a.price.message})]}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"quantity-1",children:"Quantity"}),(0,r.jsx)(j.p,{id:"quantity-1",type:"number",min:"0",step:"1",placeholder:"0",value:d||"",onChange:e=>{let t=e.target.value,a=""===t?0:Number(t);isNaN(a)||l("quantity",a,{shouldValidate:!0}),n("quantity",t)},className:a.quantity?"border-red-500":""}),a.quantity&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:a.quantity.message})]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"unit-1",children:"Unit"}),(0,r.jsxs)(C.rI,{children:[(0,r.jsx)(C.ty,{asChild:!0,children:(0,r.jsxs)(h.$,{variant:"outline",className:"w-full justify-between ".concat(a.unit?"border-red-500":""),children:[m.label,(0,r.jsx)(A.A,{className:"h-4 w-4"})]})}),(0,r.jsx)(C.SQ,{align:"start",className:"w-full",children:u.map(e=>(0,r.jsx)(C._2,{onClick:()=>{l("unit",e.value,{shouldValidate:!0}),n("unit",e.value)},children:e.label},e.value))})]}),a.unit&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:a.unit.message})]})]})}function F(e){let{form:t,errors:a,selectedCategoryName:n,onSelectCategory:s,onFieldChangeStore:l}=e,{register:o,setValue:i,watch:d}=t,c=d("name"),u=d("barcode");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"name-1",children:"Product Name"}),(0,r.jsx)(j.p,{id:"name-1",value:c||"",onChange:e=>{i("name",e.target.value,{shouldValidate:!0}),l("name",e.target.value)},className:a.name?"border-red-500":""}),a.name&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:a.name.message})]}),(0,r.jsxs)("div",{className:"flex flex-row gap-2 mt-4",children:[(0,r.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,r.jsx)(w.J,{htmlFor:"barcode-1",children:"Barcode"}),(0,r.jsx)(j.p,{id:"barcode-1",value:u||"",onChange:e=>{i("barcode",e.target.value,{shouldValidate:!0}),l("barcode",e.target.value)},className:a.barcode?"border-red-500":""}),a.barcode&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:a.barcode.message})]}),(0,r.jsx)(k,{form:t,errors:a,selectedCategoryName:n,onSelectCategory:s})]}),(0,r.jsx)(_,{form:t,errors:a,onFieldChangeStore:l})]})}function P(e){let{error:t}=e;return t?(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 mb-4",children:(0,r.jsx)("p",{className:"text-sm text-red-600",children:t})}):null}function E(e){var t,a;let{contextBarcode:s,setContextBarcode:o,onClose:x}=e,{addProduct:j,loading:w,error:N,reset:C}=function(){let[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)(null),[s,l]=(0,n.useState)(!1);return{addProduct:async e=>{t(!0),r(null),l(!1);try{let a=await g.G.create(e);return(0,m.j)(p,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[a,...e]},!1),window.dispatchEvent(new CustomEvent("product:added",{detail:{product:a}})),l(!0),t(!1),(0,m.j)(p),a}catch(e){var a;if(console.error("Add product error:",e),null==(a=e.response)?void 0:a.data){let t=e.response.data;t.field&&t.message?r({field:t.field,message:t.message}):t.message?r({message:t.message}):t.error?r({message:t.error}):500===e.response.status?r({message:"Server error while processing request. Please try again."}):r({message:"Failed to add product. Please try again."})}else e.message?r({message:e.message}):r({message:"Failed to add product. Please check your connection and try again."});return t(!1),null}},loading:e,error:a,success:s,reset:()=>{r(null),l(!1)}}}(),{refetch:S}=(0,v.Q)(),{categories:k}=(0,f.C)(),[A,_]=(0,n.useState)(null),E=(0,l.U)(e=>e.name),q=(0,l.U)(e=>e.barcode),U=(0,l.U)(e=>e.category_id),z=(0,l.U)(e=>e.category_name),I=(0,l.U)(e=>e.price),L=(0,l.U)(e=>e.quantity),B=(0,l.U)(e=>e.unit),O=(0,l.U)(e=>e.setName),M=(0,l.U)(e=>e.setBarcode),J=(0,l.U)(e=>e.setCategoryId),Q=(0,l.U)(e=>e.setCategoryName),R=(0,l.U)(e=>e.setPrice),V=(0,l.U)(e=>e.setQuantity),G=(0,l.U)(e=>e.setUnit),$=(0,l.U)(e=>e.reset),D=(0,d.mN)({resolver:(0,c.u)(b),defaultValues:{name:"",barcode:"",category_id:0,price:0,quantity:0,unit:"PC"},mode:"onChange"}),{handleSubmit:T,setValue:Y,reset:H,formState:{errors:K},setError:Z,clearErrors:W}=D,X=(0,n.useMemo)(()=>{if(k)return k.find(e=>String(y(e))===String(U))},[k,U]),ee=null!=(a=null!=(t=null==X?void 0:X.name)?t:z)?a:"";(0,n.useEffect)(()=>{H({name:E||"",barcode:s||q||"",category_id:U&&""!==U?Number(U):0,price:I&&""!==I?Number(I):0,quantity:L&&""!==L?Number(L):0,unit:B||"PC"}),s&&s!==q&&(M(s),"function"==typeof o&&o(""))},[]),(0,n.useEffect)(()=>{if(_(null),N)if(N.field){let e={name:"name",product_name:"name",barcode:"barcode",category_id:"category_id",category:"category_id",price:"price",quantity:"quantity"}[N.field]||N.field;e in K||["name","barcode","category_id","price","quantity"].includes(e)?(Z(e,{message:N.message,type:"server"}),setTimeout(()=>{let t=document.querySelector('[name="'.concat(e,'"], #').concat(e,"-1"));t&&(t.focus(),t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("animate-pulse","border-red-500"),setTimeout(()=>{t.classList.remove("animate-pulse")},1e3))},100)):_(N.message)}else _(N.message)},[N,Z,K]);let et=(0,n.useCallback)((e,t)=>{if(K[e]&&W(e),(null==N?void 0:N.field)===e||(null==N?void 0:N.field)==="product_".concat(e)){if("name"===e){let e=t.trim().toLowerCase(),a=(E||"").trim().toLowerCase();e&&e!==a&&Math.abs(e.length-a.length)>=3&&C()}else if("barcode"===e){let e=t.trim(),a=(q||"").trim();e&&e!==a&&e.length>=3&&Math.abs(e.length-a.length)>=2&&C()}else if("price"===e||"quantity"===e){let a=Number(t),r=Number("price"===e?I:L);!isNaN(a)&&a!==r&&a>=0&&C()}}switch(e){case"name":return O(t);case"barcode":return M(t);case"price":return R(t);case"quantity":return V(t);default:return}},[O,M,R,V,N,K,C,W,E,q,I,L]),ea=(0,n.useCallback)(e=>{var t;let a=y(e);((null==N?void 0:N.field)==="category_id"||(null==N?void 0:N.field)==="category")&&C(),K.category_id&&W("category_id"),J(String(null!=a?a:"")),Q(null!=(t=null==e?void 0:e.name)?t:""),Y("category_id",Number(a)||0,{shouldValidate:!0})},[J,Q,Y,N,K,C,W]),er=async e=>{_(null),C();try{console.log("\uD83D\uDE80 Submitting product:",e),O(e.name),M(e.barcode),J(String(e.category_id)),R(String(e.price)),V(String(e.quantity)),G(e.unit);let t=await j(e);t&&(x(),window.dispatchEvent(new CustomEvent("product:added",{detail:{product:t,barcode:e.barcode}})),H(),$(),null==S||S().catch(()=>{}),(0,u.GF)("Product added successfully","".concat(e.name," has been added to inventory.")),window.dispatchEvent(new Event("focusBarcodeScanner")))}catch(e){console.error("❌ Form submission failed:",e),_("Failed to add product. Please try again.")}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex-col gap-4",children:[(0,r.jsx)(P,{error:A}),(0,r.jsx)(F,{form:D,errors:K,selectedCategoryName:ee,onSelectCategory:ea,onFieldChangeStore:et})]}),(0,r.jsxs)(i.Es,{children:[(0,r.jsx)(i.HM,{asChild:!0,children:(0,r.jsx)(h.$,{variant:"outline",children:"Cancel"})}),(0,r.jsx)(h.$,{onClick:T(er),disabled:w,children:w?"Adding...":"Add Product"})]})]})}function q(){let{open:e,setOpen:t,barcode:a,setBarcode:d}=(0,s.c)(),c=(0,l.U)(e=>e.reset);return(0,n.useEffect)(()=>{e||c()},[e,c]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.lG,{open:e,onOpenChange:t,children:(0,r.jsxs)(i.Cf,{children:[(0,r.jsxs)(i.c7,{children:[(0,r.jsx)(i.L3,{children:"Product"}),(0,r.jsx)(i.rr,{children:"Fill in the details below to add a new product."})]}),(0,r.jsx)(E,{contextBarcode:a,setContextBarcode:d,onClose:()=>t(!1)})]})}),(0,r.jsx)(o.A,{})]})}},12466:(e,t,a)=>{a.d(t,{A:()=>l});var r=a(95125);let n="http://3.107.238.186:5000/api",s=r.A.create({baseURL:n,withCredentials:!1,timeout:1e4,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>e),s.interceptors.response.use(e=>e,e=>{var t,a;return"ECONNREFUSED"===e.code||"ERR_NETWORK"===e.code?(console.warn("⚠️ Backend server not available:",n),Promise.resolve({data:{data:[],success:!1,message:"Server not available"},status:200})):(null==(t=e.response)?void 0:t.status)===500?(console.warn("⚠️ Server error, returning empty data"),Promise.resolve({data:{data:[],success:!1,message:"Server error"},status:200})):(console.error("API Error:",e.message),Promise.resolve({data:{data:[],success:!1,message:e.message},status:(null==(a=e.response)?void 0:a.status)||500}))});let l=s},13501:(e,t,a)=>{a.d(t,{U:()=>r});let r=(0,a(25959).v)(e=>({name:"",barcode:"",category_id:"",category_name:"",price:"",quantity:"",unit:"pcs",setName:t=>e({name:t}),setBarcode:t=>e({barcode:t}),setCategoryId:t=>e({category_id:t}),setCategoryName:t=>e({category_name:t}),setPrice:t=>e({price:t}),setQuantity:t=>e({quantity:t}),setUnit:t=>e({unit:t}),reset:()=>e({name:"",barcode:"",category_id:"",category_name:"",price:"",quantity:"",unit:"pcs"})}))},17037:(e,t,a)=>{a.d(t,{F:()=>l});var r=a(95155);a(12115);var n=a(59034),s=a(64269);function l(e){let{className:t,children:a,...l}=e;return(0,r.jsxs)(n.bL,{"data-slot":"scroll-area",className:(0,s.cn)("relative",t),...l,children:[(0,r.jsx)(n.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),(0,r.jsx)(o,{}),(0,r.jsx)(n.OK,{})]})}function o(e){let{className:t,orientation:a="vertical",...l}=e;return(0,r.jsx)(n.VM,{"data-slot":"scroll-area-scrollbar",orientation:a,className:(0,s.cn)("flex touch-none p-px transition-colors select-none","vertical"===a&&"h-full w-2.5 border-l border-l-transparent","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent",t),...l,children:(0,r.jsx)(n.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}},20243:(e,t,a)=>{a.d(t,{E:()=>s});var r=a(95155),n=a(64269);function s(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"skeleton",className:(0,n.cn)("bg-accent animate-pulse rounded-md",t),...a})}},36764:(e,t,a)=>{a.d(t,{G:()=>p});var r=a(31342),n=a(12466),s=a(60919);let l="products:list",o=new Map,i="pos:barcode-cache",d=null;function c(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function u(){try{d&&clearTimeout(d),d=window.setTimeout(()=>{try{let e={};o.forEach((t,a)=>{e[a]=t}),window.localStorage.setItem(i,JSON.stringify(e))}catch(e){}finally{d=null}},500)}catch(e){}}function m(e){if(!e||!e.barcode)return;if(o.size>=1e3){let e=o.keys().next().value;e&&o.delete(e)}let t=String(e.barcode);o.set(t,{product:e,ts:Date.now()}),u()}function g(e){try{let a=!1;for(let[r,n]of Array.from(o.entries())){var t;String(null==n||null==(t=n.product)?void 0:t.id)===String(e)&&(o.delete(r),a=!0)}a&&u()}catch(e){}}try{!function(){try{let e=window.localStorage.getItem(i);if(!e)return;let t=JSON.parse(e);if(!c(t))return;Object.keys(t).forEach(e=>{let a=t[e];c(a)&&a.product&&"number"==typeof a.ts&&o.set(e,{product:a.product,ts:a.ts})})}catch(e){}}()}catch(e){}let p={async getAll(){try{var e;let t=await n.A.get("/products?limit=all");if(t.status>=400)return console.error("Product API error status:",t.status),[];return null!=(e=t.data.data)?e:[]}catch(e){return console.error("Error fetching products:",e),[]}},async create(e){let t=await n.A.post("/products",e),a=t.data;if(t.status>=400)throw Error((null==a?void 0:a.error)||(null==a?void 0:a.message)||"Failed to create product: ".concat(t.status));let s=a.data;try{m(s)}catch(e){}try{(0,r.j)("/products",e=>(function(e,t){if(!e)return[t];if(Array.isArray(e))return[t,...e];if(c(e)&&Array.isArray(e.data)){var a;let r=e.data;return{...e,data:[t,...r],count:(null!=(a=e.count)?a:r.length)+1}}return e})(e,s),!1).catch(()=>{})}catch(e){}return s},async search(e){if(!e||e.trim().length<2)return[];try{var t;let a=await n.A.get("/products/search?q=".concat(encodeURIComponent(e)));if(a.status>=400)return[];return null!=(t=a.data.data)?t:[]}catch(e){return[]}},async update(e,t){let a=await n.A.put("/products/".concat(e),t),s=a.data;if(a.status>=400)throw Error((null==s?void 0:s.error)||(null==s?void 0:s.message)||"Failed to update product: ".concat(a.status));let o=s.data;try{g(o.id)}catch(e){}try{m(o)}catch(e){}try{(0,r.j)(l,e=>e?Array.isArray(e)?e.map(e=>e.id===o.id?o:e):c(e)&&Array.isArray(e.data)?{...e,data:e.data.map(e=>e.id===o.id?o:e)}:e:e,!1).catch(()=>{}),(0,r.j)(["product",e],o,!1).catch(()=>{})}catch(e){}return o},async getById(e){try{var t;let a=await n.A.get("/products/".concat(e));if(a.status>=400){if(404===a.status)return null;throw Error("Failed to fetch product with id ".concat(e))}return null!=(t=a.data.data)?t:null}catch(e){return null}},async delete(e){let t=await n.A.delete("/products/".concat(e));if(t.status>=400){let e=t.data;throw Error(e&&e.error||e&&e.message||"Failed to delete product: ".concat(t.status))}let a=t.data;a.soft_deleted?console.log("Product soft deleted:",a.message):a.hard_deleted&&console.log("Product permanently deleted:",a.message);try{(0,r.j)(l,t=>(function(e,t){if(!e)return e;if(Array.isArray(e))return e.filter(e=>e.id!==t);if(c(e)&&Array.isArray(e.data)){var a;let r=e.data.filter(e=>e.id!==t);return{...e,data:r,count:Math.max(0,(null!=(a=e.count)?a:e.data.length)-1)}}return e})(t,e),!1).catch(()=>{}),(0,r.j)(["product",e],null,!1).catch(()=>{})}catch(e){}try{g(e)}catch(e){}},async getByBarcode(e){var t,a;if(!e)return null;let r=String(e).replace(/[\u0000-\u001F\u007F-\u009F]/g,"").trim();if(!r)return null;try{let e=function(e){if(!e)return null;let t=String(e),a=o.get(t);return a?Date.now()-a.ts>18e5?(o.delete(t),u(),null):a.product:null}(r);if(e)return e}catch(e){}try{let e=await n.A.get("/products/barcode/".concat(encodeURIComponent(r)));if(200===e.status&&(null==(t=e.data)?void 0:t.data)){let t=e.data.data;try{m(t)}catch(e){}return t}return null}catch(e){return(0,s.F0)(e)&&(null==(a=e.response)?void 0:a.status)!==404&&console.warn("[productApi.getByBarcode] Network error:",e.message),null}}};try{window.addEventListener("beforeunload",()=>{try{let e={};o.forEach((t,a)=>{e[a]=t}),window.localStorage.setItem(i,JSON.stringify(e))}catch(e){}})}catch(e){}},47943:(e,t,a)=>{a.d(t,{ProductModalProvider:()=>l,c:()=>o});var r=a(95155),n=a(12115);let s=(0,n.createContext)({activeModals:[],activeModal:null,isOpen:()=>!1,modalProps:void 0,openModal:()=>{},closeModal:()=>{},open:!1,setOpen:()=>{},barcode:"",setBarcode:()=>{}}),l=e=>{let{children:t}=e,[a,l]=(0,n.useState)([]),[o,i]=(0,n.useState)(void 0),[d,c]=(0,n.useState)(""),u=(e,t)=>{l(t=>t.includes(e)?t:[...t,e]),i(a=>({...a||{},[e]:t}))},m=e=>{"string"==typeof e?(l(t=>t.filter(t=>t!==e)),i(t=>{if(!t)return t;let a={...t};return delete a[e],Object.keys(a).length?a:void 0})):(l([]),i(void 0))},g=e=>a.includes(e),p=g("addProduct"),v=a.length?a[a.length-1]:null;return(0,r.jsx)(s.Provider,{value:{activeModals:a,activeModal:v,isOpen:g,modalProps:o,openModal:u,closeModal:m,open:p,setOpen:e=>{e?u("addProduct"):m("addProduct")},barcode:d,setBarcode:c},children:t})},o=()=>(0,n.useContext)(s)},51834:(e,t,a)=>{a.d(t,{Cf:()=>m,Es:()=>p,HM:()=>c,L3:()=>v,c7:()=>g,lG:()=>o,rr:()=>f,zM:()=>i});var r=a(95155);a(12115);var n=a(89511),s=a(65229),l=a(64269);function o(e){let{...t}=e;return(0,r.jsx)(n.bL,{"data-slot":"dialog",...t})}function i(e){let{...t}=e;return(0,r.jsx)(n.l9,{"data-slot":"dialog-trigger",...t})}function d(e){let{...t}=e;return(0,r.jsx)(n.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{...t}=e;return(0,r.jsx)(n.bm,{"data-slot":"dialog-close",...t})}function u(e){let{className:t,...a}=e;return(0,r.jsx)(n.hJ,{"data-slot":"dialog-overlay",className:(0,l.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function m(e){let{className:t,children:a,showCloseButton:o=!0,...i}=e;return(0,r.jsxs)(d,{"data-slot":"dialog-portal",children:[(0,r.jsx)(u,{}),(0,r.jsxs)(n.UC,{"data-slot":"dialog-content",className:(0,l.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...i,children:[a,o&&(0,r.jsxs)(n.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,r.jsx)(s.A,{}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function g(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"dialog-header",className:(0,l.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function p(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"dialog-footer",className:(0,l.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function v(e){let{className:t,...a}=e;return(0,r.jsx)(n.hE,{"data-slot":"dialog-title",className:(0,l.cn)("text-lg leading-none font-semibold",t),...a})}function f(e){let{className:t,...a}=e;return(0,r.jsx)(n.VY,{"data-slot":"dialog-description",className:(0,l.cn)("text-muted-foreground text-sm",t),...a})}},54636:(e,t,a)=>{a.d(t,{A:()=>f});var r=a(95155),n=a(12115),s=a(46512),l=a(31342),o=a(3998),i=a(51834),d=a(63769),c=a(65142),u=a(76444),m=a(47943),g=a(12466),p=a(13501);let v="categories:list";function f(){let{isOpen:e,closeModal:t}=(0,m.c)(),{addCategory:a,loading:f,error:h}=(()=>{let[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)(null);return{addCategory:async(e,a)=>{var n,s,l,o,i,d;t(!0),r(null);try{let r=(await g.A.post("/categories",e)).data,l=null!=(s=null==r?void 0:r.data)?s:r;return null==a||null==(n=a.onSuccess)||n.call(a,l),t(!1),l}catch(e){throw r(null!=(d=null!=(i=null==e||null==(o=e.response)||null==(l=o.data)?void 0:l.message)?i:null==e?void 0:e.message)?d:"Failed to create category"),t(!1),e}},loading:e,error:a}})(),x=(0,p.U)(e=>e.setCategoryId),y=(0,p.U)(e=>e.setCategoryName),[b,j]=(0,n.useState)(""),{data:w=[]}=(0,s.Ay)(v),[N,C]=(0,n.useState)(null),[S,k]=(0,n.useState)(!1),[A,_]=(0,n.useState)(!1);(0,n.useEffect)(()=>{e("addCategory")||(j(""),k(!1),C(null))},[e]);let F=(0,n.useCallback)(e=>{let t=(e||"").trim();return t?t.length<2?"Name is too short":w.some(e=>{var a;return String(null!=(a=null==e?void 0:e.name)?a:"").toLowerCase()===t.toLowerCase()})?"Category with this name already exists":null:"Name is required"},[w]),P=(0,n.useCallback)(e=>{let t=e.target.value;j(t),k(!1);let a=F(t);C(e=>e===a?e:a)},[F]),E=(0,n.useCallback)(async e=>{null==e||e.preventDefault(),k(!0);let r=F(b);if(r)return void C(e=>e===r?e:r);C(null),_(!0);try{await a({name:b.trim()},{onSuccess:e=>{var a,r,n;let s=null!=(a=null==e?void 0:e.data)?a:e;if(!s)return;(0,l.j)(v,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.some(e=>String(null==e?void 0:e.id)===String(null==s?void 0:s.id))?e:[s,...e]},!1),(0,l.j)(v);let o=null!=(r=null==s?void 0:s.id)?r:null==s?void 0:s._id,i=null!=(n=null==s?void 0:s.name)?n:"";null!=o?(x(String(o)),y(i)):(0,d.GF)("Category added","Added but ID was not returned."),t("addCategory"),(0,d.GF)("Category added",i||"New category created.")}})}catch(e){var n;(0,d.Ni)("Failed to add category",null!=(n=null==e?void 0:e.message)?n:"An error occurred.")}finally{_(!1)}},[b,a,x,y,t,F]);return(0,r.jsx)(i.lG,{open:e("addCategory"),onOpenChange:e=>{e||t("addCategory")},children:(0,r.jsx)(i.Cf,{className:"sm:max-w-[420px]",children:(0,r.jsxs)("form",{onSubmit:E,children:[(0,r.jsxs)(i.c7,{children:[(0,r.jsx)(i.L3,{children:"Add Category"}),(0,r.jsx)(i.rr,{children:"Fill in the details below to add a new category."})]}),(0,r.jsxs)("div",{className:"grid gap-4",children:[(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(u.J,{htmlFor:"category-name",children:"Name"}),(0,r.jsx)(c.p,{id:"category-name",value:b,onChange:P,placeholder:"Category name",required:!0,autoFocus:!0})]}),h&&(0,r.jsx)("div",{className:"text-sm text-red-600",children:h})]}),(0,r.jsx)(i.Es,{className:"mt-2",children:(0,r.jsxs)("div",{className:" flex flex-col w-full gap-2",children:[(0,r.jsxs)("div",{className:"flex justify-start",children:[S&&N&&(0,r.jsx)("div",{className:"text-sm text-red-600",children:N}),h&&(0,r.jsx)("div",{className:"text-sm text-red-600",children:h})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)(o.$,{variant:"outline",type:"button",onClick:()=>t("addCategory"),children:"Cancel"}),(0,r.jsx)(o.$,{type:"submit",disabled:f||!b.trim()||A,children:A?"Saving...":"Save"})]})]})})]})})})}},63769:(e,t,a)=>{a.d(t,{GF:()=>l,Ni:()=>o});var r=a(18720);let n={"--normal-bg":"light-dark(var(--color-green-600), var(--color-green-400))","--normal-text":"var(--color-white)","--normal-border":"light-dark(var(--color-green-600), var(--color-green-400))"},s={"--normal-bg":"light-dark(var(--destructive), color-mix(in oklab, var(--destructive) 60%, var(--background)))","--normal-text":"var(--color-white)","--normal-border":"transparent"},l=(e,t)=>r.oR.success(e,{description:t,style:n}),o=(e,t)=>r.oR.error(e,{description:t,style:s})},64269:(e,t,a)=>{a.d(t,{cn:()=>s});var r=a(2821),n=a(75889);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.QP)((0,r.$)(t))}},65142:(e,t,a)=>{a.d(t,{p:()=>s});var r=a(95155);a(12115);var n=a(64269);function s(e){let{className:t,type:a,...s}=e;return(0,r.jsx)("input",{type:a,"data-slot":"input",className:(0,n.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...s})}},67931:(e,t,a)=>{a.d(t,{Q:()=>l});var r=a(46512),n=a(36764);let s=async()=>{try{return await n.G.getAll()}catch(e){return console.warn("Failed to fetch products:",e),[]}},l=()=>{let{data:e,error:t,isLoading:a,mutate:n}=(0,r.Ay)("products:list",s,{revalidateOnFocus:!1,revalidateOnReconnect:!0,dedupingInterval:1e4,errorRetryCount:2,refreshInterval:0,compare:(e,t)=>!e&&!t||!!e&&!!t&&e.length===t.length&&e.every((e,a)=>e.id===t[a].id&&e.name===t[a].name)});return{products:null!=e?e:[],loading:!!a,error:t?t.message:null,refetch:n}}},76444:(e,t,a)=>{a.d(t,{J:()=>l});var r=a(95155);a(12115);var n=a(10489),s=a(64269);function l(e){let{className:t,...a}=e;return(0,r.jsx)(n.b,{"data-slot":"label",className:(0,s.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}},89234:(e,t,a)=>{a.d(t,{C:()=>i});var r=a(46512),n=a(31342),s=a(12466);let l={async getAll(){var e;let t=(await s.A.get("/categories")).data;return null!=(e=null==t?void 0:t.data)?e:[]}},o=async()=>{try{return await l.getAll()}catch(e){return console.warn("Failed to fetch categories:",e),[]}},i=()=>{let{data:e,error:t,isLoading:a,mutate:s}=(0,r.Ay)("categories:list",o,{revalidateOnFocus:!0});return{categories:null!=e?e:[],loading:!!a,error:t?t.message:null,refetch:s,mutate:n.j}}}}]);