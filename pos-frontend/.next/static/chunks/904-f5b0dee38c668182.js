"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[904],{3998:(e,t,a)=>{a.d(t,{$:()=>i,r:()=>o});var r=a(95155);a(12115);var n=a(32467),l=a(83101),s=a(64269);let o=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function i(e){let{className:t,variant:a,size:l,asChild:i=!1,...d}=e,c=i?n.DX:"button";return(0,r.jsx)(c,{"data-slot":"button",className:(0,s.cn)(o({variant:a,size:l,className:t})),...d})}},6259:(e,t,a)=>{a.d(t,{SQ:()=>i,_2:()=>d,mB:()=>c,rI:()=>s,ty:()=>o});var r=a(95155);a(12115);var n=a(95736),l=a(64269);function s(e){let{...t}=e;return(0,r.jsx)(n.bL,{"data-slot":"dropdown-menu",...t})}function o(e){let{...t}=e;return(0,r.jsx)(n.l9,{"data-slot":"dropdown-menu-trigger",...t})}function i(e){let{className:t,sideOffset:a=4,...s}=e;return(0,r.jsx)(n.ZL,{children:(0,r.jsx)(n.UC,{"data-slot":"dropdown-menu-content",sideOffset:a,className:(0,l.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...s})})}function d(e){let{className:t,inset:a,variant:s="default",...o}=e;return(0,r.jsx)(n.q7,{"data-slot":"dropdown-menu-item","data-inset":a,"data-variant":s,className:(0,l.cn)("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...o})}function c(e){let{className:t,...a}=e;return(0,r.jsx)(n.wv,{"data-slot":"dropdown-menu-separator",className:(0,l.cn)("bg-border -mx-1 my-1 h-px",t),...a})}},13501:(e,t,a)=>{a.d(t,{U:()=>r});let r=(0,a(25959).v)(e=>({name:"",barcode:"",category_id:"",category_name:"",price:"",quantity:"",setName:t=>e({name:t}),setBarcode:t=>e({barcode:t}),setCategoryId:t=>e({category_id:t}),setCategoryName:t=>e({category_name:t}),setPrice:t=>e({price:t}),setQuantity:t=>e({quantity:t}),reset:()=>e({name:"",barcode:"",category_id:"",category_name:"",price:"",quantity:""})}))},13904:(e,t,a)=>{a.d(t,{default:()=>C});var r=a(95155),n=a(12115),l=a(22544),s=a(72377),o=a(66942),i=a(6191),d=a(47943),c=a(13501),u=a(54636),g=a(31342),m=a(36764),f=a(67931),p=a(83303),h=a(51834),v=a(65142),x=a(76444),y=a(3998),b=a(6259),j=a(17037);let w=e=>{var t,a,r,n,l;return null!=(l=null!=(n=null!=(r=null!=(a=null!=(t=null==e?void 0:e.id)?t:null==e?void 0:e._id)?a:null==e?void 0:e.category_id)?r:null==e?void 0:e.categoryId)?n:null==e?void 0:e.ID)?l:null},N=s.Ik({name:s.Yj().min(1,"Product name is required"),barcode:s.vk(e=>null==e?"":String(e),s.Yj().min(1,"Barcode is required").regex(/^\d+$/,"Barcode must contain only digits")),category_id:s.vk(e=>{if(null==e||""===e)return;let t=Number(e);return Number.isNaN(t)?void 0:t},s.ai().positive("Please select a category")),price:s.vk(e=>{if(null==e||""===e)return;let t=Number(e);return Number.isNaN(t)?void 0:t},s.ai().nonnegative("Price must be >= 0")),quantity:s.vk(e=>{if(null==e||""===e)return;let t=Number(e);return Number.isNaN(t)?void 0:t},s.ai().nonnegative("Quantity must be >= 0"))});function C(){var e,t;let{open:a,setOpen:s,barcode:C,setBarcode:S,openModal:A}=(0,d.c)(),k=(0,c.U)(e=>e.name),_=(0,c.U)(e=>e.barcode),P=(0,c.U)(e=>e.category_id),E=(0,c.U)(e=>e.category_name),F=(0,c.U)(e=>e.price),q=(0,c.U)(e=>e.quantity),L=(0,c.U)(e=>e.setName),O=(0,c.U)(e=>e.setBarcode),U=(0,c.U)(e=>e.setCategoryId),z=(0,c.U)(e=>e.setCategoryName),B=(0,c.U)(e=>e.setPrice),I=(0,c.U)(e=>e.setQuantity),J=(0,c.U)(e=>e.reset),{addProduct:$,loading:M,error:T,reset:Q}=function(){let[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)(null),[l,s]=(0,n.useState)(!1),{products:o}=(0,f.Q)();return{addProduct:async e=>{t(!0),r(null),s(!1);try{var a,n,l;let i=null!=(a=e.barcode)?a:"",d=(null!=(n=e.name)?n:"").trim().toLowerCase(),c=new Set((null!=o?o:[]).map(e=>String(e.barcode))),u=new Set((null!=o?o:[]).map(e=>(e.name||"").trim().toLowerCase()));if(i&&c.has(String(i)))return r({field:"barcode",message:"Barcode already exists. Please use a unique barcode."}),t(!1),null;if(d&&u.has(d))return r({field:"name",message:"Product name already exists. Please use a unique name."}),t(!1),null;let f="http://3.25.180.232:5000/api".replace(/\/$/,""),p=null;try{if(m.G&&"function"==typeof m.G.create)p=await m.G.create(e);else{let a=await fetch("".concat(f,"/products"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await a.json().catch(()=>({}));if(!a.ok){if(409===a.status||400===a.status)if((null==n?void 0:n.field)&&(null==n?void 0:n.message))r({field:n.field,message:n.message});else if(Array.isArray(null==n?void 0:n.errors)&&n.errors.length>0){let e=n.errors[0];r({field:e.field,message:e.message})}else r({message:(null==n?void 0:n.message)||"Duplicate or invalid data"});else r({message:(null==n?void 0:n.message)||"Failed to create product (".concat(a.status,")")});return t(!1),null}p=null!=(l=null==n?void 0:n.data)?l:n}}catch(e){if((null==e?void 0:e.response)&&"function"==typeof e.response.json){let t=await e.response.json().catch(()=>null);(null==t?void 0:t.field)&&(null==t?void 0:t.message)?r({field:t.field,message:t.message}):Array.isArray(null==t?void 0:t.errors)&&t.errors.length>0?r({field:t.errors[0].field,message:t.errors[0].message}):r({message:(null==t?void 0:t.message)||"Failed to add product"})}else{let t=(null==e?void 0:e.message)||String(e);t.toLowerCase().includes("barcode")?r({field:"barcode",message:t}):t.toLowerCase().includes("name")?r({field:"name",message:t}):r({message:t})}return t(!1),null}if(!p)return t(!1),r({message:"Failed to add product"}),null;try{await (0,g.j)(m.b,e=>{let t=(null!=e?e:[]).filter(e=>e.id!==p.id);return[p,...t]},!1)}catch(e){}return(0,g.j)(m.b),s(!0),t(!1),p}catch(e){return r({message:(null==e?void 0:e.message)||"Failed to add product"}),s(!1),t(!1),null}},loading:e,error:a,success:l,reset:()=>{r(null),s(!1)}}}(),{categories:D,loading:G,error:V}=(0,p.C)(),{refetch:R}=(0,f.Q)(),[Y,H]=(0,n.useState)(""),[X,Z]=(0,n.useState)(null),[K,W]=(0,n.useState)(null),{register:ee,handleSubmit:et,setValue:ea,reset:er,formState:{errors:en},setError:el}=(0,l.mN)({resolver:(0,o.u)(N),defaultValues:{name:"",barcode:"",category_id:void 0,price:void 0,quantity:void 0}}),es=(0,n.useMemo)(()=>{if(!D)return[];let e=Y.trim().toLowerCase();return e?D.filter(t=>((null==t?void 0:t.name)||"").toLowerCase().includes(e)):D},[D,Y]),eo=(0,n.useMemo)(()=>{if(D)return D.find(e=>String(w(e))===String(P))},[D,P]),ei=null!=(t=null!=(e=null==eo?void 0:eo.name)?e:E)?t:"";(0,n.useEffect)(()=>{if(!a){J(),null==Q||Q(),er(),W(null);return}er({name:k||"",barcode:_||"",category_id:P?Number(P):void 0,price:""===F?void 0:Number(F),quantity:""===q?void 0:Number(q)}),C&&C!==_&&(O(C),ea("barcode",C),"function"==typeof S&&S(""))},[a]),(0,n.useEffect)(()=>{W(null),T&&(T.field?el(T.field,{message:T.message,type:"server"}):W(T.message))},[T,el]);let ed=(0,n.useCallback)((e,t)=>{switch(e){case"name":return L(t);case"barcode":return O(t);case"price":return B(t);case"quantity":return I(t);default:return}},[L,O,B,I]),ec=(0,n.useCallback)(e=>{let t=w(e);U(null!=t?t:""),z(""),H(""),ea("category_id",t,{shouldValidate:!0})},[U,z,ea]),eu=async e=>{var t,a,r,n,l,o;W(null),L(e.name),O(null!=(t=e.barcode)?t:""),U(String(null!=(a=e.category_id)?a:"")),B(String(null!=(r=e.price)?r:"")),I(String(null!=(n=e.quantity)?n:""));let i=await $(e);if(i){s(!1);try{window.dispatchEvent(new CustomEvent("product:added",{detail:{product:null!=(l=null==i?void 0:i.data)?l:i,barcode:null!=(o=e.barcode)?o:""}}))}catch(e){}er(),J();try{null==R||R().catch(()=>{})}catch(e){}Z("Product added successfully"),window.setTimeout(()=>Z(null),3e3)}},eg=(0,n.useCallback)(()=>{Z(null);try{window.dispatchEvent(new Event("focusBarcodeScanner"))}catch(e){}},[]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.lG,{open:a,onOpenChange:s,children:(0,r.jsxs)(h.Cf,{children:[(0,r.jsxs)(h.c7,{children:[(0,r.jsx)(h.L3,{children:"Product"}),(0,r.jsx)(h.rr,{children:"Fill in the details below to add a new product."})]}),(0,r.jsxs)("div",{className:"flex-col gap-4",children:[K&&(0,r.jsx)("p",{className:"text-sm text-red-500 mb-2",children:K}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(x.J,{htmlFor:"name-1",children:"Product Name"}),(0,r.jsx)(v.p,{id:"name-1",...ee("name"),onChange:e=>{var t,a;null==(t=(a=ee("name")).onChange)||t.call(a,e),ed("name",e.target.value)}}),en.name&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:en.name.message})]}),(0,r.jsxs)("div",{className:"flex flex-row gap-2 mt-4",children:[(0,r.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,r.jsx)(x.J,{htmlFor:"barcode-1",children:"Barcode"}),(0,r.jsx)(v.p,{id:"barcode-1",...ee("barcode"),onChange:e=>{ea("barcode",e.target.value),ed("barcode",e.target.value)}}),en.barcode&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:en.barcode.message})]}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,r.jsx)(x.J,{htmlFor:"category-1",children:"Category"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(b.rI,{children:[(0,r.jsx)(b.ty,{asChild:!0,children:(0,r.jsx)(v.p,{id:"category-1",readOnly:!0,value:ei,placeholder:"Select category",className:"cursor-pointer"})}),(0,r.jsxs)(b.SQ,{className:"w-64 p-0",children:[(0,r.jsx)("div",{className:"p-2",children:(0,r.jsx)(v.p,{placeholder:"Search category...",value:Y,onChange:e=>H(e.target.value),className:"mb-2"})}),G&&(0,r.jsx)("div",{className:"p-2 text-gray-400",children:"Loading..."}),V&&(0,r.jsx)("div",{className:"p-2 text-red-500",children:V}),!G&&!V&&(0,r.jsx)(j.F,{className:"h-40",children:(0,r.jsxs)("div",{className:"p-2",children:[es.map(e=>{let t=String(w(e));return(0,r.jsx)(b._2,{onClick:()=>ec(e),children:e.name},t)}),0===es.length&&(0,r.jsx)("div",{className:"p-2 text-gray-400",children:"No categories found."})]})})]})]}),(0,r.jsx)(y.$,{variant:"outline",size:"icon",onClick:()=>"function"==typeof A?A("addCategory"):null,"aria-label":"Add Category",children:(0,r.jsx)(i.A,{className:"w-4 h-4"})})]}),en.category_id&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:en.category_id.message})]})]}),(0,r.jsxs)("div",{className:"flex flex-row gap-2 my-4",children:[(0,r.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,r.jsx)(x.J,{htmlFor:"price-1",children:"Price"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 pointer-events-none",children:"₱"}),(0,r.jsx)(v.p,{id:"price-1",type:"number",...ee("price"),onChange:e=>{let t=e.target.value;ea("price",""===t?void 0:Number(t),{shouldValidate:!0}),ed("price",t)},className:"pl-8"})]}),en.price&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:en.price.message})]}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,r.jsx)(x.J,{htmlFor:"quantity-1",children:"Quantity"}),(0,r.jsx)(v.p,{id:"quantity-1",type:"number",...ee("quantity"),onChange:e=>{let t=e.target.value;ea("quantity",""===t?void 0:Number(t),{shouldValidate:!0}),ed("quantity",t)}}),en.quantity&&(0,r.jsx)("p",{className:"text-sm text-red-500 mt-1",children:en.quantity.message})]})]})]}),(0,r.jsxs)(h.Es,{children:[(0,r.jsx)(h.HM,{asChild:!0,children:(0,r.jsx)(y.$,{variant:"outline",children:"Cancel"})}),(0,r.jsx)(y.$,{onClick:et(eu),disabled:M,children:M?"Adding...":"Add Product"})]})]})}),(0,r.jsx)(u.A,{}),X&&(0,r.jsx)("div",{className:"fixed bottom-6 right-6 z-50 bg-green-600 text-white px-4 py-2 rounded shadow-lg cursor-pointer",role:"status","aria-live":"polite",onClick:eg,children:X})]})}},17037:(e,t,a)=>{a.d(t,{F:()=>s});var r=a(95155);a(12115);var n=a(77062),l=a(64269);function s(e){let{className:t,children:a,...s}=e;return(0,r.jsxs)(n.bL,{"data-slot":"scroll-area",className:(0,l.cn)("relative",t),...s,children:[(0,r.jsx)(n.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),(0,r.jsx)(o,{}),(0,r.jsx)(n.OK,{})]})}function o(e){let{className:t,orientation:a="vertical",...s}=e;return(0,r.jsx)(n.VM,{"data-slot":"scroll-area-scrollbar",orientation:a,className:(0,l.cn)("flex touch-none p-px transition-colors select-none","vertical"===a&&"h-full w-2.5 border-l border-l-transparent","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent",t),...s,children:(0,r.jsx)(n.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}},36764:(e,t,a)=>{a.d(t,{G:()=>m,b:()=>n});var r=a(31342);let n="/products",l="http://3.25.180.232:5000/api".replace(/\/$/,""),s=new Map,o="pos:barcode-cache",i=null;function d(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function c(){try{i&&clearTimeout(i),i=window.setTimeout(()=>{try{let e={};s.forEach((t,a)=>{e[a]=t}),window.localStorage.setItem(o,JSON.stringify(e))}catch(e){}finally{i=null}},500)}catch(e){}}function u(e){if(!e||!e.barcode)return;let t=String(e.barcode);s.set(t,{product:e,ts:Date.now()}),c()}function g(e){try{let a=!1;for(let[r,n]of Array.from(s.entries())){var t;(null==n||null==(t=n.product)?void 0:t.id)===e&&(s.delete(r),a=!0)}a&&c()}catch(e){}}try{!function(){try{let e=window.localStorage.getItem(o);if(!e)return;let t=JSON.parse(e);if(!d(t))return;Object.keys(t).forEach(e=>{let a=t[e];d(a)&&a.product&&"number"==typeof a.ts&&s.set(e,{product:a.product,ts:a.ts})})}catch(e){}}()}catch(e){}let m={async getAll(){try{var e;let t="".concat(l,"/products");console.debug("[productApi.getAll] fetching",t);let a=await fetch(t);if(console.debug("[productApi.getAll] status",a.status),!a.ok)return[];let r=await a.json().catch(()=>({data:[]}));return console.debug("[productApi.getAll] got",Array.isArray(r.data)?r.data.length:0,"items"),null!=(e=r.data)?e:[]}catch(e){return[]}},async create(e){let t=await fetch("".concat(l,"/products"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json().catch(()=>({data:null}));if(!t.ok)throw Error((null==a?void 0:a.error)||(null==a?void 0:a.message)||"Failed to create product: ".concat(t.status));let n=a.data;try{u(n)}catch(e){}try{(0,r.j)("/products",e=>(function(e,t){if(!e)return[t];if(Array.isArray(e))return[t,...e];if(d(e)&&Array.isArray(e.data)){var a;let r=e.data;return{...e,data:[t,...r],count:(null!=(a=e.count)?a:r.length)+1}}return e})(e,n),!1).catch(()=>{})}catch(e){}return n},async update(e,t){let a=await fetch("".concat(l,"/products/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await a.json().catch(()=>({data:null}));if(!a.ok)throw Error((null==s?void 0:s.error)||(null==s?void 0:s.message)||"Failed to update product: ".concat(a.status));let o=s.data;try{g(o.id)}catch(e){}try{u(o)}catch(e){}try{(0,r.j)(n,e=>e?Array.isArray(e)?e.map(e=>e.id===o.id?o:e):d(e)&&Array.isArray(e.data)?{...e,data:e.data.map(e=>e.id===o.id?o:e)}:e:e,!1).catch(()=>{}),(0,r.j)(["product",e],o,!1).catch(()=>{})}catch(e){}return o},async getById(e){try{var t;let a=await fetch("".concat(l,"/products/").concat(e));if(!a.ok){if(404===a.status)return null;throw Error("Failed to fetch product with id ".concat(e))}return null!=(t=(await a.json().catch(()=>({data:null}))).data)?t:null}catch(e){return null}},async delete(e){let t=await fetch("".concat(l,"/products/").concat(e),{method:"DELETE"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e&&e.error||e&&e.message||"Failed to delete product: ".concat(t.status))}try{(0,r.j)(n,t=>(function(e,t){if(!e)return e;if(Array.isArray(e))return e.filter(e=>e.id!==t);if(d(e)&&Array.isArray(e.data)){var a;let r=e.data.filter(e=>e.id!==t);return{...e,data:r,count:Math.max(0,(null!=(a=e.count)?a:e.data.length)-1)}}return e})(t,e),!1).catch(()=>{}),(0,r.j)(["product",e],null,!1).catch(()=>{})}catch(e){}try{g(e)}catch(e){}},async getByBarcode(e){var t,a;if(!e)return null;let r=e=>String(e).replace(/[\u0000-\u001F\u007F-\u009F]/g,"").trim(),n=r(e);if(!n)return null;let o=encodeURIComponent(n),i="".concat(l,"/products/barcode/").concat(o),d="".concat(l,"/products?barcode=").concat(o);try{let e=await fetch(i);if(404===e.status)return null;if(e.ok){let a=await e.json().catch(()=>({data:null})),r=null!=(t=null==a?void 0:a.data)?t:null;if(r){try{u(r)}catch(e){}return r}}}catch(e){}try{let e=function(e){if(!e)return null;let t=String(e),a=s.get(t);return a?Date.now()-a.ts>3e5?(s.delete(t),c(),null):a.product:null}(n);if(e)return e}catch(e){}try{let e=await fetch(d);if(!e.ok)return null;let t=await e.json().catch(()=>({data:[]})),l=null!=(a=null==t?void 0:t.data)?a:[];if(0===l.length)return null;let s=l.find(e=>{var t;return r(null!=(t=null==e?void 0:e.barcode)?t:"")===n}),o=null!=s?s:l[0];try{u(o)}catch(e){}return o}catch(e){return null}}};try{window.addEventListener("beforeunload",()=>{try{!function(){try{let e={};s.forEach((t,a)=>{e[a]=t}),window.localStorage.setItem(o,JSON.stringify(e))}catch(e){}}()}catch(e){}})}catch(e){}},47943:(e,t,a)=>{a.d(t,{ProductModalProvider:()=>s,c:()=>o});var r=a(95155),n=a(12115);let l=(0,n.createContext)({activeModals:[],activeModal:null,isOpen:()=>!1,modalProps:void 0,openModal:()=>{},closeModal:()=>{},open:!1,setOpen:()=>{},barcode:"",setBarcode:()=>{}}),s=e=>{let{children:t}=e,[a,s]=(0,n.useState)([]),[o,i]=(0,n.useState)(void 0),[d,c]=(0,n.useState)(""),u=(e,t)=>{s(t=>t.includes(e)?t:[...t,e]),i(a=>({...a||{},[e]:t}))},g=e=>{"string"==typeof e?(s(t=>t.filter(t=>t!==e)),i(t=>{if(!t)return t;let a={...t};return delete a[e],Object.keys(a).length?a:void 0})):(s([]),i(void 0))},m=e=>a.includes(e),f=m("addProduct"),p=a.length?a[a.length-1]:null;return(0,r.jsx)(l.Provider,{value:{activeModals:a,activeModal:p,isOpen:m,modalProps:o,openModal:u,closeModal:g,open:f,setOpen:e=>{e?u("addProduct"):g("addProduct")},barcode:d,setBarcode:c},children:t})},o=()=>(0,n.useContext)(l)},51834:(e,t,a)=>{a.d(t,{Cf:()=>g,Es:()=>f,HM:()=>c,L3:()=>p,c7:()=>m,lG:()=>o,rr:()=>h,zM:()=>i});var r=a(95155);a(12115);var n=a(89511),l=a(65229),s=a(64269);function o(e){let{...t}=e;return(0,r.jsx)(n.bL,{"data-slot":"dialog",...t})}function i(e){let{...t}=e;return(0,r.jsx)(n.l9,{"data-slot":"dialog-trigger",...t})}function d(e){let{...t}=e;return(0,r.jsx)(n.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{...t}=e;return(0,r.jsx)(n.bm,{"data-slot":"dialog-close",...t})}function u(e){let{className:t,...a}=e;return(0,r.jsx)(n.hJ,{"data-slot":"dialog-overlay",className:(0,s.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function g(e){let{className:t,children:a,showCloseButton:o=!0,...i}=e;return(0,r.jsxs)(d,{"data-slot":"dialog-portal",children:[(0,r.jsx)(u,{}),(0,r.jsxs)(n.UC,{"data-slot":"dialog-content",className:(0,s.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...i,children:[a,o&&(0,r.jsxs)(n.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,r.jsx)(l.A,{}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"dialog-header",className:(0,s.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function f(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"dialog-footer",className:(0,s.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function p(e){let{className:t,...a}=e;return(0,r.jsx)(n.hE,{"data-slot":"dialog-title",className:(0,s.cn)("text-lg leading-none font-semibold",t),...a})}function h(e){let{className:t,...a}=e;return(0,r.jsx)(n.VY,{"data-slot":"dialog-description",className:(0,s.cn)("text-muted-foreground text-sm",t),...a})}},54636:(e,t,a)=>{a.d(t,{A:()=>h});var r=a(95155),n=a(12115),l=a(18720),s=a(68371),o=a(46512),i=a(31342),d=a(3998),c=a(51834),u=a(65142),g=a(76444),m=a(47943),f=a(95704),p=a(13501);function h(){let{isOpen:e,closeModal:t}=(0,m.c)(),{addCategory:a,loading:h,error:v}=(()=>{let[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)(null);return{addCategory:async(e,a)=>{var n,l,s,o,i,d,c,u;t(!0),r(null);let g=null!=(l=null!=(n=f.env.NEXT_PUBLIC_API_URL)?n:"http://3.25.180.232:5000/api")?l:"",m=String(g).trim();console.log("useAddCategory: raw env value:",g),(m=(m=(m=m.replace(/^["']|["']$/g,"")).replace(/\/+$/g,"")).replace(/\/api$/i,""))?/^https?:\/\//i.test(m)||(m=m.startsWith(":")?"http://localhost".concat(m):"http://".concat(m)):m="";let p=m?"".concat(m,"/api/categories"):"/api/categories";console.log("useAddCategory: POST url:",p,"payload:",e);try{let r=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e="";try{let t=r.clone();e=await t.text()}catch(t){e="<could not read response body>"}console.error("useAddCategory: non-ok response",{url:p,status:r.status,body:e});let t="Request failed with status ".concat(r.status);try{let e=await r.json();t=null!=(c=null!=(d=null!=(i=null==e?void 0:e.message)?i:null==e?void 0:e.error)?d:null==e||null==(o=e.data)?void 0:o.message)?c:t}catch(e){}throw Error(t)}let n=await r.json();console.log("useAddCategory: success response json:",n);let l=null!=(u=null==n?void 0:n.data)?u:n;return null==a||null==(s=a.onSuccess)||s.call(a,l),t(!1),l}catch(e){throw console.error("useAddCategory: caught error",e),r(e instanceof Error?e.message:"Failed to create category"),t(!1),e}},loading:e,error:a}})(),x=(0,p.U)(e=>e.setCategoryId),y=(0,p.U)(e=>e.setCategoryName),[b,j]=(0,n.useState)(""),{data:w=[]}=(0,o.Ay)(s.P),[N,C]=(0,n.useState)(null),[S,A]=(0,n.useState)(!1);(0,n.useEffect)(()=>{e("addCategory")||(j(""),A(!1))},[e]),(0,n.useEffect)(()=>{let e=b.trim();if(!e)return void C("Name is required");C(w.some(t=>{var a;return String(null!=(a=null==t?void 0:t.name)?a:"").toLowerCase()===e.toLowerCase()})?"Category with this name already exists":null)},[b,w]);let k=(0,n.useCallback)(async e=>{e.preventDefault(),A(!0);let r=b.trim();if(!r)return void C("Category name is required");if(w.some(e=>{var t;return String(null!=(t=null==e?void 0:e.name)?t:"").toLowerCase()===r.toLowerCase()}))return void C("Category with this name already exists");try{await a({name:r},{onSuccess:e=>{var a,r,n;let o=null!=(a=null==e?void 0:e.data)?a:e;if(!o)return;(0,i.j)(s.P,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.some(e=>String(null==e?void 0:e.id)===String(null==o?void 0:o.id))?e:[o,...e]},!1),(0,i.j)(s.P);let d=null!=(r=null==o?void 0:o.id)?r:null==o?void 0:o._id,c=null!=(n=null==o?void 0:o.name)?n:"";null!=d?(x(String(d)),y(c)):(0,l.oR)("Category added",{description:"Added but ID was not returned."}),t("addCategory"),(0,l.oR)("Category added",{description:c||"New category created."})}})}catch(e){var n;(0,l.oR)("Failed to add category",{description:null!=(n=null==e?void 0:e.message)?n:"An error occurred."})}},[b,a,x,y,t]);return(0,r.jsx)(c.lG,{open:e("addCategory"),onOpenChange:e=>{e||t("addCategory")},children:(0,r.jsx)(c.Cf,{className:"sm:max-w-[420px]",children:(0,r.jsxs)("form",{onSubmit:k,children:[(0,r.jsxs)(c.c7,{children:[(0,r.jsx)(c.L3,{children:"Add Category"}),(0,r.jsx)(c.rr,{children:"Fill in the details below to add a new category."})]}),(0,r.jsxs)("div",{className:"grid gap-4",children:[(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(g.J,{htmlFor:"category-name",children:"Name"}),(0,r.jsx)(u.p,{id:"category-name",value:b,onChange:e=>j(e.target.value),placeholder:"Category name",required:!0,autoFocus:!0})]}),v&&(0,r.jsx)("div",{className:"text-sm text-red-600",children:v})]}),(0,r.jsx)(c.Es,{className:"mt-2",children:(0,r.jsxs)("div",{className:" flex flex-col w-full gap-2",children:[(0,r.jsxs)("div",{className:"flex justify-start",children:[S&&N&&(0,r.jsx)("div",{className:"text-sm text-red-600",children:N}),v&&(0,r.jsx)("div",{className:"text-sm text-red-600",children:v})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)(d.$,{variant:"outline",type:"button",onClick:()=>t("addCategory"),children:"Cancel"}),(0,r.jsx)(d.$,{type:"submit",disabled:h||!b.trim(),children:h?"Saving...":"Save"})]})]})})]})})})}},64269:(e,t,a)=>{a.d(t,{cn:()=>l});var r=a(2821),n=a(75889);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.QP)((0,r.$)(t))}},65142:(e,t,a)=>{a.d(t,{p:()=>l});var r=a(95155);a(12115);var n=a(64269);function l(e){let{className:t,type:a,...l}=e;return(0,r.jsx)("input",{type:a,"data-slot":"input",className:(0,n.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...l})}},67931:(e,t,a)=>{a.d(t,{Q:()=>s});var r=a(46512),n=a(36764);let l=async()=>{try{return await n.G.getAll()}catch(e){return[]}},s=()=>{let{data:e,error:t,isLoading:a,mutate:n}=(0,r.Ay)("/products",l,{revalidateOnFocus:!0});return{products:null!=e?e:[],loading:!!a,error:t?t.message:null,refetch:n}}},68371:(e,t,a)=>{a.d(t,{B:()=>l,P:()=>n});let r=String("http://3.25.180.232:5000/api").replace(/^["']|["']$/g,"").replace(/\/+$/g,""),n=r?"".concat(r,"/categories"):"/categories",l={async getAll(){var e;let t=await fetch(n);if(!t.ok)throw Error("Failed to fetch categories: ".concat(t.status));let a=await t.json();return null!=(e=null==a?void 0:a.data)?e:[]}}},76444:(e,t,a)=>{a.d(t,{J:()=>s});var r=a(95155);a(12115);var n=a(10489),l=a(64269);function s(e){let{className:t,...a}=e;return(0,r.jsx)(n.b,{"data-slot":"label",className:(0,l.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}},83303:(e,t,a)=>{a.d(t,{C:()=>s});var r=a(46512),n=a(31342),l=a(68371);let s=()=>{let{data:e,error:t,mutate:a}=(0,r.Ay)(l.P,()=>l.B.getAll(),{revalidateOnFocus:!0});return{categories:null!=e?e:[],loading:!t&&!e,error:t?t.message:null,refetch:a,mutate:n.j}}}}]);