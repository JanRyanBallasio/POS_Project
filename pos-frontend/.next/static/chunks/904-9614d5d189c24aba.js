"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[904],{3998:(e,t,r)=>{r.d(t,{$:()=>i,r:()=>s});var a=r(95155);r(12115);var n=r(32467),l=r(83101),o=r(64269);let s=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function i(e){let{className:t,variant:r,size:l,asChild:i=!1,...d}=e,c=i?n.DX:"button";return(0,a.jsx)(c,{"data-slot":"button",className:(0,o.cn)(s({variant:r,size:l,className:t})),...d})}},6259:(e,t,r)=>{r.d(t,{SQ:()=>i,_2:()=>d,mB:()=>c,rI:()=>o,ty:()=>s});var a=r(95155);r(12115);var n=r(95736),l=r(64269);function o(e){let{...t}=e;return(0,a.jsx)(n.bL,{"data-slot":"dropdown-menu",...t})}function s(e){let{...t}=e;return(0,a.jsx)(n.l9,{"data-slot":"dropdown-menu-trigger",...t})}function i(e){let{className:t,sideOffset:r=4,...o}=e;return(0,a.jsx)(n.ZL,{children:(0,a.jsx)(n.UC,{"data-slot":"dropdown-menu-content",sideOffset:r,className:(0,l.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...o})})}function d(e){let{className:t,inset:r,variant:o="default",...s}=e;return(0,a.jsx)(n.q7,{"data-slot":"dropdown-menu-item","data-inset":r,"data-variant":o,className:(0,l.cn)("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}function c(e){let{className:t,...r}=e;return(0,a.jsx)(n.wv,{"data-slot":"dropdown-menu-separator",className:(0,l.cn)("bg-border -mx-1 my-1 h-px",t),...r})}},12466:(e,t,r)=>{r.d(t,{A:()=>u,t:()=>o});var a=r(95125),n=r(60919),l=r(13297);let o="http://3.107.238.186:5000/api",s=a.A.create({baseURL:o,withCredentials:!0,timeout:15e3,headers:{"Content-Type":"application/json"}}),i=!1,d=null;s.interceptors.request.use(e=>{try{let t=(e.url||"").toString();if(t.includes("/auth/login")||t.includes("/auth/register"))return e;let r=(0,l.iD)();r&&e.headers&&(e.headers.Authorization="Bearer ".concat(r))}catch(e){console.warn("Token retrieval error:",e)}return e});let c=async()=>{try{var e;let t=null==(e=(await s.post("/auth/refresh")).data)?void 0:e.accessToken;if(t)return(0,l.ki)(t),t;throw Error("No access token received")}catch(e){throw(0,l.q0)(),window.location.href="/login",e}};s.interceptors.response.use(e=>e,async e=>{var t,r;let a=e.config;if(!a)return Promise.reject(e);if((0,n.F0)(e)&&(null==(t=e.response)?void 0:t.status)===401&&!(null==(r=a.url)?void 0:r.includes("/auth/"))){if(a._retry)return(0,l.q0)(),window.location.href="/login",Promise.reject(e);a._retry=!0,i||(i=!0,d=c().finally(()=>{i=!1,d=null}));try{let e=await d;if(e&&a.headers)return a.headers.Authorization="Bearer ".concat(e),s(a)}catch(e){return Promise.reject(e)}}return Promise.reject(e)});let u=s},13297:(e,t,r)=>{r.d(t,{gV:()=>i,gm:()=>u,iD:()=>s,ki:()=>o,q0:()=>c,wz:()=>d});let a=null,n=null,l=0;function o(e){try{a=e,l=Date.now(),e?localStorage.setItem("accessToken",e):localStorage.removeItem("accessToken")}catch(e){}}function s(){try{let e=Date.now();if(null!==a&&e-l<5e3)return a;return a=localStorage.getItem("accessToken"),l=e,a}catch(e){return null}}function i(e){try{n=e,l=Date.now(),e?localStorage.setItem("user",JSON.stringify(e)):localStorage.removeItem("user")}catch(e){}}function d(){try{let e=Date.now();if(null!==n&&e-l<5e3)return n;let t=localStorage.getItem("user");return n=t?JSON.parse(t):null,l=e,n}catch(e){return null}}function c(){try{a=null,n=null,l=0,localStorage.removeItem("accessToken"),localStorage.removeItem("user")}catch(e){}}function u(){a=null,n=null,l=0}},13501:(e,t,r)=>{r.d(t,{U:()=>a});let a=(0,r(25959).v)(e=>({name:"",barcode:"",category_id:"",category_name:"",price:"",quantity:"",setName:t=>e({name:t}),setBarcode:t=>e({barcode:t}),setCategoryId:t=>e({category_id:t}),setCategoryName:t=>e({category_name:t}),setPrice:t=>e({price:t}),setQuantity:t=>e({quantity:t}),reset:()=>e({name:"",barcode:"",category_id:"",category_name:"",price:"",quantity:""})}))},13904:(e,t,r)=>{r.d(t,{default:()=>k});var a=r(95155),n=r(12115),l=r(22544),o=r(72377),s=r(66942),i=r(6191),d=r(47943),c=r(13501),u=r(54636),g=r(63769),m=r(31342),v=r(36764);let f="products:list";var h=r(67931),p=r(89234),x=r(51834),y=r(65142),b=r(76444),j=r(3998),w=r(6259),N=r(17037);let C=e=>{var t,r,a,n,l;return null!=(l=null!=(n=null!=(a=null!=(r=null!=(t=null==e?void 0:e.id)?t:null==e?void 0:e._id)?r:null==e?void 0:e.category_id)?a:null==e?void 0:e.categoryId)?n:null==e?void 0:e.ID)?l:null},S=o.Ik({name:o.Yj().min(1,"Product name is required"),barcode:o.vk(e=>null==e?"":String(e),o.Yj().min(1,"Barcode is required").regex(/^\d+$/,"Barcode must contain only digits")),category_id:o.vk(e=>{if(null==e||""===e)return;let t=Number(e);return Number.isNaN(t)?void 0:t},o.ai().positive("Please select a category")),price:o.vk(e=>{if(null==e||""===e)return;let t=Number(e);return Number.isNaN(t)?void 0:t},o.ai().nonnegative("Price must be >= 0")),quantity:o.vk(e=>{if(null==e||""===e)return;let t=Number(e);return Number.isNaN(t)?void 0:t},o.ai().nonnegative("Quantity must be >= 0"))});function k(){var e,t;let{open:r,setOpen:o,barcode:k,setBarcode:A,openModal:_}=(0,d.c)(),F=(0,c.U)(e=>e.name),q=(0,c.U)(e=>e.barcode),E=(0,c.U)(e=>e.category_id),z=(0,c.U)(e=>e.category_name),I=(0,c.U)(e=>e.price),P=(0,c.U)(e=>e.quantity),L=(0,c.U)(e=>e.setName),U=(0,c.U)(e=>e.setBarcode),O=(0,c.U)(e=>e.setCategoryId),B=(0,c.U)(e=>e.setCategoryName),M=(0,c.U)(e=>e.setPrice),J=(0,c.U)(e=>e.setQuantity),D=(0,c.U)(e=>e.reset),{addProduct:G,loading:Q,error:T,reset:V}=function(){let[e,t]=(0,n.useState)(!1),[r,a]=(0,n.useState)(null),[l,o]=(0,n.useState)(!1);return{addProduct:async e=>{t(!0),a(null),o(!1);try{let r=await v.G.create(e);return(0,m.j)(f,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[r,...e]},!1),window.dispatchEvent(new CustomEvent("product:added",{detail:{product:r}})),o(!0),t(!1),(0,m.j)(f),r}catch(r){let e=(null==r?void 0:r.message)||"Failed to add product";return e.toLowerCase().includes("barcode")?a({field:"barcode",message:e}):e.toLowerCase().includes("name")?a({field:"name",message:e}):a({message:e}),t(!1),null}},loading:e,error:r,success:l,reset:()=>{a(null),o(!1)}}}(),{categories:$,loading:R,error:Y}=(0,p.C)(),{refetch:H}=(0,h.Q)(),[Z,K]=(0,n.useState)(""),[X,W]=(0,n.useState)(null),{register:ee,handleSubmit:et,setValue:er,reset:ea,formState:{errors:en},setError:el}=(0,l.mN)({resolver:(0,s.u)(S),defaultValues:{name:"",barcode:"",category_id:void 0,price:void 0,quantity:void 0}}),eo=(0,n.useMemo)(()=>{if(!$)return[];let e=Z.trim().toLowerCase();return e?$.filter(t=>((null==t?void 0:t.name)||"").toLowerCase().includes(e)):$},[$,Z]),es=(0,n.useMemo)(()=>{if($)return $.find(e=>String(C(e))===String(E))},[$,E]),ei=null!=(t=null!=(e=null==es?void 0:es.name)?e:z)?t:"";(0,n.useEffect)(()=>{if(!r){D(),null==V||V(),ea(),W(null);return}ea({name:F||"",barcode:q||"",category_id:E?Number(E):void 0,price:""===I?void 0:Number(I),quantity:""===P?void 0:Number(P)}),k&&k!==q&&(U(k),er("barcode",k),"function"==typeof A&&A(""))},[r]),(0,n.useEffect)(()=>{W(null),T&&(T.field?el(T.field,{message:T.message,type:"server"}):W(T.message))},[T,el]);let ed=(0,n.useCallback)((e,t)=>{switch(e){case"name":return L(t);case"barcode":return U(t);case"price":return M(t);case"quantity":return J(t);default:return}},[L,U,M,J]),ec=(0,n.useCallback)(e=>{let t=C(e);O(null!=t?t:""),B(""),K(""),er("category_id",t,{shouldValidate:!0})},[O,B,er]),eu=async e=>{var t,r,a,n,l,s;W(null),L(e.name),U(null!=(t=e.barcode)?t:""),O(String(null!=(r=e.category_id)?r:"")),M(String(null!=(a=e.price)?a:"")),J(String(null!=(n=e.quantity)?n:""));let i=await G(e);if(i){o(!1);try{window.dispatchEvent(new CustomEvent("product:added",{detail:{product:null!=(l=null==i?void 0:i.data)?l:i,barcode:null!=(s=e.barcode)?s:""}}))}catch(e){}ea(),D();try{null==H||H().catch(()=>{})}catch(e){}(0,g.GF)("Product added successfully","".concat(e.name," has been added to inventory."));try{window.dispatchEvent(new Event("focusBarcodeScanner"))}catch(e){}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.lG,{open:r,onOpenChange:o,children:(0,a.jsxs)(x.Cf,{children:[(0,a.jsxs)(x.c7,{children:[(0,a.jsx)(x.L3,{children:"Product"}),(0,a.jsx)(x.rr,{children:"Fill in the details below to add a new product."})]}),(0,a.jsxs)("div",{className:"flex-col gap-4",children:[X&&(0,a.jsx)("p",{className:"text-sm text-red-500 mb-2",children:X}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(b.J,{htmlFor:"name-1",children:"Product Name"}),(0,a.jsx)(y.p,{id:"name-1",...ee("name"),onChange:e=>{var t,r;null==(t=(r=ee("name")).onChange)||t.call(r,e),ed("name",e.target.value)}}),en.name&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:en.name.message})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-2 mt-4",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,a.jsx)(b.J,{htmlFor:"barcode-1",children:"Barcode"}),(0,a.jsx)(y.p,{id:"barcode-1",...ee("barcode"),onChange:e=>{er("barcode",e.target.value),ed("barcode",e.target.value)}}),en.barcode&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:en.barcode.message})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,a.jsx)(b.J,{htmlFor:"category-1",children:"Category"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(w.rI,{children:[(0,a.jsx)(w.ty,{asChild:!0,children:(0,a.jsx)(y.p,{id:"category-1",readOnly:!0,value:ei,placeholder:"Select category",className:"cursor-pointer"})}),(0,a.jsxs)(w.SQ,{className:"w-64 p-0",children:[(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(y.p,{placeholder:"Search category...",value:Z,onChange:e=>K(e.target.value),className:"mb-2"})}),R&&(0,a.jsx)("div",{className:"p-2 text-gray-400",children:"Loading..."}),Y&&(0,a.jsx)("div",{className:"p-2 text-red-500",children:Y}),!R&&!Y&&(0,a.jsx)(N.F,{className:"h-40",children:(0,a.jsxs)("div",{className:"p-2",children:[eo.map(e=>{let t=String(C(e));return(0,a.jsx)(w._2,{onClick:()=>ec(e),children:e.name},t)}),0===eo.length&&(0,a.jsx)("div",{className:"p-2 text-gray-400",children:"No categories found."})]})})]})]}),(0,a.jsx)(j.$,{variant:"outline",size:"icon",onClick:()=>"function"==typeof _?_("addCategory"):null,"aria-label":"Add Category",children:(0,a.jsx)(i.A,{className:"w-4 h-4"})})]}),en.category_id&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:en.category_id.message})]})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-2 my-4",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,a.jsx)(b.J,{htmlFor:"price-1",children:"Price"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 pointer-events-none",children:"â‚±"}),(0,a.jsx)(y.p,{id:"price-1",type:"number",...ee("price"),onChange:e=>{let t=e.target.value;er("price",""===t?void 0:Number(t),{shouldValidate:!0}),ed("price",t)},className:"pl-8"})]}),en.price&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:en.price.message})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,a.jsx)(b.J,{htmlFor:"quantity-1",children:"Quantity"}),(0,a.jsx)(y.p,{id:"quantity-1",type:"number",...ee("quantity"),onChange:e=>{let t=e.target.value;er("quantity",""===t?void 0:Number(t),{shouldValidate:!0}),ed("quantity",t)}}),en.quantity&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:en.quantity.message})]})]})]}),(0,a.jsxs)(x.Es,{children:[(0,a.jsx)(x.HM,{asChild:!0,children:(0,a.jsx)(j.$,{variant:"outline",children:"Cancel"})}),(0,a.jsx)(j.$,{onClick:et(eu),disabled:Q,children:Q?"Adding...":"Add Product"})]})]})}),(0,a.jsx)(u.A,{})]})}},17037:(e,t,r)=>{r.d(t,{F:()=>o});var a=r(95155);r(12115);var n=r(77062),l=r(64269);function o(e){let{className:t,children:r,...o}=e;return(0,a.jsxs)(n.bL,{"data-slot":"scroll-area",className:(0,l.cn)("relative",t),...o,children:[(0,a.jsx)(n.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:r}),(0,a.jsx)(s,{}),(0,a.jsx)(n.OK,{})]})}function s(e){let{className:t,orientation:r="vertical",...o}=e;return(0,a.jsx)(n.VM,{"data-slot":"scroll-area-scrollbar",orientation:r,className:(0,l.cn)("flex touch-none p-px transition-colors select-none","vertical"===r&&"h-full w-2.5 border-l border-l-transparent","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent",t),...o,children:(0,a.jsx)(n.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}},36764:(e,t,r)=>{r.d(t,{G:()=>v});var a=r(31342),n=r(12466),l=r(60919);let o="products:list",s=new Map,i="pos:barcode-cache",d=null;function c(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function u(){try{d&&clearTimeout(d),d=window.setTimeout(()=>{try{let e={};s.forEach((t,r)=>{e[r]=t}),window.localStorage.setItem(i,JSON.stringify(e))}catch(e){}finally{d=null}},500)}catch(e){}}function g(e){if(!e||!e.barcode)return;if(s.size>=1e3){let e=s.keys().next().value;e&&s.delete(e)}let t=String(e.barcode);s.set(t,{product:e,ts:Date.now()}),u()}function m(e){try{let r=!1;for(let[a,n]of Array.from(s.entries())){var t;(null==n||null==(t=n.product)?void 0:t.id)===e&&(s.delete(a),r=!0)}r&&u()}catch(e){}}try{!function(){try{let e=window.localStorage.getItem(i);if(!e)return;let t=JSON.parse(e);if(!c(t))return;Object.keys(t).forEach(e=>{let r=t[e];c(r)&&r.product&&"number"==typeof r.ts&&s.set(e,{product:r.product,ts:r.ts})})}catch(e){}}()}catch(e){}let v={async getAll(){try{var e;let t=await n.A.get("/products");if(t.status>=400)return[];return null!=(e=t.data.data)?e:[]}catch(e){return[]}},async create(e){let t=await n.A.post("/products",e),r=t.data;if(t.status>=400)throw Error((null==r?void 0:r.error)||(null==r?void 0:r.message)||"Failed to create product: ".concat(t.status));let l=r.data;try{g(l)}catch(e){}try{(0,a.j)("/products",e=>(function(e,t){if(!e)return[t];if(Array.isArray(e))return[t,...e];if(c(e)&&Array.isArray(e.data)){var r;let a=e.data;return{...e,data:[t,...a],count:(null!=(r=e.count)?r:a.length)+1}}return e})(e,l),!1).catch(()=>{})}catch(e){}return l},async update(e,t){let r=await n.A.put("/products/".concat(e),t),l=r.data;if(r.status>=400)throw Error((null==l?void 0:l.error)||(null==l?void 0:l.message)||"Failed to update product: ".concat(r.status));let s=l.data;try{m(s.id)}catch(e){}try{g(s)}catch(e){}try{(0,a.j)(o,e=>e?Array.isArray(e)?e.map(e=>e.id===s.id?s:e):c(e)&&Array.isArray(e.data)?{...e,data:e.data.map(e=>e.id===s.id?s:e)}:e:e,!1).catch(()=>{}),(0,a.j)(["product",e],s,!1).catch(()=>{})}catch(e){}return s},async getById(e){try{var t;let r=await n.A.get("/products/".concat(e));if(r.status>=400){if(404===r.status)return null;throw Error("Failed to fetch product with id ".concat(e))}return null!=(t=r.data.data)?t:null}catch(e){return null}},async delete(e){let t=await n.A.delete("/products/".concat(e));if(t.status>=400){let e=t.data;throw Error(e&&e.error||e&&e.message||"Failed to delete product: ".concat(t.status))}try{(0,a.j)(o,t=>(function(e,t){if(!e)return e;if(Array.isArray(e))return e.filter(e=>e.id!==t);if(c(e)&&Array.isArray(e.data)){var r;let a=e.data.filter(e=>e.id!==t);return{...e,data:a,count:Math.max(0,(null!=(r=e.count)?r:e.data.length)-1)}}return e})(t,e),!1).catch(()=>{}),(0,a.j)(["product",e],null,!1).catch(()=>{})}catch(e){}try{m(e)}catch(e){}},async getByBarcode(e){var t,r;if(!e)return null;let a=String(e).replace(/[\u0000-\u001F\u007F-\u009F]/g,"").trim();if(!a)return null;try{let e=function(e){if(!e)return null;let t=String(e),r=s.get(t);return r?Date.now()-r.ts>18e5?(s.delete(t),u(),null):r.product:null}(a);if(e)return e}catch(e){}try{let e=await n.A.get("/products/barcode/".concat(encodeURIComponent(a)));if(200===e.status&&(null==(t=e.data)?void 0:t.data)){let t=e.data.data;try{g(t)}catch(e){}return t}return null}catch(e){return(0,l.F0)(e)&&(null==(r=e.response)?void 0:r.status)!==404&&console.warn("[productApi.getByBarcode] Network error:",e.message),null}}};try{window.addEventListener("beforeunload",()=>{try{let e={};s.forEach((t,r)=>{e[r]=t}),window.localStorage.setItem(i,JSON.stringify(e))}catch(e){}})}catch(e){}},47943:(e,t,r)=>{r.d(t,{ProductModalProvider:()=>o,c:()=>s});var a=r(95155),n=r(12115);let l=(0,n.createContext)({activeModals:[],activeModal:null,isOpen:()=>!1,modalProps:void 0,openModal:()=>{},closeModal:()=>{},open:!1,setOpen:()=>{},barcode:"",setBarcode:()=>{}}),o=e=>{let{children:t}=e,[r,o]=(0,n.useState)([]),[s,i]=(0,n.useState)(void 0),[d,c]=(0,n.useState)(""),u=(e,t)=>{o(t=>t.includes(e)?t:[...t,e]),i(r=>({...r||{},[e]:t}))},g=e=>{"string"==typeof e?(o(t=>t.filter(t=>t!==e)),i(t=>{if(!t)return t;let r={...t};return delete r[e],Object.keys(r).length?r:void 0})):(o([]),i(void 0))},m=e=>r.includes(e),v=m("addProduct"),f=r.length?r[r.length-1]:null;return(0,a.jsx)(l.Provider,{value:{activeModals:r,activeModal:f,isOpen:m,modalProps:s,openModal:u,closeModal:g,open:v,setOpen:e=>{e?u("addProduct"):g("addProduct")},barcode:d,setBarcode:c},children:t})},s=()=>(0,n.useContext)(l)},51834:(e,t,r)=>{r.d(t,{Cf:()=>g,Es:()=>v,HM:()=>c,L3:()=>f,c7:()=>m,lG:()=>s,rr:()=>h,zM:()=>i});var a=r(95155);r(12115);var n=r(89511),l=r(65229),o=r(64269);function s(e){let{...t}=e;return(0,a.jsx)(n.bL,{"data-slot":"dialog",...t})}function i(e){let{...t}=e;return(0,a.jsx)(n.l9,{"data-slot":"dialog-trigger",...t})}function d(e){let{...t}=e;return(0,a.jsx)(n.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{...t}=e;return(0,a.jsx)(n.bm,{"data-slot":"dialog-close",...t})}function u(e){let{className:t,...r}=e;return(0,a.jsx)(n.hJ,{"data-slot":"dialog-overlay",className:(0,o.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...r})}function g(e){let{className:t,children:r,showCloseButton:s=!0,...i}=e;return(0,a.jsxs)(d,{"data-slot":"dialog-portal",children:[(0,a.jsx)(u,{}),(0,a.jsxs)(n.UC,{"data-slot":"dialog-content",className:(0,o.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...i,children:[r,s&&(0,a.jsxs)(n.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(l.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:(0,o.cn)("flex flex-col gap-2 text-center sm:text-left",t),...r})}function v(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"dialog-footer",className:(0,o.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...r})}function f(e){let{className:t,...r}=e;return(0,a.jsx)(n.hE,{"data-slot":"dialog-title",className:(0,o.cn)("text-lg leading-none font-semibold",t),...r})}function h(e){let{className:t,...r}=e;return(0,a.jsx)(n.VY,{"data-slot":"dialog-description",className:(0,o.cn)("text-muted-foreground text-sm",t),...r})}},54636:(e,t,r)=>{r.d(t,{A:()=>h});var a=r(95155),n=r(12115),l=r(46512),o=r(31342),s=r(3998),i=r(51834),d=r(63769),c=r(65142),u=r(76444),g=r(47943),m=r(12466),v=r(13501);let f="categories:list";function h(){let{isOpen:e,closeModal:t}=(0,g.c)(),{addCategory:r,loading:h,error:p}=(()=>{let[e,t]=(0,n.useState)(!1),[r,a]=(0,n.useState)(null);return{addCategory:async(e,r)=>{var n,l,o,s,i,d;t(!0),a(null);try{let a=(await m.A.post("/categories",e)).data,o=null!=(l=null==a?void 0:a.data)?l:a;return null==r||null==(n=r.onSuccess)||n.call(r,o),t(!1),o}catch(e){throw a(null!=(d=null!=(i=null==e||null==(s=e.response)||null==(o=s.data)?void 0:o.message)?i:null==e?void 0:e.message)?d:"Failed to create category"),t(!1),e}},loading:e,error:r}})(),x=(0,v.U)(e=>e.setCategoryId),y=(0,v.U)(e=>e.setCategoryName),[b,j]=(0,n.useState)(""),{data:w=[]}=(0,l.Ay)(f),[N,C]=(0,n.useState)(null),[S,k]=(0,n.useState)(!1);(0,n.useEffect)(()=>{e("addCategory")||(j(""),k(!1))},[e]),(0,n.useEffect)(()=>{let e=b.trim();if(!e)return void C("Name is required");C(w.some(t=>{var r;return String(null!=(r=null==t?void 0:t.name)?r:"").toLowerCase()===e.toLowerCase()})?"Category with this name already exists":null)},[b,w]);let A=(0,n.useCallback)(async e=>{e.preventDefault(),k(!0);let a=b.trim();if(!a)return void C("Category name is required");if(w.some(e=>{var t;return String(null!=(t=null==e?void 0:e.name)?t:"").toLowerCase()===a.toLowerCase()}))return void C("Category with this name already exists");try{await r({name:a},{onSuccess:e=>{var r,a,n;let l=null!=(r=null==e?void 0:e.data)?r:e;if(!l)return;(0,o.j)(f,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.some(e=>String(null==e?void 0:e.id)===String(null==l?void 0:l.id))?e:[l,...e]},!1),(0,o.j)(f);let s=null!=(a=null==l?void 0:l.id)?a:null==l?void 0:l._id,i=null!=(n=null==l?void 0:l.name)?n:"";null!=s?(x(String(s)),y(i)):(0,d.GF)("Category added","Added but ID was not returned."),t("addCategory"),(0,d.GF)("Category added",i||"New category created.")}})}catch(e){var n;(0,d.Ni)("Failed to add category",null!=(n=null==e?void 0:e.message)?n:"An error occurred.")}},[b,r,x,y,t]);return(0,a.jsx)(i.lG,{open:e("addCategory"),onOpenChange:e=>{e||t("addCategory")},children:(0,a.jsx)(i.Cf,{className:"sm:max-w-[420px]",children:(0,a.jsxs)("form",{onSubmit:A,children:[(0,a.jsxs)(i.c7,{children:[(0,a.jsx)(i.L3,{children:"Add Category"}),(0,a.jsx)(i.rr,{children:"Fill in the details below to add a new category."})]}),(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(u.J,{htmlFor:"category-name",children:"Name"}),(0,a.jsx)(c.p,{id:"category-name",value:b,onChange:e=>j(e.target.value),placeholder:"Category name",required:!0,autoFocus:!0})]}),p&&(0,a.jsx)("div",{className:"text-sm text-red-600",children:p})]}),(0,a.jsx)(i.Es,{className:"mt-2",children:(0,a.jsxs)("div",{className:" flex flex-col w-full gap-2",children:[(0,a.jsxs)("div",{className:"flex justify-start",children:[S&&N&&(0,a.jsx)("div",{className:"text-sm text-red-600",children:N}),p&&(0,a.jsx)("div",{className:"text-sm text-red-600",children:p})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(s.$,{variant:"outline",type:"button",onClick:()=>t("addCategory"),children:"Cancel"}),(0,a.jsx)(s.$,{type:"submit",disabled:h||!b.trim(),children:h?"Saving...":"Save"})]})]})})]})})})}},63769:(e,t,r)=>{r.d(t,{GF:()=>o,Ni:()=>s});var a=r(18720);let n={"--normal-bg":"light-dark(var(--color-green-600), var(--color-green-400))","--normal-text":"var(--color-white)","--normal-border":"light-dark(var(--color-green-600), var(--color-green-400))"},l={"--normal-bg":"light-dark(var(--destructive), color-mix(in oklab, var(--destructive) 60%, var(--background)))","--normal-text":"var(--color-white)","--normal-border":"transparent"},o=(e,t)=>a.oR.success(e,{description:t,style:n}),s=(e,t)=>a.oR.error(e,{description:t,style:l})},64269:(e,t,r)=>{r.d(t,{cn:()=>l});var a=r(2821),n=r(75889);function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.QP)((0,a.$)(t))}},65142:(e,t,r)=>{r.d(t,{p:()=>l});var a=r(95155);r(12115);var n=r(64269);function l(e){let{className:t,type:r,...l}=e;return(0,a.jsx)("input",{type:r,"data-slot":"input",className:(0,n.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...l})}},67931:(e,t,r)=>{r.d(t,{Q:()=>o});var a=r(46512),n=r(36764);let l=async()=>{try{return await n.G.getAll()}catch(e){return[]}},o=()=>{let{data:e,error:t,isLoading:r,mutate:n}=(0,a.Ay)("products:list",l,{revalidateOnFocus:!1,revalidateOnReconnect:!0,dedupingInterval:1e4,errorRetryCount:2,refreshInterval:0,compare:(e,t)=>!e&&!t||!!e&&!!t&&e.length===t.length&&e.every((e,r)=>e.id===t[r].id&&e.name===t[r].name)});return{products:null!=e?e:[],loading:!!r,error:t?t.message:null,refetch:n}}},76444:(e,t,r)=>{r.d(t,{J:()=>o});var a=r(95155);r(12115);var n=r(10489),l=r(64269);function o(e){let{className:t,...r}=e;return(0,a.jsx)(n.b,{"data-slot":"label",className:(0,l.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...r})}},89234:(e,t,r)=>{r.d(t,{C:()=>i});var a=r(46512),n=r(31342),l=r(12466);let o={async getAll(){var e;let t=(await l.A.get("/categories")).data;return null!=(e=null==t?void 0:t.data)?e:[]}},s=async()=>{try{return await o.getAll()}catch(e){return[]}},i=()=>{let{data:e,error:t,isLoading:r,mutate:l}=(0,a.Ay)("categories:list",s,{revalidateOnFocus:!0});return{categories:null!=e?e:[],loading:!!r,error:t?t.message:null,refetch:l,mutate:n.j}}}}]);